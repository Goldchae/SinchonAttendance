/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var t={312:(t,e,n)=>{n.d(e,{us:()=>r});const r=1},783:(t,e,n)=>{var r=n(312);const s=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let s=t.charCodeAt(r);s<128?e[n++]=s:s<2048?(e[n++]=s>>6|192,e[n++]=63&s|128):55296==(64512&s)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(s=65536+((1023&s)<<10)+(1023&t.charCodeAt(++r)),e[n++]=s>>18|240,e[n++]=s>>12&63|128,e[n++]=s>>6&63|128,e[n++]=63&s|128):(e[n++]=s>>12|224,e[n++]=s>>6&63|128,e[n++]=63&s|128)}return e},i={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let e=0;e<t.length;e+=3){const s=t[e],i=e+1<t.length,o=i?t[e+1]:0,a=e+2<t.length,h=a?t[e+2]:0,c=s>>2,u=(3&s)<<4|o>>4;let l=(15&o)<<2|h>>6,d=63&h;a||(d=64,i||(l=64)),r.push(n[c],n[u],n[l],n[d])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(s(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const s=t[n++];if(s<128)e[r++]=String.fromCharCode(s);else if(s>191&&s<224){const i=t[n++];e[r++]=String.fromCharCode((31&s)<<6|63&i)}else if(s>239&&s<365){const i=((7&s)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(i>>10)),e[r++]=String.fromCharCode(56320+(1023&i))}else{const i=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&s)<<12|(63&i)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let e=0;e<t.length;){const s=n[t.charAt(e++)],i=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const h=e<t.length?n[t.charAt(e)]:64;if(++e,null==s||null==i||null==a||null==h)throw new o;const c=s<<2|i>>4;if(r.push(c),64!==a){const t=i<<4&240|a>>2;if(r.push(t),64!==h){const t=a<<6&192|h;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class o extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const a=function(t){return function(t){const e=s(t);return i.encodeByteArray(e,!0)}(t).replace(/\./g,"")},h=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return i.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},c=()=>{var t;return null===(t=h())||void 0===t?void 0:t.config};class u{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function l(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function d(){try{return"object"==typeof indexedDB}catch(t){return!1}}class f extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,f.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,g.prototype.create)}}class g{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,s=this.errors[t],i=s?function(t,e){return t.replace(p,((t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`}))}(s,n):"Error",o=`${this.serviceName}: ${i} (${r}).`;return new f(r,o,n)}}const p=/\{\$([^}]+)}/g;function m(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const s of n){if(!r.includes(s))return!1;const n=t[s],i=e[s];if(y(n)&&y(i)){if(!m(n,i))return!1}else if(n!==i)return!1}for(const t of r)if(!n.includes(t))return!1;return!0}function y(t){return null!==t&&"object"==typeof t}class v{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const w="[DEFAULT]";class E{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new u;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:w})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=w){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=w){return this.instances.has(t)}getOptions(t=w){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(r);return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),s=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;s.add(t),this.onInitCallbacks.set(r,s);const i=this.instances.get(r);return i&&t(i,r),()=>{s.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const r of n)try{r(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===w?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var r;return n||null}normalizeInstanceIdentifier(t=w){return this.component?this.component.multipleInstances?t:w:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class b{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new E(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const _=[];var T;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(T||(T={}));const S={debug:T.DEBUG,verbose:T.VERBOSE,info:T.INFO,warn:T.WARN,error:T.ERROR,silent:T.SILENT},C=T.INFO,I={[T.DEBUG]:"log",[T.VERBOSE]:"log",[T.INFO]:"info",[T.WARN]:"warn",[T.ERROR]:"error"},A=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),s=I[e];if(!s)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[s](`[${r}]  ${t.name}:`,...n)};class D{constructor(t){this.name=t,this._logLevel=C,this._logHandler=A,this._userLogHandler=null,_.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in T))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?S[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,T.DEBUG,...t),this._logHandler(this,T.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,T.VERBOSE,...t),this._logHandler(this,T.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,T.INFO,...t),this._logHandler(this,T.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,T.WARN,...t),this._logHandler(this,T.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,T.ERROR,...t),this._logHandler(this,T.ERROR,...t)}}const N=(t,e)=>e.some((e=>t instanceof e));let k,x;const R=new WeakMap,L=new WeakMap,O=new WeakMap,M=new WeakMap,P=new WeakMap;let V={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return L.get(t);if("objectStoreNames"===e)return t.objectStoreNames||O.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return U(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function F(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(x||(x=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(B(this),t),U(R.get(this))}:function(...t){return U(e.apply(B(this),t))}:function(t,...n){const r=e.call(B(this),t,...n);return O.set(r,t.sort?t.sort():[t]),U(r)}:(t instanceof IDBTransaction&&function(t){if(L.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",s),t.removeEventListener("error",i),t.removeEventListener("abort",i)},s=()=>{e(),r()},i=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",s),t.addEventListener("error",i),t.addEventListener("abort",i)}));L.set(t,e)}(t),N(t,k||(k=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,V):t);var e}function U(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",s),t.removeEventListener("error",i)},s=()=>{e(U(t.result)),r()},i=()=>{n(t.error),r()};t.addEventListener("success",s),t.addEventListener("error",i)}));return e.then((e=>{e instanceof IDBCursor&&R.set(e,t)})).catch((()=>{})),P.set(e,t),e}(t);if(M.has(t))return M.get(t);const e=F(t);return e!==t&&(M.set(t,e),P.set(e,t)),e}const B=t=>P.get(t),j=["get","getKey","getAll","getAllKeys","count"],q=["put","add","delete","clear"],$=new Map;function z(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if($.get(e))return $.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,s=q.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!s&&!j.includes(n))return;const i=async function(t,...e){const i=this.transaction(t,s?"readwrite":"readonly");let o=i.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),s&&i.done]))[0]};return $.set(e,i),i}var K;K=V,V={...K,get:(t,e,n)=>z(t,e)||K.get(t,e,n),has:(t,e)=>!!z(t,e)||K.has(t,e)};class G{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const H="@firebase/app",Q="0.9.26",W=new D("@firebase/app"),X="[DEFAULT]",Y={[H]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},J=new Map,Z=new Map;function tt(t,e){try{t.container.addComponent(e)}catch(n){W.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function et(t){const e=t.name;if(Z.has(e))return W.debug(`There were multiple attempts to register component ${e}.`),!1;Z.set(e,t);for(const e of J.values())tt(e,t);return!0}const nt=new g("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class rt{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new v("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw nt.create("app-deleted",{appName:this._name})}}function st(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const r=Object.assign({name:X,automaticDataCollectionEnabled:!1},e),s=r.name;if("string"!=typeof s||!s)throw nt.create("bad-app-name",{appName:String(s)});if(n||(n=c()),!n)throw nt.create("no-options");const i=J.get(s);if(i){if(m(n,i.options)&&m(r,i.config))return i;throw nt.create("duplicate-app",{appName:s})}const o=new b(s);for(const t of Z.values())o.addComponent(t);const a=new rt(n,r,o);return J.set(s,a),a}function it(t,e,n){var r;let s=null!==(r=Y[t])&&void 0!==r?r:t;n&&(s+=`-${n}`);const i=s.match(/\s|\//),o=e.match(/\s|\//);if(i||o){const t=[`Unable to register library "${s}" with version "${e}":`];return i&&t.push(`library name "${s}" contains illegal characters (whitespace or "/")`),i&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void W.warn(t.join(" "))}et(new v(`${s}-version`,(()=>({library:s,version:e})),"VERSION"))}const ot="firebase-heartbeat-database",at=1,ht="firebase-heartbeat-store";let ct=null;function ut(){return ct||(ct=function(t,e,{blocked:n,upgrade:r,blocking:s,terminated:i}={}){const o=indexedDB.open(t,e),a=U(o);return r&&o.addEventListener("upgradeneeded",(t=>{r(U(o.result),t.oldVersion,t.newVersion,U(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{i&&t.addEventListener("close",(()=>i())),s&&t.addEventListener("versionchange",(t=>s(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}(ot,at,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(ht)}catch(t){console.warn(t)}}}).catch((t=>{throw nt.create("idb-open",{originalErrorMessage:t.message})}))),ct}async function lt(t,e){try{const n=(await ut()).transaction(ht,"readwrite"),r=n.objectStore(ht);await r.put(e,dt(t)),await n.done}catch(t){if(t instanceof f)W.warn(t.message);else{const e=nt.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});W.warn(e.message)}}}function dt(t){return`${t.name}!${t.options.appId}`}class ft{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new pt(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){var t,e;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=gt();if((null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((t=>t.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var t;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=gt(),{heartbeatsToSend:n,unsentEntries:r}=function(t,e=1024){const n=[];let r=t.slice();for(const s of t){const t=n.find((t=>t.agent===s.agent));if(t){if(t.dates.push(s.date),mt(n)>e){t.dates.pop();break}}else if(n.push({agent:s.agent,dates:[s.date]}),mt(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),s=a(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),s}}function gt(){return(new Date).toISOString().substring(0,10)}class pt{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!d()&&new Promise(((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",s=self.indexedDB.open(r);s.onsuccess=()=>{s.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},s.onupgradeneeded=()=>{n=!1},s.onerror=()=>{var t;e((null===(t=s.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=await ut();return await e.transaction(ht).objectStore(ht).get(dt(t))}catch(t){if(t instanceof f)W.warn(t.message);else{const e=nt.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});W.warn(e.message)}}}(this.app);return(null==t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return lt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return lt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function mt(t){return a(JSON.stringify({version:2,heartbeats:t})).length}et(new v("platform-logger",(t=>new G(t)),"PRIVATE")),et(new v("heartbeat",(t=>new ft(t)),"PRIVATE")),it(H,Q,""),it(H,Q,"esm2017"),it("fire-js",""),it("firebase","10.7.2","app");var yt,vt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},wt={},Et=Et||{},bt=vt||self;function _t(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function Tt(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var St="closure_uid_"+(1e9*Math.random()>>>0),Ct=0;function It(t,e,n){return t.call.apply(t.bind,arguments)}function At(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function Dt(t,e,n){return(Dt=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?It:At).apply(null,arguments)}function Nt(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function kt(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(t,n,r){for(var s=Array(arguments.length-2),i=2;i<arguments.length;i++)s[i-2]=arguments[i];return e.prototype[n].apply(t,s)}}function xt(){this.s=this.s,this.o=this.o}xt.prototype.s=!1,xt.prototype.sa=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,St)&&t[St]||(t[St]=++Ct))},xt.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Rt=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function Lt(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function Ot(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(_t(n)){const e=t.length||0,r=n.length||0;t.length=e+r;for(let s=0;s<r;s++)t[e+s]=n[s]}else t.push(n)}}function Mt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}Mt.prototype.h=function(){this.defaultPrevented=!0};var Pt=function(){if(!bt.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};bt.addEventListener("test",t,e),bt.removeEventListener("test",t,e)}catch(t){}return t}();function Vt(t){return/^[\s\xa0]*$/.test(t)}function Ft(){var t=bt.navigator;return t&&(t=t.userAgent)?t:""}function Ut(t){return-1!=Ft().indexOf(t)}function Bt(t){return Bt[" "](t),t}Bt[" "]=function(){};var jt,qt,$t,zt=Ut("Opera"),Kt=Ut("Trident")||Ut("MSIE"),Gt=Ut("Edge"),Ht=Gt||Kt,Qt=Ut("Gecko")&&!(-1!=Ft().toLowerCase().indexOf("webkit")&&!Ut("Edge"))&&!(Ut("Trident")||Ut("MSIE"))&&!Ut("Edge"),Wt=-1!=Ft().toLowerCase().indexOf("webkit")&&!Ut("Edge");function Xt(){var t=bt.document;return t?t.documentMode:void 0}t:{var Yt="",Jt=(qt=Ft(),Qt?/rv:([^\);]+)(\)|;)/.exec(qt):Gt?/Edge\/([\d\.]+)/.exec(qt):Kt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(qt):Wt?/WebKit\/(\S+)/.exec(qt):zt?/(?:Version)[ \/]?(\S+)/.exec(qt):void 0);if(Jt&&(Yt=Jt?Jt[1]:""),Kt){var Zt=Xt();if(null!=Zt&&Zt>parseFloat(Yt)){jt=String(Zt);break t}}jt=Yt}bt.document&&Kt?$t=Xt()||parseInt(jt,10)||void 0:$t=void 0;var te=$t;function ee(t,e){if(Mt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Qt){t:{try{Bt(e.nodeName);var s=!0;break t}catch(t){}s=!1}s||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:ne[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&ee.$.h.call(this)}}kt(ee,Mt);var ne={2:"touch",3:"pen",4:"mouse"};ee.prototype.h=function(){ee.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var re="closure_listenable_"+(1e6*Math.random()|0),se=0;function ie(t,e,n,r,s){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.la=s,this.key=++se,this.fa=this.ia=!1}function oe(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function ae(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function he(t){const e={};for(const n in t)e[n]=t[n];return e}const ce="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function ue(t,e){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e],r)t[n]=r[n];for(let e=0;e<ce.length;e++)n=ce[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function le(t){this.src=t,this.g={},this.h=0}function de(t,e){var n=e.type;if(n in t.g){var r,s=t.g[n],i=Rt(s,e);(r=0<=i)&&Array.prototype.splice.call(s,i,1),r&&(oe(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function fe(t,e,n,r){for(var s=0;s<t.length;++s){var i=t[s];if(!i.fa&&i.listener==e&&i.capture==!!n&&i.la==r)return s}return-1}le.prototype.add=function(t,e,n,r,s){var i=t.toString();(t=this.g[i])||(t=this.g[i]=[],this.h++);var o=fe(t,e,r,s);return-1<o?(e=t[o],n||(e.ia=!1)):((e=new ie(e,this.src,i,!!r,s)).ia=n,t.push(e)),e};var ge="closure_lm_"+(1e6*Math.random()|0),pe={};function me(t,e,n,r,s){if(r&&r.once)return ve(t,e,n,r,s);if(Array.isArray(e)){for(var i=0;i<e.length;i++)me(t,e[i],n,r,s);return null}return n=Ce(n),t&&t[re]?t.O(e,n,Tt(r)?!!r.capture:!!r,s):ye(t,e,n,!1,r,s)}function ye(t,e,n,r,s,i){if(!e)throw Error("Invalid event type");var o=Tt(s)?!!s.capture:!!s,a=Te(t);if(a||(t[ge]=a=new le(t)),(n=a.add(e,n,r,o,i)).proxy)return n;if(r=function(){const t=_e;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Pt||(s=o),void 0===s&&(s=!1),t.addEventListener(e.toString(),r,s);else if(t.attachEvent)t.attachEvent(be(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function ve(t,e,n,r,s){if(Array.isArray(e)){for(var i=0;i<e.length;i++)ve(t,e[i],n,r,s);return null}return n=Ce(n),t&&t[re]?t.P(e,n,Tt(r)?!!r.capture:!!r,s):ye(t,e,n,!0,r,s)}function we(t,e,n,r,s){if(Array.isArray(e))for(var i=0;i<e.length;i++)we(t,e[i],n,r,s);else r=Tt(r)?!!r.capture:!!r,n=Ce(n),t&&t[re]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=fe(i=t.g[e],n,r,s))&&(oe(i[n]),Array.prototype.splice.call(i,n,1),0==i.length&&(delete t.g[e],t.h--))):t&&(t=Te(t))&&(e=t.g[e.toString()],t=-1,e&&(t=fe(e,n,r,s)),(n=-1<t?e[t]:null)&&Ee(n))}function Ee(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[re])de(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(be(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Te(e))?(de(n,t),0==n.h&&(n.src=null,e[ge]=null)):oe(t)}}}function be(t){return t in pe?pe[t]:pe[t]="on"+t}function _e(t,e){if(t.fa)t=!0;else{e=new ee(e,this);var n=t.listener,r=t.la||t.src;t.ia&&Ee(t),t=n.call(r,e)}return t}function Te(t){return(t=t[ge])instanceof le?t:null}var Se="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ce(t){return"function"==typeof t?t:(t[Se]||(t[Se]=function(e){return t.handleEvent(e)}),t[Se])}function Ie(){xt.call(this),this.i=new le(this),this.S=this,this.J=null}function Ae(t,e){var n,r=t.J;if(r)for(n=[];r;r=r.J)n.push(r);if(t=t.S,r=e.type||e,"string"==typeof e)e=new Mt(e,t);else if(e instanceof Mt)e.target=e.target||t;else{var s=e;ue(e=new Mt(r,t),s)}if(s=!0,n)for(var i=n.length-1;0<=i;i--){var o=e.g=n[i];s=De(o,r,!0,e)&&s}if(s=De(o=e.g=t,r,!0,e)&&s,s=De(o,r,!1,e)&&s,n)for(i=0;i<n.length;i++)s=De(o=e.g=n[i],r,!1,e)&&s}function De(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var s=!0,i=0;i<e.length;++i){var o=e[i];if(o&&!o.fa&&o.capture==n){var a=o.listener,h=o.la||o.src;o.ia&&de(t.i,o),s=!1!==a.call(h,r)&&s}}return s&&!r.defaultPrevented}kt(Ie,xt),Ie.prototype[re]=!0,Ie.prototype.removeEventListener=function(t,e,n,r){we(this,t,e,n,r)},Ie.prototype.N=function(){if(Ie.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)oe(n[r]);delete e.g[t],e.h--}}this.J=null},Ie.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Ie.prototype.P=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var Ne=bt.JSON.stringify;function ke(){var t=Ve;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var xe=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new Re),(t=>t.reset()));class Re{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Le(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function Oe(t){bt.setTimeout((()=>{throw t}),0)}let Me,Pe=!1,Ve=new class{constructor(){this.h=this.g=null}add(t,e){const n=xe.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},Fe=()=>{const t=bt.Promise.resolve(void 0);Me=()=>{t.then(Ue)}};var Ue=()=>{for(var t;t=ke();){try{t.h.call(t.g)}catch(t){Oe(t)}var e=xe;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Pe=!1};function Be(t,e){Ie.call(this),this.h=t||1,this.g=e||bt,this.j=Dt(this.qb,this),this.l=Date.now()}function je(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function qe(t,e,n){if("function"==typeof t)n&&(t=Dt(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Dt(t.handleEvent,t)}return 2147483647<Number(e)?-1:bt.setTimeout(t,e||0)}function $e(t){t.g=qe((()=>{t.g=null,t.i&&(t.i=!1,$e(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}kt(Be,Ie),(yt=Be.prototype).ga=!1,yt.T=null,yt.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Ae(this,"tick"),this.ga&&(je(this),this.start()))}},yt.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},yt.N=function(){Be.$.N.call(this),je(this),delete this.g};class ze extends xt{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:$e(this)}N(){super.N(),this.g&&(bt.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ke(t){xt.call(this),this.h=t,this.g={}}kt(Ke,xt);var Ge=[];function He(t,e,n,r){Array.isArray(n)||(n&&(Ge[0]=n.toString()),n=Ge);for(var s=0;s<n.length;s++){var i=me(e,n[s],r||t.handleEvent,!1,t.h||t);if(!i)break;t.g[i.key]=i}}function Qe(t){ae(t.g,(function(t,e){this.g.hasOwnProperty(e)&&Ee(t)}),t),t.g={}}function We(){this.g=!0}function Xe(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var s=r[1];if(Array.isArray(s)&&!(1>s.length)){var i=s[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(var o=1;o<s.length;o++)s[o]=""}}}return Ne(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}Ke.prototype.N=function(){Ke.$.N.call(this),Qe(this)},Ke.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},We.prototype.Ea=function(){this.g=!1},We.prototype.info=function(){};var Ye={},Je=null;function Ze(){return Je=Je||new Ie}function tn(t){Mt.call(this,Ye.Ta,t)}function en(t){const e=Ze();Ae(e,new tn(e))}function nn(t,e){Mt.call(this,Ye.STAT_EVENT,t),this.stat=e}function rn(t){const e=Ze();Ae(e,new nn(e,t))}function sn(t,e){Mt.call(this,Ye.Ua,t),this.size=e}function on(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return bt.setTimeout((function(){t()}),e)}Ye.Ta="serverreachability",kt(tn,Mt),Ye.STAT_EVENT="statevent",kt(nn,Mt),Ye.Ua="timingevent",kt(sn,Mt);var an={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},hn={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function cn(){}function un(t){return t.h||(t.h=t.i())}function ln(){}cn.prototype.h=null;var dn,fn={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function gn(){Mt.call(this,"d")}function pn(){Mt.call(this,"c")}function mn(){}function yn(t,e,n,r){this.l=t,this.j=e,this.m=n,this.W=r||1,this.U=new Ke(this),this.P=wn,t=Ht?125:void 0,this.V=new Be(t),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new vn}function vn(){this.i=null,this.g="",this.h=!1}kt(gn,Mt),kt(pn,Mt),kt(mn,cn),mn.prototype.g=function(){return new XMLHttpRequest},mn.prototype.i=function(){return{}},dn=new mn;var wn=45e3,En={},bn={};function _n(t,e,n){t.L=1,t.A=jn(Pn(e)),t.u=n,t.S=!0,Tn(t,null)}function Tn(t,e){t.G=Date.now(),An(t),t.B=Pn(t.A);var n=t.B,r=t.W;Array.isArray(r)||(r=[String(r)]),tr(n.i,"t",r),t.o=0,n=t.l.J,t.h=new vn,t.g=ts(t.l,n?e:null,!t.u),0<t.O&&(t.M=new ze(Dt(t.Pa,t,t.g),t.O)),He(t.U,t.g,"readystatechange",t.nb),e=t.I?he(t.I):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.B,t.v,t.u,e)):(t.v="GET",t.g.ha(t.B,t.v,null,e)),en(),function(t,e,n,r,s,i){t.info((function(){if(t.g)if(i)for(var o="",a=i.split("&"),h=0;h<a.length;h++){var c=a[h].split("=");if(1<c.length){var u=c[0];c=c[1];var l=u.split("_");o=2<=l.length&&"type"==l[1]?o+(u+"=")+c+"&":o+(u+"=redacted&")}}else o=null;else o=i;return"XMLHTTP REQ ("+r+") [attempt "+s+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.v,t.B,t.m,t.W,t.u)}function Sn(t){return!!t.g&&"GET"==t.v&&2!=t.L&&t.l.Ha}function Cn(t,e,n){let r,s=!0;for(;!t.J&&t.o<n.length;){if(r=In(t,n),r==bn){4==e&&(t.s=4,rn(14),s=!1),Xe(t.j,t.m,null,"[Incomplete Response]");break}if(r==En){t.s=4,rn(15),Xe(t.j,t.m,n,"[Invalid Chunk]"),s=!1;break}Xe(t.j,t.m,r,null),Rn(t,r)}Sn(t)&&0!=t.o&&(t.h.g=t.h.g.slice(t.o),t.o=0),4!=e||0!=n.length||t.h.h||(t.s=1,rn(16),s=!1),t.i=t.i&&s,s?0<n.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Gr(e),e.M=!0,rn(11))):(Xe(t.j,t.m,n,"[Invalid Chunked Response]"),xn(t),kn(t))}function In(t,e){var n=t.o,r=e.indexOf("\n",n);return-1==r?bn:(n=Number(e.substring(n,r)),isNaN(n)?En:(r+=1)+n>e.length?bn:(e=e.slice(r,r+n),t.o=r+n,e))}function An(t){t.Y=Date.now()+t.P,Dn(t,t.P)}function Dn(t,e){if(null!=t.C)throw Error("WatchDog timer not null");t.C=on(Dt(t.lb,t),e)}function Nn(t){t.C&&(bt.clearTimeout(t.C),t.C=null)}function kn(t){0==t.l.H||t.J||Wr(t.l,t)}function xn(t){Nn(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,je(t.V),Qe(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function Rn(t,e){try{var n=t.l;if(0!=n.H&&(n.g==t||ar(n.i,t)))if(!t.K&&ar(n.i,t)&&3==n.H){try{var r=n.Ja.g.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var s=r;if(0==s[0]){t:if(!n.u){if(n.g){if(!(n.g.G+3e3<t.G))break t;Qr(n),Fr(n)}Kr(n),rn(18)}}else n.Fa=s[1],0<n.Fa-n.V&&37500>s[2]&&n.G&&0==n.A&&!n.v&&(n.v=on(Dt(n.ib,n),6e3));if(1>=or(n.i)&&n.oa){try{n.oa()}catch(t){}n.oa=void 0}}else Yr(n,11)}else if((t.K||n.g==t)&&Qr(n),!Vt(e))for(s=n.Ja.g.parse(e),e=0;e<s.length;e++){let c=s[e];if(n.V=c[0],c=c[1],2==n.H)if("c"==c[0]){n.K=c[1],n.pa=c[2];const e=c[3];null!=e&&(n.ra=e,n.l.info("VER="+n.ra));const s=c[4];null!=s&&(n.Ga=s,n.l.info("SVER="+n.Ga));const u=c[5];null!=u&&"number"==typeof u&&0<u&&(r=1.5*u,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var i=r.i;i.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(i.j=i.l,i.g=new Set,i.h&&(hr(i,i.h),i.h=null))}if(r.F){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.Da=t,Bn(r.I,r.F,t))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=t;if((r=n).wa=Zr(r,r.J?r.pa:null,r.Y),o.K){cr(r.i,o);var a=o,h=r.L;h&&a.setTimeout(h),a.C&&(Nn(a),An(a)),r.g=o}else zr(r);0<n.j.length&&Br(n)}else"stop"!=c[0]&&"close"!=c[0]||Yr(n,7);else 3==n.H&&("stop"==c[0]||"close"==c[0]?"stop"==c[0]?Yr(n,7):Vr(n):"noop"!=c[0]&&n.h&&n.h.Aa(c),n.A=0)}en()}catch(t){}}function Ln(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(_t(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(_t(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}(t),r=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(_t(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),s=r.length,i=0;i<s;i++)e.call(void 0,r[i],n&&n[i],t)}(yt=yn.prototype).setTimeout=function(t){this.P=t},yt.nb=function(t){t=t.target;const e=this.M;e&&3==xr(t)?e.l():this.Pa(t)},yt.Pa=function(t){try{if(t==this.g)t:{const u=xr(this.g);var e=this.g.Ia();if(this.g.da(),!(3>u)&&(3!=u||Ht||this.g&&(this.h.h||this.g.ja()||Rr(this.g)))){this.J||4!=u||7==e||en(),Nn(this);var n=this.g.da();this.ca=n;e:if(Sn(this)){var r=Rr(this.g);t="";var s=r.length,i=4==xr(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){xn(this),kn(this);var o="";break e}this.h.i=new bt.TextDecoder}for(e=0;e<s;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:i&&e==s-1});r.length=0,this.h.g+=t,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(t,e,n,r,s,i,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+s+"]: "+e+"\n"+n+"\n"+i+" "+o}))}(this.j,this.v,this.B,this.m,this.W,u,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,h=this.g;if((a=h.g?h.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Vt(a)){var c=a;break e}}c=null}if(!(n=c)){this.i=!1,this.s=3,rn(12),xn(this),kn(this);break t}Xe(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Rn(this,n)}this.S?(Cn(this,u,o),Ht&&this.i&&3==u&&(He(this.U,this.V,"tick",this.mb),this.V.start())):(Xe(this.j,this.m,o,null),Rn(this,o)),4==u&&xn(this),this.i&&!this.J&&(4==u?Wr(this.l,this):(this.i=!1,An(this)))}else(function(t){const e={};t=(t.g&&2<=xr(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(Vt(t[r]))continue;var n=Le(t[r]);const s=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const i=e[s]||[];e[s]=i,i.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,rn(12)):(this.s=0,rn(13)),xn(this),kn(this)}}}catch(t){}},yt.mb=function(){if(this.g){var t=xr(this.g),e=this.g.ja();this.o<e.length&&(Nn(this),Cn(this,t,e),this.i&&4!=t&&An(this))}},yt.cancel=function(){this.J=!0,xn(this)},yt.lb=function(){this.C=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.B),2!=this.L&&(en(),rn(17)),xn(this),this.s=2,kn(this)):Dn(this,this.Y-t)};var On=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Mn(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Mn){this.h=t.h,Vn(this,t.j),this.s=t.s,this.g=t.g,Fn(this,t.m),this.l=t.l;var e=t.i,n=new Xn;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),Un(this,n),this.o=t.o}else t&&(e=String(t).match(On))?(this.h=!1,Vn(this,e[1]||"",!0),this.s=qn(e[2]||""),this.g=qn(e[3]||"",!0),Fn(this,e[4]),this.l=qn(e[5]||"",!0),Un(this,e[6]||"",!0),this.o=qn(e[7]||"")):(this.h=!1,this.i=new Xn(null,this.h))}function Pn(t){return new Mn(t)}function Vn(t,e,n){t.j=n?qn(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Fn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Un(t,e,n){e instanceof Xn?(t.i=e,function(t,e){e&&!t.j&&(Yn(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Jn(this,e),tr(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=$n(e,Qn)),t.i=new Xn(e,t.h))}function Bn(t,e,n){t.i.set(e,n)}function jn(t){return Bn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function qn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function $n(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,zn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function zn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Mn.prototype.toString=function(){var t=[],e=this.j;e&&t.push($n(e,Kn,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push($n(e,Kn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push($n(n,"/"==n.charAt(0)?Hn:Gn,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",$n(n,Wn)),t.join("")};var Kn=/[#\/\?@]/g,Gn=/[#\?:]/g,Hn=/[#\?]/g,Qn=/[#\?@]/g,Wn=/#/g;function Xn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Yn(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),s=null;if(0<=r){var i=t[n].substring(0,r);s=t[n].substring(r+1)}else i=t[n];e(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Jn(t,e){Yn(t),e=er(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Zn(t,e){return Yn(t),e=er(t,e),t.g.has(e)}function tr(t,e,n){Jn(t,e),0<n.length&&(t.i=null,t.g.set(er(t,e),Lt(n)),t.h+=n.length)}function er(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(yt=Xn.prototype).add=function(t,e){Yn(this),this.i=null,t=er(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},yt.forEach=function(t,e){Yn(this),this.g.forEach((function(n,r){n.forEach((function(n){t.call(e,n,r,this)}),this)}),this)},yt.ta=function(){Yn(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const s=t[r];for(let t=0;t<s.length;t++)n.push(e[r])}return n},yt.Z=function(t){Yn(this);let e=[];if("string"==typeof t)Zn(this,t)&&(e=e.concat(this.g.get(er(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},yt.set=function(t,e){return Yn(this),this.i=null,Zn(this,t=er(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},yt.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},yt.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const i=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var s=i;""!==o[r]&&(s+="="+encodeURIComponent(String(o[r]))),t.push(s)}}return this.i=t.join("&")};var nr=class{constructor(t,e){this.g=t,this.map=e}};function rr(t){this.l=t||sr,t=bt.PerformanceNavigationTiming?0<(t=bt.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(bt.g&&bt.g.Ka&&bt.g.Ka()&&bt.g.Ka().dc),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var sr=10;function ir(t){return!!t.h||!!t.g&&t.g.size>=t.j}function or(t){return t.h?1:t.g?t.g.size:0}function ar(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function hr(t,e){t.g?t.g.add(e):t.h=e}function cr(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function ur(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return Lt(t.i)}rr.prototype.cancel=function(){if(this.i=ur(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var lr=class{stringify(t){return bt.JSON.stringify(t,void 0)}parse(t){return bt.JSON.parse(t,void 0)}};function dr(){this.g=new lr}function fr(t,e,n){const r=n||"";try{Ln(t,(function(t,n){let s=t;Tt(t)&&(s=Ne(t)),e.push(r+n+"="+encodeURIComponent(s))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function gr(t,e,n,r,s){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,s(r)}catch(t){}}function pr(t){this.l=t.ec||null,this.j=t.ob||!1}function mr(t,e){Ie.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=yr,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}kt(pr,cn),pr.prototype.g=function(){return new mr(this.l,this.j)},pr.prototype.i=function(t){return function(){return t}}({}),kt(mr,Ie);var yr=0;function vr(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function wr(t){t.readyState=4,t.l=null,t.j=null,t.A=null,Er(t)}function Er(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(yt=mr.prototype).open=function(t,e){if(this.readyState!=yr)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,Er(this)},yt.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||bt).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},yt.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,wr(this)),this.readyState=yr},yt.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,Er(this)),this.g&&(this.readyState=3,Er(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==bt.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;vr(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},yt.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?wr(this):Er(this),3==this.readyState&&vr(this)}},yt.Za=function(t){this.g&&(this.response=this.responseText=t,wr(this))},yt.Ya=function(t){this.g&&(this.response=t,wr(this))},yt.ka=function(){this.g&&wr(this)},yt.setRequestHeader=function(t,e){this.v.append(t,e)},yt.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},yt.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(mr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var br=bt.JSON.parse;function _r(t){Ie.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Tr,this.L=this.M=!1}kt(_r,Ie);var Tr="",Sr=/^https?$/i,Cr=["POST","PUT"];function Ir(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Ar(t),Nr(t)}function Ar(t){t.F||(t.F=!0,Ae(t,"complete"),Ae(t,"error"))}function Dr(t){if(t.h&&void 0!==Et&&(!t.C[1]||4!=xr(t)||2!=t.da()))if(t.v&&4==xr(t))qe(t.La,0,t);else if(Ae(t,"readystatechange"),4==xr(t)){t.h=!1;try{const o=t.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var r;if(r=0===o){var s=String(t.I).match(On)[1]||null;!s&&bt.self&&bt.self.location&&(s=bt.self.location.protocol.slice(0,-1)),r=!Sr.test(s?s.toLowerCase():"")}n=r}if(n)Ae(t,"complete"),Ae(t,"success");else{t.m=6;try{var i=2<xr(t)?t.g.statusText:""}catch(t){i=""}t.j=i+" ["+t.da()+"]",Ar(t)}}finally{Nr(t)}}}function Nr(t,e){if(t.g){kr(t);const n=t.g,r=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||Ae(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function kr(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(bt.clearTimeout(t.A),t.A=null)}function xr(t){return t.g?t.g.readyState:0}function Rr(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case Tr:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Lr(t){let e="";return ae(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function Or(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=Lr(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Bn(t,e,n))}function Mr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Pr(t){this.Ga=0,this.j=[],this.l=new We,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Mr("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Mr("baseRetryDelayMs",5e3,t),this.hb=Mr("retryDelaySeedMs",1e4,t),this.eb=Mr("forwardChannelMaxRetries",2,t),this.xa=Mr("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new rr(t&&t.concurrentRequestLimit),this.Ja=new dr,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Vr(t){if(Ur(t),3==t.H){var e=t.W++,n=Pn(t.I);if(Bn(n,"SID",t.K),Bn(n,"RID",e),Bn(n,"TYPE","terminate"),qr(t,n),(e=new yn(t,t.l,e)).L=2,e.A=jn(Pn(n)),n=!1,bt.navigator&&bt.navigator.sendBeacon)try{n=bt.navigator.sendBeacon(e.A.toString(),"")}catch(t){}!n&&bt.Image&&((new Image).src=e.A,n=!0),n||(e.g=ts(e.l,null),e.g.ha(e.A)),e.G=Date.now(),An(e)}Jr(t)}function Fr(t){t.g&&(Gr(t),t.g.cancel(),t.g=null)}function Ur(t){Fr(t),t.u&&(bt.clearTimeout(t.u),t.u=null),Qr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&bt.clearTimeout(t.m),t.m=null)}function Br(t){if(!ir(t.i)&&!t.m){t.m=!0;var e=t.Na;Me||Fe(),Pe||(Me(),Pe=!0),Ve.add(e,t),t.C=0}}function jr(t,e){var n;n=e?e.m:t.W++;const r=Pn(t.I);Bn(r,"SID",t.K),Bn(r,"RID",n),Bn(r,"AID",t.V),qr(t,r),t.o&&t.s&&Or(r,t.o,t.s),n=new yn(t,t.l,n,t.C+1),null===t.o&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=$r(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),hr(t.i,n),_n(n,r,e)}function qr(t,e){t.na&&ae(t.na,(function(t,n){Bn(e,n,t)})),t.h&&Ln({},(function(t,n){Bn(e,n,t)}))}function $r(t,e,n){n=Math.min(t.j.length,n);var r=t.h?Dt(t.h.Va,t.h,t):null;t:{var s=t.j;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=s[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let i=!0;for(let o=0;o<n;o++){let n=s[o].g;const a=s[o].map;if(n-=e,0>n)e=Math.max(0,s[o].g-100),i=!1;else try{fr(a,t,"req"+n+"_")}catch(t){r&&r(a)}}if(i){r=t.join("&");break t}}}return t=t.j.splice(0,n),e.F=t,r}function zr(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;Me||Fe(),Pe||(Me(),Pe=!0),Ve.add(e,t),t.A=0}}function Kr(t){return!(t.g||t.u||3<=t.A||(t.ba++,t.u=on(Dt(t.Ma,t),Xr(t,t.A)),t.A++,0))}function Gr(t){null!=t.B&&(bt.clearTimeout(t.B),t.B=null)}function Hr(t){t.g=new yn(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=Pn(t.wa);Bn(e,"RID","rpc"),Bn(e,"SID",t.K),Bn(e,"AID",t.V),Bn(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&Bn(e,"TO",t.qa),Bn(e,"TYPE","xmlhttp"),qr(t,e),t.o&&t.s&&Or(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.A=jn(Pn(e)),n.u=null,n.S=!0,Tn(n,t)}function Qr(t){null!=t.v&&(bt.clearTimeout(t.v),t.v=null)}function Wr(t,e){var n=null;if(t.g==e){Qr(t),Gr(t),t.g=null;var r=2}else{if(!ar(t.i,e))return;n=e.F,cr(t.i,e),r=1}if(0!=t.H)if(e.i)if(1==r){n=e.u?e.u.length:0,e=Date.now()-e.G;var s=t.C;Ae(r=Ze(),new sn(r,n)),Br(t)}else zr(t);else if(3==(s=e.s)||0==s&&0<e.ca||!(1==r&&function(t,e){return!(or(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.j=e.F.concat(t.j),0):1==t.H||2==t.H||t.C>=(t.cb?0:t.eb)||(t.m=on(Dt(t.Na,t,e),Xr(t,t.C)),t.C++,0)))}(t,e)||2==r&&Kr(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),s){case 1:Yr(t,5);break;case 4:Yr(t,10);break;case 3:Yr(t,6);break;default:Yr(t,2)}}function Xr(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function Yr(t,e){if(t.l.info("Error code "+e),2==e){var n=null;t.h&&(n=null);var r=Dt(t.pb,t);n||(n=new Mn("//www.google.com/images/cleardot.gif"),bt.location&&"http"==bt.location.protocol||Vn(n,"https"),jn(n)),function(t,e){const n=new We;if(bt.Image){const r=new Image;r.onload=Nt(gr,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Nt(gr,n,r,"TestLoadImage: error",!1,e),r.onabort=Nt(gr,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Nt(gr,n,r,"TestLoadImage: timeout",!1,e),bt.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else rn(2);t.H=0,t.h&&t.h.za(e),Jr(t),Ur(t)}function Jr(t){if(t.H=0,t.ma=[],t.h){const e=ur(t.i);0==e.length&&0==t.j.length||(Ot(t.ma,e),Ot(t.ma,t.j),t.i.i.length=0,Lt(t.j),t.j.length=0),t.h.ya()}}function Zr(t,e,n){var r=n instanceof Mn?Pn(n):new Mn(n);if(""!=r.g)e&&(r.g=e+"."+r.g),Fn(r,r.m);else{var s=bt.location;r=s.protocol,e=e?e+"."+s.hostname:s.hostname,s=+s.port;var i=new Mn(null);r&&Vn(i,r),e&&(i.g=e),s&&Fn(i,s),n&&(i.l=n),r=i}return n=t.F,e=t.Da,n&&e&&Bn(r,n,e),Bn(r,"VER",t.ra),qr(t,r),r}function ts(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Ha&&!t.va?new _r(new pr({ob:n})):new _r(t.va)).Oa(t.J),e}function es(){}function ns(){if(Kt&&!(10<=Number(te)))throw Error("Environmental error: no available transport.")}function rs(t,e){Ie.call(this),this.g=new Pr(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!Vt(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Vt(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new os(this)}function ss(t){gn.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function is(){pn.call(this),this.status=1}function os(t){this.g=t}function as(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function hs(t,e,n){n||(n=0);var r=Array(16);if("string"==typeof e)for(var s=0;16>s;++s)r[s]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(s=0;16>s;++s)r[s]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],s=t.g[2];var i=t.g[3],o=e+(i^n&(s^i))+r[0]+3614090360&4294967295;o=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=(n=(s=(i=(e=n+(o<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^n&(s^i))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=i+(s^e&(n^s))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=s+(n^i&(e^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^s&(i^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^i&(n^s))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(s^i&(n^s))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=i+(n^s&(e^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=s+(e^n&(i^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(i^e&(s^i))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^s^i)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^s^i)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=i+(e^n^s)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=s+(i^e^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(s^i^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(s^(n|~i))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(n|~i))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(s^(n|~i))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=s+(e^(i|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(i^(s|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((i=(e=n+((o=e+(s^(n|~i))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=i+(n^(e|~s))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((s=i+((o=s+(e^(i|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(s+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+s&4294967295,t.g[3]=t.g[3]+i&4294967295}function cs(t,e){this.h=e;for(var n=[],r=!0,s=t.length-1;0<=s;s--){var i=0|t[s];r&&i==e||(n[s]=i,r=!1)}this.g=n}(yt=_r.prototype).Oa=function(t){this.M=t},yt.ha=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():dn.g(),this.C=this.u?un(this.u):un(dn),this.g.onreadystatechange=Dt(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(t){return void Ir(this,t)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var s in r)n.set(s,r[s]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),s=bt.FormData&&t instanceof bt.FormData,!(0<=Rt(Cr,e))||r||s||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{kr(this),0<this.B&&((this.L=function(t){return Kt&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Dt(this.ua,this)):this.A=qe(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Ir(this,t)}},yt.ua=function(){void 0!==Et&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ae(this,"timeout"),this.abort(8))},yt.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Ae(this,"complete"),Ae(this,"abort"),Nr(this))},yt.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Nr(this,!0)),_r.$.N.call(this)},yt.La=function(){this.s||(this.G||this.v||this.l?Dr(this):this.kb())},yt.kb=function(){Dr(this)},yt.isActive=function(){return!!this.g},yt.da=function(){try{return 2<xr(this)?this.g.status:-1}catch(t){return-1}},yt.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},yt.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),br(e)}},yt.Ia=function(){return this.m},yt.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(yt=Pr.prototype).ra=8,yt.H=1,yt.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const s=new yn(this,this.l,t);let i=this.s;if(this.U&&(i?(i=he(i),ue(i,this.U)):i=this.U),null!==this.o||this.O||(s.I=i,i=null),this.P)t:{for(var e=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.j.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=$r(this,s,e),Bn(n=Pn(this.I),"RID",t),Bn(n,"CVER",22),this.F&&Bn(n,"X-HTTP-Session-Id",this.F),qr(this,n),i&&(this.O?e="headers="+encodeURIComponent(String(Lr(i)))+"&"+e:this.o&&Or(n,this.o,i)),hr(this.i,s),this.bb&&Bn(n,"TYPE","init"),this.P?(Bn(n,"$req",e),Bn(n,"SID","null"),s.aa=!0,_n(s,n,null)):_n(s,n,e),this.H=2}}else 3==this.H&&(t?jr(this,t):0==this.j.length||ir(this.i)||jr(this))},yt.Ma=function(){if(this.u=null,Hr(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=on(Dt(this.jb,this),t)}},yt.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,rn(10),Fr(this),Hr(this))},yt.ib=function(){null!=this.v&&(this.v=null,Fr(this),Kr(this),rn(19))},yt.pb=function(t){t?(this.l.info("Successfully pinged google.com"),rn(2)):(this.l.info("Failed to ping google.com"),rn(1))},yt.isActive=function(){return!!this.h&&this.h.isActive(this)},(yt=es.prototype).Ba=function(){},yt.Aa=function(){},yt.za=function(){},yt.ya=function(){},yt.isActive=function(){return!0},yt.Va=function(){},ns.prototype.g=function(t,e){return new rs(t,e)},kt(rs,Ie),rs.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;rn(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=Zr(t,null,t.Y),Br(t)},rs.prototype.close=function(){Vr(this.g)},rs.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=Ne(t),t=n);e.j.push(new nr(e.fb++,t)),3==e.H&&Br(e)},rs.prototype.N=function(){this.g.h=null,delete this.j,Vr(this.g),delete this.g,rs.$.N.call(this)},kt(ss,gn),kt(is,pn),kt(os,es),os.prototype.Ba=function(){Ae(this.g,"a")},os.prototype.Aa=function(t){Ae(this.g,new ss(t))},os.prototype.za=function(t){Ae(this.g,new is)},os.prototype.ya=function(){Ae(this.g,"b")},kt(as,(function(){this.blockSize=-1})),as.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},as.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=this.m,s=this.h,i=0;i<e;){if(0==s)for(;i<=n;)hs(this,t,i),i+=this.blockSize;if("string"==typeof t){for(;i<e;)if(r[s++]=t.charCodeAt(i++),s==this.blockSize){hs(this,r),s=0;break}}else for(;i<e;)if(r[s++]=t[i++],s==this.blockSize){hs(this,r),s=0;break}}this.h=s,this.i+=e},as.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};var us={};function ls(t){return-128<=t&&128>t?function(t,e){var n=us;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=function(t){return new cs([0|t],0>t?-1:0)}(t)}(t):new cs([0|t],0>t?-1:0)}function ds(t){if(isNaN(t)||!isFinite(t))return gs;if(0>t)return ws(ds(-t));for(var e=[],n=1,r=0;t>=n;r++)e[r]=t/n|0,n*=fs;return new cs(e,0)}var fs=4294967296,gs=ls(0),ps=ls(1),ms=ls(16777216);function ys(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function vs(t){return-1==t.h}function ws(t){for(var e=t.g.length,n=[],r=0;r<e;r++)n[r]=~t.g[r];return new cs(n,~t.h).add(ps)}function Es(t,e){return t.add(ws(e))}function bs(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function _s(t,e){this.g=t,this.h=e}function Ts(t,e){if(ys(e))throw Error("division by zero");if(ys(t))return new _s(gs,gs);if(vs(t))return e=Ts(ws(t),e),new _s(ws(e.g),ws(e.h));if(vs(e))return e=Ts(t,ws(e)),new _s(ws(e.g),e.h);if(30<t.g.length){if(vs(t)||vs(e))throw Error("slowDivide_ only works with positive integers.");for(var n=ps,r=e;0>=r.X(t);)n=Ss(n),r=Ss(r);var s=Cs(n,1),i=Cs(r,1);for(r=Cs(r,2),n=Cs(n,2);!ys(r);){var o=i.add(r);0>=o.X(t)&&(s=s.add(n),i=o),r=Cs(r,1),n=Cs(n,1)}return e=Es(t,s.R(e)),new _s(s,e)}for(s=gs;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(i=ds(n)).R(e);vs(o)||0<o.X(t);)o=(i=ds(n-=r)).R(e);ys(i)&&(i=ps),s=s.add(i),t=Es(t,o)}return new _s(s,t)}function Ss(t){for(var e=t.g.length+1,n=[],r=0;r<e;r++)n[r]=t.D(r)<<1|t.D(r-1)>>>31;return new cs(n,t.h)}function Cs(t,e){var n=e>>5;e%=32;for(var r=t.g.length-n,s=[],i=0;i<r;i++)s[i]=0<e?t.D(i+n)>>>e|t.D(i+n+1)<<32-e:t.D(i+n);return new cs(s,t.h)}(yt=cs.prototype).ea=function(){if(vs(this))return-ws(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.D(n);t+=(0<=r?r:fs+r)*e,e*=fs}return t},yt.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(ys(this))return"0";if(vs(this))return"-"+ws(this).toString(t);for(var e=ds(Math.pow(t,6)),n=this,r="";;){var s=Ts(n,e).g,i=((0<(n=Es(n,s.R(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(ys(n=s))return i+r;for(;6>i.length;)i="0"+i;r=i+r}},yt.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},yt.X=function(t){return vs(t=Es(this,t))?-1:ys(t)?0:1},yt.abs=function(){return vs(this)?ws(this):this},yt.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0,s=0;s<=e;s++){var i=r+(65535&this.D(s))+(65535&t.D(s)),o=(i>>>16)+(this.D(s)>>>16)+(t.D(s)>>>16);r=o>>>16,i&=65535,o&=65535,n[s]=o<<16|i}return new cs(n,-2147483648&n[n.length-1]?-1:0)},yt.R=function(t){if(ys(this)||ys(t))return gs;if(vs(this))return vs(t)?ws(this).R(ws(t)):ws(ws(this).R(t));if(vs(t))return ws(this.R(ws(t)));if(0>this.X(ms)&&0>t.X(ms))return ds(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var s=0;s<t.g.length;s++){var i=this.D(r)>>>16,o=65535&this.D(r),a=t.D(s)>>>16,h=65535&t.D(s);n[2*r+2*s]+=o*h,bs(n,2*r+2*s),n[2*r+2*s+1]+=i*h,bs(n,2*r+2*s+1),n[2*r+2*s+1]+=o*a,bs(n,2*r+2*s+1),n[2*r+2*s+2]+=i*a,bs(n,2*r+2*s+2)}for(r=0;r<e;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=e;r<2*e;r++)n[r]=0;return new cs(n,0)},yt.gb=function(t){return Ts(this,t).h},yt.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)&t.D(r);return new cs(n,this.h&t.h)},yt.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)|t.D(r);return new cs(n,this.h|t.h)},yt.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)^t.D(r);return new cs(n,this.h^t.h)},ns.prototype.createWebChannel=ns.prototype.g,rs.prototype.send=rs.prototype.u,rs.prototype.open=rs.prototype.m,rs.prototype.close=rs.prototype.close,an.NO_ERROR=0,an.TIMEOUT=8,an.HTTP_ERROR=6,hn.COMPLETE="complete",ln.EventType=fn,fn.OPEN="a",fn.CLOSE="b",fn.ERROR="c",fn.MESSAGE="d",Ie.prototype.listen=Ie.prototype.O,_r.prototype.listenOnce=_r.prototype.P,_r.prototype.getLastError=_r.prototype.Sa,_r.prototype.getLastErrorCode=_r.prototype.Ia,_r.prototype.getStatus=_r.prototype.da,_r.prototype.getResponseJson=_r.prototype.Wa,_r.prototype.getResponseText=_r.prototype.ja,_r.prototype.send=_r.prototype.ha,_r.prototype.setWithCredentials=_r.prototype.Oa,as.prototype.digest=as.prototype.l,as.prototype.reset=as.prototype.reset,as.prototype.update=as.prototype.j,cs.prototype.add=cs.prototype.add,cs.prototype.multiply=cs.prototype.R,cs.prototype.modulo=cs.prototype.gb,cs.prototype.compare=cs.prototype.X,cs.prototype.toNumber=cs.prototype.ea,cs.prototype.toString=cs.prototype.toString,cs.prototype.getBits=cs.prototype.D,cs.fromNumber=ds,cs.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return ws(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=ds(Math.pow(n,8)),s=gs,i=0;i<e.length;i+=8){var o=Math.min(8,e.length-i),a=parseInt(e.substring(i,i+o),n);8>o?(o=ds(Math.pow(n,o)),s=s.R(o).add(ds(a))):s=(s=s.R(r)).add(ds(a))}return s};var Is=wt.createWebChannelTransport=function(){return new ns},As=wt.getStatEventTarget=function(){return Ze()},Ds=wt.ErrorCode=an,Ns=wt.EventType=hn,ks=wt.Event=Ye,xs=wt.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Rs=(wt.FetchXmlHttpFactory=pr,wt.WebChannel=ln),Ls=wt.XhrIo=_r,Os=wt.Md5=as,Ms=wt.Integer=cs;const Ps="@firebase/firestore";class Vs{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Vs.UNAUTHENTICATED=new Vs(null),Vs.GOOGLE_CREDENTIALS=new Vs("google-credentials-uid"),Vs.FIRST_PARTY=new Vs("first-party-uid"),Vs.MOCK_USER=new Vs("mock-user");let Fs="10.7.2";const Us=new D("@firebase/firestore");function Bs(){return Us.logLevel}function js(t,...e){if(Us.logLevel<=T.DEBUG){const n=e.map(zs);Us.debug(`Firestore (${Fs}): ${t}`,...n)}}function qs(t,...e){if(Us.logLevel<=T.ERROR){const n=e.map(zs);Us.error(`Firestore (${Fs}): ${t}`,...n)}}function $s(t,...e){if(Us.logLevel<=T.WARN){const n=e.map(zs);Us.warn(`Firestore (${Fs}): ${t}`,...n)}}function zs(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function Ks(t="Unexpected state"){const e=`FIRESTORE (${Fs}) INTERNAL ASSERTION FAILED: `+t;throw qs(e),new Error(e)}function Gs(t,e){t||Ks()}function Hs(t,e){return t}const Qs={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Ws extends f{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Xs{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Ys{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Js{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Vs.UNAUTHENTICATED)))}shutdown(){}}class Zs{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class ti{constructor(t){this.t=t,this.currentUser=Vs.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let s=new Xs;this.o=()=>{this.i++,this.currentUser=this.u(),s.resolve(),s=new Xs,t.enqueueRetryable((()=>r(this.currentUser)))};const i=()=>{const e=s;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{js("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),i()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(js("FirebaseAuthCredentialsProvider","Auth not yet detected"),s.resolve(),s=new Xs)}}),0),i()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(js("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Gs("string"==typeof e.accessToken),new Ys(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return Gs(null===t||"string"==typeof t),new Vs(t)}}class ei{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=Vs.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class ni{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new ei(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e(Vs.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class ri{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class si{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){const n=t=>{null!=t.error&&js("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.R;return this.R=t.token,js("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{js("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?r(t):js("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(Gs("string"==typeof t.token),this.R=t.token,new ri(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function ii(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class oi{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=ii(40);for(let r=0;r<n.length;++r)e.length<20&&n[r]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return e}}function ai(t,e){return t<e?-1:t>e?1:0}function hi(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}class ci{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Ws(Qs.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Ws(Qs.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Ws(Qs.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Ws(Qs.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return ci.fromMillis(Date.now())}static fromDate(t){return ci.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new ci(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?ai(this.nanoseconds,t.nanoseconds):ai(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class ui{constructor(t){this.timestamp=t}static fromTimestamp(t){return new ui(t)}static min(){return new ui(new ci(0,0))}static max(){return new ui(new ci(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class li{constructor(t,e,n){void 0===e?e=0:e>t.length&&Ks(),void 0===n?n=t.length-e:n>t.length-e&&Ks(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===li.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof li?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),s=e.get(r);if(n<s)return-1;if(n>s)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class di extends li{construct(t,e,n){return new di(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Ws(Qs.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new di(e)}static emptyPath(){return new di([])}}const fi=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class gi extends li{construct(t,e,n){return new gi(t,e,n)}static isValidIdentifier(t){return fi.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),gi.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new gi(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const s=()=>{if(0===n.length)throw new Ws(Qs.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let i=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new Ws(Qs.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Ws(Qs.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(i=!i,r++):"."!==e||i?(n+=e,r++):(s(),r++)}if(s(),i)throw new Ws(Qs.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new gi(e)}static emptyPath(){return new gi([])}}class pi{constructor(t){this.path=t}static fromPath(t){return new pi(di.fromString(t))}static fromName(t){return new pi(di.fromString(t).popFirst(5))}static empty(){return new pi(di.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===di.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return di.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new pi(new di(t.slice()))}}function mi(t){return new yi(t.readTime,t.key,-1)}class yi{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new yi(ui.min(),pi.empty(),-1)}static max(){return new yi(ui.max(),pi.empty(),-1)}}function vi(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=pi.comparator(t.documentKey,e.documentKey),0!==n?n:ai(t.largestBatchId,e.largestBatchId))}const wi="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class Ei{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function bi(t){if(t.code!==Qs.FAILED_PRECONDITION||t.message!==wi)throw t;js("LocalStore","Unexpectedly lost primary lease")}class _i{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Ks(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new _i(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof _i?e:_i.resolve(e)}catch(t){return _i.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):_i.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):_i.reject(e)}static resolve(t){return new _i(((e,n)=>{e(t)}))}static reject(t){return new _i(((e,n)=>{n(t)}))}static waitFor(t){return new _i(((e,n)=>{let r=0,s=0,i=!1;t.forEach((t=>{++r,t.next((()=>{++s,i&&s===r&&e()}),(t=>n(t)))})),i=!0,s===r&&e()}))}static or(t){let e=_i.resolve(!1);for(const n of t)e=e.next((t=>t?_i.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new _i(((n,r)=>{const s=t.length,i=new Array(s);let o=0;for(let a=0;a<s;a++){const h=a;e(t[h]).next((t=>{i[h]=t,++o,o===s&&n(i)}),(t=>r(t)))}}))}static doWhile(t,e){return new _i(((n,r)=>{const s=()=>{!0===t()?e().next((()=>{s()}),r):n()};s()}))}}class Ti{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new Xs,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new Ii(t,e.error)):this.V.resolve()},this.transaction.onerror=e=>{const n=xi(e.target.error);this.V.reject(new Ii(t,n))}}static open(t,e,n,r){try{return new Ti(e,t.transaction(r,n))}catch(t){throw new Ii(e,t)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(js("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const t=this.transaction;this.aborted||"function"!=typeof t.commit||t.commit()}store(t){const e=this.transaction.objectStore(t);return new Di(e)}}class Si{constructor(t,e,n){this.name=t,this.version=e,this.p=n,12.2===Si.S(l())&&qs("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return js("SimpleDb","Removing database:",t),Ni(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!d())return!1;if(Si.C())return!0;const t=l(),e=Si.S(t),n=0<e&&e<10,r=Si.v(t),s=0<r&&r<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||s)}static C(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.__PRIVATE_env)||void 0===t?void 0:t.F)}static M(t,e){return t.store(e)}static S(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static v(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async O(t){return this.db||(js("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=t=>{const n=t.target.result;e(n)},r.onblocked=()=>{n(new Ii(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{const r=e.target.error;"VersionError"===r.name?n(new Ws(Qs.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new Ws(Qs.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new Ii(t,r))},r.onupgradeneeded=t=>{js("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.p.N(e,r.transaction,t.oldVersion,this.version).next((()=>{js("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.B&&(this.db.onversionchange=t=>this.B(t)),this.db}L(t){this.B=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,r){const s="readonly"===e;let i=0;for(;;){++i;try{this.db=await this.O(t);const e=Ti.open(this.db,t,s?"readonly":"readwrite",n),i=r(e).next((t=>(e.g(),t))).catch((t=>(e.abort(t),_i.reject(t)))).toPromise();return i.catch((()=>{})),await e.m,i}catch(t){const e=t,n="FirebaseError"!==e.name&&i<3;if(js("SimpleDb","Transaction failed with error:",e.message,"Retrying:",n),this.close(),!n)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Ci{constructor(t){this.k=t,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(t){this.k=t}done(){this.q=!0}U(t){this.K=t}delete(){return Ni(this.k.delete())}}class Ii extends Ws{constructor(t,e){super(Qs.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function Ai(t){return"IndexedDbTransactionError"===t.name}class Di{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(js("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(js("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Ni(n)}add(t){return js("SimpleDb","ADD",this.store.name,t,t),Ni(this.store.add(t))}get(t){return Ni(this.store.get(t)).next((e=>(void 0===e&&(e=null),js("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return js("SimpleDb","DELETE",this.store.name,t),Ni(this.store.delete(t))}count(){return js("SimpleDb","COUNT",this.store.name),Ni(this.store.count())}W(t,e){const n=this.options(t,e),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const t=r.getAll(n.range);return new _i(((e,n)=>{t.onerror=t=>{n(t.target.error)},t.onsuccess=t=>{e(t.target.result)}}))}{const t=this.cursor(n),e=[];return this.G(t,((t,n)=>{e.push(n)})).next((()=>e))}}j(t,e){const n=this.store.getAll(t,null===e?void 0:e);return new _i(((t,e)=>{n.onerror=t=>{e(t.target.error)},n.onsuccess=e=>{t(e.target.result)}}))}H(t,e){js("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.J=!1;const r=this.cursor(n);return this.G(r,((t,e,n)=>n.delete()))}Y(t,e){let n;e?n=t:(n={},e=t);const r=this.cursor(n);return this.G(r,e)}Z(t){const e=this.cursor({});return new _i(((n,r)=>{e.onerror=t=>{const e=xi(t.target.error);r(e)},e.onsuccess=e=>{const r=e.target.result;r?t(r.primaryKey,r.value).next((t=>{t?r.continue():n()})):n()}}))}G(t,e){const n=[];return new _i(((r,s)=>{t.onerror=t=>{s(t.target.error)},t.onsuccess=t=>{const s=t.target.result;if(!s)return void r();const i=new Ci(s),o=e(s.primaryKey,s.value,i);if(o instanceof _i){const t=o.catch((t=>(i.done(),_i.reject(t))));n.push(t)}i.isDone?r():null===i.$?s.continue():s.continue(i.$)}})).next((()=>_i.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.J?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function Ni(t){return new _i(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=xi(t.target.error);n(e)}}))}let ki=!1;function xi(t){const e=Si.S(l());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new Ws("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ki||(ki=!0,setTimeout((()=>{throw t}),0)),t}}return t}class Ri{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.se(t),this.oe=t=>e.writeSequenceNumber(t))}se(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.oe&&this.oe(t),t}}function Li(t){return null==t}function Oi(t){return 0===t&&1/t==-1/0}Ri._e=-1;function Mi(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Pi(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}class Vi{constructor(t,e){this.comparator=t,this.root=e||Ui.EMPTY}insert(t,e){return new Vi(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Ui.BLACK,null,null))}remove(t){return new Vi(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Ui.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Fi(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Fi(this.root,t,this.comparator,!1)}getReverseIterator(){return new Fi(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Fi(this.root,t,this.comparator,!0)}}class Fi{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let s=1;for(;!t.isEmpty();)if(s=e?n(t.key,e):1,e&&r&&(s*=-1),s<0)t=this.isReverse?t.left:t.right;else{if(0===s){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Ui{constructor(t,e,n,r,s){this.key=t,this.value=e,this.color=null!=n?n:Ui.RED,this.left=null!=r?r:Ui.EMPTY,this.right=null!=s?s:Ui.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,s){return new Ui(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=s?s:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const s=n(t,r.key);return r=s<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===s?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Ui.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return Ui.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Ui.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Ui.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ks();if(this.right.isRed())throw Ks();const t=this.left.check();if(t!==this.right.check())throw Ks();return t+(this.isRed()?0:1)}}Ui.EMPTY=null,Ui.RED=!0,Ui.BLACK=!1,Ui.EMPTY=new class{constructor(){this.size=0}get key(){throw Ks()}get value(){throw Ks()}get color(){throw Ks()}get left(){throw Ks()}get right(){throw Ks()}copy(t,e,n,r,s){return this}insert(t,e,n){return new Ui(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class Bi{constructor(t){this.comparator=t,this.data=new Vi(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new ji(this.data.getIterator())}getIteratorFrom(t){return new ji(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof Bi))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new Bi(this.comparator);return e.data=t,e}}class ji{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class qi{constructor(t){this.fields=t,t.sort(gi.comparator)}static empty(){return new qi([])}unionWith(t){let e=new Bi(gi.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new qi(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return hi(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class $i extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class zi{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new $i("Invalid base64 string: "+t):t}}(t);return new zi(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new zi(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return ai(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}zi.EMPTY_BYTE_STRING=new zi("");const Ki=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Gi(t){if(Gs(!!t),"string"==typeof t){let e=0;const n=Ki.exec(t);if(Gs(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Hi(t.seconds),nanos:Hi(t.nanos)}}function Hi(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Qi(t){return"string"==typeof t?zi.fromBase64String(t):zi.fromUint8Array(t)}function Wi(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Xi(t){const e=t.mapValue.fields.__previous_value__;return Wi(e)?Xi(e):e}function Yi(t){const e=Gi(t.mapValue.fields.__local_write_time__.timestampValue);return new ci(e.seconds,e.nanos)}class Ji{constructor(t,e,n,r,s,i,o,a,h){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=s,this.forceLongPolling=i,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=h}}class Zi{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new Zi("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof Zi&&t.projectId===this.projectId&&t.database===this.database}}const to={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function eo(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Wi(t)?4:po(t)?9007199254740991:10:Ks()}function no(t,e){if(t===e)return!0;const n=eo(t);if(n!==eo(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Yi(t).isEqual(Yi(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Gi(t.timestampValue),r=Gi(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Qi(t.bytesValue).isEqual(Qi(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Hi(t.geoPointValue.latitude)===Hi(e.geoPointValue.latitude)&&Hi(t.geoPointValue.longitude)===Hi(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Hi(t.integerValue)===Hi(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Hi(t.doubleValue),r=Hi(e.doubleValue);return n===r?Oi(n)===Oi(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return hi(t.arrayValue.values||[],e.arrayValue.values||[],no);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Mi(n)!==Mi(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!no(n[t],r[t])))return!1;return!0}(t,e);default:return Ks()}}function ro(t,e){return void 0!==(t.values||[]).find((t=>no(t,e)))}function so(t,e){if(t===e)return 0;const n=eo(t),r=eo(e);if(n!==r)return ai(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return ai(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Hi(t.integerValue||t.doubleValue),r=Hi(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return io(t.timestampValue,e.timestampValue);case 4:return io(Yi(t),Yi(e));case 5:return ai(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Qi(t),r=Qi(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=ai(n[t],r[t]);if(0!==e)return e}return ai(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=ai(Hi(t.latitude),Hi(e.latitude));return 0!==n?n:ai(Hi(t.longitude),Hi(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=so(n[t],r[t]);if(e)return e}return ai(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===to.mapValue&&e===to.mapValue)return 0;if(t===to.mapValue)return 1;if(e===to.mapValue)return-1;const n=t.fields||{},r=Object.keys(n),s=e.fields||{},i=Object.keys(s);r.sort(),i.sort();for(let t=0;t<r.length&&t<i.length;++t){const e=ai(r[t],i[t]);if(0!==e)return e;const o=so(n[r[t]],s[i[t]]);if(0!==o)return o}return ai(r.length,i.length)}(t.mapValue,e.mapValue);default:throw Ks()}}function io(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return ai(t,e);const n=Gi(t),r=Gi(e),s=ai(n.seconds,r.seconds);return 0!==s?s:ai(n.nanos,r.nanos)}function oo(t){return ao(t)}function ao(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=Gi(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return Qi(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return pi.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=ao(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const s of e)r?r=!1:n+=",",n+=`${s}:${ao(t.fields[s])}`;return n+"}"}(t.mapValue):Ks()}function ho(t){return!!t&&"integerValue"in t}function co(t){return!!t&&"arrayValue"in t}function uo(t){return!!t&&"nullValue"in t}function lo(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function fo(t){return!!t&&"mapValue"in t}function go(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Pi(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=go(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=go(t.arrayValue.values[n]);return e}return Object.assign({},t)}function po(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class mo{constructor(t){this.value=t}static empty(){return new mo({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!fo(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=go(e)}setAll(t){let e=gi.emptyPath(),n={},r=[];t.forEach(((t,s)=>{if(!e.isImmediateParentOf(s)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=s.popLast()}t?n[s.lastSegment()]=go(t):r.push(s.lastSegment())}));const s=this.getFieldsMap(e);this.applyChanges(s,n,r)}delete(t){const e=this.field(t.popLast());fo(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return no(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];fo(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){Pi(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new mo(go(this.value))}}class yo{constructor(t,e,n,r,s,i,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=s,this.data=i,this.documentState=o}static newInvalidDocument(t){return new yo(t,0,ui.min(),ui.min(),ui.min(),mo.empty(),0)}static newFoundDocument(t,e,n,r){return new yo(t,1,e,ui.min(),n,r,0)}static newNoDocument(t,e){return new yo(t,2,e,ui.min(),ui.min(),mo.empty(),0)}static newUnknownDocument(t,e){return new yo(t,3,e,ui.min(),ui.min(),mo.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(ui.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=mo.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=mo.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=ui.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof yo&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new yo(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class vo{constructor(t,e){this.position=t,this.inclusive=e}}function wo(t,e,n){let r=0;for(let s=0;s<t.position.length;s++){const i=e[s],o=t.position[s];if(r=i.field.isKeyField()?pi.comparator(pi.fromName(o.referenceValue),n.key):so(o,n.data.field(i.field)),"desc"===i.dir&&(r*=-1),0!==r)break}return r}function Eo(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!no(t.position[n],e.position[n]))return!1;return!0}class bo{constructor(t,e="asc"){this.field=t,this.dir=e}}function _o(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class To{}class So extends To{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new xo(t,e,n):"array-contains"===e?new Mo(t,n):"in"===e?new Po(t,n):"not-in"===e?new Vo(t,n):"array-contains-any"===e?new Fo(t,n):new So(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new Ro(t,n):new Lo(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(so(e,this.value)):null!==e&&eo(this.value)===eo(e)&&this.matchesComparison(so(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Ks()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Co extends To{constructor(t,e){super(),this.filters=t,this.op=e,this.ue=null}static create(t,e){return new Co(t,e)}matches(t){return Io(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function Io(t){return"and"===t.op}function Ao(t){return function(t){for(const e of t.filters)if(e instanceof Co)return!1;return!0}(t)&&Io(t)}function Do(t){if(t instanceof So)return t.field.canonicalString()+t.op.toString()+oo(t.value);if(Ao(t))return t.filters.map((t=>Do(t))).join(",");{const e=t.filters.map((t=>Do(t))).join(",");return`${t.op}(${e})`}}function No(t,e){return t instanceof So?function(t,e){return e instanceof So&&t.op===e.op&&t.field.isEqual(e.field)&&no(t.value,e.value)}(t,e):t instanceof Co?function(t,e){return e instanceof Co&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,r)=>t&&No(n,e.filters[r])),!0)}(t,e):void Ks()}function ko(t){return t instanceof So?function(t){return`${t.field.canonicalString()} ${t.op} ${oo(t.value)}`}(t):t instanceof Co?function(t){return t.op.toString()+" {"+t.getFilters().map(ko).join(" ,")+"}"}(t):"Filter"}class xo extends So{constructor(t,e,n){super(t,e,n),this.key=pi.fromName(n.referenceValue)}matches(t){const e=pi.comparator(t.key,this.key);return this.matchesComparison(e)}}class Ro extends So{constructor(t,e){super(t,"in",e),this.keys=Oo(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Lo extends So{constructor(t,e){super(t,"not-in",e),this.keys=Oo(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Oo(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>pi.fromName(t.referenceValue)))}class Mo extends So{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return co(e)&&ro(e.arrayValue,this.value)}}class Po extends So{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&ro(this.value.arrayValue,e)}}class Vo extends So{constructor(t,e){super(t,"not-in",e)}matches(t){if(ro(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!ro(this.value.arrayValue,e)}}class Fo extends So{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!co(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>ro(this.value.arrayValue,t)))}}class Uo{constructor(t,e=null,n=[],r=[],s=null,i=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=s,this.startAt=i,this.endAt=o,this.ce=null}}function Bo(t,e=null,n=[],r=[],s=null,i=null,o=null){return new Uo(t,e,n,r,s,i,o)}function jo(t){const e=Hs(t);if(null===e.ce){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>Do(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Li(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>oo(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>oo(t))).join(",")),e.ce=t}return e.ce}function qo(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!_o(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!No(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!Eo(t.startAt,e.startAt)&&Eo(t.endAt,e.endAt)}function $o(t){return pi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class zo{constructor(t,e=null,n=[],r=[],s=null,i="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=s,this.limitType=i,this.startAt=o,this.endAt=a,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function Ko(t){return new zo(t)}function Go(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Ho(t){const e=Hs(t);if(null===e.le){e.le=[];const t=new Set;for(const n of e.explicitOrderBy)e.le.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",r=function(t){let e=new Bi(gi.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);r.forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.le.push(new bo(r,n))})),t.has(gi.keyField().canonicalString())||e.le.push(new bo(gi.keyField(),n))}return e.le}function Qo(t){const e=Hs(t);return e.he||(e.he=function(t,e){if("F"===t.limitType)return Bo(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new bo(t.field,e)}));const n=t.endAt?new vo(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new vo(t.startAt.position,t.startAt.inclusive):null;return Bo(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}(e,Ho(t))),e.he}function Wo(t,e,n){return new zo(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Xo(t,e){return qo(Qo(t),Qo(e))&&t.limitType===e.limitType}function Yo(t){return`${jo(Qo(t))}|lt:${t.limitType}`}function Jo(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>ko(t))).join(", ")}]`),Li(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>oo(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>oo(t))).join(",")),`Target(${e})`}(Qo(t))}; limitType=${t.limitType})`}function Zo(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):pi.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of Ho(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=wo(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,Ho(t),e)||t.endAt&&!function(t,e,n){const r=wo(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,Ho(t),e))}(t,e)}function ta(t){return(e,n)=>{let r=!1;for(const s of Ho(t)){const t=ea(s,e,n);if(0!==t)return t;r=r||s.field.isKeyField()}return 0}}function ea(t,e,n){const r=t.field.isKeyField()?pi.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),s=n.data.field(t);return null!==r&&null!==s?so(r,s):Ks()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Ks()}}class na{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){Pi(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return function(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}(this.inner)}size(){return this.innerSize}}const ra=new Vi(pi.comparator);function sa(){return ra}const ia=new Vi(pi.comparator);function oa(...t){let e=ia;for(const n of t)e=e.insert(n.key,n);return e}function aa(t){let e=ia;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function ha(){return ua()}function ca(){return ua()}function ua(){return new na((t=>t.toString()),((t,e)=>t.isEqual(e)))}new Vi(pi.comparator);const la=new Bi(pi.comparator);function da(...t){let e=la;for(const n of t)e=e.add(n);return e}const fa=new Bi(ai);class ga{constructor(){this._=void 0}}function pa(t,e,n){return t instanceof ya?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Wi(e)&&(e=Xi(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof va?wa(t,e):t instanceof Ea?ba(t,e):function(t,e){const n=function(t,e){return t instanceof _a?function(t){return ho(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}(t,e),r=Ta(n)+Ta(t.Ie);return ho(n)&&ho(t.Ie)?function(t){return{integerValue:""+t}}(r):function(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Oi(e)?"-0":e}}(t.serializer,r)}(t,e)}function ma(t,e,n){return t instanceof va?wa(t,e):t instanceof Ea?ba(t,e):n}class ya extends ga{}class va extends ga{constructor(t){super(),this.elements=t}}function wa(t,e){const n=Sa(e);for(const e of t.elements)n.some((t=>no(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Ea extends ga{constructor(t){super(),this.elements=t}}function ba(t,e){let n=Sa(e);for(const e of t.elements)n=n.filter((t=>!no(t,e)));return{arrayValue:{values:n}}}class _a extends ga{constructor(t,e){super(),this.serializer=t,this.Ie=e}}function Ta(t){return Hi(t.integerValue||t.doubleValue)}function Sa(t){return co(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Ca{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new Ca}static exists(t){return new Ca(void 0,t)}static updateTime(t){return new Ca(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Ia(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Aa{}function Da(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Va(t.key,Ca.none()):new Ra(t.key,t.data,Ca.none());{const n=t.data,r=mo.empty();let s=new Bi(gi.comparator);for(let t of e.fields)if(!s.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),s=s.add(t)}return new La(t.key,r,new qi(s.toArray()),Ca.none())}}function Na(t,e,n){t instanceof Ra?function(t,e,n){const r=t.value.clone(),s=Ma(t.fieldTransforms,e,n.transformResults);r.setAll(s),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof La?function(t,e,n){if(!Ia(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=Ma(t.fieldTransforms,e,n.transformResults),s=e.data;s.setAll(Oa(t)),s.setAll(r),e.convertToFoundDocument(n.version,s).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function ka(t,e,n,r){return t instanceof Ra?function(t,e,n,r){if(!Ia(t.precondition,e))return n;const s=t.value.clone(),i=Pa(t.fieldTransforms,r,e);return s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null}(t,e,n,r):t instanceof La?function(t,e,n,r){if(!Ia(t.precondition,e))return n;const s=Pa(t.fieldTransforms,r,e),i=e.data;return i.setAll(Oa(t)),i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return Ia(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function xa(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&hi(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof va&&e instanceof va||t instanceof Ea&&e instanceof Ea?hi(t.elements,e.elements,no):t instanceof _a&&e instanceof _a?no(t.Ie,e.Ie):t instanceof ya&&e instanceof ya}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class Ra extends Aa{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class La extends Aa{constructor(t,e,n,r,s=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=s,this.type=1}getFieldMask(){return this.fieldMask}}function Oa(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function Ma(t,e,n){const r=new Map;Gs(t.length===n.length);for(let s=0;s<n.length;s++){const i=t[s],o=i.transform,a=e.data.field(i.field);r.set(i.field,ma(o,a,n[s]))}return r}function Pa(t,e,n){const r=new Map;for(const s of t){const t=s.transform,i=n.data.field(s.field);r.set(s.field,pa(t,i,e))}return r}class Va extends Aa{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Fa{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&Na(r,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=ka(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=ka(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=ca();return this.mutations.forEach((r=>{const s=t.get(r.key),i=s.overlayedDocument;let o=this.applyToLocalView(i,s.mutatedFields);o=e.has(r.key)?null:o;const a=Da(i,o);null!==a&&n.set(r.key,a),i.isValidDocument()||i.convertToNoDocument(ui.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),da())}isEqual(t){return this.batchId===t.batchId&&hi(this.mutations,t.mutations,((t,e)=>xa(t,e)))&&hi(this.baseMutations,t.baseMutations,((t,e)=>xa(t,e)))}}class Ua{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Ba{constructor(t,e){this.count=t,this.unchangedNames=e}}var ja,qa;function $a(t){if(void 0===t)return qs("GRPC error has no .code"),Qs.UNKNOWN;switch(t){case ja.OK:return Qs.OK;case ja.CANCELLED:return Qs.CANCELLED;case ja.UNKNOWN:return Qs.UNKNOWN;case ja.DEADLINE_EXCEEDED:return Qs.DEADLINE_EXCEEDED;case ja.RESOURCE_EXHAUSTED:return Qs.RESOURCE_EXHAUSTED;case ja.INTERNAL:return Qs.INTERNAL;case ja.UNAVAILABLE:return Qs.UNAVAILABLE;case ja.UNAUTHENTICATED:return Qs.UNAUTHENTICATED;case ja.INVALID_ARGUMENT:return Qs.INVALID_ARGUMENT;case ja.NOT_FOUND:return Qs.NOT_FOUND;case ja.ALREADY_EXISTS:return Qs.ALREADY_EXISTS;case ja.PERMISSION_DENIED:return Qs.PERMISSION_DENIED;case ja.FAILED_PRECONDITION:return Qs.FAILED_PRECONDITION;case ja.ABORTED:return Qs.ABORTED;case ja.OUT_OF_RANGE:return Qs.OUT_OF_RANGE;case ja.UNIMPLEMENTED:return Qs.UNIMPLEMENTED;case ja.DATA_LOSS:return Qs.DATA_LOSS;default:return Ks()}}(qa=ja||(ja={}))[qa.OK=0]="OK",qa[qa.CANCELLED=1]="CANCELLED",qa[qa.UNKNOWN=2]="UNKNOWN",qa[qa.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",qa[qa.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",qa[qa.NOT_FOUND=5]="NOT_FOUND",qa[qa.ALREADY_EXISTS=6]="ALREADY_EXISTS",qa[qa.PERMISSION_DENIED=7]="PERMISSION_DENIED",qa[qa.UNAUTHENTICATED=16]="UNAUTHENTICATED",qa[qa.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",qa[qa.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",qa[qa.ABORTED=10]="ABORTED",qa[qa.OUT_OF_RANGE=11]="OUT_OF_RANGE",qa[qa.UNIMPLEMENTED=12]="UNIMPLEMENTED",qa[qa.INTERNAL=13]="INTERNAL",qa[qa.UNAVAILABLE=14]="UNAVAILABLE",qa[qa.DATA_LOSS=15]="DATA_LOSS";const za=new Ms([4294967295,4294967295],0);function Ka(t){const e=(new TextEncoder).encode(t),n=new Os;return n.update(e),new Uint8Array(n.digest())}function Ga(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),s=e.getUint32(8,!0),i=e.getUint32(12,!0);return[new Ms([n,r],0),new Ms([s,i],0)]}class Ha{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new Qa(`Invalid padding: ${e}`);if(n<0)throw new Qa(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new Qa(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new Qa(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ee=Ms.fromNumber(this.Te)}de(t,e,n){let r=t.add(e.multiply(Ms.fromNumber(n)));return 1===r.compare(za)&&(r=new Ms([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(t){return 0!=(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.Te)return!1;const e=Ka(t),[n,r]=Ga(e);for(let t=0;t<this.hashCount;t++){const e=this.de(n,r,t);if(!this.Ae(e))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,s=new Uint8Array(Math.ceil(t/8)),i=new Ha(s,r,e);return n.forEach((t=>i.insert(t))),i}insert(t){if(0===this.Te)return;const e=Ka(t),[n,r]=Ga(e);for(let t=0;t<this.hashCount;t++){const e=this.de(n,r,t);this.Re(e)}}Re(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class Qa extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Wa{constructor(t,e,n,r,s){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=s}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,Xa.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new Wa(ui.min(),r,new Vi(ai),sa(),da())}}class Xa{constructor(t,e,n,r,s){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=s}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new Xa(n,e,da(),da(),da())}}class Ya{constructor(t,e,n,r){this.Ve=t,this.removedTargetIds=e,this.key=n,this.me=r}}class Ja{constructor(t,e){this.targetId=t,this.fe=e}}class Za{constructor(t,e,n=zi.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class th{constructor(){this.ge=0,this.pe=rh(),this.ye=zi.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.ye=t)}ve(){let t=da(),e=da(),n=da();return this.pe.forEach(((r,s)=>{switch(s){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Ks()}})),new Xa(this.ye,this.we,t,e,n)}Fe(){this.Se=!1,this.pe=rh()}Me(t,e){this.Se=!0,this.pe=this.pe.insert(t,e)}xe(t){this.Se=!0,this.pe=this.pe.remove(t)}Oe(){this.ge+=1}Ne(){this.ge-=1,Gs(this.ge>=0)}Be(){this.Se=!0,this.we=!0}}class eh{constructor(t){this.Le=t,this.ke=new Map,this.qe=sa(),this.Qe=nh(),this.Ke=new Vi(ai)}$e(t){for(const e of t.Ve)t.me&&t.me.isFoundDocument()?this.Ue(e,t.me):this.We(e,t.key,t.me);for(const e of t.removedTargetIds)this.We(e,t.key,t.me)}Ge(t){this.forEachTarget(t,(e=>{const n=this.ze(e);switch(t.state){case 0:this.je(e)&&n.Ce(t.resumeToken);break;case 1:n.Ne(),n.be||n.Fe(),n.Ce(t.resumeToken);break;case 2:n.Ne(),n.be||this.removeTarget(e);break;case 3:this.je(e)&&(n.Be(),n.Ce(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),n.Ce(t.resumeToken));break;default:Ks()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ke.forEach(((t,n)=>{this.je(n)&&e(n)}))}Je(t){const e=t.targetId,n=t.fe.count,r=this.Ye(e);if(r){const s=r.target;if($o(s))if(0===n){const t=new pi(s.path);this.We(e,t,yo.newNoDocument(t,ui.min()))}else Gs(1===n);else{const r=this.Ze(e);if(r!==n){const n=this.Xe(t),s=n?this.et(n,t,r):1;if(0!==s){this.He(e);const t=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,t)}}}}}Xe(t){const e=t.fe.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:s=0}=e;let i,o;try{i=Qi(n).toUint8Array()}catch(t){if(t instanceof $i)return $s("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new Ha(i,r,s)}catch(t){return $s(t instanceof Qa?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.Te?null:o}et(t,e,n){return e.fe.count===n-this.rt(t,e.targetId)?0:2}rt(t,e){const n=this.Le.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const s=this.Le.nt(),i=`projects/${s.projectId}/databases/${s.database}/documents/${n.path.canonicalString()}`;t.mightContain(i)||(this.We(e,n,null),r++)})),r}it(t){const e=new Map;this.ke.forEach(((n,r)=>{const s=this.Ye(r);if(s){if(n.current&&$o(s.target)){const e=new pi(s.target.path);null!==this.qe.get(e)||this.st(r,e)||this.We(r,e,yo.newNoDocument(e,t))}n.De&&(e.set(r,n.ve()),n.Fe())}}));let n=da();this.Qe.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.Ye(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.qe.forEach(((e,n)=>n.setReadTime(t)));const r=new Wa(t,e,this.Ke,this.qe,n);return this.qe=sa(),this.Qe=nh(),this.Ke=new Vi(ai),r}Ue(t,e){if(!this.je(t))return;const n=this.st(t,e.key)?2:0;this.ze(t).Me(e.key,n),this.qe=this.qe.insert(e.key,e),this.Qe=this.Qe.insert(e.key,this.ot(e.key).add(t))}We(t,e,n){if(!this.je(t))return;const r=this.ze(t);this.st(t,e)?r.Me(e,1):r.xe(e),this.Qe=this.Qe.insert(e,this.ot(e).delete(t)),n&&(this.qe=this.qe.insert(e,n))}removeTarget(t){this.ke.delete(t)}Ze(t){const e=this.ze(t).ve();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Oe(t){this.ze(t).Oe()}ze(t){let e=this.ke.get(t);return e||(e=new th,this.ke.set(t,e)),e}ot(t){let e=this.Qe.get(t);return e||(e=new Bi(ai),this.Qe=this.Qe.insert(t,e)),e}je(t){const e=null!==this.Ye(t);return e||js("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){const e=this.ke.get(t);return e&&e.be?null:this.Le._t(t)}He(t){this.ke.set(t,new th),this.Le.getRemoteKeysForTarget(t).forEach((e=>{this.We(t,e,null)}))}st(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}}function nh(){return new Vi(pi.comparator)}function rh(){return new Vi(pi.comparator)}const sh={asc:"ASCENDING",desc:"DESCENDING"},ih={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},oh={and:"AND",or:"OR"};class ah{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function hh(t,e){return t.useProto3Json||Li(e)?e:{value:e}}function ch(t){return Gs(!!t),ui.fromTimestamp(function(t){const e=Gi(t);return new ci(e.seconds,e.nanos)}(t))}function uh(t,e){const n=function(t){return new di(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function lh(t){const e=di.fromString(t);return Gs(Ih(e)),e}function dh(t,e){const n=lh(e);if(n.get(1)!==t.databaseId.projectId)throw new Ws(Qs.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Ws(Qs.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new pi(ph(n))}function fh(t,e){return function(t,e){return uh(t,e).canonicalString()}(t.databaseId,e)}function gh(t){return new di(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function ph(t){return Gs(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function mh(t,e){return{documents:[fh(t,e.path)]}}function yh(t,e){const n={structuredQuery:{}},r=e.path;let s;null!==e.collectionGroup?(s=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(s=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=fh(t,s);const i=function(t){if(0!==t.length)return Ch(Co.create(t,"and"))}(e.filters);i&&(n.structuredQuery.where=i);const o=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:Th(t.field),direction:Eh(t.dir)}}(t)))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=hh(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{ut:n,parent:s}}function vh(t){let e=function(t){const e=lh(t);return 4===e.length?di.emptyPath():ph(e)}(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let s=null;if(r>0){Gs(1===r);const t=n.from[0];t.allDescendants?s=t.collectionId:e=e.child(t.collectionId)}let i=[];n.where&&(i=function(t){const e=wh(t);return e instanceof Co&&Ao(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new bo(Sh(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Li(e)?null:e}(n.limit));let h=null;n.startAt&&(h=function(t){const e=!!t.before,n=t.values||[];return new vo(n,e)}(n.startAt));let c=null;return n.endAt&&(c=function(t){const e=!t.before,n=t.values||[];return new vo(n,e)}(n.endAt)),function(t,e,n,r,s,i,o,a){return new zo(t,e,n,r,s,i,o,a)}(e,s,o,i,a,"F",h,c)}function wh(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=Sh(t.unaryFilter.field);return So.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=Sh(t.unaryFilter.field);return So.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=Sh(t.unaryFilter.field);return So.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const s=Sh(t.unaryFilter.field);return So.create(s,"!=",{nullValue:"NULL_VALUE"});default:return Ks()}}(t):void 0!==t.fieldFilter?function(t){return So.create(Sh(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ks()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return Co.create(t.compositeFilter.filters.map((t=>wh(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return Ks()}}(t.compositeFilter.op))}(t):Ks()}function Eh(t){return sh[t]}function bh(t){return ih[t]}function _h(t){return oh[t]}function Th(t){return{fieldPath:t.canonicalString()}}function Sh(t){return gi.fromServerFormat(t.fieldPath)}function Ch(t){return t instanceof So?function(t){if("=="===t.op){if(lo(t.value))return{unaryFilter:{field:Th(t.field),op:"IS_NAN"}};if(uo(t.value))return{unaryFilter:{field:Th(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(lo(t.value))return{unaryFilter:{field:Th(t.field),op:"IS_NOT_NAN"}};if(uo(t.value))return{unaryFilter:{field:Th(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Th(t.field),op:bh(t.op),value:t.value}}}(t):t instanceof Co?function(t){const e=t.getFilters().map((t=>Ch(t)));return 1===e.length?e[0]:{compositeFilter:{op:_h(t.op),filters:e}}}(t):Ks()}function Ih(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Ah{constructor(t,e,n,r,s=ui.min(),i=ui.min(),o=zi.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=s,this.lastLimboFreeSnapshotVersion=i,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new Ah(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Ah(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Ah(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Ah(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Dh{constructor(t){this.ct=t}}function Nh(t){const e=vh({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Wo(e,e.limit,"L"):e}class kh{constructor(){}Pt(t,e){this.It(t,e),e.Tt()}It(t,e){if("nullValue"in t)this.Et(e,5);else if("booleanValue"in t)this.Et(e,10),e.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(e,15),e.dt(Hi(t.integerValue));else if("doubleValue"in t){const n=Hi(t.doubleValue);isNaN(n)?this.Et(e,13):(this.Et(e,15),Oi(n)?e.dt(0):e.dt(n))}else if("timestampValue"in t){const n=t.timestampValue;this.Et(e,20),"string"==typeof n?e.At(n):(e.At(`${n.seconds||""}`),e.dt(n.nanos||0))}else if("stringValue"in t)this.Rt(t.stringValue,e),this.Vt(e);else if("bytesValue"in t)this.Et(e,30),e.ft(Qi(t.bytesValue)),this.Vt(e);else if("referenceValue"in t)this.gt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Et(e,45),e.dt(n.latitude||0),e.dt(n.longitude||0)}else"mapValue"in t?po(t)?this.Et(e,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,e),this.Vt(e)):"arrayValue"in t?(this.wt(t.arrayValue,e),this.Vt(e)):Ks()}Rt(t,e){this.Et(e,25),this.St(t,e)}St(t,e){e.At(t)}yt(t,e){const n=t.fields||{};this.Et(e,55);for(const t of Object.keys(n))this.Rt(t,e),this.It(n[t],e)}wt(t,e){const n=t.values||[];this.Et(e,50);for(const t of n)this.It(t,e)}gt(t,e){this.Et(e,37),pi.fromName(t).path.forEach((t=>{this.Et(e,60),this.St(t,e)}))}Et(t,e){t.dt(e)}Vt(t){t.dt(2)}}kh.bt=new kh;class xh{constructor(){this._n=new Rh}addToCollectionParentIndex(t,e){return this._n.add(e),_i.resolve()}getCollectionParents(t,e){return _i.resolve(this._n.getEntries(e))}addFieldIndex(t,e){return _i.resolve()}deleteFieldIndex(t,e){return _i.resolve()}deleteAllFieldIndexes(t){return _i.resolve()}createTargetIndexes(t,e){return _i.resolve()}getDocumentsMatchingTarget(t,e){return _i.resolve(null)}getIndexType(t,e){return _i.resolve(0)}getFieldIndexes(t,e){return _i.resolve([])}getNextCollectionGroupToUpdate(t){return _i.resolve(null)}getMinOffset(t,e){return _i.resolve(yi.min())}getMinOffsetFromCollectionGroup(t,e){return _i.resolve(yi.min())}updateCollectionGroup(t,e,n){return _i.resolve()}updateIndexEntries(t,e){return _i.resolve()}}class Rh{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Bi(di.comparator),s=!r.has(n);return this.index[e]=r.add(n),s}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new Bi(di.comparator)).toArray()}}new Uint8Array(0);class Lh{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Lh(t,Lh.DEFAULT_COLLECTION_PERCENTILE,Lh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Lh.DEFAULT_COLLECTION_PERCENTILE=10,Lh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Lh.DEFAULT=new Lh(41943040,Lh.DEFAULT_COLLECTION_PERCENTILE,Lh.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Lh.DISABLED=new Lh(-1,0,0);class Oh{constructor(t){this.On=t}next(){return this.On+=2,this.On}static Nn(){return new Oh(0)}static Bn(){return new Oh(-1)}}class Mh{constructor(){this.changes=new na((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,yo.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?_i.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class Ph{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class Vh{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&ka(n.mutation,t,qi.empty(),ci.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,da()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=da()){const r=ha();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=oa();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=ha();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,da())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let s=sa();const i=ua(),o=ua();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof La)?s=s.insert(e.key,e):void 0!==o?(i.set(e.key,o.mutation.getFieldMask()),ka(o.mutation,e,o.mutation.getFieldMask(),ci.now())):i.set(e.key,qi.empty())})),this.recalculateAndSaveOverlays(t,s).next((t=>(t.forEach(((t,e)=>i.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new Ph(e,null!==(n=i.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=ua();let r=new Vi(((t,e)=>t-e)),s=da();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const s of t)s.keys().forEach((t=>{const i=e.get(t);if(null===i)return;let o=n.get(t)||qi.empty();o=s.applyToLocalView(i,o),n.set(t,o);const a=(r.get(s.batchId)||da()).add(t);r=r.insert(s.batchId,a)}))})).next((()=>{const i=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,h=r.value,c=ca();h.forEach((t=>{if(!s.has(t)){const r=Da(e.get(t),n.get(t));null!==r&&c.set(t,r),s=s.add(t)}})),i.push(this.documentOverlayCache.saveOverlays(t,a,c))}return _i.waitFor(i)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n,r){return function(t){return pi.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):function(t){return null!==t.collectionGroup}(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,r):this.getDocumentsMatchingCollectionQuery(t,e,n,r)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((s=>{const i=r-s.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-s.size):_i.resolve(ha());let o=-1,a=s;return i.next((e=>_i.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),s.get(e)?_i.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,s))).next((()=>this.computeViews(t,a,e,da()))).next((t=>({batchId:o,changes:aa(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new pi(e)).next((t=>{let e=oa();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,r){const s=e.collectionGroup;let i=oa();return this.indexManager.getCollectionParents(t,s).next((o=>_i.forEach(o,(o=>{const a=function(t,e){return new zo(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(s));return this.getDocumentsMatchingCollectionQuery(t,a,n,r).next((t=>{t.forEach(((t,e)=>{i=i.insert(t,e)}))}))})).next((()=>i))))}getDocumentsMatchingCollectionQuery(t,e,n,r){let s;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((i=>(s=i,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,s,r)))).next((t=>{s.forEach(((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,yo.newInvalidDocument(r)))}));let n=oa();return t.forEach(((t,r)=>{const i=s.get(t);void 0!==i&&ka(i.mutation,r,qi.empty(),ci.now()),Zo(e,r)&&(n=n.insert(t,r))})),n}))}}class Fh{constructor(t){this.serializer=t,this.cr=new Map,this.lr=new Map}getBundleMetadata(t,e){return _i.resolve(this.cr.get(e))}saveBundleMetadata(t,e){return this.cr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:ch(t.createTime)}}(e)),_i.resolve()}getNamedQuery(t,e){return _i.resolve(this.lr.get(e))}saveNamedQuery(t,e){return this.lr.set(e.name,function(t){return{name:t.name,query:Nh(t.bundledQuery),readTime:ch(t.readTime)}}(e)),_i.resolve()}}class Uh{constructor(){this.overlays=new Vi(pi.comparator),this.hr=new Map}getOverlay(t,e){return _i.resolve(this.overlays.get(e))}getOverlays(t,e){const n=ha();return _i.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.ht(t,e,r)})),_i.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.hr.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.hr.delete(n)),_i.resolve()}getOverlaysForCollection(t,e,n){const r=ha(),s=e.length+1,i=new pi(e.child("")),o=this.overlays.getIteratorFrom(i);for(;o.hasNext();){const t=o.getNext().value,i=t.getKey();if(!e.isPrefixOf(i.path))break;i.path.length===s&&t.largestBatchId>n&&r.set(t.getKey(),t)}return _i.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let s=new Vi(((t,e)=>t-e));const i=this.overlays.getIterator();for(;i.hasNext();){const t=i.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=s.get(t.largestBatchId);null===e&&(e=ha(),s=s.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=ha(),a=s.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return _i.resolve(o)}ht(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Ua(e,n));let s=this.hr.get(e);void 0===s&&(s=da(),this.hr.set(e,s)),this.hr.set(e,s.add(n.key))}}class Bh{constructor(){this.Pr=new Bi(jh.Ir),this.Tr=new Bi(jh.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(t,e){const n=new jh(t,e);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.Ar(new jh(t,e))}Rr(t,e){t.forEach((t=>this.removeReference(t,e)))}Vr(t){const e=new pi(new di([])),n=new jh(e,t),r=new jh(e,t+1),s=[];return this.Tr.forEachInRange([n,r],(t=>{this.Ar(t),s.push(t.key)})),s}mr(){this.Pr.forEach((t=>this.Ar(t)))}Ar(t){this.Pr=this.Pr.delete(t),this.Tr=this.Tr.delete(t)}gr(t){const e=new pi(new di([])),n=new jh(e,t),r=new jh(e,t+1);let s=da();return this.Tr.forEachInRange([n,r],(t=>{s=s.add(t.key)})),s}containsKey(t){const e=new jh(t,0),n=this.Pr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class jh{constructor(t,e){this.key=t,this.pr=e}static Ir(t,e){return pi.comparator(t.key,e.key)||ai(t.pr,e.pr)}static Er(t,e){return ai(t.pr,e.pr)||pi.comparator(t.key,e.key)}}class qh{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.yr=1,this.wr=new Bi(jh.Ir)}checkEmpty(t){return _i.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const s=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const i=new Fa(s,e,n,r);this.mutationQueue.push(i);for(const e of r)this.wr=this.wr.add(new jh(e.key,s)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return _i.resolve(i)}lookupMutationBatch(t,e){return _i.resolve(this.Sr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.br(n),s=r<0?0:r;return _i.resolve(this.mutationQueue.length>s?this.mutationQueue[s]:null)}getHighestUnacknowledgedBatchId(){return _i.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(t){return _i.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new jh(e,0),r=new jh(e,Number.POSITIVE_INFINITY),s=[];return this.wr.forEachInRange([n,r],(t=>{const e=this.Sr(t.pr);s.push(e)})),_i.resolve(s)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new Bi(ai);return e.forEach((t=>{const e=new jh(t,0),r=new jh(t,Number.POSITIVE_INFINITY);this.wr.forEachInRange([e,r],(t=>{n=n.add(t.pr)}))})),_i.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let s=n;pi.isDocumentKey(s)||(s=s.child(""));const i=new jh(new pi(s),0);let o=new Bi(ai);return this.wr.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.pr)),!0)}),i),_i.resolve(this.Dr(o))}Dr(t){const e=[];return t.forEach((t=>{const n=this.Sr(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){Gs(0===this.Cr(e.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return _i.forEach(e.mutations,(r=>{const s=new jh(r.key,e.batchId);return n=n.delete(s),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.wr=n}))}Mn(t){}containsKey(t,e){const n=new jh(e,0),r=this.wr.firstAfterOrEqual(n);return _i.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,_i.resolve()}Cr(t,e){return this.br(t)}br(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Sr(t){const e=this.br(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class $h{constructor(t){this.vr=t,this.docs=new Vi(pi.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),s=r?r.size:0,i=this.vr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:i}),this.size+=i-s,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return _i.resolve(n?n.document.mutableCopy():yo.newInvalidDocument(e))}getEntries(t,e){let n=sa();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():yo.newInvalidDocument(t))})),_i.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let s=sa();const i=e.path,o=new pi(i.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!i.isPrefixOf(t.path))break;t.path.length>i.length+1||vi(mi(o),n)<=0||(r.has(o.key)||Zo(e,o))&&(s=s.insert(o.key,o.mutableCopy()))}return _i.resolve(s)}getAllFromCollectionGroup(t,e,n,r){Ks()}Fr(t,e){return _i.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new zh(this)}getSize(t){return _i.resolve(this.size)}}class zh extends Mh{constructor(t){super(),this.ar=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this.ar.addEntry(t,r)):this.ar.removeEntry(n)})),_i.waitFor(e)}getFromCache(t,e){return this.ar.getEntry(t,e)}getAllFromCache(t,e){return this.ar.getEntries(t,e)}}class Kh{constructor(t){this.persistence=t,this.Mr=new na((t=>jo(t)),qo),this.lastRemoteSnapshotVersion=ui.min(),this.highestTargetId=0,this.Or=0,this.Nr=new Bh,this.targetCount=0,this.Br=Oh.Nn()}forEachTarget(t,e){return this.Mr.forEach(((t,n)=>e(n))),_i.resolve()}getLastRemoteSnapshotVersion(t){return _i.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return _i.resolve(this.Or)}allocateTargetId(t){return this.highestTargetId=this.Br.next(),_i.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Or&&(this.Or=e),_i.resolve()}qn(t){this.Mr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Br=new Oh(e),this.highestTargetId=e),t.sequenceNumber>this.Or&&(this.Or=t.sequenceNumber)}addTargetData(t,e){return this.qn(e),this.targetCount+=1,_i.resolve()}updateTargetData(t,e){return this.qn(e),_i.resolve()}removeTargetData(t,e){return this.Mr.delete(e.target),this.Nr.Vr(e.targetId),this.targetCount-=1,_i.resolve()}removeTargets(t,e,n){let r=0;const s=[];return this.Mr.forEach(((i,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Mr.delete(i),s.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),_i.waitFor(s).next((()=>r))}getTargetCount(t){return _i.resolve(this.targetCount)}getTargetData(t,e){const n=this.Mr.get(e)||null;return _i.resolve(n)}addMatchingKeys(t,e,n){return this.Nr.dr(e,n),_i.resolve()}removeMatchingKeys(t,e,n){this.Nr.Rr(e,n);const r=this.persistence.referenceDelegate,s=[];return r&&e.forEach((e=>{s.push(r.markPotentiallyOrphaned(t,e))})),_i.waitFor(s)}removeMatchingKeysForTargetId(t,e){return this.Nr.Vr(e),_i.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Nr.gr(e);return _i.resolve(n)}containsKey(t,e){return _i.resolve(this.Nr.containsKey(e))}}class Gh{constructor(t,e){this.Lr={},this.overlays={},this.kr=new Ri(0),this.qr=!1,this.qr=!0,this.referenceDelegate=t(this),this.Qr=new Kh(this),this.indexManager=new xh,this.remoteDocumentCache=function(t){return new $h(t)}((t=>this.referenceDelegate.Kr(t))),this.serializer=new Dh(e),this.$r=new Fh(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new Uh,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Lr[t.toKey()];return n||(n=new qh(e,this.referenceDelegate),this.Lr[t.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(t,e,n){js("MemoryPersistence","Starting transaction:",t);const r=new Hh(this.kr.next());return this.referenceDelegate.Ur(),n(r).next((t=>this.referenceDelegate.Wr(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Gr(t,e){return _i.or(Object.values(this.Lr).map((n=>()=>n.containsKey(t,e))))}}class Hh extends Ei{constructor(t){super(),this.currentSequenceNumber=t}}class Qh{constructor(t){this.persistence=t,this.zr=new Bh,this.jr=null}static Hr(t){return new Qh(t)}get Jr(){if(this.jr)return this.jr;throw Ks()}addReference(t,e,n){return this.zr.addReference(n,e),this.Jr.delete(n.toString()),_i.resolve()}removeReference(t,e,n){return this.zr.removeReference(n,e),this.Jr.add(n.toString()),_i.resolve()}markPotentiallyOrphaned(t,e){return this.Jr.add(e.toString()),_i.resolve()}removeTarget(t,e){this.zr.Vr(e.targetId).forEach((t=>this.Jr.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Jr.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Ur(){this.jr=new Set}Wr(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return _i.forEach(this.Jr,(n=>{const r=pi.fromPath(n);return this.Yr(t,r).next((t=>{t||e.removeEntry(r,ui.min())}))})).next((()=>(this.jr=null,e.apply(t))))}updateLimboDocument(t,e){return this.Yr(t,e).next((t=>{t?this.Jr.delete(e.toString()):this.Jr.add(e.toString())}))}Kr(t){return 0}Yr(t,e){return _i.or([()=>_i.resolve(this.zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gr(t,e)])}}class Wh{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.qi=n,this.Qi=r}static Ki(t,e){let n=da(),r=da();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new Wh(t,e.fromCache,n,r)}}class Xh{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class Yh{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){var t;const e=null===(t=h())||void 0===t?void 0:t.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(t){return!1}}()||!navigator.userAgent.includes("Safari")||navigator.userAgent.includes("Chrome")?Si.v(l())>0?6:4:8}initialize(t,e){this.zi=t,this.indexManager=e,this.$i=!0}getDocumentsMatchingQuery(t,e,n,r){const s={result:null};return this.ji(t,e).next((t=>{s.result=t})).next((()=>{if(!s.result)return this.Hi(t,e,r,n).next((t=>{s.result=t}))})).next((()=>{if(s.result)return;const n=new Xh;return this.Ji(t,e,n).next((r=>{if(s.result=r,this.Ui)return this.Yi(t,e,n,r.size)}))})).next((()=>s.result))}Yi(t,e,n,r){return n.documentReadCount<this.Wi?(Bs()<=T.DEBUG&&js("QueryEngine","SDK will not create cache indexes for query:",Jo(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),_i.resolve()):(Bs()<=T.DEBUG&&js("QueryEngine","Query:",Jo(e),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(Bs()<=T.DEBUG&&js("QueryEngine","The SDK decides to create cache indexes for query:",Jo(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Qo(e))):_i.resolve())}ji(t,e){if(Go(e))return _i.resolve(null);let n=Qo(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=Wo(e,null,"F"),n=Qo(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const s=da(...r);return this.zi.getDocuments(t,s).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const i=this.Zi(e,r);return this.Xi(e,i,s,n.readTime)?this.ji(t,Wo(e,null,"F")):this.es(t,i,e,n)}))))})))))}Hi(t,e,n,r){return Go(e)||r.isEqual(ui.min())?_i.resolve(null):this.zi.getDocuments(t,n).next((s=>{const i=this.Zi(e,s);return this.Xi(e,i,n,r)?_i.resolve(null):(Bs()<=T.DEBUG&&js("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),Jo(e)),this.es(t,i,e,function(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,s=ui.fromTimestamp(1e9===r?new ci(n+1,0):new ci(n,r));return new yi(s,pi.empty(),e)}(r,-1)).next((t=>t)))}))}Zi(t,e){let n=new Bi(ta(t));return e.forEach(((e,r)=>{Zo(t,r)&&(n=n.add(r))})),n}Xi(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const s="F"===t.limitType?e.last():e.first();return!!s&&(s.hasPendingWrites||s.version.compareTo(r)>0)}Ji(t,e,n){return Bs()<=T.DEBUG&&js("QueryEngine","Using full collection scan to execute query:",Jo(e)),this.zi.getDocumentsMatchingQuery(t,e,yi.min(),n)}es(t,e,n,r){return this.zi.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class Jh{constructor(t,e,n,r){this.persistence=t,this.ts=e,this.serializer=r,this.ns=new Vi(ai),this.rs=new na((t=>jo(t)),qo),this.ss=new Map,this.os=t.getRemoteDocumentCache(),this.Qr=t.getTargetCache(),this.$r=t.getBundleCache(),this._s(n)}_s(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new Vh(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.ns)))}}async function Zh(t,e){const n=Hs(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((s=>(r=s,n._s(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const s=[],i=[];let o=da();for(const t of r){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({us:t,removedBatchIds:s,addedBatchIds:i})))}))}))}function tc(t){const e=Hs(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Qr.getLastRemoteSnapshotVersion(t)))}async function ec(t,e,n){const r=Hs(t),s=r.ns.get(e),i=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",i,(t=>r.persistence.referenceDelegate.removeTarget(t,s)))}catch(t){if(!Ai(t))throw t;js("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.ns=r.ns.remove(e),r.rs.delete(s.target)}function nc(t,e,n){const r=Hs(t);let s=ui.min(),i=da();return r.persistence.runTransaction("Execute query","readwrite",(t=>function(t,e,n){const r=Hs(t),s=r.rs.get(n);return void 0!==s?_i.resolve(r.ns.get(s)):r.Qr.getTargetData(e,n)}(r,t,Qo(e)).next((e=>{if(e)return s=e.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(t,e.targetId).next((t=>{i=t}))})).next((()=>r.ts.getDocumentsMatchingQuery(t,e,n?s:ui.min(),n?i:da()))).next((t=>(function(t,e,n){let r=t.ss.get(e)||ui.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.ss.set(e,r)}(r,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,hs:i})))))}class rc{constructor(){this.activeTargetIds=fa}As(t){this.activeTargetIds=this.activeTargetIds.add(t)}Rs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ds(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class sc{constructor(){this.no=new rc,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.no.As(t),this.ro[t]||"not-current"}updateQueryState(t,e,n){this.ro[t]=e}removeLocalQueryTarget(t){this.no.Rs(t)}isLocalQueryTarget(t){return this.no.activeTargetIds.has(t)}clearQueryState(t){delete this.ro[t]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(t){return this.no.activeTargetIds.has(t)}start(){return this.no=new rc,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class ic{io(t){}shutdown(){}}class oc{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(t){this.uo.push(t)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){js("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.uo)t(0)}ao(){js("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.uo)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let ac=null;function hc(){return null===ac?ac=268435456+Math.round(2147483648*Math.random()):ac++,"0x"+ac.toString(16)}const cc={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class uc{constructor(t){this.lo=t.lo,this.ho=t.ho}Po(t){this.Io=t}To(t){this.Eo=t}onMessage(t){this.Ao=t}close(){this.ho()}send(t){this.lo(t)}Ro(){this.Io()}Vo(t){this.Eo(t)}mo(t){this.Ao(t)}}const lc="WebChannelConnection";class dc extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.fo=e+"://"+t.host,this.po=`projects/${n}/databases/${r}`,this.yo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get wo(){return!1}So(t,e,n,r,s){const i=hc(),o=this.bo(t,e.toUriEncodedString());js("RestConnection",`Sending RPC '${t}' ${i}:`,o,n);const a={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(a,r,s),this.Co(t,o,a,n).then((e=>(js("RestConnection",`Received RPC '${t}' ${i}: `,e),e)),(e=>{throw $s("RestConnection",`RPC '${t}' ${i} failed with error: `,e,"url: ",o,"request:",n),e}))}vo(t,e,n,r,s,i){return this.So(t,e,n,r,s)}Do(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+Fs,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}bo(t,e){const n=cc[t];return`${this.fo}/v1/${e}:${n}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Co(t,e,n,r){const s=hc();return new Promise(((i,o)=>{const a=new Ls;a.setWithCredentials(!0),a.listenOnce(Ns.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Ds.NO_ERROR:const e=a.getResponseJson();js(lc,`XHR for RPC '${t}' ${s} received:`,JSON.stringify(e)),i(e);break;case Ds.TIMEOUT:js(lc,`RPC '${t}' ${s} timed out`),o(new Ws(Qs.DEADLINE_EXCEEDED,"Request time out"));break;case Ds.HTTP_ERROR:const n=a.getStatus();if(js(lc,`RPC '${t}' ${s} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Qs).indexOf(e)>=0?e:Qs.UNKNOWN}(e.status);o(new Ws(t,e.message))}else o(new Ws(Qs.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Ws(Qs.UNAVAILABLE,"Connection failed."));break;default:Ks()}}finally{js(lc,`RPC '${t}' ${s} completed.`)}}));const h=JSON.stringify(r);js(lc,`RPC '${t}' ${s} sending request:`,r),a.send(e,"POST",h,n,15)}))}Fo(t,e,n){const r=hc(),s=[this.fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],i=Is(),o=As(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},h=this.longPollingOptions.timeoutSeconds;void 0!==h&&(a.longPollingTimeout=Math.round(1e3*h)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Do(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const c=s.join("");js(lc,`Creating RPC '${t}' stream ${r}: ${c}`,a);const u=i.createWebChannel(c,a);let l=!1,d=!1;const f=new uc({lo:e=>{d?js(lc,`Not sending because RPC '${t}' stream ${r} is closed:`,e):(l||(js(lc,`Opening RPC '${t}' stream ${r} transport.`),u.open(),l=!0),js(lc,`RPC '${t}' stream ${r} sending:`,e),u.send(e))},ho:()=>u.close()}),g=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return g(u,Rs.EventType.OPEN,(()=>{d||js(lc,`RPC '${t}' stream ${r} transport opened.`)})),g(u,Rs.EventType.CLOSE,(()=>{d||(d=!0,js(lc,`RPC '${t}' stream ${r} transport closed`),f.Vo())})),g(u,Rs.EventType.ERROR,(e=>{d||(d=!0,$s(lc,`RPC '${t}' stream ${r} transport errored:`,e),f.Vo(new Ws(Qs.UNAVAILABLE,"The operation could not be completed")))})),g(u,Rs.EventType.MESSAGE,(e=>{var n;if(!d){const s=e.data[0];Gs(!!s);const i=s,o=i.error||(null===(n=i[0])||void 0===n?void 0:n.error);if(o){js(lc,`RPC '${t}' stream ${r} received error:`,o);const e=o.status;let n=function(t){const e=ja[t];if(void 0!==e)return $a(e)}(e),s=o.message;void 0===n&&(n=Qs.INTERNAL,s="Unknown error status: "+e+" with message "+o.message),d=!0,f.Vo(new Ws(n,s)),u.close()}else js(lc,`RPC '${t}' stream ${r} received:`,s),f.mo(s)}})),g(o,ks.STAT_EVENT,(e=>{e.stat===xs.PROXY?js(lc,`RPC '${t}' stream ${r} detected buffering proxy`):e.stat===xs.NOPROXY&&js(lc,`RPC '${t}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.Ro()}),0),f}}function fc(){return"undefined"!=typeof document?document:null}function gc(t){return new ah(t,!0)}class pc{constructor(t,e,n=1e3,r=1.5,s=6e4){this.oi=t,this.timerId=e,this.Mo=n,this.xo=r,this.Oo=s,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(t){this.cancel();const e=Math.floor(this.No+this.Qo()),n=Math.max(0,Date.now()-this.Lo),r=Math.max(0,e-n);r>0&&js("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.No} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Bo=this.oi.enqueueAfterDelay(this.timerId,r,(()=>(this.Lo=Date.now(),t()))),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Bo&&(this.Bo.skipDelay(),this.Bo=null)}cancel(){null!==this.Bo&&(this.Bo.cancel(),this.Bo=null)}Qo(){return(Math.random()-.5)*this.No}}class mc{constructor(t,e,n,r,s,i,o,a){this.oi=t,this.$o=n,this.Uo=r,this.connection=s,this.authCredentialsProvider=i,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new pc(t,e)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}async stop(){this.Ho()&&await this.close(0)}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,(()=>this.e_())))}t_(t){this.n_(),this.stream.send(t)}async e_(){if(this.Jo())return this.close(0)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}async close(t,e){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,4!==t?this.jo.reset():e&&e.code===Qs.RESOURCE_EXHAUSTED?(qs(e.toString()),qs("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):e&&e.code===Qs.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.i_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.To(e)}i_(){}auth(){this.state=1;const t=this.s_(this.Wo),e=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Wo===e&&this.o_(t,n)}),(e=>{t((()=>{const t=new Ws(Qs.UNKNOWN,"Fetching auth token failed: "+e.message);return this.__(t)}))}))}o_(t,e){const n=this.s_(this.Wo);this.stream=this.a_(t,e),this.stream.Po((()=>{n((()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,(()=>(this.Jo()&&(this.state=3),Promise.resolve()))),this.listener.Po())))})),this.stream.To((t=>{n((()=>this.__(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Yo(){this.state=5,this.jo.qo((async()=>{this.state=0,this.start()}))}__(t){return js("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}s_(t){return e=>{this.oi.enqueueAndForget((()=>this.Wo===t?e():(js("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class yc extends mc{constructor(t,e,n,r,s,i){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,i),this.serializer=s}a_(t,e){return this.connection.Fo("Listen",t,e)}onMessage(t){this.jo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Ks()}(e.targetChange.targetChangeType||"NO_CHANGE"),s=e.targetChange.targetIds||[],i=function(t,e){return t.useProto3Json?(Gs(void 0===e||"string"==typeof e),zi.fromBase64String(e||"")):(Gs(void 0===e||e instanceof Uint8Array),zi.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Qs.UNKNOWN:$a(t.code);return new Ws(e,t.message||"")}(o);n=new Za(r,s,i,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const s=dh(t,r.document.name),i=ch(r.document.updateTime),o=r.document.createTime?ch(r.document.createTime):ui.min(),a=new mo({mapValue:{fields:r.document.fields}}),h=yo.newFoundDocument(s,i,o,a),c=r.targetIds||[],u=r.removedTargetIds||[];n=new Ya(c,u,h.key,h)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const s=dh(t,r.document),i=r.readTime?ch(r.readTime):ui.min(),o=yo.newNoDocument(s,i),a=r.removedTargetIds||[];n=new Ya([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const s=dh(t,r.document),i=r.removedTargetIds||[];n=new Ya([],i,s,null)}else{if(!("filter"in e))return Ks();{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:s}=t,i=new Ba(r,s),o=t.targetId;n=new Ja(o,i)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return ui.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?ui.min():e.readTime?ch(e.readTime):ui.min()}(t);return this.listener.u_(e,n)}c_(t){const e={};e.database=gh(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=$o(r)?{documents:mh(t,r)}:{query:yh(t,r).ut},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=function(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}(t,e.resumeToken);const r=hh(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(ui.min())>0){n.readTime=function(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}(t,e.snapshotVersion.toTimestamp());const r=hh(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ks()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.t_(e)}l_(t){const e={};e.database=gh(this.serializer),e.removeTarget=t,this.t_(e)}}class vc extends class{}{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.A_=!1}R_(){if(this.A_)throw new Ws(Qs.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,e,n,r){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,i])=>this.connection.So(t,uh(e,n),r,s,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Qs.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Ws(Qs.UNKNOWN,t.toString())}))}vo(t,e,n,r,s){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,o])=>this.connection.vo(t,uh(e,n),r,i,o,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Qs.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Ws(Qs.UNKNOWN,t.toString())}))}terminate(){this.A_=!0,this.connection.terminate()}}class wc{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve()))))}S_(t){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.y_("Offline")))}set(t){this.b_(),this.m_=0,"Online"===t&&(this.g_=!1),this.y_(t)}y_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}w_(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?(qs(e),this.g_=!1):js("OnlineStateTracker",e)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class Ec{constructor(t,e,n,r,s){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=s,this.M_.io((t=>{n.enqueueAndForget((async()=>{Nc(this)&&(js("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Hs(t);e.v_.add(4),await _c(e),e.x_.set("Unknown"),e.v_.delete(4),await bc(e)}(this))}))})),this.x_=new wc(n,r)}}async function bc(t){if(Nc(t))for(const e of t.F_)await e(!0)}async function _c(t){for(const e of t.F_)await e(!1)}function Tc(t,e){const n=Hs(t);n.C_.has(e.targetId)||(n.C_.set(e.targetId,e),Dc(n)?Ac(n):Pc(n).Jo()&&Cc(n,e))}function Sc(t,e){const n=Hs(t),r=Pc(n);n.C_.delete(e),r.Jo()&&Ic(n,e),0===n.C_.size&&(r.Jo()?r.Xo():Nc(n)&&n.x_.set("Unknown"))}function Cc(t,e){if(t.O_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(ui.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}Pc(t).c_(e)}function Ic(t,e){t.O_.Oe(e),Pc(t).l_(e)}function Ac(t){t.O_=new eh({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>t.C_.get(e)||null,nt:()=>t.datastore.serializer.databaseId}),Pc(t).start(),t.x_.p_()}function Dc(t){return Nc(t)&&!Pc(t).Ho()&&t.C_.size>0}function Nc(t){return 0===Hs(t).v_.size}function kc(t){t.O_=void 0}async function xc(t){t.C_.forEach(((e,n)=>{Cc(t,e)}))}async function Rc(t,e){kc(t),Dc(t)?(t.x_.S_(e),Ac(t)):t.x_.set("Unknown")}async function Lc(t,e,n){if(t.x_.set("Online"),e instanceof Za&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.C_.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.C_.delete(r),t.O_.removeTarget(r))}(t,e)}catch(n){js("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await Oc(t,n)}else if(e instanceof Ya?t.O_.$e(e):e instanceof Ja?t.O_.Je(e):t.O_.Ge(e),!n.isEqual(ui.min()))try{const e=await tc(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.O_.it(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const s=t.C_.get(r);s&&t.C_.set(r,s.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const r=t.C_.get(e);if(!r)return;t.C_.set(e,r.withResumeToken(zi.EMPTY_BYTE_STRING,r.snapshotVersion)),Ic(t,e);const s=new Ah(r.target,e,n,r.sequenceNumber);Cc(t,s)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){js("RemoteStore","Failed to raise snapshot:",e),await Oc(t,e)}}async function Oc(t,e,n){if(!Ai(e))throw e;t.v_.add(1),await _c(t),t.x_.set("Offline"),n||(n=()=>tc(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{js("RemoteStore","Retrying IndexedDB access"),await n(),t.v_.delete(1),await bc(t)}))}async function Mc(t,e){const n=Hs(t);n.asyncQueue.verifyOperationInProgress(),js("RemoteStore","RemoteStore received new credentials");const r=Nc(n);n.v_.add(3),await _c(n),r&&n.x_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.v_.delete(3),await bc(n)}function Pc(t){return t.N_||(t.N_=function(t,e,n){const r=Hs(t);return r.R_(),new yc(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Po:xc.bind(null,t),To:Rc.bind(null,t),u_:Lc.bind(null,t)}),t.F_.push((async e=>{e?(t.N_.Zo(),Dc(t)?Ac(t):t.x_.set("Unknown")):(await t.N_.stop(),kc(t))}))),t.N_}class Vc{constructor(t,e,n,r,s){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=s,this.deferred=new Xs,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,s){const i=Date.now()+n,o=new Vc(t,e,i,r,s);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Ws(Qs.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Fc(t,e){if(qs("AsyncQueue",`${e}: ${t}`),Ai(t))return new Ws(Qs.UNAVAILABLE,`${e}: ${t}`);throw t}class Uc{constructor(t){this.comparator=t?(e,n)=>t(e,n)||pi.comparator(e.key,n.key):(t,e)=>pi.comparator(t.key,e.key),this.keyedMap=oa(),this.sortedSet=new Vi(this.comparator)}static emptySet(t){return new Uc(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof Uc))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new Uc;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class Bc{constructor(){this.L_=new Vi(pi.comparator)}track(t){const e=t.doc.key,n=this.L_.get(e);n?0!==t.type&&3===n.type?this.L_=this.L_.insert(e,t):3===t.type&&1!==n.type?this.L_=this.L_.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.L_=this.L_.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.L_=this.L_.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.L_=this.L_.remove(e):1===t.type&&2===n.type?this.L_=this.L_.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.L_=this.L_.insert(e,{type:2,doc:t.doc}):Ks():this.L_=this.L_.insert(e,t)}k_(){const t=[];return this.L_.inorderTraversal(((e,n)=>{t.push(n)})),t}}class jc{constructor(t,e,n,r,s,i,o,a,h){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=s,this.fromCache=i,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=h}static fromInitialDocuments(t,e,n,r,s){const i=[];return e.forEach((t=>{i.push({type:0,doc:t})})),new jc(t,e,Uc.emptySet(e),i,n,r,!0,!1,s)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Xo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class qc{constructor(){this.q_=void 0,this.Q_=[]}}class $c{constructor(){this.queries=new na((t=>Yo(t)),Xo),this.onlineState="Unknown",this.K_=new Set}}function zc(t,e){const n=Hs(t);let r=!1;for(const t of e){const e=t.query,s=n.queries.get(e);if(s){for(const e of s.Q_)e.W_(t)&&(r=!0);s.q_=t}}r&&Gc(n)}function Kc(t,e,n){const r=Hs(t),s=r.queries.get(e);if(s)for(const t of s.Q_)t.onError(n);r.queries.delete(e)}function Gc(t){t.K_.forEach((t=>{t.next()}))}class Hc{constructor(t,e,n){this.query=t,this.G_=e,this.z_=!1,this.j_=null,this.onlineState="Unknown",this.options=n||{}}W_(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new jc(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.z_?this.H_(t)&&(this.G_.next(t),e=!0):this.J_(t,this.onlineState)&&(this.Y_(t),e=!0),this.j_=t,e}onError(t){this.G_.error(t)}U_(t){this.onlineState=t;let e=!1;return this.j_&&!this.z_&&this.J_(this.j_,t)&&(this.Y_(this.j_),e=!0),e}J_(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return(!this.options.Z_||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}H_(t){if(t.docChanges.length>0)return!0;const e=this.j_&&this.j_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}Y_(t){t=jc.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.z_=!0,this.G_.next(t)}}class Qc{constructor(t){this.key=t}}class Wc{constructor(t){this.key=t}}class Xc{constructor(t,e){this.query=t,this.oa=e,this._a=null,this.hasCachedResults=!1,this.current=!1,this.aa=da(),this.mutatedKeys=da(),this.ua=ta(t),this.ca=new Uc(this.ua)}get la(){return this.oa}ha(t,e){const n=e?e.Pa:new Bc,r=e?e.ca:this.ca;let s=e?e.mutatedKeys:this.mutatedKeys,i=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,h="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const c=r.get(t),u=Zo(this.query,e)?e:null,l=!!c&&this.mutatedKeys.has(c.key),d=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let f=!1;c&&u?c.data.isEqual(u.data)?l!==d&&(n.track({type:3,doc:u}),f=!0):this.Ia(c,u)||(n.track({type:2,doc:u}),f=!0,(a&&this.ua(u,a)>0||h&&this.ua(u,h)<0)&&(o=!0)):!c&&u?(n.track({type:0,doc:u}),f=!0):c&&!u&&(n.track({type:1,doc:c}),f=!0,(a||h)&&(o=!0)),f&&(u?(i=i.add(u),s=d?s.add(t):s.delete(t)):(i=i.delete(t),s=s.delete(t)))})),null!==this.query.limit)for(;i.size>this.query.limit;){const t="F"===this.query.limitType?i.last():i.first();i=i.delete(t.key),s=s.delete(t.key),n.track({type:1,doc:t})}return{ca:i,Pa:n,Xi:o,mutatedKeys:s}}Ia(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,r){const s=this.ca;this.ca=t.ca,this.mutatedKeys=t.mutatedKeys;const i=t.Pa.k_();i.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ks()}};return n(t)-n(e)}(t.type,e.type)||this.ua(t.doc,e.doc))),this.Ta(n),r=null!=r&&r;const o=e&&!r?this.Ea():[],a=0===this.aa.size&&this.current&&!r?1:0,h=a!==this._a;return this._a=a,0!==i.length||h?{snapshot:new jc(this.query,t.ca,s,i,t.mutatedKeys,0===a,h,!1,!!n&&n.resumeToken.approximateByteSize()>0),da:o}:{da:o}}U_(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({ca:this.ca,Pa:new Bc,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{da:[]}}Aa(t){return!this.oa.has(t)&&!!this.ca.has(t)&&!this.ca.get(t).hasLocalMutations}Ta(t){t&&(t.addedDocuments.forEach((t=>this.oa=this.oa.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.oa=this.oa.delete(t))),this.current=t.current)}Ea(){if(!this.current)return[];const t=this.aa;this.aa=da(),this.ca.forEach((t=>{this.Aa(t.key)&&(this.aa=this.aa.add(t.key))}));const e=[];return t.forEach((t=>{this.aa.has(t)||e.push(new Wc(t))})),this.aa.forEach((n=>{t.has(n)||e.push(new Qc(n))})),e}Ra(t){this.oa=t.hs,this.aa=da();const e=this.ha(t.documents);return this.applyChanges(e,!0)}Va(){return jc.fromInitialDocuments(this.query,this.ca,this.mutatedKeys,0===this._a,this.hasCachedResults)}}class Yc{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Jc{constructor(t){this.key=t,this.ma=!1}}class Zc{constructor(t,e,n,r,s,i){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=s,this.maxConcurrentLimboResolutions=i,this.fa={},this.ga=new na((t=>Yo(t)),Xo),this.pa=new Map,this.ya=new Set,this.wa=new Vi(pi.comparator),this.Sa=new Map,this.ba=new Bh,this.Da={},this.Ca=new Map,this.va=Oh.Bn(),this.onlineState="Unknown",this.Fa=void 0}get isPrimaryClient(){return!0===this.Fa}}async function tu(t,e){const n=function(t){const e=Hs(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=nu.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=du.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=su.bind(null,e),e.fa.u_=zc.bind(null,e.eventManager),e.fa.xa=Kc.bind(null,e.eventManager),e}(t);let r,s;const i=n.ga.get(e);if(i)r=i.targetId,n.sharedClientState.addLocalQueryTarget(r),s=i.view.Va();else{const t=await function(t,e){const n=Hs(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.Qr.getTargetData(t,e).next((s=>s?(r=s,_i.resolve(r)):n.Qr.allocateTargetId(t).next((s=>(r=new Ah(e,s,"TargetPurposeListen",t.currentSequenceNumber),n.Qr.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.ns.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ns=n.ns.insert(t.targetId,t),n.rs.set(e,t.targetId)),t}))}(n.localStore,Qo(e)),i=n.sharedClientState.addLocalQueryTarget(t.targetId);r=t.targetId,s=await async function(t,e,n,r,s){t.Ma=(e,n,r)=>async function(t,e,n,r){let s=e.view.ha(n);s.Xi&&(s=await nc(t.localStore,e.query,!1).then((({documents:t})=>e.view.ha(t,s))));const i=r&&r.targetChanges.get(e.targetId),o=r&&null!=r.targetMismatches.get(e.targetId),a=e.view.applyChanges(s,t.isPrimaryClient,i,o);return au(t,e.targetId,a.da),a.snapshot}(t,e,n,r);const i=await nc(t.localStore,e,!0),o=new Xc(e,i.hs),a=o.ha(i.documents),h=Xa.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,s),c=o.applyChanges(a,t.isPrimaryClient,h);au(t,n,c.da);const u=new Yc(e,n,o);return t.ga.set(e,u),t.pa.has(n)?t.pa.get(n).push(e):t.pa.set(n,[e]),c.snapshot}(n,e,r,"current"===i,t.resumeToken),n.isPrimaryClient&&Tc(n.remoteStore,t)}return s}async function eu(t,e){const n=Hs(t),r=n.ga.get(e),s=n.pa.get(r.targetId);if(s.length>1)return n.pa.set(r.targetId,s.filter((t=>!Xo(t,e)))),void n.ga.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await ec(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),Sc(n.remoteStore,r.targetId),iu(n,r.targetId)})).catch(bi)):(iu(n,r.targetId),await ec(n.localStore,r.targetId,!0))}async function nu(t,e){const n=Hs(t);try{const t=await function(t,e){const n=Hs(t),r=e.snapshotVersion;let s=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const i=n.os.newChangeBuffer({trackRemovals:!0});s=n.ns;const o=[];e.targetChanges.forEach(((i,a)=>{const h=s.get(a);if(!h)return;o.push(n.Qr.removeMatchingKeys(t,i.removedDocuments,a).next((()=>n.Qr.addMatchingKeys(t,i.addedDocuments,a))));let c=h.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?c=c.withResumeToken(zi.EMPTY_BYTE_STRING,ui.min()).withLastLimboFreeSnapshotVersion(ui.min()):i.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(i.resumeToken,r)),s=s.insert(a,c),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(h,c,i)&&o.push(n.Qr.updateTargetData(t,c))}));let a=sa(),h=da();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(function(t,e,n){let r=da(),s=da();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=sa();return n.forEach(((n,i)=>{const o=t.get(n);i.isFoundDocument()!==o.isFoundDocument()&&(s=s.add(n)),i.isNoDocument()&&i.version.isEqual(ui.min())?(e.removeEntry(n,i.readTime),r=r.insert(n,i)):!o.isValidDocument()||i.version.compareTo(o.version)>0||0===i.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(i),r=r.insert(n,i)):js("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",i.version)})),{cs:r,ls:s}}))}(t,i,e.documentUpdates).next((t=>{a=t.cs,h=t.ls}))),!r.isEqual(ui.min())){const e=n.Qr.getLastRemoteSnapshotVersion(t).next((e=>n.Qr.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return _i.waitFor(o).next((()=>i.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,h))).next((()=>a))})).then((t=>(n.ns=s,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.Sa.get(e);r&&(Gs(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.ma=!0:t.modifiedDocuments.size>0?Gs(r.ma):t.removedDocuments.size>0&&(Gs(r.ma),r.ma=!1))})),await uu(n,t,e)}catch(t){await bi(t)}}function ru(t,e,n){const r=Hs(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.ga.forEach(((n,r)=>{const s=r.view.U_(e);s.snapshot&&t.push(s.snapshot)})),function(t,e){const n=Hs(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.Q_)t.U_(e)&&(r=!0)})),r&&Gc(n)}(r.eventManager,e),t.length&&r.fa.u_(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function su(t,e,n){const r=Hs(t);r.sharedClientState.updateQueryState(e,"rejected",n);const s=r.Sa.get(e),i=s&&s.key;if(i){let t=new Vi(pi.comparator);t=t.insert(i,yo.newNoDocument(i,ui.min()));const n=da().add(i),s=new Wa(ui.min(),new Map,new Vi(ai),t,n);await nu(r,s),r.wa=r.wa.remove(i),r.Sa.delete(e),cu(r)}else await ec(r.localStore,e,!1).then((()=>iu(r,e,n))).catch(bi)}function iu(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.pa.get(e))t.ga.delete(r),n&&t.fa.xa(r,n);t.pa.delete(e),t.isPrimaryClient&&t.ba.Vr(e).forEach((e=>{t.ba.containsKey(e)||ou(t,e)}))}function ou(t,e){t.ya.delete(e.path.canonicalString());const n=t.wa.get(e);null!==n&&(Sc(t.remoteStore,n),t.wa=t.wa.remove(e),t.Sa.delete(n),cu(t))}function au(t,e,n){for(const r of n)r instanceof Qc?(t.ba.addReference(r.key,e),hu(t,r)):r instanceof Wc?(js("SyncEngine","Document no longer in limbo: "+r.key),t.ba.removeReference(r.key,e),t.ba.containsKey(r.key)||ou(t,r.key)):Ks()}function hu(t,e){const n=e.key,r=n.path.canonicalString();t.wa.get(n)||t.ya.has(r)||(js("SyncEngine","New document in limbo: "+n),t.ya.add(r),cu(t))}function cu(t){for(;t.ya.size>0&&t.wa.size<t.maxConcurrentLimboResolutions;){const e=t.ya.values().next().value;t.ya.delete(e);const n=new pi(di.fromString(e)),r=t.va.next();t.Sa.set(r,new Jc(n)),t.wa=t.wa.insert(n,r),Tc(t.remoteStore,new Ah(Qo(Ko(n.path)),r,"TargetPurposeLimboResolution",Ri._e))}}async function uu(t,e,n){const r=Hs(t),s=[],i=[],o=[];r.ga.isEmpty()||(r.ga.forEach(((t,a)=>{o.push(r.Ma(a,e,n).then((t=>{if((t||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){s.push(t);const e=Wh.Ki(a.targetId,t);i.push(e)}})))})),await Promise.all(o),r.fa.u_(s),await async function(t,e){const n=Hs(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>_i.forEach(e,(e=>_i.forEach(e.qi,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>_i.forEach(e.Qi,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!Ai(t))throw t;js("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.ns.get(e),r=t.snapshotVersion,s=t.withLastLimboFreeSnapshotVersion(r);n.ns=n.ns.insert(e,s)}}}(r.localStore,i))}async function lu(t,e){const n=Hs(t);if(!n.currentUser.isEqual(e)){js("SyncEngine","User change. New user:",e.toKey());const t=await Zh(n.localStore,e);n.currentUser=e,function(t,e){t.Ca.forEach((t=>{t.forEach((t=>{t.reject(new Ws(Qs.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Ca.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await uu(n,t.us)}}function du(t,e){const n=Hs(t),r=n.Sa.get(e);if(r&&r.ma)return da().add(r.key);{let t=da();const r=n.pa.get(e);if(!r)return t;for(const e of r){const r=n.ga.get(e);t=t.unionWith(r.view.la)}return t}}class fu{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=gc(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return function(t,e,n,r){return new Jh(t,e,n,r)}(this.persistence,new Yh,t.initialUser,this.serializer)}createPersistence(t){return new Gh(Qh.Hr,this.serializer)}createSharedClientState(t){return new sc}async terminate(){var t,e;null===(t=this.gcScheduler)||void 0===t||t.stop(),null===(e=this.indexBackfillerScheduler)||void 0===e||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class gu{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>ru(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=lu.bind(null,this.syncEngine),await async function(t,e){const n=Hs(t);e?(n.v_.delete(2),await bc(n)):e||(n.v_.add(2),await _c(n),n.x_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new $c}createDatastore(t){const e=gc(t.databaseInfo.databaseId),n=function(t){return new dc(t)}(t.databaseInfo);return function(t,e,n,r){return new vc(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,r,s){return new Ec(t,e,n,r,s)}(this.localStore,this.datastore,t.asyncQueue,(t=>ru(this.syncEngine,t,0)),oc.D()?new oc:new ic)}createSyncEngine(t,e){return function(t,e,n,r,s,i,o){const a=new Zc(t,e,n,r,s,i);return o&&(a.Fa=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t;await async function(t){const e=Hs(t);js("RemoteStore","RemoteStore shutting down."),e.v_.add(5),await _c(e),e.M_.shutdown(),e.x_.set("Unknown")}(this.remoteStore),null===(t=this.datastore)||void 0===t||t.terminate()}}class pu{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ba(this.observer.next,t)}error(t){this.observer.error?this.Ba(this.observer.error,t):qs("Uncaught Error in snapshot listener:",t.toString())}La(){this.muted=!0}Ba(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class mu{constructor(t,e,n,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=Vs.UNAUTHENTICATED,this.clientId=oi.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{js("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(js("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Ws(Qs.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Xs;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=Fc(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function yu(t,e){t.asyncQueue.verifyOperationInProgress(),js("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await Zh(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function vu(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){js("FirestoreClient","Using user provided OfflineComponentProvider");try{await yu(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===Qs.FAILED_PRECONDITION||t.code===Qs.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;$s("Error using user provided cache. Falling back to memory cache: "+n),await yu(t,new fu)}}else js("FirestoreClient","Using default OfflineComponentProvider"),await yu(t,new fu);return t._offlineComponents}(t);js("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((t=>Mc(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>Mc(e.remoteStore,n))),t._onlineComponents=e}async function wu(t){const e=await async function(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(js("FirestoreClient","Using user provided OnlineComponentProvider"),await vu(t,t._uninitializedComponentsProvider._online)):(js("FirestoreClient","Using default OnlineComponentProvider"),await vu(t,new gu))),t._onlineComponents}(t),n=e.eventManager;return n.onListen=tu.bind(null,e.syncEngine),n.onUnlisten=eu.bind(null,e.syncEngine),n}function Eu(t,e,n={}){const r=new Xs;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,s){const i=new pu({next:i=>{e.enqueueAndForget((()=>async function(t,e){const n=Hs(t),r=e.query;let s=!1;const i=n.queries.get(r);if(i){const t=i.Q_.indexOf(e);t>=0&&(i.Q_.splice(t,1),s=0===i.Q_.length)}if(s)return n.queries.delete(r),n.onUnlisten(r)}(t,o)));const a=i.docs.has(n);!a&&i.fromCache?s.reject(new Ws(Qs.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&i.fromCache&&r&&"server"===r.source?s.reject(new Ws(Qs.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):s.resolve(i)},error:t=>s.reject(t)}),o=new Hc(Ko(n.path),i,{includeMetadataChanges:!0,Z_:!0});return async function(t,e){const n=Hs(t),r=e.query;let s=!1,i=n.queries.get(r);if(i||(s=!0,i=new qc),s)try{i.q_=await n.onListen(r)}catch(t){const n=Fc(t,`Initialization of query '${Jo(e.query)}' failed`);return void e.onError(n)}n.queries.set(r,i),i.Q_.push(e),e.U_(n.onlineState),i.q_&&e.W_(i.q_)&&Gc(n)}(t,o)}(await wu(t),t.asyncQueue,e,n,r))),r.promise}function bu(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const _u=new Map;function Tu(t){if(!pi.isDocumentKey(t))throw new Ws(Qs.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function Su(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Ws(Qs.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=function(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Ks()}(t);throw new Ws(Qs.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class Cu{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new Ws(Qs.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Ws(Qs.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,r){if(!0===e&&!0===r)throw new Ws(Qs.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=bu(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new Ws(Qs.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new Ws(Qs.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new Ws(Qs.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class Iu{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new Cu({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Ws(Qs.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Ws(Qs.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new Cu(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Js;switch(t.type){case"firstParty":return new ni(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new Ws(Qs.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=_u.get(t);e&&(js("ComponentProvider","Removing Datastore"),_u.delete(t),e.terminate())}(this),Promise.resolve()}}class Au{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new Au(this.firestore,t,this._query)}}class Du{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Nu(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new Du(this.firestore,t,this._key)}}class Nu extends Au{constructor(t,e,n){super(t,e,Ko(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new Du(this.firestore,null,new pi(t))}withConverter(t){return new Nu(this.firestore,t,this._path)}}function ku(t,e,...n){if(t=(r=t)&&r._delegate?r._delegate:r,1===arguments.length&&(e=oi.newId()),function(t,e,n){if(!n)throw new Ws(Qs.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}("doc","path",e),t instanceof Iu){const r=di.fromString(e,...n);return Tu(r),new Du(t,null,new pi(r))}var r;{if(!(t instanceof Du||t instanceof Nu))throw new Ws(Qs.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(di.fromString(e,...n));return Tu(r),new Du(t.firestore,t instanceof Nu?t.converter:null,new pi(r))}}class xu{constructor(){this.Xa=Promise.resolve(),this.eu=[],this.tu=!1,this.nu=[],this.ru=null,this.iu=!1,this.su=!1,this.ou=[],this.jo=new pc(this,"async_queue_retry"),this._u=()=>{const t=fc();t&&js("AsyncQueue","Visibility state changed to "+t.visibilityState),this.jo.Ko()};const t=fc();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._u)}get isShuttingDown(){return this.tu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.au(),this.uu(t)}enterRestrictedMode(t){if(!this.tu){this.tu=!0,this.su=t||!1;const e=fc();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this._u)}}enqueue(t){if(this.au(),this.tu)return new Promise((()=>{}));const e=new Xs;return this.uu((()=>this.tu&&this.su?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.eu.push(t),this.cu())))}async cu(){if(0!==this.eu.length){try{await this.eu[0](),this.eu.shift(),this.jo.reset()}catch(t){if(!Ai(t))throw t;js("AsyncQueue","Operation failed with retryable error: "+t)}this.eu.length>0&&this.jo.qo((()=>this.cu()))}}uu(t){const e=this.Xa.then((()=>(this.iu=!0,t().catch((t=>{this.ru=t,this.iu=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw qs("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.iu=!1,t))))));return this.Xa=e,e}enqueueAfterDelay(t,e,n){this.au(),this.ou.indexOf(t)>-1&&(e=0);const r=Vc.createAndSchedule(this,t,e,n,(t=>this.lu(t)));return this.nu.push(r),r}au(){this.ru&&Ks()}verifyOperationInProgress(){}async hu(){let t;do{t=this.Xa,await t}while(t!==this.Xa)}Pu(t){for(const e of this.nu)if(e.timerId===t)return!0;return!1}Iu(t){return this.hu().then((()=>{this.nu.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.nu)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.hu()}))}Tu(t){this.ou.push(t)}lu(t){const e=this.nu.indexOf(t);this.nu.splice(e,1)}}class Ru extends Iu{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new xu,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||Lu(this),this._firestoreClient.terminate()}}function Lu(t){var e,n,r;const s=t._freezeSettings(),i=function(t,e,n,r){return new Ji(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,bu(r.experimentalLongPollingOptions),r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,s);t._firestoreClient=new mu(t._authCredentials,t._appCheckCredentials,t._queue,i),(null===(n=s.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=s.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:s.localCache.kind,_offline:s.localCache._offlineComponentProvider,_online:s.localCache._onlineComponentProvider})}class Ou{constructor(t){this._byteString=t}static fromBase64String(t){try{return new Ou(zi.fromBase64String(t))}catch(t){throw new Ws(Qs.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new Ou(zi.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class Mu{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Ws(Qs.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new gi(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class Pu{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Ws(Qs.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Ws(Qs.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return ai(this._lat,t._lat)||ai(this._long,t._long)}}const Vu=new RegExp("[~\\*/\\[\\]]");function Fu(t,e,n,r,s){const i=r&&!r.isEmpty(),o=void 0!==s;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let h="";return(i||o)&&(h+=" (found",i&&(h+=` in field ${r}`),o&&(h+=` in document ${s}`),h+=")"),new Ws(Qs.INVALID_ARGUMENT,a+t+h)}class Uu{constructor(t,e,n,r,s){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=s}get id(){return this._key.path.lastSegment()}get ref(){return new Du(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Bu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(ju("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Bu extends Uu{data(){return super.data()}}function ju(t,e){return"string"==typeof e?function(t,e,n){if(e.search(Vu)>=0)throw Fu(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new Mu(...e.split("."))._internalPath}catch(r){throw Fu(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}(t,e):e instanceof Mu?e._internalPath:e._delegate._internalPath}class qu{convertValue(t,e="none"){switch(eo(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Hi(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Qi(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Ks()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return Pi(t,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertGeoPoint(t){return new Pu(Hi(t.latitude),Hi(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Xi(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Yi(t));default:return null}}convertTimestamp(t){const e=Gi(t);return new ci(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=di.fromString(t);Gs(Ih(n));const r=new Zi(n.get(1),n.get(3)),s=new pi(n.popFirst(5));return r.isEqual(e)||qs(`Document ${s} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),s}}class $u{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class zu extends Uu{constructor(t,e,n,r,s,i){super(t,e,n,r,i),this._firestore=t,this._firestoreImpl=t,this.metadata=s}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new Ku(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(ju("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class Ku extends zu{data(t={}){return super.data(t)}}function Gu(t){t=Su(t,Du);const e=Su(t.firestore,Ru);return Eu(function(t){return t._firestoreClient||Lu(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}(e),t._key).then((n=>function(t,e,n){const r=n.docs.get(e._key),s=new Hu(t);return new zu(t,s,e._key,r,new $u(n.hasPendingWrites,n.fromCache),e.converter)}(e,t,n)))}class Hu extends qu{constructor(t){super(),this.firestore=t}convertBytes(t){return new Ou(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new Du(this.firestore,null,e)}}new WeakMap,function(t,e=!0){Fs="10.7.2",et(new v("firestore",((t,{instanceIdentifier:n,options:r})=>{const s=t.getProvider("app").getImmediate(),i=new Ru(new ti(t.getProvider("auth-internal")),new si(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Ws(Qs.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Zi(t.options.projectId,e)}(s,n),s);return r=Object.assign({useFetchStreams:e},r),i._setSettings(r),i}),"PUBLIC").setMultipleInstances(!0)),it(Ps,"4.4.1",t),it(Ps,"4.4.1","esm2017")}();var Qu=function(t,e,n,r){return new(n||(n=Promise))((function(s,i){function o(t){try{h(r.next(t))}catch(t){i(t)}}function a(t){try{h(r.throw(t))}catch(t){i(t)}}function h(t){var e;t.done?s(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}h((r=r.apply(t,e||[])).next())}))};const Wu=function(t,e){const n="string"==typeof t?t:"(default)",r=function(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}("object"==typeof t?t:function(t=X){const e=J.get(t);if(!e&&t===X&&c())return st();if(!e)throw nt.create("no-app",{appName:t});return e}(),"firestore").getImmediate({identifier:n});if(!r._initialized){const t=(t=>{const e=(t=>{var e,n;return null===(n=null===(e=h())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]})("firestore");t&&function(t,e,n,r={}){var s;const i=(t=Su(t,Iu))._getSettings(),o=`${e}:${n}`;if("firestore.googleapis.com"!==i.host&&i.host!==o&&$s("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},i),{host:o,ssl:!1})),r.mockUserToken){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=Vs.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,s=t.sub||t.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const i=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},t);return[a(JSON.stringify({alg:"none",type:"JWT"})),a(JSON.stringify(i)),""].join(".")}(r.mockUserToken,null===(s=t._app)||void 0===s?void 0:s.options.projectId);const i=r.mockUserToken.sub||r.mockUserToken.user_id;if(!i)throw new Ws(Qs.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Vs(i)}t._authCredentials=new Zs(new Ys(e,n))}}(r,...t)}return r}(st({apiKey:"AIzaSyDPiIf3b-npnhE1yUe6zh71rH0Ao8LKeTo",authDomain:"sinchonattendance.firebaseapp.com",databaseURL:"https://sinchonattendance-default-rtdb.firebaseio.com",projectId:"sinchonattendance",storageBucket:"sinchonattendance.appspot.com",messagingSenderId:"502890463273",appId:"1:502890463273:web:8da140c037f1f532e09c38",measurementId:"G-ND0CDPHZ3Z"})),Xu=ku(Wu,"attendance",String(r.us)),Yu=ku(Wu,"secret",String(r.us));!function(){Qu(this,void 0,void 0,(function*(){const t=(yield Gu(Yu)).data();return t&&t.secretCode?t.secretCode:(alert(" .  ."),null)}))}(),function(){Qu(this,void 0,void 0,(function*(){console.log(r.us,Xu);const t=yield Gu(Xu);console.log(t.data())}))}()}},e={};function n(r){var s=e[r];if(void 0!==s)return s.exports;var i=e[r]={exports:{}};return t[r](i,i.exports,n),i.exports}n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),n(312),n(783)})();