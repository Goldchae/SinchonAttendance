/*! For license information please see main.js.LICENSE.txt */
(()=>{"use strict";var t={426:(t,e,n)=>{n.d(e,{Z:()=>v});var r=n(81),i=n.n(r),s=n(645),o=n.n(s),a=n(667),c=n.n(a),u=new URL(n(956),n.b),h=new URL(n(719),n.b),l=new URL(n(238),n.b),d=new URL(n(9),n.b),f=o()(i()),p=c()(u),g=c()(h),m=c()(l),y=c()(d);f.push([t.id,`* {\n  margin: 0;\n  padding: 0;\n  box-sizing: border-box;\n\n  --toggler-icon: url(${p});\n}\n\nbody {\n  font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue",\n    "Noto Sans", "Liberation Sans", Arial, sans-serif, "Apple Color Emoji",\n    "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji";\n  font-size: 1rem;\n  font-weight: 400;\n  line-height: 1.5;\n  color: #212529;\n  background-color: #000;\n}\n\n.bg-dark {\n  background-color: rgba(33, 37, 41, 1);\n}\n\n.outer {\n  width: 100vw;\n  height: 100vh;\n  background-image: url(${g});\n  background-position: center center;\n  background-size: cover;\n  text-align: center;\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  position: relative;\n  z-index: 0;\n}\n\n.attendForm {\n  height: 11vh;\n  display: flex;\n  margin-top: 10px;\n}\n\n.attendInput {\n  margin: 0 10px;\n  width: 40vh;\n  height: 100%;\n  background-color: rgb(255, 255, 255, 0);\n  border: 5px solid #6cffc8;\n  border-radius: 10px;\n  font-size: 4vh;\n  color: white;\n  text-align: center;\n}\n\n.attendSubmit {\n  width: 10vh;\n  background-image: url(${m});\n  background-size: cover;\n  height: 100%;\n  border: none;\n  border-radius: 10px;\n  color: black;\n  font-size: 4vh;\n}\n\n.navbar {\n  position: absolute;\n  width: 100%;\n  top: 0;\n  display: flex;\n  flex-wrap: wrap;\n  align-items: center;\n  justify-content: space-between;\n  padding: 0.5rem 0.75rem;\n  z-index: 1;\n}\n\n.navbar-brand {\n  height: 6vh;\n  padding: 5px 0px;\n  margin-right: 1rem;\n  font-size: 1.25rem;\n  color: #fff;\n  text-decoration: none;\n  white-space: nowrap;\n}\n\n.navbar-toggler {\n  cursor: pointer;\n  padding: 0.25rem 0.75rem;\n  font-size: 1.25rem;\n  line-height: 1;\n  color: rgba(255, 255, 255, 0.55);\n  background-color: transparent;\n  border: 1px solid rgba(255, 255, 255, 0.1);\n  border-radius: 0.375rem;\n  transition: box-shadow 0.15s ease-in-out;\n\n  text-transform: none;\n}\n\n.navbar-toggler:focus {\n  outline: 0;\n  box-shadow: 0 0 0 0.2rem rgba(255, 255, 255, 0.25);\n}\n\n.navbar-toggler-icon {\n  display: inline-block;\n  width: 1.5em;\n  height: 1.5em;\n  vertical-align: middle;\n  background-image: var(--toggler-icon);\n  background-repeat: no-repeat;\n  background-position: center;\n  background-size: 100%;\n}\n\n.textIn {\n  height: 20%;\n  width: 65%;\n  margin: 0 auto;\n  background-image: url(${y});\n  background-size: contain;\n  background-position: center;\n  background-repeat: no-repeat;\n\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n}\n\n.inner {\n  width: 90%;\n}\n\n.talking {\n  color: white;\n  font-size: 4vh;\n  font-weight: 500;\n}\n\n.timerContainer {\n  display: flex;\n  flex-direction: column;\n  justify-content: center;\n  align-items: center;\n  margin-bottom: 1rem;\n}\n\n.timerTitle {\n  color: white;\n  font-size: 4vh;\n  font-weight: 500;\n}\n\n.timer {\n  color: white;\n  font-size: 3vh;\n  font-weight: 500;\n}\n\n@media screen and (max-width: 670px) {\n  .textIn {\n    width: 90%;\n  }\n\n  .talking {\n    font-size: 2.8vh;\n  }\n\n  .attendInput {\n    width: 30vh;\n  }\n}\n`,""]);const v=f},645:t=>{t.exports=function(t){var e=[];return e.toString=function(){return this.map((function(e){var n="",r=void 0!==e[5];return e[4]&&(n+="@supports (".concat(e[4],") {")),e[2]&&(n+="@media ".concat(e[2]," {")),r&&(n+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),n+=t(e),r&&(n+="}"),e[2]&&(n+="}"),e[4]&&(n+="}"),n})).join("")},e.i=function(t,n,r,i,s){"string"==typeof t&&(t=[[null,t,void 0]]);var o={};if(r)for(var a=0;a<this.length;a++){var c=this[a][0];null!=c&&(o[c]=!0)}for(var u=0;u<t.length;u++){var h=[].concat(t[u]);r&&o[h[0]]||(void 0!==s&&(void 0===h[5]||(h[1]="@layer".concat(h[5].length>0?" ".concat(h[5]):""," {").concat(h[1],"}")),h[5]=s),n&&(h[2]?(h[1]="@media ".concat(h[2]," {").concat(h[1],"}"),h[2]=n):h[2]=n),i&&(h[4]?(h[1]="@supports (".concat(h[4],") {").concat(h[1],"}"),h[4]=i):h[4]="".concat(i)),e.push(h))}},e}},667:t=>{t.exports=function(t,e){return e||(e={}),t?(t=String(t.__esModule?t.default:t),/^['"].*['"]$/.test(t)&&(t=t.slice(1,-1)),e.hash&&(t+=e.hash),/["'() \t\n]|(%20)/.test(t)||e.needQuotes?'"'.concat(t.replace(/"/g,'\\"').replace(/\n/g,"\\n"),'"'):t):t}},81:t=>{t.exports=function(t){return t[1]}},379:t=>{var e=[];function n(t){for(var n=-1,r=0;r<e.length;r++)if(e[r].identifier===t){n=r;break}return n}function r(t,r){for(var s={},o=[],a=0;a<t.length;a++){var c=t[a],u=r.base?c[0]+r.base:c[0],h=s[u]||0,l="".concat(u," ").concat(h);s[u]=h+1;var d=n(l),f={css:c[1],media:c[2],sourceMap:c[3],supports:c[4],layer:c[5]};if(-1!==d)e[d].references++,e[d].updater(f);else{var p=i(f,r);r.byIndex=a,e.splice(a,0,{identifier:l,updater:p,references:1})}o.push(l)}return o}function i(t,e){var n=e.domAPI(e);return n.update(t),function(e){if(e){if(e.css===t.css&&e.media===t.media&&e.sourceMap===t.sourceMap&&e.supports===t.supports&&e.layer===t.layer)return;n.update(t=e)}else n.remove()}}t.exports=function(t,i){var s=r(t=t||[],i=i||{});return function(t){t=t||[];for(var o=0;o<s.length;o++){var a=n(s[o]);e[a].references--}for(var c=r(t,i),u=0;u<s.length;u++){var h=n(s[u]);0===e[h].references&&(e[h].updater(),e.splice(h,1))}s=c}}},569:t=>{var e={};t.exports=function(t,n){var r=function(t){if(void 0===e[t]){var n=document.querySelector(t);if(window.HTMLIFrameElement&&n instanceof window.HTMLIFrameElement)try{n=n.contentDocument.head}catch(t){n=null}e[t]=n}return e[t]}(t);if(!r)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");r.appendChild(n)}},216:t=>{t.exports=function(t){var e=document.createElement("style");return t.setAttributes(e,t.attributes),t.insert(e,t.options),e}},565:(t,e,n)=>{t.exports=function(t){var e=n.nc;e&&t.setAttribute("nonce",e)}},795:t=>{t.exports=function(t){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=t.insertStyleElement(t);return{update:function(n){!function(t,e,n){var r="";n.supports&&(r+="@supports (".concat(n.supports,") {")),n.media&&(r+="@media ".concat(n.media," {"));var i=void 0!==n.layer;i&&(r+="@layer".concat(n.layer.length>0?" ".concat(n.layer):""," {")),r+=n.css,i&&(r+="}"),n.media&&(r+="}"),n.supports&&(r+="}");var s=n.sourceMap;s&&"undefined"!=typeof btoa&&(r+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleTagTransform(r,t,e.options)}(e,t,n)},remove:function(){!function(t){if(null===t.parentNode)return!1;t.parentNode.removeChild(t)}(e)}}}},589:t=>{t.exports=function(t,e){if(e.styleSheet)e.styleSheet.cssText=t;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(t))}}},183:(t,e,n)=>{function r(t,e){return e in t&&Object.hasOwnProperty.call(t,e)}function i(t,e){return t[e]}n.d(e,{H:()=>i,f:()=>r})},312:(t,e,n)=>{n.d(e,{$B:()=>i,Nk:()=>s,p1:()=>r});const r={240122:1,240125:2,240129:3,240201:4,240205:5,240208:6,240213:7,240215:8,240219:9,240222:10},i={DB_CONNECTION_ERROR:"데이터베이스 연결에 실패했습니다. 다시 시도해주세요.",YET_STARTED:"아직 출석 시간이 아닙니다.",ALREADY_FINISHED:"출석 시간이 지났습니다.",ALREADY_END:"이미 출석 완료되었습니다.",END:"출석 완료되었습니다.",DO_ATTENDANCE:"출석코드를 입력해주세요.",HANDLE_NOT_EXIST:"존재하는 핸들이 아닙니다.",TRY_AGAIN:"정해진 출석코드와 다릅니다. 재시도해주세요.",LOADING:"로딩중입니다..."},s=900},783:(t,e,n)=>{n.d(e,{B3:()=>td,Q5:()=>ed,tn:()=>Xl,es:()=>nd});const r=function(t){const e=[];let n=0;for(let r=0;r<t.length;r++){let i=t.charCodeAt(r);i<128?e[n++]=i:i<2048?(e[n++]=i>>6|192,e[n++]=63&i|128):55296==(64512&i)&&r+1<t.length&&56320==(64512&t.charCodeAt(r+1))?(i=65536+((1023&i)<<10)+(1023&t.charCodeAt(++r)),e[n++]=i>>18|240,e[n++]=i>>12&63|128,e[n++]=i>>6&63|128,e[n++]=63&i|128):(e[n++]=i>>12|224,e[n++]=i>>6&63|128,e[n++]=63&i|128)}return e},i={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"==typeof atob,encodeByteArray(t,e){if(!Array.isArray(t))throw Error("encodeByteArray takes an array as a parameter");this.init_();const n=e?this.byteToCharMapWebSafe_:this.byteToCharMap_,r=[];for(let e=0;e<t.length;e+=3){const i=t[e],s=e+1<t.length,o=s?t[e+1]:0,a=e+2<t.length,c=a?t[e+2]:0,u=i>>2,h=(3&i)<<4|o>>4;let l=(15&o)<<2|c>>6,d=63&c;a||(d=64,s||(l=64)),r.push(n[u],n[h],n[l],n[d])}return r.join("")},encodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?btoa(t):this.encodeByteArray(r(t),e)},decodeString(t,e){return this.HAS_NATIVE_SUPPORT&&!e?atob(t):function(t){const e=[];let n=0,r=0;for(;n<t.length;){const i=t[n++];if(i<128)e[r++]=String.fromCharCode(i);else if(i>191&&i<224){const s=t[n++];e[r++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&t[n++])<<12|(63&t[n++])<<6|63&t[n++])-65536;e[r++]=String.fromCharCode(55296+(s>>10)),e[r++]=String.fromCharCode(56320+(1023&s))}else{const s=t[n++],o=t[n++];e[r++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return e.join("")}(this.decodeStringToByteArray(t,e))},decodeStringToByteArray(t,e){this.init_();const n=e?this.charToByteMapWebSafe_:this.charToByteMap_,r=[];for(let e=0;e<t.length;){const i=n[t.charAt(e++)],o=e<t.length?n[t.charAt(e)]:0;++e;const a=e<t.length?n[t.charAt(e)]:64;++e;const c=e<t.length?n[t.charAt(e)]:64;if(++e,null==i||null==o||null==a||null==c)throw new s;const u=i<<2|o>>4;if(r.push(u),64!==a){const t=o<<4&240|a>>2;if(r.push(t),64!==c){const t=a<<6&192|c;r.push(t)}}}return r},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let t=0;t<this.ENCODED_VALS.length;t++)this.byteToCharMap_[t]=this.ENCODED_VALS.charAt(t),this.charToByteMap_[this.byteToCharMap_[t]]=t,this.byteToCharMapWebSafe_[t]=this.ENCODED_VALS_WEBSAFE.charAt(t),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[t]]=t,t>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(t)]=t,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(t)]=t)}}};class s extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const o=function(t){return function(t){const e=r(t);return i.encodeByteArray(e,!0)}(t).replace(/\./g,"")},a=()=>{try{return function(){if("undefined"!=typeof self)return self;if("undefined"!=typeof window)return window;if(void 0!==n.g)return n.g;throw new Error("Unable to locate global object.")}().__FIREBASE_DEFAULTS__||(()=>{if("undefined"==typeof process||void 0===process.env)return;const t=process.env.__FIREBASE_DEFAULTS__;return t?JSON.parse(t):void 0})()||(()=>{if("undefined"==typeof document)return;let t;try{t=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(t){return}const e=t&&function(t){try{return i.decodeString(t,!0)}catch(t){console.error("base64Decode failed: ",t)}return null}(t[1]);return e&&JSON.parse(e)})()}catch(t){return void console.info(`Unable to get __FIREBASE_DEFAULTS__ due to: ${t}`)}},c=()=>{var t;return null===(t=a())||void 0===t?void 0:t.config};class u{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}wrapCallback(t){return(e,n)=>{e?this.reject(e):this.resolve(n),"function"==typeof t&&(this.promise.catch((()=>{})),1===t.length?t(e):t(e,n))}}}function h(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}function l(){try{return"object"==typeof indexedDB}catch(t){return!1}}class d extends Error{constructor(t,e,n){super(e),this.code=t,this.customData=n,this.name="FirebaseError",Object.setPrototypeOf(this,d.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,f.prototype.create)}}class f{constructor(t,e,n){this.service=t,this.serviceName=e,this.errors=n}create(t,...e){const n=e[0]||{},r=`${this.service}/${t}`,i=this.errors[t],s=i?function(t,e){return t.replace(p,((t,n)=>{const r=e[n];return null!=r?String(r):`<${n}?>`}))}(i,n):"Error",o=`${this.serviceName}: ${s} (${r}).`;return new d(r,o,n)}}const p=/\{\$([^}]+)}/g;function g(t,e){if(t===e)return!0;const n=Object.keys(t),r=Object.keys(e);for(const i of n){if(!r.includes(i))return!1;const n=t[i],s=e[i];if(m(n)&&m(s)){if(!g(n,s))return!1}else if(n!==s)return!1}for(const t of r)if(!n.includes(t))return!1;return!0}function m(t){return null!==t&&"object"==typeof t}function y(t){return t&&t._delegate?t._delegate:t}class v{constructor(t,e,n){this.name=t,this.instanceFactory=e,this.type=n,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(t){return this.instantiationMode=t,this}setMultipleInstances(t){return this.multipleInstances=t,this}setServiceProps(t){return this.serviceProps=t,this}setInstanceCreatedCallback(t){return this.onInstanceCreated=t,this}}const w="[DEFAULT]";class b{constructor(t,e){this.name=t,this.container=e,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(t){const e=this.normalizeInstanceIdentifier(t);if(!this.instancesDeferred.has(e)){const t=new u;if(this.instancesDeferred.set(e,t),this.isInitialized(e)||this.shouldAutoInitialize())try{const n=this.getOrInitializeService({instanceIdentifier:e});n&&t.resolve(n)}catch(t){}}return this.instancesDeferred.get(e).promise}getImmediate(t){var e;const n=this.normalizeInstanceIdentifier(null==t?void 0:t.identifier),r=null!==(e=null==t?void 0:t.optional)&&void 0!==e&&e;if(!this.isInitialized(n)&&!this.shouldAutoInitialize()){if(r)return null;throw Error(`Service ${this.name} is not available`)}try{return this.getOrInitializeService({instanceIdentifier:n})}catch(t){if(r)return null;throw t}}getComponent(){return this.component}setComponent(t){if(t.name!==this.name)throw Error(`Mismatching Component ${t.name} for Provider ${this.name}.`);if(this.component)throw Error(`Component for ${this.name} has already been provided`);if(this.component=t,this.shouldAutoInitialize()){if(function(t){return"EAGER"===t.instantiationMode}(t))try{this.getOrInitializeService({instanceIdentifier:w})}catch(t){}for(const[t,e]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(t);try{const t=this.getOrInitializeService({instanceIdentifier:n});e.resolve(t)}catch(t){}}}}clearInstance(t=w){this.instancesDeferred.delete(t),this.instancesOptions.delete(t),this.instances.delete(t)}async delete(){const t=Array.from(this.instances.values());await Promise.all([...t.filter((t=>"INTERNAL"in t)).map((t=>t.INTERNAL.delete())),...t.filter((t=>"_delete"in t)).map((t=>t._delete()))])}isComponentSet(){return null!=this.component}isInitialized(t=w){return this.instances.has(t)}getOptions(t=w){return this.instancesOptions.get(t)||{}}initialize(t={}){const{options:e={}}=t,n=this.normalizeInstanceIdentifier(t.instanceIdentifier);if(this.isInitialized(n))throw Error(`${this.name}(${n}) has already been initialized`);if(!this.isComponentSet())throw Error(`Component ${this.name} has not been registered yet`);const r=this.getOrInitializeService({instanceIdentifier:n,options:e});for(const[t,e]of this.instancesDeferred.entries())n===this.normalizeInstanceIdentifier(t)&&e.resolve(r);return r}onInit(t,e){var n;const r=this.normalizeInstanceIdentifier(e),i=null!==(n=this.onInitCallbacks.get(r))&&void 0!==n?n:new Set;i.add(t),this.onInitCallbacks.set(r,i);const s=this.instances.get(r);return s&&t(s,r),()=>{i.delete(t)}}invokeOnInitCallbacks(t,e){const n=this.onInitCallbacks.get(e);if(n)for(const r of n)try{r(t,e)}catch(t){}}getOrInitializeService({instanceIdentifier:t,options:e={}}){let n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(r=t,r===w?void 0:r),options:e}),this.instances.set(t,n),this.instancesOptions.set(t,e),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(t){}var r;return n||null}normalizeInstanceIdentifier(t=w){return this.component?this.component.multipleInstances?t:w:t}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class E{constructor(t){this.name=t,this.providers=new Map}addComponent(t){const e=this.getProvider(t.name);if(e.isComponentSet())throw new Error(`Component ${t.name} has already been registered with ${this.name}`);e.setComponent(t)}addOrOverwriteComponent(t){this.getProvider(t.name).isComponentSet()&&this.providers.delete(t.name),this.addComponent(t)}getProvider(t){if(this.providers.has(t))return this.providers.get(t);const e=new b(t,this);return this.providers.set(t,e),e}getProviders(){return Array.from(this.providers.values())}}const _=[];var T;!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(T||(T={}));const S={debug:T.DEBUG,verbose:T.VERBOSE,info:T.INFO,warn:T.WARN,error:T.ERROR,silent:T.SILENT},I=T.INFO,C={[T.DEBUG]:"log",[T.VERBOSE]:"log",[T.INFO]:"info",[T.WARN]:"warn",[T.ERROR]:"error"},A=(t,e,...n)=>{if(e<t.logLevel)return;const r=(new Date).toISOString(),i=C[e];if(!i)throw new Error(`Attempted to log a message with an invalid logType (value: ${e})`);console[i](`[${r}]  ${t.name}:`,...n)};class D{constructor(t){this.name=t,this._logLevel=I,this._logHandler=A,this._userLogHandler=null,_.push(this)}get logLevel(){return this._logLevel}set logLevel(t){if(!(t in T))throw new TypeError(`Invalid value "${t}" assigned to \`logLevel\``);this._logLevel=t}setLogLevel(t){this._logLevel="string"==typeof t?S[t]:t}get logHandler(){return this._logHandler}set logHandler(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t}get userLogHandler(){return this._userLogHandler}set userLogHandler(t){this._userLogHandler=t}debug(...t){this._userLogHandler&&this._userLogHandler(this,T.DEBUG,...t),this._logHandler(this,T.DEBUG,...t)}log(...t){this._userLogHandler&&this._userLogHandler(this,T.VERBOSE,...t),this._logHandler(this,T.VERBOSE,...t)}info(...t){this._userLogHandler&&this._userLogHandler(this,T.INFO,...t),this._logHandler(this,T.INFO,...t)}warn(...t){this._userLogHandler&&this._userLogHandler(this,T.WARN,...t),this._logHandler(this,T.WARN,...t)}error(...t){this._userLogHandler&&this._userLogHandler(this,T.ERROR,...t),this._logHandler(this,T.ERROR,...t)}}const N=(t,e)=>e.some((e=>t instanceof e));let k,x;const R=new WeakMap,L=new WeakMap,O=new WeakMap,M=new WeakMap,P=new WeakMap;let V={get(t,e,n){if(t instanceof IDBTransaction){if("done"===e)return L.get(t);if("objectStoreNames"===e)return t.objectStoreNames||O.get(t);if("store"===e)return n.objectStoreNames[1]?void 0:n.objectStore(n.objectStoreNames[0])}return U(t[e])},set:(t,e,n)=>(t[e]=n,!0),has:(t,e)=>t instanceof IDBTransaction&&("done"===e||"store"===e)||e in t};function F(t){return"function"==typeof t?(e=t)!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(x||(x=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(...t){return e.apply(B(this),t),U(R.get(this))}:function(...t){return U(e.apply(B(this),t))}:function(t,...n){const r=e.call(B(this),t,...n);return O.set(r,t.sort?t.sort():[t]),U(r)}:(t instanceof IDBTransaction&&function(t){if(L.has(t))return;const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("complete",i),t.removeEventListener("error",s),t.removeEventListener("abort",s)},i=()=>{e(),r()},s=()=>{n(t.error||new DOMException("AbortError","AbortError")),r()};t.addEventListener("complete",i),t.addEventListener("error",s),t.addEventListener("abort",s)}));L.set(t,e)}(t),N(t,k||(k=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction]))?new Proxy(t,V):t);var e}function U(t){if(t instanceof IDBRequest)return function(t){const e=new Promise(((e,n)=>{const r=()=>{t.removeEventListener("success",i),t.removeEventListener("error",s)},i=()=>{e(U(t.result)),r()},s=()=>{n(t.error),r()};t.addEventListener("success",i),t.addEventListener("error",s)}));return e.then((e=>{e instanceof IDBCursor&&R.set(e,t)})).catch((()=>{})),P.set(e,t),e}(t);if(M.has(t))return M.get(t);const e=F(t);return e!==t&&(M.set(t,e),P.set(e,t)),e}const B=t=>P.get(t),j=["get","getKey","getAll","getAllKeys","count"],$=["put","add","delete","clear"],q=new Map;function z(t,e){if(!(t instanceof IDBDatabase)||e in t||"string"!=typeof e)return;if(q.get(e))return q.get(e);const n=e.replace(/FromIndex$/,""),r=e!==n,i=$.includes(n);if(!(n in(r?IDBIndex:IDBObjectStore).prototype)||!i&&!j.includes(n))return;const s=async function(t,...e){const s=this.transaction(t,i?"readwrite":"readonly");let o=s.store;return r&&(o=o.index(e.shift())),(await Promise.all([o[n](...e),i&&s.done]))[0]};return q.set(e,s),s}var K;K=V,V={...K,get:(t,e,n)=>z(t,e)||K.get(t,e,n),has:(t,e)=>!!z(t,e)||K.has(t,e)};class H{constructor(t){this.container=t}getPlatformInfoString(){return this.container.getProviders().map((t=>{if(function(t){const e=t.getComponent();return"VERSION"===(null==e?void 0:e.type)}(t)){const e=t.getImmediate();return`${e.library}/${e.version}`}return null})).filter((t=>t)).join(" ")}}const G="@firebase/app",Q="0.9.26",W=new D("@firebase/app"),X="[DEFAULT]",Y={[G]:"fire-core","@firebase/app-compat":"fire-core-compat","@firebase/analytics":"fire-analytics","@firebase/analytics-compat":"fire-analytics-compat","@firebase/app-check":"fire-app-check","@firebase/app-check-compat":"fire-app-check-compat","@firebase/auth":"fire-auth","@firebase/auth-compat":"fire-auth-compat","@firebase/database":"fire-rtdb","@firebase/database-compat":"fire-rtdb-compat","@firebase/functions":"fire-fn","@firebase/functions-compat":"fire-fn-compat","@firebase/installations":"fire-iid","@firebase/installations-compat":"fire-iid-compat","@firebase/messaging":"fire-fcm","@firebase/messaging-compat":"fire-fcm-compat","@firebase/performance":"fire-perf","@firebase/performance-compat":"fire-perf-compat","@firebase/remote-config":"fire-rc","@firebase/remote-config-compat":"fire-rc-compat","@firebase/storage":"fire-gcs","@firebase/storage-compat":"fire-gcs-compat","@firebase/firestore":"fire-fst","@firebase/firestore-compat":"fire-fst-compat","fire-js":"fire-js",firebase:"fire-js-all"},J=new Map,Z=new Map;function tt(t,e){try{t.container.addComponent(e)}catch(n){W.debug(`Component ${e.name} failed to register with FirebaseApp ${t.name}`,n)}}function et(t){const e=t.name;if(Z.has(e))return W.debug(`There were multiple attempts to register component ${e}.`),!1;Z.set(e,t);for(const e of J.values())tt(e,t);return!0}const nt=new f("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}."});class rt{constructor(t,e,n){this._isDeleted=!1,this._options=Object.assign({},t),this._config=Object.assign({},e),this._name=e.name,this._automaticDataCollectionEnabled=e.automaticDataCollectionEnabled,this._container=n,this.container.addComponent(new v("app",(()=>this),"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(t){this.checkDestroyed(),this._automaticDataCollectionEnabled=t}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(t){this._isDeleted=t}checkDestroyed(){if(this.isDeleted)throw nt.create("app-deleted",{appName:this._name})}}function it(t,e={}){let n=t;"object"!=typeof e&&(e={name:e});const r=Object.assign({name:X,automaticDataCollectionEnabled:!1},e),i=r.name;if("string"!=typeof i||!i)throw nt.create("bad-app-name",{appName:String(i)});if(n||(n=c()),!n)throw nt.create("no-options");const s=J.get(i);if(s){if(g(n,s.options)&&g(r,s.config))return s;throw nt.create("duplicate-app",{appName:i})}const o=new E(i);for(const t of Z.values())o.addComponent(t);const a=new rt(n,r,o);return J.set(i,a),a}function st(t,e,n){var r;let i=null!==(r=Y[t])&&void 0!==r?r:t;n&&(i+=`-${n}`);const s=i.match(/\s|\//),o=e.match(/\s|\//);if(s||o){const t=[`Unable to register library "${i}" with version "${e}":`];return s&&t.push(`library name "${i}" contains illegal characters (whitespace or "/")`),s&&o&&t.push("and"),o&&t.push(`version name "${e}" contains illegal characters (whitespace or "/")`),void W.warn(t.join(" "))}et(new v(`${i}-version`,(()=>({library:i,version:e})),"VERSION"))}const ot="firebase-heartbeat-database",at=1,ct="firebase-heartbeat-store";let ut=null;function ht(){return ut||(ut=function(t,e,{blocked:n,upgrade:r,blocking:i,terminated:s}={}){const o=indexedDB.open(t,e),a=U(o);return r&&o.addEventListener("upgradeneeded",(t=>{r(U(o.result),t.oldVersion,t.newVersion,U(o.transaction),t)})),n&&o.addEventListener("blocked",(t=>n(t.oldVersion,t.newVersion,t))),a.then((t=>{s&&t.addEventListener("close",(()=>s())),i&&t.addEventListener("versionchange",(t=>i(t.oldVersion,t.newVersion,t)))})).catch((()=>{})),a}(ot,at,{upgrade:(t,e)=>{if(0===e)try{t.createObjectStore(ct)}catch(t){console.warn(t)}}}).catch((t=>{throw nt.create("idb-open",{originalErrorMessage:t.message})}))),ut}async function lt(t,e){try{const n=(await ht()).transaction(ct,"readwrite"),r=n.objectStore(ct);await r.put(e,dt(t)),await n.done}catch(t){if(t instanceof d)W.warn(t.message);else{const e=nt.create("idb-set",{originalErrorMessage:null==t?void 0:t.message});W.warn(e.message)}}}function dt(t){return`${t.name}!${t.options.appId}`}class ft{constructor(t){this.container=t,this._heartbeatsCache=null;const e=this.container.getProvider("app").getImmediate();this._storage=new gt(e),this._heartbeatsCachePromise=this._storage.read().then((t=>(this._heartbeatsCache=t,t)))}async triggerHeartbeat(){var t,e;const n=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),r=pt();if((null!=(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||(this._heartbeatsCache=await this._heartbeatsCachePromise,null!=(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)))&&this._heartbeatsCache.lastSentHeartbeatDate!==r&&!this._heartbeatsCache.heartbeats.some((t=>t.date===r)))return this._heartbeatsCache.heartbeats.push({date:r,agent:n}),this._heartbeatsCache.heartbeats=this._heartbeatsCache.heartbeats.filter((t=>{const e=new Date(t.date).valueOf();return Date.now()-e<=2592e6})),this._storage.overwrite(this._heartbeatsCache)}async getHeartbeatsHeader(){var t;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const e=pt(),{heartbeatsToSend:n,unsentEntries:r}=function(t,e=1024){const n=[];let r=t.slice();for(const i of t){const t=n.find((t=>t.agent===i.agent));if(t){if(t.dates.push(i.date),mt(n)>e){t.dates.pop();break}}else if(n.push({agent:i.agent,dates:[i.date]}),mt(n)>e){n.pop();break}r=r.slice(1)}return{heartbeatsToSend:n,unsentEntries:r}}(this._heartbeatsCache.heartbeats),i=o(JSON.stringify({version:2,heartbeats:n}));return this._heartbeatsCache.lastSentHeartbeatDate=e,r.length>0?(this._heartbeatsCache.heartbeats=r,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}}function pt(){return(new Date).toISOString().substring(0,10)}class gt{constructor(t){this.app=t,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!l()&&new Promise(((t,e)=>{try{let n=!0;const r="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(r);i.onsuccess=()=>{i.result.close(),n||self.indexedDB.deleteDatabase(r),t(!0)},i.onupgradeneeded=()=>{n=!1},i.onerror=()=>{var t;e((null===(t=i.error)||void 0===t?void 0:t.message)||"")}}catch(t){e(t)}})).then((()=>!0)).catch((()=>!1))}async read(){if(await this._canUseIndexedDBPromise){const t=await async function(t){try{const e=await ht();return await e.transaction(ct).objectStore(ct).get(dt(t))}catch(t){if(t instanceof d)W.warn(t.message);else{const e=nt.create("idb-get",{originalErrorMessage:null==t?void 0:t.message});W.warn(e.message)}}}(this.app);return(null==t?void 0:t.heartbeats)?t:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return lt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:t.heartbeats})}}async add(t){var e;if(await this._canUseIndexedDBPromise){const n=await this.read();return lt(this.app,{lastSentHeartbeatDate:null!==(e=t.lastSentHeartbeatDate)&&void 0!==e?e:n.lastSentHeartbeatDate,heartbeats:[...n.heartbeats,...t.heartbeats]})}}}function mt(t){return o(JSON.stringify({version:2,heartbeats:t})).length}et(new v("platform-logger",(t=>new H(t)),"PRIVATE")),et(new v("heartbeat",(t=>new ft(t)),"PRIVATE")),st(G,Q,""),st(G,Q,"esm2017"),st("fire-js",""),st("firebase","10.7.2","app");var yt,vt="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},wt={},bt=bt||{},Et=vt||self;function _t(t){var e=typeof t;return"array"==(e="object"!=e?e:t?Array.isArray(t)?"array":e:"null")||"object"==e&&"number"==typeof t.length}function Tt(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var St="closure_uid_"+(1e9*Math.random()>>>0),It=0;function Ct(t,e,n){return t.call.apply(t.bind,arguments)}function At(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function Dt(t,e,n){return(Dt=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Ct:At).apply(null,arguments)}function Nt(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}function kt(t,e){function n(){}n.prototype=e.prototype,t.$=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.ac=function(t,n,r){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return e.prototype[n].apply(t,i)}}function xt(){this.s=this.s,this.o=this.o}xt.prototype.s=!1,xt.prototype.sa=function(){var t;!this.s&&(this.s=!0,this.N(),0)&&(t=this,Object.prototype.hasOwnProperty.call(t,St)&&t[St]||(t[St]=++It))},xt.prototype.N=function(){if(this.o)for(;this.o.length;)this.o.shift()()};const Rt=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if("string"==typeof t)return"string"!=typeof e||1!=e.length?-1:t.indexOf(e,0);for(let n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1};function Lt(t){const e=t.length;if(0<e){const n=Array(e);for(let r=0;r<e;r++)n[r]=t[r];return n}return[]}function Ot(t,e){for(let e=1;e<arguments.length;e++){const n=arguments[e];if(_t(n)){const e=t.length||0,r=n.length||0;t.length=e+r;for(let i=0;i<r;i++)t[e+i]=n[i]}else t.push(n)}}function Mt(t,e){this.type=t,this.g=this.target=e,this.defaultPrevented=!1}Mt.prototype.h=function(){this.defaultPrevented=!0};var Pt=function(){if(!Et.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{const t=()=>{};Et.addEventListener("test",t,e),Et.removeEventListener("test",t,e)}catch(t){}return t}();function Vt(t){return/^[\s\xa0]*$/.test(t)}function Ft(){var t=Et.navigator;return t&&(t=t.userAgent)?t:""}function Ut(t){return-1!=Ft().indexOf(t)}function Bt(t){return Bt[" "](t),t}Bt[" "]=function(){};var jt,$t,qt,zt=Ut("Opera"),Kt=Ut("Trident")||Ut("MSIE"),Ht=Ut("Edge"),Gt=Ht||Kt,Qt=Ut("Gecko")&&!(-1!=Ft().toLowerCase().indexOf("webkit")&&!Ut("Edge"))&&!(Ut("Trident")||Ut("MSIE"))&&!Ut("Edge"),Wt=-1!=Ft().toLowerCase().indexOf("webkit")&&!Ut("Edge");function Xt(){var t=Et.document;return t?t.documentMode:void 0}t:{var Yt="",Jt=($t=Ft(),Qt?/rv:([^\);]+)(\)|;)/.exec($t):Ht?/Edge\/([\d\.]+)/.exec($t):Kt?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec($t):Wt?/WebKit\/(\S+)/.exec($t):zt?/(?:Version)[ \/]?(\S+)/.exec($t):void 0);if(Jt&&(Yt=Jt?Jt[1]:""),Kt){var Zt=Xt();if(null!=Zt&&Zt>parseFloat(Yt)){jt=String(Zt);break t}}jt=Yt}Et.document&&Kt?qt=Xt()||parseInt(jt,10)||void 0:qt=void 0;var te=qt;function ee(t,e){if(Mt.call(this,t?t.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.g=e,e=t.relatedTarget){if(Qt){t:{try{Bt(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType="string"==typeof t.pointerType?t.pointerType:ne[t.pointerType]||"",this.state=t.state,this.i=t,t.defaultPrevented&&ee.$.h.call(this)}}kt(ee,Mt);var ne={2:"touch",3:"pen",4:"mouse"};ee.prototype.h=function(){ee.$.h.call(this);var t=this.i;t.preventDefault?t.preventDefault():t.returnValue=!1};var re="closure_listenable_"+(1e6*Math.random()|0),ie=0;function se(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.la=i,this.key=++ie,this.fa=this.ia=!1}function oe(t){t.fa=!0,t.listener=null,t.proxy=null,t.src=null,t.la=null}function ae(t,e,n){for(const r in t)e.call(n,t[r],r,t)}function ce(t){const e={};for(const n in t)e[n]=t[n];return e}const ue="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function he(t,e){let n,r;for(let e=1;e<arguments.length;e++){for(n in r=arguments[e],r)t[n]=r[n];for(let e=0;e<ue.length;e++)n=ue[e],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function le(t){this.src=t,this.g={},this.h=0}function de(t,e){var n=e.type;if(n in t.g){var r,i=t.g[n],s=Rt(i,e);(r=0<=s)&&Array.prototype.splice.call(i,s,1),r&&(oe(e),0==t.g[n].length&&(delete t.g[n],t.h--))}}function fe(t,e,n,r){for(var i=0;i<t.length;++i){var s=t[i];if(!s.fa&&s.listener==e&&s.capture==!!n&&s.la==r)return i}return-1}le.prototype.add=function(t,e,n,r,i){var s=t.toString();(t=this.g[s])||(t=this.g[s]=[],this.h++);var o=fe(t,e,r,i);return-1<o?(e=t[o],n||(e.ia=!1)):((e=new se(e,this.src,s,!!r,i)).ia=n,t.push(e)),e};var pe="closure_lm_"+(1e6*Math.random()|0),ge={};function me(t,e,n,r,i){if(r&&r.once)return ve(t,e,n,r,i);if(Array.isArray(e)){for(var s=0;s<e.length;s++)me(t,e[s],n,r,i);return null}return n=Ie(n),t&&t[re]?t.O(e,n,Tt(r)?!!r.capture:!!r,i):ye(t,e,n,!1,r,i)}function ye(t,e,n,r,i,s){if(!e)throw Error("Invalid event type");var o=Tt(i)?!!i.capture:!!i,a=Te(t);if(a||(t[pe]=a=new le(t)),(n=a.add(e,n,r,o,s)).proxy)return n;if(r=function(){const t=_e;return function e(n){return t.call(e.src,e.listener,n)}}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Pt||(i=o),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Ee(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function ve(t,e,n,r,i){if(Array.isArray(e)){for(var s=0;s<e.length;s++)ve(t,e[s],n,r,i);return null}return n=Ie(n),t&&t[re]?t.P(e,n,Tt(r)?!!r.capture:!!r,i):ye(t,e,n,!0,r,i)}function we(t,e,n,r,i){if(Array.isArray(e))for(var s=0;s<e.length;s++)we(t,e[s],n,r,i);else r=Tt(r)?!!r.capture:!!r,n=Ie(n),t&&t[re]?(t=t.i,(e=String(e).toString())in t.g&&-1<(n=fe(s=t.g[e],n,r,i))&&(oe(s[n]),Array.prototype.splice.call(s,n,1),0==s.length&&(delete t.g[e],t.h--))):t&&(t=Te(t))&&(e=t.g[e.toString()],t=-1,e&&(t=fe(e,n,r,i)),(n=-1<t?e[t]:null)&&be(n))}function be(t){if("number"!=typeof t&&t&&!t.fa){var e=t.src;if(e&&e[re])de(e.i,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Ee(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=Te(e))?(de(n,t),0==n.h&&(n.src=null,e[pe]=null)):oe(t)}}}function Ee(t){return t in ge?ge[t]:ge[t]="on"+t}function _e(t,e){if(t.fa)t=!0;else{e=new ee(e,this);var n=t.listener,r=t.la||t.src;t.ia&&be(t),t=n.call(r,e)}return t}function Te(t){return(t=t[pe])instanceof le?t:null}var Se="__closure_events_fn_"+(1e9*Math.random()>>>0);function Ie(t){return"function"==typeof t?t:(t[Se]||(t[Se]=function(e){return t.handleEvent(e)}),t[Se])}function Ce(){xt.call(this),this.i=new le(this),this.S=this,this.J=null}function Ae(t,e){var n,r=t.J;if(r)for(n=[];r;r=r.J)n.push(r);if(t=t.S,r=e.type||e,"string"==typeof e)e=new Mt(e,t);else if(e instanceof Mt)e.target=e.target||t;else{var i=e;he(e=new Mt(r,t),i)}if(i=!0,n)for(var s=n.length-1;0<=s;s--){var o=e.g=n[s];i=De(o,r,!0,e)&&i}if(i=De(o=e.g=t,r,!0,e)&&i,i=De(o,r,!1,e)&&i,n)for(s=0;s<n.length;s++)i=De(o=e.g=n[s],r,!1,e)&&i}function De(t,e,n,r){if(!(e=t.i.g[String(e)]))return!0;e=e.concat();for(var i=!0,s=0;s<e.length;++s){var o=e[s];if(o&&!o.fa&&o.capture==n){var a=o.listener,c=o.la||o.src;o.ia&&de(t.i,o),i=!1!==a.call(c,r)&&i}}return i&&!r.defaultPrevented}kt(Ce,xt),Ce.prototype[re]=!0,Ce.prototype.removeEventListener=function(t,e,n,r){we(this,t,e,n,r)},Ce.prototype.N=function(){if(Ce.$.N.call(this),this.i){var t,e=this.i;for(t in e.g){for(var n=e.g[t],r=0;r<n.length;r++)oe(n[r]);delete e.g[t],e.h--}}this.J=null},Ce.prototype.O=function(t,e,n,r){return this.i.add(String(t),e,!1,n,r)},Ce.prototype.P=function(t,e,n,r){return this.i.add(String(t),e,!0,n,r)};var Ne=Et.JSON.stringify;function ke(){var t=Ve;let e=null;return t.g&&(e=t.g,t.g=t.g.next,t.g||(t.h=null),e.next=null),e}var xe=new class{constructor(t,e){this.i=t,this.j=e,this.h=0,this.g=null}get(){let t;return 0<this.h?(this.h--,t=this.g,this.g=t.next,t.next=null):t=this.i(),t}}((()=>new Re),(t=>t.reset()));class Re{constructor(){this.next=this.g=this.h=null}set(t,e){this.h=t,this.g=e,this.next=null}reset(){this.next=this.g=this.h=null}}function Le(t){var e=1;t=t.split(":");const n=[];for(;0<e&&t.length;)n.push(t.shift()),e--;return t.length&&n.push(t.join(":")),n}function Oe(t){Et.setTimeout((()=>{throw t}),0)}let Me,Pe=!1,Ve=new class{constructor(){this.h=this.g=null}add(t,e){const n=xe.get();n.set(t,e),this.h?this.h.next=n:this.g=n,this.h=n}},Fe=()=>{const t=Et.Promise.resolve(void 0);Me=()=>{t.then(Ue)}};var Ue=()=>{for(var t;t=ke();){try{t.h.call(t.g)}catch(t){Oe(t)}var e=xe;e.j(t),100>e.h&&(e.h++,t.next=e.g,e.g=t)}Pe=!1};function Be(t,e){Ce.call(this),this.h=t||1,this.g=e||Et,this.j=Dt(this.qb,this),this.l=Date.now()}function je(t){t.ga=!1,t.T&&(t.g.clearTimeout(t.T),t.T=null)}function $e(t,e,n){if("function"==typeof t)n&&(t=Dt(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Dt(t.handleEvent,t)}return 2147483647<Number(e)?-1:Et.setTimeout(t,e||0)}function qe(t){t.g=$e((()=>{t.g=null,t.i&&(t.i=!1,qe(t))}),t.j);const e=t.h;t.h=null,t.m.apply(null,e)}kt(Be,Ce),(yt=Be.prototype).ga=!1,yt.T=null,yt.qb=function(){if(this.ga){var t=Date.now()-this.l;0<t&&t<.8*this.h?this.T=this.g.setTimeout(this.j,this.h-t):(this.T&&(this.g.clearTimeout(this.T),this.T=null),Ae(this,"tick"),this.ga&&(je(this),this.start()))}},yt.start=function(){this.ga=!0,this.T||(this.T=this.g.setTimeout(this.j,this.h),this.l=Date.now())},yt.N=function(){Be.$.N.call(this),je(this),delete this.g};class ze extends xt{constructor(t,e){super(),this.m=t,this.j=e,this.h=null,this.i=!1,this.g=null}l(t){this.h=arguments,this.g?this.i=!0:qe(this)}N(){super.N(),this.g&&(Et.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function Ke(t){xt.call(this),this.h=t,this.g={}}kt(Ke,xt);var He=[];function Ge(t,e,n,r){Array.isArray(n)||(n&&(He[0]=n.toString()),n=He);for(var i=0;i<n.length;i++){var s=me(e,n[i],r||t.handleEvent,!1,t.h||t);if(!s)break;t.g[s.key]=s}}function Qe(t){ae(t.g,(function(t,e){this.g.hasOwnProperty(e)&&be(t)}),t),t.g={}}function We(){this.g=!0}function Xe(t,e,n,r){t.info((function(){return"XMLHTTP TEXT ("+e+"): "+function(t,e){if(!t.g)return e;if(!e)return null;try{var n=JSON.parse(e);if(n)for(t=0;t<n.length;t++)if(Array.isArray(n[t])){var r=n[t];if(!(2>r.length)){var i=r[1];if(Array.isArray(i)&&!(1>i.length)){var s=i[0];if("noop"!=s&&"stop"!=s&&"close"!=s)for(var o=1;o<i.length;o++)i[o]=""}}}return Ne(n)}catch(t){return e}}(t,n)+(r?" "+r:"")}))}Ke.prototype.N=function(){Ke.$.N.call(this),Qe(this)},Ke.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")},We.prototype.Ea=function(){this.g=!1},We.prototype.info=function(){};var Ye={},Je=null;function Ze(){return Je=Je||new Ce}function tn(t){Mt.call(this,Ye.Ta,t)}function en(t){const e=Ze();Ae(e,new tn(e))}function nn(t,e){Mt.call(this,Ye.STAT_EVENT,t),this.stat=e}function rn(t){const e=Ze();Ae(e,new nn(e,t))}function sn(t,e){Mt.call(this,Ye.Ua,t),this.size=e}function on(t,e){if("function"!=typeof t)throw Error("Fn must not be null and must be a function");return Et.setTimeout((function(){t()}),e)}Ye.Ta="serverreachability",kt(tn,Mt),Ye.STAT_EVENT="statevent",kt(nn,Mt),Ye.Ua="timingevent",kt(sn,Mt);var an={NO_ERROR:0,rb:1,Eb:2,Db:3,yb:4,Cb:5,Fb:6,Qa:7,TIMEOUT:8,Ib:9},cn={wb:"complete",Sb:"success",Ra:"error",Qa:"abort",Kb:"ready",Lb:"readystatechange",TIMEOUT:"timeout",Gb:"incrementaldata",Jb:"progress",zb:"downloadprogress",$b:"uploadprogress"};function un(){}function hn(t){return t.h||(t.h=t.i())}function ln(){}un.prototype.h=null;var dn,fn={OPEN:"a",vb:"b",Ra:"c",Hb:"d"};function pn(){Mt.call(this,"d")}function gn(){Mt.call(this,"c")}function mn(){}function yn(t,e,n,r){this.l=t,this.j=e,this.m=n,this.W=r||1,this.U=new Ke(this),this.P=wn,t=Gt?125:void 0,this.V=new Be(t),this.I=null,this.i=!1,this.u=this.B=this.A=this.L=this.G=this.Y=this.C=null,this.F=[],this.g=null,this.o=0,this.s=this.v=null,this.ca=-1,this.J=!1,this.O=0,this.M=null,this.ba=this.K=this.aa=this.S=!1,this.h=new vn}function vn(){this.i=null,this.g="",this.h=!1}kt(pn,Mt),kt(gn,Mt),kt(mn,un),mn.prototype.g=function(){return new XMLHttpRequest},mn.prototype.i=function(){return{}},dn=new mn;var wn=45e3,bn={},En={};function _n(t,e,n){t.L=1,t.A=jn(Pn(e)),t.u=n,t.S=!0,Tn(t,null)}function Tn(t,e){t.G=Date.now(),An(t),t.B=Pn(t.A);var n=t.B,r=t.W;Array.isArray(r)||(r=[String(r)]),tr(n.i,"t",r),t.o=0,n=t.l.J,t.h=new vn,t.g=ti(t.l,n?e:null,!t.u),0<t.O&&(t.M=new ze(Dt(t.Pa,t,t.g),t.O)),Ge(t.U,t.g,"readystatechange",t.nb),e=t.I?ce(t.I):{},t.u?(t.v||(t.v="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.g.ha(t.B,t.v,t.u,e)):(t.v="GET",t.g.ha(t.B,t.v,null,e)),en(),function(t,e,n,r,i,s){t.info((function(){if(t.g)if(s)for(var o="",a=s.split("&"),c=0;c<a.length;c++){var u=a[c].split("=");if(1<u.length){var h=u[0];u=u[1];var l=h.split("_");o=2<=l.length&&"type"==l[1]?o+(h+"=")+u+"&":o+(h+"=redacted&")}}else o=null;else o=s;return"XMLHTTP REQ ("+r+") [attempt "+i+"]: "+e+"\n"+n+"\n"+o}))}(t.j,t.v,t.B,t.m,t.W,t.u)}function Sn(t){return!!t.g&&"GET"==t.v&&2!=t.L&&t.l.Ha}function In(t,e,n){let r,i=!0;for(;!t.J&&t.o<n.length;){if(r=Cn(t,n),r==En){4==e&&(t.s=4,rn(14),i=!1),Xe(t.j,t.m,null,"[Incomplete Response]");break}if(r==bn){t.s=4,rn(15),Xe(t.j,t.m,n,"[Invalid Chunk]"),i=!1;break}Xe(t.j,t.m,r,null),Rn(t,r)}Sn(t)&&0!=t.o&&(t.h.g=t.h.g.slice(t.o),t.o=0),4!=e||0!=n.length||t.h.h||(t.s=1,rn(16),i=!1),t.i=t.i&&i,i?0<n.length&&!t.ba&&(t.ba=!0,(e=t.l).g==t&&e.ca&&!e.M&&(e.l.info("Great, no buffering proxy detected. Bytes received: "+n.length),Hr(e),e.M=!0,rn(11))):(Xe(t.j,t.m,n,"[Invalid Chunked Response]"),xn(t),kn(t))}function Cn(t,e){var n=t.o,r=e.indexOf("\n",n);return-1==r?En:(n=Number(e.substring(n,r)),isNaN(n)?bn:(r+=1)+n>e.length?En:(e=e.slice(r,r+n),t.o=r+n,e))}function An(t){t.Y=Date.now()+t.P,Dn(t,t.P)}function Dn(t,e){if(null!=t.C)throw Error("WatchDog timer not null");t.C=on(Dt(t.lb,t),e)}function Nn(t){t.C&&(Et.clearTimeout(t.C),t.C=null)}function kn(t){0==t.l.H||t.J||Wr(t.l,t)}function xn(t){Nn(t);var e=t.M;e&&"function"==typeof e.sa&&e.sa(),t.M=null,je(t.V),Qe(t.U),t.g&&(e=t.g,t.g=null,e.abort(),e.sa())}function Rn(t,e){try{var n=t.l;if(0!=n.H&&(n.g==t||ar(n.i,t)))if(!t.K&&ar(n.i,t)&&3==n.H){try{var r=n.Ja.g.parse(e)}catch(t){r=null}if(Array.isArray(r)&&3==r.length){var i=r;if(0==i[0]){t:if(!n.u){if(n.g){if(!(n.g.G+3e3<t.G))break t;Qr(n),Fr(n)}Kr(n),rn(18)}}else n.Fa=i[1],0<n.Fa-n.V&&37500>i[2]&&n.G&&0==n.A&&!n.v&&(n.v=on(Dt(n.ib,n),6e3));if(1>=or(n.i)&&n.oa){try{n.oa()}catch(t){}n.oa=void 0}}else Yr(n,11)}else if((t.K||n.g==t)&&Qr(n),!Vt(e))for(i=n.Ja.g.parse(e),e=0;e<i.length;e++){let u=i[e];if(n.V=u[0],u=u[1],2==n.H)if("c"==u[0]){n.K=u[1],n.pa=u[2];const e=u[3];null!=e&&(n.ra=e,n.l.info("VER="+n.ra));const i=u[4];null!=i&&(n.Ga=i,n.l.info("SVER="+n.Ga));const h=u[5];null!=h&&"number"==typeof h&&0<h&&(r=1.5*h,n.L=r,n.l.info("backChannelRequestTimeoutMs_="+r)),r=n;const l=t.g;if(l){const t=l.g?l.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(t){var s=r.i;s.g||-1==t.indexOf("spdy")&&-1==t.indexOf("quic")&&-1==t.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(cr(s,s.h),s.h=null))}if(r.F){const t=l.g?l.g.getResponseHeader("X-HTTP-Session-Id"):null;t&&(r.Da=t,Bn(r.I,r.F,t))}}n.H=3,n.h&&n.h.Ba(),n.ca&&(n.S=Date.now()-t.G,n.l.info("Handshake RTT: "+n.S+"ms"));var o=t;if((r=n).wa=Zr(r,r.J?r.pa:null,r.Y),o.K){ur(r.i,o);var a=o,c=r.L;c&&a.setTimeout(c),a.C&&(Nn(a),An(a)),r.g=o}else zr(r);0<n.j.length&&Br(n)}else"stop"!=u[0]&&"close"!=u[0]||Yr(n,7);else 3==n.H&&("stop"==u[0]||"close"==u[0]?"stop"==u[0]?Yr(n,7):Vr(n):"noop"!=u[0]&&n.h&&n.h.Aa(u),n.A=0)}en()}catch(t){}}function Ln(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(_t(t)||"string"==typeof t)Array.prototype.forEach.call(t,e,void 0);else for(var n=function(t){if(t.ta&&"function"==typeof t.ta)return t.ta();if(!t.Z||"function"!=typeof t.Z){if("undefined"!=typeof Map&&t instanceof Map)return Array.from(t.keys());if(!("undefined"!=typeof Set&&t instanceof Set)){if(_t(t)||"string"==typeof t){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}e=[],n=0;for(const r in t)e[n++]=r;return e}}}(t),r=function(t){if(t.Z&&"function"==typeof t.Z)return t.Z();if("undefined"!=typeof Map&&t instanceof Map||"undefined"!=typeof Set&&t instanceof Set)return Array.from(t.values());if("string"==typeof t)return t.split("");if(_t(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t),i=r.length,s=0;s<i;s++)e.call(void 0,r[s],n&&n[s],t)}(yt=yn.prototype).setTimeout=function(t){this.P=t},yt.nb=function(t){t=t.target;const e=this.M;e&&3==xr(t)?e.l():this.Pa(t)},yt.Pa=function(t){try{if(t==this.g)t:{const h=xr(this.g);var e=this.g.Ia();if(this.g.da(),!(3>h)&&(3!=h||Gt||this.g&&(this.h.h||this.g.ja()||Rr(this.g)))){this.J||4!=h||7==e||en(),Nn(this);var n=this.g.da();this.ca=n;e:if(Sn(this)){var r=Rr(this.g);t="";var i=r.length,s=4==xr(this.g);if(!this.h.i){if("undefined"==typeof TextDecoder){xn(this),kn(this);var o="";break e}this.h.i=new Et.TextDecoder}for(e=0;e<i;e++)this.h.h=!0,t+=this.h.i.decode(r[e],{stream:s&&e==i-1});r.length=0,this.h.g+=t,this.o=0,o=this.h.g}else o=this.g.ja();if(this.i=200==n,function(t,e,n,r,i,s,o){t.info((function(){return"XMLHTTP RESP ("+r+") [ attempt "+i+"]: "+e+"\n"+n+"\n"+s+" "+o}))}(this.j,this.v,this.B,this.m,this.W,h,n),this.i){if(this.aa&&!this.K){e:{if(this.g){var a,c=this.g;if((a=c.g?c.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!Vt(a)){var u=a;break e}}u=null}if(!(n=u)){this.i=!1,this.s=3,rn(12),xn(this),kn(this);break t}Xe(this.j,this.m,n,"Initial handshake response via X-HTTP-Initial-Response"),this.K=!0,Rn(this,n)}this.S?(In(this,h,o),Gt&&this.i&&3==h&&(Ge(this.U,this.V,"tick",this.mb),this.V.start())):(Xe(this.j,this.m,o,null),Rn(this,o)),4==h&&xn(this),this.i&&!this.J&&(4==h?Wr(this.l,this):(this.i=!1,An(this)))}else(function(t){const e={};t=(t.g&&2<=xr(t)&&t.g.getAllResponseHeaders()||"").split("\r\n");for(let r=0;r<t.length;r++){if(Vt(t[r]))continue;var n=Le(t[r]);const i=n[0];if("string"!=typeof(n=n[1]))continue;n=n.trim();const s=e[i]||[];e[i]=s,s.push(n)}!function(t,e){for(const n in t)e.call(void 0,t[n],n,t)}(e,(function(t){return t.join(", ")}))})(this.g),400==n&&0<o.indexOf("Unknown SID")?(this.s=3,rn(12)):(this.s=0,rn(13)),xn(this),kn(this)}}}catch(t){}},yt.mb=function(){if(this.g){var t=xr(this.g),e=this.g.ja();this.o<e.length&&(Nn(this),In(this,t,e),this.i&&4!=t&&An(this))}},yt.cancel=function(){this.J=!0,xn(this)},yt.lb=function(){this.C=null;const t=Date.now();0<=t-this.Y?(function(t,e){t.info((function(){return"TIMEOUT: "+e}))}(this.j,this.B),2!=this.L&&(en(),rn(17)),xn(this),this.s=2,kn(this)):Dn(this,this.Y-t)};var On=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function Mn(t){if(this.g=this.s=this.j="",this.m=null,this.o=this.l="",this.h=!1,t instanceof Mn){this.h=t.h,Vn(this,t.j),this.s=t.s,this.g=t.g,Fn(this,t.m),this.l=t.l;var e=t.i,n=new Xn;n.i=e.i,e.g&&(n.g=new Map(e.g),n.h=e.h),Un(this,n),this.o=t.o}else t&&(e=String(t).match(On))?(this.h=!1,Vn(this,e[1]||"",!0),this.s=$n(e[2]||""),this.g=$n(e[3]||"",!0),Fn(this,e[4]),this.l=$n(e[5]||"",!0),Un(this,e[6]||"",!0),this.o=$n(e[7]||"")):(this.h=!1,this.i=new Xn(null,this.h))}function Pn(t){return new Mn(t)}function Vn(t,e,n){t.j=n?$n(e,!0):e,t.j&&(t.j=t.j.replace(/:$/,""))}function Fn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.m=e}else t.m=null}function Un(t,e,n){e instanceof Xn?(t.i=e,function(t,e){e&&!t.j&&(Yn(t),t.i=null,t.g.forEach((function(t,e){var n=e.toLowerCase();e!=n&&(Jn(this,e),tr(this,n,t))}),t)),t.j=e}(t.i,t.h)):(n||(e=qn(e,Qn)),t.i=new Xn(e,t.h))}function Bn(t,e,n){t.i.set(e,n)}function jn(t){return Bn(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),t}function $n(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function qn(t,e,n){return"string"==typeof t?(t=encodeURI(t).replace(e,zn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function zn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Mn.prototype.toString=function(){var t=[],e=this.j;e&&t.push(qn(e,Kn,!0),":");var n=this.g;return(n||"file"==e)&&(t.push("//"),(e=this.s)&&t.push(qn(e,Kn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.m)&&t.push(":",String(n))),(n=this.l)&&(this.g&&"/"!=n.charAt(0)&&t.push("/"),t.push(qn(n,"/"==n.charAt(0)?Gn:Hn,!0))),(n=this.i.toString())&&t.push("?",n),(n=this.o)&&t.push("#",qn(n,Wn)),t.join("")};var Kn=/[#\/\?@]/g,Hn=/[#\?:]/g,Gn=/[#\?]/g,Qn=/[#\?@]/g,Wn=/#/g;function Xn(t,e){this.h=this.g=null,this.i=t||null,this.j=!!e}function Yn(t){t.g||(t.g=new Map,t.h=0,t.i&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var s=t[n].substring(0,r);i=t[n].substring(r+1)}else s=t[n];e(s,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.i,(function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)})))}function Jn(t,e){Yn(t),e=er(t,e),t.g.has(e)&&(t.i=null,t.h-=t.g.get(e).length,t.g.delete(e))}function Zn(t,e){return Yn(t),e=er(t,e),t.g.has(e)}function tr(t,e,n){Jn(t,e),0<n.length&&(t.i=null,t.g.set(er(t,e),Lt(n)),t.h+=n.length)}function er(t,e){return e=String(e),t.j&&(e=e.toLowerCase()),e}(yt=Xn.prototype).add=function(t,e){Yn(this),this.i=null,t=er(this,t);var n=this.g.get(t);return n||this.g.set(t,n=[]),n.push(e),this.h+=1,this},yt.forEach=function(t,e){Yn(this),this.g.forEach((function(n,r){n.forEach((function(n){t.call(e,n,r,this)}),this)}),this)},yt.ta=function(){Yn(this);const t=Array.from(this.g.values()),e=Array.from(this.g.keys()),n=[];for(let r=0;r<e.length;r++){const i=t[r];for(let t=0;t<i.length;t++)n.push(e[r])}return n},yt.Z=function(t){Yn(this);let e=[];if("string"==typeof t)Zn(this,t)&&(e=e.concat(this.g.get(er(this,t))));else{t=Array.from(this.g.values());for(let n=0;n<t.length;n++)e=e.concat(t[n])}return e},yt.set=function(t,e){return Yn(this),this.i=null,Zn(this,t=er(this,t))&&(this.h-=this.g.get(t).length),this.g.set(t,[e]),this.h+=1,this},yt.get=function(t,e){return t&&0<(t=this.Z(t)).length?String(t[0]):e},yt.toString=function(){if(this.i)return this.i;if(!this.g)return"";const t=[],e=Array.from(this.g.keys());for(var n=0;n<e.length;n++){var r=e[n];const s=encodeURIComponent(String(r)),o=this.Z(r);for(r=0;r<o.length;r++){var i=s;""!==o[r]&&(i+="="+encodeURIComponent(String(o[r]))),t.push(i)}}return this.i=t.join("&")};var nr=class{constructor(t,e){this.g=t,this.map=e}};function rr(t){this.l=t||ir,t=Et.PerformanceNavigationTiming?0<(t=Et.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):!!(Et.g&&Et.g.Ka&&Et.g.Ka()&&Et.g.Ka().dc),this.j=t?this.l:1,this.g=null,1<this.j&&(this.g=new Set),this.h=null,this.i=[]}var ir=10;function sr(t){return!!t.h||!!t.g&&t.g.size>=t.j}function or(t){return t.h?1:t.g?t.g.size:0}function ar(t,e){return t.h?t.h==e:!!t.g&&t.g.has(e)}function cr(t,e){t.g?t.g.add(e):t.h=e}function ur(t,e){t.h&&t.h==e?t.h=null:t.g&&t.g.has(e)&&t.g.delete(e)}function hr(t){if(null!=t.h)return t.i.concat(t.h.F);if(null!=t.g&&0!==t.g.size){let e=t.i;for(const n of t.g.values())e=e.concat(n.F);return e}return Lt(t.i)}rr.prototype.cancel=function(){if(this.i=hr(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const t of this.g.values())t.cancel();this.g.clear()}};var lr=class{stringify(t){return Et.JSON.stringify(t,void 0)}parse(t){return Et.JSON.parse(t,void 0)}};function dr(){this.g=new lr}function fr(t,e,n){const r=n||"";try{Ln(t,(function(t,n){let i=t;Tt(t)&&(i=Ne(t)),e.push(r+n+"="+encodeURIComponent(i))}))}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function pr(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}function gr(t){this.l=t.ec||null,this.j=t.ob||!1}function mr(t,e){Ce.call(this),this.F=t,this.u=e,this.m=void 0,this.readyState=yr,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.v=new Headers,this.h=null,this.C="GET",this.B="",this.g=!1,this.A=this.j=this.l=null}kt(gr,un),gr.prototype.g=function(){return new mr(this.l,this.j)},gr.prototype.i=function(t){return function(){return t}}({}),kt(mr,Ce);var yr=0;function vr(t){t.j.read().then(t.Xa.bind(t)).catch(t.ka.bind(t))}function wr(t){t.readyState=4,t.l=null,t.j=null,t.A=null,br(t)}function br(t){t.onreadystatechange&&t.onreadystatechange.call(t)}(yt=mr.prototype).open=function(t,e){if(this.readyState!=yr)throw this.abort(),Error("Error reopening a connection");this.C=t,this.B=e,this.readyState=1,br(this)},yt.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.g=!0;const e={headers:this.v,method:this.C,credentials:this.m,cache:void 0};t&&(e.body=t),(this.F||Et).fetch(new Request(this.B,e)).then(this.$a.bind(this),this.ka.bind(this))},yt.abort=function(){this.response=this.responseText="",this.v=new Headers,this.status=0,this.j&&this.j.cancel("Request was aborted.").catch((()=>{})),1<=this.readyState&&this.g&&4!=this.readyState&&(this.g=!1,wr(this)),this.readyState=yr},yt.$a=function(t){if(this.g&&(this.l=t,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=t.headers,this.readyState=2,br(this)),this.g&&(this.readyState=3,br(this),this.g)))if("arraybuffer"===this.responseType)t.arrayBuffer().then(this.Ya.bind(this),this.ka.bind(this));else if(void 0!==Et.ReadableStream&&"body"in t){if(this.j=t.body.getReader(),this.u){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.A=new TextDecoder;vr(this)}else t.text().then(this.Za.bind(this),this.ka.bind(this))},yt.Xa=function(t){if(this.g){if(this.u&&t.value)this.response.push(t.value);else if(!this.u){var e=t.value?t.value:new Uint8Array(0);(e=this.A.decode(e,{stream:!t.done}))&&(this.response=this.responseText+=e)}t.done?wr(this):br(this),3==this.readyState&&vr(this)}},yt.Za=function(t){this.g&&(this.response=this.responseText=t,wr(this))},yt.Ya=function(t){this.g&&(this.response=t,wr(this))},yt.ka=function(){this.g&&wr(this)},yt.setRequestHeader=function(t,e){this.v.append(t,e)},yt.getResponseHeader=function(t){return this.h&&this.h.get(t.toLowerCase())||""},yt.getAllResponseHeaders=function(){if(!this.h)return"";const t=[],e=this.h.entries();for(var n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},Object.defineProperty(mr.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(t){this.m=t?"include":"same-origin"}});var Er=Et.JSON.parse;function _r(t){Ce.call(this),this.headers=new Map,this.u=t||null,this.h=!1,this.C=this.g=null,this.I="",this.m=0,this.j="",this.l=this.G=this.v=this.F=!1,this.B=0,this.A=null,this.K=Tr,this.L=this.M=!1}kt(_r,Ce);var Tr="",Sr=/^https?$/i,Ir=["POST","PUT"];function Cr(t,e){t.h=!1,t.g&&(t.l=!0,t.g.abort(),t.l=!1),t.j=e,t.m=5,Ar(t),Nr(t)}function Ar(t){t.F||(t.F=!0,Ae(t,"complete"),Ae(t,"error"))}function Dr(t){if(t.h&&void 0!==bt&&(!t.C[1]||4!=xr(t)||2!=t.da()))if(t.v&&4==xr(t))$e(t.La,0,t);else if(Ae(t,"readystatechange"),4==xr(t)){t.h=!1;try{const o=t.da();t:switch(o){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var e=!0;break t;default:e=!1}var n;if(!(n=e)){var r;if(r=0===o){var i=String(t.I).match(On)[1]||null;!i&&Et.self&&Et.self.location&&(i=Et.self.location.protocol.slice(0,-1)),r=!Sr.test(i?i.toLowerCase():"")}n=r}if(n)Ae(t,"complete"),Ae(t,"success");else{t.m=6;try{var s=2<xr(t)?t.g.statusText:""}catch(t){s=""}t.j=s+" ["+t.da()+"]",Ar(t)}}finally{Nr(t)}}}function Nr(t,e){if(t.g){kr(t);const n=t.g,r=t.C[0]?()=>{}:null;t.g=null,t.C=null,e||Ae(t,"ready");try{n.onreadystatechange=r}catch(t){}}}function kr(t){t.g&&t.L&&(t.g.ontimeout=null),t.A&&(Et.clearTimeout(t.A),t.A=null)}function xr(t){return t.g?t.g.readyState:0}function Rr(t){try{if(!t.g)return null;if("response"in t.g)return t.g.response;switch(t.K){case Tr:case"text":return t.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in t.g)return t.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Lr(t){let e="";return ae(t,(function(t,n){e+=n,e+=":",e+=t,e+="\r\n"})),e}function Or(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}r||(n=Lr(n),"string"==typeof t?null!=n&&encodeURIComponent(String(n)):Bn(t,e,n))}function Mr(t,e,n){return n&&n.internalChannelParams&&n.internalChannelParams[t]||e}function Pr(t){this.Ga=0,this.j=[],this.l=new We,this.pa=this.wa=this.I=this.Y=this.g=this.Da=this.F=this.na=this.o=this.U=this.s=null,this.fb=this.W=0,this.cb=Mr("failFast",!1,t),this.G=this.v=this.u=this.m=this.h=null,this.aa=!0,this.Fa=this.V=-1,this.ba=this.A=this.C=0,this.ab=Mr("baseRetryDelayMs",5e3,t),this.hb=Mr("retryDelaySeedMs",1e4,t),this.eb=Mr("forwardChannelMaxRetries",2,t),this.xa=Mr("forwardChannelRequestTimeoutMs",2e4,t),this.va=t&&t.xmlHttpFactory||void 0,this.Ha=t&&t.useFetchStreams||!1,this.L=void 0,this.J=t&&t.supportsCrossDomainXhr||!1,this.K="",this.i=new rr(t&&t.concurrentRequestLimit),this.Ja=new dr,this.P=t&&t.fastHandshake||!1,this.O=t&&t.encodeInitMessageHeaders||!1,this.P&&this.O&&(this.O=!1),this.bb=t&&t.bc||!1,t&&t.Ea&&this.l.Ea(),t&&t.forceLongPolling&&(this.aa=!1),this.ca=!this.P&&this.aa&&t&&t.detectBufferingProxy||!1,this.qa=void 0,t&&t.longPollingTimeout&&0<t.longPollingTimeout&&(this.qa=t.longPollingTimeout),this.oa=void 0,this.S=0,this.M=!1,this.ma=this.B=null}function Vr(t){if(Ur(t),3==t.H){var e=t.W++,n=Pn(t.I);if(Bn(n,"SID",t.K),Bn(n,"RID",e),Bn(n,"TYPE","terminate"),$r(t,n),(e=new yn(t,t.l,e)).L=2,e.A=jn(Pn(n)),n=!1,Et.navigator&&Et.navigator.sendBeacon)try{n=Et.navigator.sendBeacon(e.A.toString(),"")}catch(t){}!n&&Et.Image&&((new Image).src=e.A,n=!0),n||(e.g=ti(e.l,null),e.g.ha(e.A)),e.G=Date.now(),An(e)}Jr(t)}function Fr(t){t.g&&(Hr(t),t.g.cancel(),t.g=null)}function Ur(t){Fr(t),t.u&&(Et.clearTimeout(t.u),t.u=null),Qr(t),t.i.cancel(),t.m&&("number"==typeof t.m&&Et.clearTimeout(t.m),t.m=null)}function Br(t){if(!sr(t.i)&&!t.m){t.m=!0;var e=t.Na;Me||Fe(),Pe||(Me(),Pe=!0),Ve.add(e,t),t.C=0}}function jr(t,e){var n;n=e?e.m:t.W++;const r=Pn(t.I);Bn(r,"SID",t.K),Bn(r,"RID",n),Bn(r,"AID",t.V),$r(t,r),t.o&&t.s&&Or(r,t.o,t.s),n=new yn(t,t.l,n,t.C+1),null===t.o&&(n.I=t.s),e&&(t.j=e.F.concat(t.j)),e=qr(t,n,1e3),n.setTimeout(Math.round(.5*t.xa)+Math.round(.5*t.xa*Math.random())),cr(t.i,n),_n(n,r,e)}function $r(t,e){t.na&&ae(t.na,(function(t,n){Bn(e,n,t)})),t.h&&Ln({},(function(t,n){Bn(e,n,t)}))}function qr(t,e,n){n=Math.min(t.j.length,n);var r=t.h?Dt(t.h.Va,t.h,t):null;t:{var i=t.j;let e=-1;for(;;){const t=["count="+n];-1==e?0<n?(e=i[0].g,t.push("ofs="+e)):e=0:t.push("ofs="+e);let s=!0;for(let o=0;o<n;o++){let n=i[o].g;const a=i[o].map;if(n-=e,0>n)e=Math.max(0,i[o].g-100),s=!1;else try{fr(a,t,"req"+n+"_")}catch(t){r&&r(a)}}if(s){r=t.join("&");break t}}}return t=t.j.splice(0,n),e.F=t,r}function zr(t){if(!t.g&&!t.u){t.ba=1;var e=t.Ma;Me||Fe(),Pe||(Me(),Pe=!0),Ve.add(e,t),t.A=0}}function Kr(t){return!(t.g||t.u||3<=t.A||(t.ba++,t.u=on(Dt(t.Ma,t),Xr(t,t.A)),t.A++,0))}function Hr(t){null!=t.B&&(Et.clearTimeout(t.B),t.B=null)}function Gr(t){t.g=new yn(t,t.l,"rpc",t.ba),null===t.o&&(t.g.I=t.s),t.g.O=0;var e=Pn(t.wa);Bn(e,"RID","rpc"),Bn(e,"SID",t.K),Bn(e,"AID",t.V),Bn(e,"CI",t.G?"0":"1"),!t.G&&t.qa&&Bn(e,"TO",t.qa),Bn(e,"TYPE","xmlhttp"),$r(t,e),t.o&&t.s&&Or(e,t.o,t.s),t.L&&t.g.setTimeout(t.L);var n=t.g;t=t.pa,n.L=1,n.A=jn(Pn(e)),n.u=null,n.S=!0,Tn(n,t)}function Qr(t){null!=t.v&&(Et.clearTimeout(t.v),t.v=null)}function Wr(t,e){var n=null;if(t.g==e){Qr(t),Hr(t),t.g=null;var r=2}else{if(!ar(t.i,e))return;n=e.F,ur(t.i,e),r=1}if(0!=t.H)if(e.i)if(1==r){n=e.u?e.u.length:0,e=Date.now()-e.G;var i=t.C;Ae(r=Ze(),new sn(r,n)),Br(t)}else zr(t);else if(3==(i=e.s)||0==i&&0<e.ca||!(1==r&&function(t,e){return!(or(t.i)>=t.i.j-(t.m?1:0)||(t.m?(t.j=e.F.concat(t.j),0):1==t.H||2==t.H||t.C>=(t.cb?0:t.eb)||(t.m=on(Dt(t.Na,t,e),Xr(t,t.C)),t.C++,0)))}(t,e)||2==r&&Kr(t)))switch(n&&0<n.length&&(e=t.i,e.i=e.i.concat(n)),i){case 1:Yr(t,5);break;case 4:Yr(t,10);break;case 3:Yr(t,6);break;default:Yr(t,2)}}function Xr(t,e){let n=t.ab+Math.floor(Math.random()*t.hb);return t.isActive()||(n*=2),n*e}function Yr(t,e){if(t.l.info("Error code "+e),2==e){var n=null;t.h&&(n=null);var r=Dt(t.pb,t);n||(n=new Mn("//www.google.com/images/cleardot.gif"),Et.location&&"http"==Et.location.protocol||Vn(n,"https"),jn(n)),function(t,e){const n=new We;if(Et.Image){const r=new Image;r.onload=Nt(pr,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Nt(pr,n,r,"TestLoadImage: error",!1,e),r.onabort=Nt(pr,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Nt(pr,n,r,"TestLoadImage: timeout",!1,e),Et.setTimeout((function(){r.ontimeout&&r.ontimeout()}),1e4),r.src=t}else e(!1)}(n.toString(),r)}else rn(2);t.H=0,t.h&&t.h.za(e),Jr(t),Ur(t)}function Jr(t){if(t.H=0,t.ma=[],t.h){const e=hr(t.i);0==e.length&&0==t.j.length||(Ot(t.ma,e),Ot(t.ma,t.j),t.i.i.length=0,Lt(t.j),t.j.length=0),t.h.ya()}}function Zr(t,e,n){var r=n instanceof Mn?Pn(n):new Mn(n);if(""!=r.g)e&&(r.g=e+"."+r.g),Fn(r,r.m);else{var i=Et.location;r=i.protocol,e=e?e+"."+i.hostname:i.hostname,i=+i.port;var s=new Mn(null);r&&Vn(s,r),e&&(s.g=e),i&&Fn(s,i),n&&(s.l=n),r=s}return n=t.F,e=t.Da,n&&e&&Bn(r,n,e),Bn(r,"VER",t.ra),$r(t,r),r}function ti(t,e,n){if(e&&!t.J)throw Error("Can't create secondary domain capable XhrIo object.");return(e=t.Ha&&!t.va?new _r(new gr({ob:n})):new _r(t.va)).Oa(t.J),e}function ei(){}function ni(){if(Kt&&!(10<=Number(te)))throw Error("Environmental error: no available transport.")}function ri(t,e){Ce.call(this),this.g=new Pr(e),this.l=t,this.h=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.g.s=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.Ca&&(t?t["X-WebChannel-Client-Profile"]=e.Ca:t={"X-WebChannel-Client-Profile":e.Ca}),this.g.U=t,(t=e&&e.cc)&&!Vt(t)&&(this.g.o=t),this.A=e&&e.supportsCrossDomainXhr||!1,this.v=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Vt(e)&&(this.g.F=e,null!==(t=this.h)&&e in t&&e in(t=this.h)&&delete t[e]),this.j=new oi(this)}function ii(t){pn.call(this),t.__headers__&&(this.headers=t.__headers__,this.statusCode=t.__status__,delete t.__headers__,delete t.__status__);var e=t.__sm__;if(e){t:{for(const n in e){t=n;break t}t=void 0}(this.i=t)&&(t=this.i,e=null!==e&&t in e?e[t]:void 0),this.data=e}else this.data=t}function si(){gn.call(this),this.status=1}function oi(t){this.g=t}function ai(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.m=Array(this.blockSize),this.i=this.h=0,this.reset()}function ci(t,e,n){n||(n=0);var r=Array(16);if("string"==typeof e)for(var i=0;16>i;++i)r[i]=e.charCodeAt(n++)|e.charCodeAt(n++)<<8|e.charCodeAt(n++)<<16|e.charCodeAt(n++)<<24;else for(i=0;16>i;++i)r[i]=e[n++]|e[n++]<<8|e[n++]<<16|e[n++]<<24;e=t.g[0],n=t.g[1],i=t.g[2];var s=t.g[3],o=e+(s^n&(i^s))+r[0]+3614090360&4294967295;o=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=(n=(i=(s=(e=n+(o<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[1]+3905402710&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[2]+606105819&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[3]+3250441966&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[4]+4118548399&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[5]+1200080426&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[6]+2821735955&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[7]+4249261313&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[8]+1770035416&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[9]+2336552879&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[10]+4294925233&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[11]+2304563134&4294967295)<<22&4294967295|o>>>10))+((o=e+(s^n&(i^s))+r[12]+1804603682&4294967295)<<7&4294967295|o>>>25))+((o=s+(i^e&(n^i))+r[13]+4254626195&4294967295)<<12&4294967295|o>>>20))+((o=i+(n^s&(e^n))+r[14]+2792965006&4294967295)<<17&4294967295|o>>>15))+((o=n+(e^i&(s^e))+r[15]+1236535329&4294967295)<<22&4294967295|o>>>10))+((o=e+(i^s&(n^i))+r[1]+4129170786&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[6]+3225465664&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[11]+643717713&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[0]+3921069994&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[5]+3593408605&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[10]+38016083&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[15]+3634488961&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[4]+3889429448&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[9]+568446438&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[14]+3275163606&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[3]+4107603335&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[8]+1163531501&4294967295)<<20&4294967295|o>>>12))+((o=e+(i^s&(n^i))+r[13]+2850285829&4294967295)<<5&4294967295|o>>>27))+((o=s+(n^i&(e^n))+r[2]+4243563512&4294967295)<<9&4294967295|o>>>23))+((o=i+(e^n&(s^e))+r[7]+1735328473&4294967295)<<14&4294967295|o>>>18))+((o=n+(s^e&(i^s))+r[12]+2368359562&4294967295)<<20&4294967295|o>>>12))+((o=e+(n^i^s)+r[5]+4294588738&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[8]+2272392833&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[11]+1839030562&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[14]+4259657740&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[1]+2763975236&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[4]+1272893353&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[7]+4139469664&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[10]+3200236656&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[13]+681279174&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[0]+3936430074&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[3]+3572445317&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[6]+76029189&4294967295)<<23&4294967295|o>>>9))+((o=e+(n^i^s)+r[9]+3654602809&4294967295)<<4&4294967295|o>>>28))+((o=s+(e^n^i)+r[12]+3873151461&4294967295)<<11&4294967295|o>>>21))+((o=i+(s^e^n)+r[15]+530742520&4294967295)<<16&4294967295|o>>>16))+((o=n+(i^s^e)+r[2]+3299628645&4294967295)<<23&4294967295|o>>>9))+((o=e+(i^(n|~s))+r[0]+4096336452&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[7]+1126891415&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[14]+2878612391&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[5]+4237533241&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~s))+r[12]+1700485571&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[3]+2399980690&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[10]+4293915773&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[1]+2240044497&4294967295)<<21&4294967295|o>>>11))+((o=e+(i^(n|~s))+r[8]+1873313359&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[15]+4264355552&4294967295)<<10&4294967295|o>>>22))+((o=i+(e^(s|~n))+r[6]+2734768916&4294967295)<<15&4294967295|o>>>17))+((o=n+(s^(i|~e))+r[13]+1309151649&4294967295)<<21&4294967295|o>>>11))+((s=(e=n+((o=e+(i^(n|~s))+r[4]+4149444226&4294967295)<<6&4294967295|o>>>26))+((o=s+(n^(e|~i))+r[11]+3174756917&4294967295)<<10&4294967295|o>>>22))^((i=s+((o=i+(e^(s|~n))+r[2]+718787259&4294967295)<<15&4294967295|o>>>17))|~e))+r[9]+3951481745&4294967295,t.g[0]=t.g[0]+e&4294967295,t.g[1]=t.g[1]+(i+(o<<21&4294967295|o>>>11))&4294967295,t.g[2]=t.g[2]+i&4294967295,t.g[3]=t.g[3]+s&4294967295}function ui(t,e){this.h=e;for(var n=[],r=!0,i=t.length-1;0<=i;i--){var s=0|t[i];r&&s==e||(n[i]=s,r=!1)}this.g=n}(yt=_r.prototype).Oa=function(t){this.M=t},yt.ha=function(t,e,n,r){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.I+"; newUri="+t);e=e?e.toUpperCase():"GET",this.I=t,this.j="",this.m=0,this.F=!1,this.h=!0,this.g=this.u?this.u.g():dn.g(),this.C=this.u?hn(this.u):hn(dn),this.g.onreadystatechange=Dt(this.La,this);try{this.G=!0,this.g.open(e,String(t),!0),this.G=!1}catch(t){return void Cr(this,t)}if(t=n||"",n=new Map(this.headers),r)if(Object.getPrototypeOf(r)===Object.prototype)for(var i in r)n.set(i,r[i]);else{if("function"!=typeof r.keys||"function"!=typeof r.get)throw Error("Unknown input type for opt_headers: "+String(r));for(const t of r.keys())n.set(t,r.get(t))}r=Array.from(n.keys()).find((t=>"content-type"==t.toLowerCase())),i=Et.FormData&&t instanceof Et.FormData,!(0<=Rt(Ir,e))||r||i||n.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[t,e]of n)this.g.setRequestHeader(t,e);this.K&&(this.g.responseType=this.K),"withCredentials"in this.g&&this.g.withCredentials!==this.M&&(this.g.withCredentials=this.M);try{kr(this),0<this.B&&((this.L=function(t){return Kt&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(this.g))?(this.g.timeout=this.B,this.g.ontimeout=Dt(this.ua,this)):this.A=$e(this.ua,this.B,this)),this.v=!0,this.g.send(t),this.v=!1}catch(t){Cr(this,t)}},yt.ua=function(){void 0!==bt&&this.g&&(this.j="Timed out after "+this.B+"ms, aborting",this.m=8,Ae(this,"timeout"),this.abort(8))},yt.abort=function(t){this.g&&this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1,this.m=t||7,Ae(this,"complete"),Ae(this,"abort"),Nr(this))},yt.N=function(){this.g&&(this.h&&(this.h=!1,this.l=!0,this.g.abort(),this.l=!1),Nr(this,!0)),_r.$.N.call(this)},yt.La=function(){this.s||(this.G||this.v||this.l?Dr(this):this.kb())},yt.kb=function(){Dr(this)},yt.isActive=function(){return!!this.g},yt.da=function(){try{return 2<xr(this)?this.g.status:-1}catch(t){return-1}},yt.ja=function(){try{return this.g?this.g.responseText:""}catch(t){return""}},yt.Wa=function(t){if(this.g){var e=this.g.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),Er(e)}},yt.Ia=function(){return this.m},yt.Sa=function(){return"string"==typeof this.j?this.j:String(this.j)},(yt=Pr.prototype).ra=8,yt.H=1,yt.Na=function(t){if(this.m)if(this.m=null,1==this.H){if(!t){this.W=Math.floor(1e5*Math.random()),t=this.W++;const i=new yn(this,this.l,t);let s=this.s;if(this.U&&(s?(s=ce(s),he(s,this.U)):s=this.U),null!==this.o||this.O||(i.I=s,s=null),this.P)t:{for(var e=0,n=0;n<this.j.length;n++){var r=this.j[n];if(void 0===(r="__data__"in r.map&&"string"==typeof(r=r.map.__data__)?r.length:void 0))break;if(4096<(e+=r)){e=n;break t}if(4096===e||n===this.j.length-1){e=n+1;break t}}e=1e3}else e=1e3;e=qr(this,i,e),Bn(n=Pn(this.I),"RID",t),Bn(n,"CVER",22),this.F&&Bn(n,"X-HTTP-Session-Id",this.F),$r(this,n),s&&(this.O?e="headers="+encodeURIComponent(String(Lr(s)))+"&"+e:this.o&&Or(n,this.o,s)),cr(this.i,i),this.bb&&Bn(n,"TYPE","init"),this.P?(Bn(n,"$req",e),Bn(n,"SID","null"),i.aa=!0,_n(i,n,null)):_n(i,n,e),this.H=2}}else 3==this.H&&(t?jr(this,t):0==this.j.length||sr(this.i)||jr(this))},yt.Ma=function(){if(this.u=null,Gr(this),this.ca&&!(this.M||null==this.g||0>=this.S)){var t=2*this.S;this.l.info("BP detection timer enabled: "+t),this.B=on(Dt(this.jb,this),t)}},yt.jb=function(){this.B&&(this.B=null,this.l.info("BP detection timeout reached."),this.l.info("Buffering proxy detected and switch to long-polling!"),this.G=!1,this.M=!0,rn(10),Fr(this),Gr(this))},yt.ib=function(){null!=this.v&&(this.v=null,Fr(this),Kr(this),rn(19))},yt.pb=function(t){t?(this.l.info("Successfully pinged google.com"),rn(2)):(this.l.info("Failed to ping google.com"),rn(1))},yt.isActive=function(){return!!this.h&&this.h.isActive(this)},(yt=ei.prototype).Ba=function(){},yt.Aa=function(){},yt.za=function(){},yt.ya=function(){},yt.isActive=function(){return!0},yt.Va=function(){},ni.prototype.g=function(t,e){return new ri(t,e)},kt(ri,Ce),ri.prototype.m=function(){this.g.h=this.j,this.A&&(this.g.J=!0);var t=this.g,e=this.l,n=this.h||void 0;rn(0),t.Y=e,t.na=n||{},t.G=t.aa,t.I=Zr(t,null,t.Y),Br(t)},ri.prototype.close=function(){Vr(this.g)},ri.prototype.u=function(t){var e=this.g;if("string"==typeof t){var n={};n.__data__=t,t=n}else this.v&&((n={}).__data__=Ne(t),t=n);e.j.push(new nr(e.fb++,t)),3==e.H&&Br(e)},ri.prototype.N=function(){this.g.h=null,delete this.j,Vr(this.g),delete this.g,ri.$.N.call(this)},kt(ii,pn),kt(si,gn),kt(oi,ei),oi.prototype.Ba=function(){Ae(this.g,"a")},oi.prototype.Aa=function(t){Ae(this.g,new ii(t))},oi.prototype.za=function(t){Ae(this.g,new si)},oi.prototype.ya=function(){Ae(this.g,"b")},kt(ai,(function(){this.blockSize=-1})),ai.prototype.reset=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.i=this.h=0},ai.prototype.j=function(t,e){void 0===e&&(e=t.length);for(var n=e-this.blockSize,r=this.m,i=this.h,s=0;s<e;){if(0==i)for(;s<=n;)ci(this,t,s),s+=this.blockSize;if("string"==typeof t){for(;s<e;)if(r[i++]=t.charCodeAt(s++),i==this.blockSize){ci(this,r),i=0;break}}else for(;s<e;)if(r[i++]=t[s++],i==this.blockSize){ci(this,r),i=0;break}}this.h=i,this.i+=e},ai.prototype.l=function(){var t=Array((56>this.h?this.blockSize:2*this.blockSize)-this.h);t[0]=128;for(var e=1;e<t.length-8;++e)t[e]=0;var n=8*this.i;for(e=t.length-8;e<t.length;++e)t[e]=255&n,n/=256;for(this.j(t),t=Array(16),e=n=0;4>e;++e)for(var r=0;32>r;r+=8)t[n++]=this.g[e]>>>r&255;return t};var hi={};function li(t){return-128<=t&&128>t?function(t,e){var n=hi;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=function(t){return new ui([0|t],0>t?-1:0)}(t)}(t):new ui([0|t],0>t?-1:0)}function di(t){if(isNaN(t)||!isFinite(t))return pi;if(0>t)return wi(di(-t));for(var e=[],n=1,r=0;t>=n;r++)e[r]=t/n|0,n*=fi;return new ui(e,0)}var fi=4294967296,pi=li(0),gi=li(1),mi=li(16777216);function yi(t){if(0!=t.h)return!1;for(var e=0;e<t.g.length;e++)if(0!=t.g[e])return!1;return!0}function vi(t){return-1==t.h}function wi(t){for(var e=t.g.length,n=[],r=0;r<e;r++)n[r]=~t.g[r];return new ui(n,~t.h).add(gi)}function bi(t,e){return t.add(wi(e))}function Ei(t,e){for(;(65535&t[e])!=t[e];)t[e+1]+=t[e]>>>16,t[e]&=65535,e++}function _i(t,e){this.g=t,this.h=e}function Ti(t,e){if(yi(e))throw Error("division by zero");if(yi(t))return new _i(pi,pi);if(vi(t))return e=Ti(wi(t),e),new _i(wi(e.g),wi(e.h));if(vi(e))return e=Ti(t,wi(e)),new _i(wi(e.g),e.h);if(30<t.g.length){if(vi(t)||vi(e))throw Error("slowDivide_ only works with positive integers.");for(var n=gi,r=e;0>=r.X(t);)n=Si(n),r=Si(r);var i=Ii(n,1),s=Ii(r,1);for(r=Ii(r,2),n=Ii(n,2);!yi(r);){var o=s.add(r);0>=o.X(t)&&(i=i.add(n),s=o),r=Ii(r,1),n=Ii(n,1)}return e=bi(t,i.R(e)),new _i(i,e)}for(i=pi;0<=t.X(e);){for(n=Math.max(1,Math.floor(t.ea()/e.ea())),r=48>=(r=Math.ceil(Math.log(n)/Math.LN2))?1:Math.pow(2,r-48),o=(s=di(n)).R(e);vi(o)||0<o.X(t);)o=(s=di(n-=r)).R(e);yi(s)&&(s=gi),i=i.add(s),t=bi(t,o)}return new _i(i,t)}function Si(t){for(var e=t.g.length+1,n=[],r=0;r<e;r++)n[r]=t.D(r)<<1|t.D(r-1)>>>31;return new ui(n,t.h)}function Ii(t,e){var n=e>>5;e%=32;for(var r=t.g.length-n,i=[],s=0;s<r;s++)i[s]=0<e?t.D(s+n)>>>e|t.D(s+n+1)<<32-e:t.D(s+n);return new ui(i,t.h)}(yt=ui.prototype).ea=function(){if(vi(this))return-wi(this).ea();for(var t=0,e=1,n=0;n<this.g.length;n++){var r=this.D(n);t+=(0<=r?r:fi+r)*e,e*=fi}return t},yt.toString=function(t){if(2>(t=t||10)||36<t)throw Error("radix out of range: "+t);if(yi(this))return"0";if(vi(this))return"-"+wi(this).toString(t);for(var e=di(Math.pow(t,6)),n=this,r="";;){var i=Ti(n,e).g,s=((0<(n=bi(n,i.R(e))).g.length?n.g[0]:n.h)>>>0).toString(t);if(yi(n=i))return s+r;for(;6>s.length;)s="0"+s;r=s+r}},yt.D=function(t){return 0>t?0:t<this.g.length?this.g[t]:this.h},yt.X=function(t){return vi(t=bi(this,t))?-1:yi(t)?0:1},yt.abs=function(){return vi(this)?wi(this):this},yt.add=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0,i=0;i<=e;i++){var s=r+(65535&this.D(i))+(65535&t.D(i)),o=(s>>>16)+(this.D(i)>>>16)+(t.D(i)>>>16);r=o>>>16,s&=65535,o&=65535,n[i]=o<<16|s}return new ui(n,-2147483648&n[n.length-1]?-1:0)},yt.R=function(t){if(yi(this)||yi(t))return pi;if(vi(this))return vi(t)?wi(this).R(wi(t)):wi(wi(this).R(t));if(vi(t))return wi(this.R(wi(t)));if(0>this.X(mi)&&0>t.X(mi))return di(this.ea()*t.ea());for(var e=this.g.length+t.g.length,n=[],r=0;r<2*e;r++)n[r]=0;for(r=0;r<this.g.length;r++)for(var i=0;i<t.g.length;i++){var s=this.D(r)>>>16,o=65535&this.D(r),a=t.D(i)>>>16,c=65535&t.D(i);n[2*r+2*i]+=o*c,Ei(n,2*r+2*i),n[2*r+2*i+1]+=s*c,Ei(n,2*r+2*i+1),n[2*r+2*i+1]+=o*a,Ei(n,2*r+2*i+1),n[2*r+2*i+2]+=s*a,Ei(n,2*r+2*i+2)}for(r=0;r<e;r++)n[r]=n[2*r+1]<<16|n[2*r];for(r=e;r<2*e;r++)n[r]=0;return new ui(n,0)},yt.gb=function(t){return Ti(this,t).h},yt.and=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)&t.D(r);return new ui(n,this.h&t.h)},yt.or=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)|t.D(r);return new ui(n,this.h|t.h)},yt.xor=function(t){for(var e=Math.max(this.g.length,t.g.length),n=[],r=0;r<e;r++)n[r]=this.D(r)^t.D(r);return new ui(n,this.h^t.h)},ni.prototype.createWebChannel=ni.prototype.g,ri.prototype.send=ri.prototype.u,ri.prototype.open=ri.prototype.m,ri.prototype.close=ri.prototype.close,an.NO_ERROR=0,an.TIMEOUT=8,an.HTTP_ERROR=6,cn.COMPLETE="complete",ln.EventType=fn,fn.OPEN="a",fn.CLOSE="b",fn.ERROR="c",fn.MESSAGE="d",Ce.prototype.listen=Ce.prototype.O,_r.prototype.listenOnce=_r.prototype.P,_r.prototype.getLastError=_r.prototype.Sa,_r.prototype.getLastErrorCode=_r.prototype.Ia,_r.prototype.getStatus=_r.prototype.da,_r.prototype.getResponseJson=_r.prototype.Wa,_r.prototype.getResponseText=_r.prototype.ja,_r.prototype.send=_r.prototype.ha,_r.prototype.setWithCredentials=_r.prototype.Oa,ai.prototype.digest=ai.prototype.l,ai.prototype.reset=ai.prototype.reset,ai.prototype.update=ai.prototype.j,ui.prototype.add=ui.prototype.add,ui.prototype.multiply=ui.prototype.R,ui.prototype.modulo=ui.prototype.gb,ui.prototype.compare=ui.prototype.X,ui.prototype.toNumber=ui.prototype.ea,ui.prototype.toString=ui.prototype.toString,ui.prototype.getBits=ui.prototype.D,ui.fromNumber=di,ui.fromString=function t(e,n){if(0==e.length)throw Error("number format error: empty string");if(2>(n=n||10)||36<n)throw Error("radix out of range: "+n);if("-"==e.charAt(0))return wi(t(e.substring(1),n));if(0<=e.indexOf("-"))throw Error('number format error: interior "-" character');for(var r=di(Math.pow(n,8)),i=pi,s=0;s<e.length;s+=8){var o=Math.min(8,e.length-s),a=parseInt(e.substring(s,s+o),n);8>o?(o=di(Math.pow(n,o)),i=i.R(o).add(di(a))):i=(i=i.R(r)).add(di(a))}return i};var Ci=wt.createWebChannelTransport=function(){return new ni},Ai=wt.getStatEventTarget=function(){return Ze()},Di=wt.ErrorCode=an,Ni=wt.EventType=cn,ki=wt.Event=Ye,xi=wt.Stat={xb:0,Ab:1,Bb:2,Ub:3,Zb:4,Wb:5,Xb:6,Vb:7,Tb:8,Yb:9,PROXY:10,NOPROXY:11,Rb:12,Nb:13,Ob:14,Mb:15,Pb:16,Qb:17,tb:18,sb:19,ub:20},Ri=(wt.FetchXmlHttpFactory=gr,wt.WebChannel=ln),Li=wt.XhrIo=_r,Oi=wt.Md5=ai,Mi=wt.Integer=ui;const Pi="@firebase/firestore";class Vi{constructor(t){this.uid=t}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(t){return t.uid===this.uid}}Vi.UNAUTHENTICATED=new Vi(null),Vi.GOOGLE_CREDENTIALS=new Vi("google-credentials-uid"),Vi.FIRST_PARTY=new Vi("first-party-uid"),Vi.MOCK_USER=new Vi("mock-user");let Fi="10.7.2";const Ui=new D("@firebase/firestore");function Bi(){return Ui.logLevel}function ji(t,...e){if(Ui.logLevel<=T.DEBUG){const n=e.map(zi);Ui.debug(`Firestore (${Fi}): ${t}`,...n)}}function $i(t,...e){if(Ui.logLevel<=T.ERROR){const n=e.map(zi);Ui.error(`Firestore (${Fi}): ${t}`,...n)}}function qi(t,...e){if(Ui.logLevel<=T.WARN){const n=e.map(zi);Ui.warn(`Firestore (${Fi}): ${t}`,...n)}}function zi(t){if("string"==typeof t)return t;try{return function(t){return JSON.stringify(t)}(t)}catch(e){return t}}function Ki(t="Unexpected state"){const e=`FIRESTORE (${Fi}) INTERNAL ASSERTION FAILED: `+t;throw $i(e),new Error(e)}function Hi(t,e){t||Ki()}function Gi(t,e){return t}const Qi={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Wi extends d{constructor(t,e){super(t,e),this.code=t,this.message=e,this.toString=()=>`${this.name}: [code=${this.code}]: ${this.message}`}}class Xi{constructor(){this.promise=new Promise(((t,e)=>{this.resolve=t,this.reject=e}))}}class Yi{constructor(t,e){this.user=e,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization",`Bearer ${t}`)}}class Ji{getToken(){return Promise.resolve(null)}invalidateToken(){}start(t,e){t.enqueueRetryable((()=>e(Vi.UNAUTHENTICATED)))}shutdown(){}}class Zi{constructor(t){this.token=t,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(t,e){this.changeListener=e,t.enqueueRetryable((()=>e(this.token.user)))}shutdown(){this.changeListener=null}}class ts{constructor(t){this.t=t,this.currentUser=Vi.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(t,e){let n=this.i;const r=t=>this.i!==n?(n=this.i,e(t)):Promise.resolve();let i=new Xi;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Xi,t.enqueueRetryable((()=>r(this.currentUser)))};const s=()=>{const e=i;t.enqueueRetryable((async()=>{await e.promise,await r(this.currentUser)}))},o=t=>{ji("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=t,this.auth.addAuthTokenListener(this.o),s()};this.t.onInit((t=>o(t))),setTimeout((()=>{if(!this.auth){const t=this.t.getImmediate({optional:!0});t?o(t):(ji("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Xi)}}),0),s()}getToken(){const t=this.i,e=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(e).then((e=>this.i!==t?(ji("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):e?(Hi("string"==typeof e.accessToken),new Yi(e.accessToken,this.currentUser)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.auth.removeAuthTokenListener(this.o)}u(){const t=this.auth&&this.auth.getUid();return Hi(null===t||"string"==typeof t),new Vi(t)}}class es{constructor(t,e,n){this.l=t,this.h=e,this.P=n,this.type="FirstParty",this.user=Vi.FIRST_PARTY,this.I=new Map}T(){return this.P?this.P():null}get headers(){this.I.set("X-Goog-AuthUser",this.l);const t=this.T();return t&&this.I.set("Authorization",t),this.h&&this.I.set("X-Goog-Iam-Authorization-Token",this.h),this.I}}class ns{constructor(t,e,n){this.l=t,this.h=e,this.P=n}getToken(){return Promise.resolve(new es(this.l,this.h,this.P))}start(t,e){t.enqueueRetryable((()=>e(Vi.FIRST_PARTY)))}shutdown(){}invalidateToken(){}}class rs{constructor(t){this.value=t,this.type="AppCheck",this.headers=new Map,t&&t.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class is{constructor(t){this.A=t,this.forceRefresh=!1,this.appCheck=null,this.R=null}start(t,e){const n=t=>{null!=t.error&&ji("FirebaseAppCheckTokenProvider",`Error getting App Check token; using placeholder token instead. Error: ${t.error.message}`);const n=t.token!==this.R;return this.R=t.token,ji("FirebaseAppCheckTokenProvider",`Received ${n?"new":"existing"} token.`),n?e(t.token):Promise.resolve()};this.o=e=>{t.enqueueRetryable((()=>n(e)))};const r=t=>{ji("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=t,this.appCheck.addTokenListener(this.o)};this.A.onInit((t=>r(t))),setTimeout((()=>{if(!this.appCheck){const t=this.A.getImmediate({optional:!0});t?r(t):ji("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}}),0)}getToken(){const t=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(t).then((t=>t?(Hi("string"==typeof t.token),this.R=t.token,new rs(t.token)):null)):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.appCheck.removeTokenListener(this.o)}}function ss(t){const e="undefined"!=typeof self&&(self.crypto||self.msCrypto),n=new Uint8Array(t);if(e&&"function"==typeof e.getRandomValues)e.getRandomValues(n);else for(let e=0;e<t;e++)n[e]=Math.floor(256*Math.random());return n}class os{static newId(){const t=62*Math.floor(256/62);let e="";for(;e.length<20;){const n=ss(40);for(let r=0;r<n.length;++r)e.length<20&&n[r]<t&&(e+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(n[r]%62))}return e}}function as(t,e){return t<e?-1:t>e?1:0}function cs(t,e,n){return t.length===e.length&&t.every(((t,r)=>n(t,e[r])))}class us{constructor(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Wi(Qi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Wi(Qi.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Wi(Qi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Wi(Qi.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}static now(){return us.fromMillis(Date.now())}static fromDate(t){return us.fromMillis(t.getTime())}static fromMillis(t){const e=Math.floor(t/1e3),n=Math.floor(1e6*(t-1e3*e));return new us(e,n)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/1e6}_compareTo(t){return this.seconds===t.seconds?as(this.nanoseconds,t.nanoseconds):as(this.seconds,t.seconds)}isEqual(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{seconds:this.seconds,nanoseconds:this.nanoseconds}}valueOf(){const t=this.seconds- -62135596800;return String(t).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}class hs{constructor(t){this.timestamp=t}static fromTimestamp(t){return new hs(t)}static min(){return new hs(new us(0,0))}static max(){return new hs(new us(253402300799,999999999))}compareTo(t){return this.timestamp._compareTo(t.timestamp)}isEqual(t){return this.timestamp.isEqual(t.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}class ls{constructor(t,e,n){void 0===e?e=0:e>t.length&&Ki(),void 0===n?n=t.length-e:n>t.length-e&&Ki(),this.segments=t,this.offset=e,this.len=n}get length(){return this.len}isEqual(t){return 0===ls.comparator(this,t)}child(t){const e=this.segments.slice(this.offset,this.limit());return t instanceof ls?t.forEach((t=>{e.push(t)})):e.push(t),this.construct(e)}limit(){return this.offset+this.length}popFirst(t){return t=void 0===t?1:t,this.construct(this.segments,this.offset+t,this.length-t)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(t){return this.segments[this.offset+t]}isEmpty(){return 0===this.length}isPrefixOf(t){if(t.length<this.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}isImmediateParentOf(t){if(this.length+1!==t.length)return!1;for(let e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0}forEach(t){for(let e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(t,e){const n=Math.min(t.length,e.length);for(let r=0;r<n;r++){const n=t.get(r),i=e.get(r);if(n<i)return-1;if(n>i)return 1}return t.length<e.length?-1:t.length>e.length?1:0}}class ds extends ls{construct(t,e,n){return new ds(t,e,n)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(...t){const e=[];for(const n of t){if(n.indexOf("//")>=0)throw new Wi(Qi.INVALID_ARGUMENT,`Invalid segment (${n}). Paths must not contain // in them.`);e.push(...n.split("/").filter((t=>t.length>0)))}return new ds(e)}static emptyPath(){return new ds([])}}const fs=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class ps extends ls{construct(t,e,n){return new ps(t,e,n)}static isValidIdentifier(t){return fs.test(t)}canonicalString(){return this.toArray().map((t=>(t=t.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),ps.isValidIdentifier(t)||(t="`"+t+"`"),t))).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&"__name__"===this.get(0)}static keyField(){return new ps(["__name__"])}static fromServerFormat(t){const e=[];let n="",r=0;const i=()=>{if(0===n.length)throw new Wi(Qi.INVALID_ARGUMENT,`Invalid field path (${t}). Paths must not be empty, begin with '.', end with '.', or contain '..'`);e.push(n),n=""};let s=!1;for(;r<t.length;){const e=t[r];if("\\"===e){if(r+1===t.length)throw new Wi(Qi.INVALID_ARGUMENT,"Path has trailing escape character: "+t);const e=t[r+1];if("\\"!==e&&"."!==e&&"`"!==e)throw new Wi(Qi.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);n+=e,r+=2}else"`"===e?(s=!s,r++):"."!==e||s?(n+=e,r++):(i(),r++)}if(i(),s)throw new Wi(Qi.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new ps(e)}static emptyPath(){return new ps([])}}class gs{constructor(t){this.path=t}static fromPath(t){return new gs(ds.fromString(t))}static fromName(t){return new gs(ds.fromString(t).popFirst(5))}static empty(){return new gs(ds.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(t){return null!==t&&0===ds.comparator(this.path,t.path)}toString(){return this.path.toString()}static comparator(t,e){return ds.comparator(t.path,e.path)}static isDocumentKey(t){return t.length%2==0}static fromSegments(t){return new gs(new ds(t.slice()))}}function ms(t){return new ys(t.readTime,t.key,-1)}class ys{constructor(t,e,n){this.readTime=t,this.documentKey=e,this.largestBatchId=n}static min(){return new ys(hs.min(),gs.empty(),-1)}static max(){return new ys(hs.max(),gs.empty(),-1)}}function vs(t,e){let n=t.readTime.compareTo(e.readTime);return 0!==n?n:(n=gs.comparator(t.documentKey,e.documentKey),0!==n?n:as(t.largestBatchId,e.largestBatchId))}const ws="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class bs{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(t){this.onCommittedListeners.push(t)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach((t=>t()))}}async function Es(t){if(t.code!==Qi.FAILED_PRECONDITION||t.message!==ws)throw t;ji("LocalStore","Unexpectedly lost primary lease")}class _s{constructor(t){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t((t=>{this.isDone=!0,this.result=t,this.nextCallback&&this.nextCallback(t)}),(t=>{this.isDone=!0,this.error=t,this.catchCallback&&this.catchCallback(t)}))}catch(t){return this.next(void 0,t)}next(t,e){return this.callbackAttached&&Ki(),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(e,this.error):this.wrapSuccess(t,this.result):new _s(((n,r)=>{this.nextCallback=e=>{this.wrapSuccess(t,e).next(n,r)},this.catchCallback=t=>{this.wrapFailure(e,t).next(n,r)}}))}toPromise(){return new Promise(((t,e)=>{this.next(t,e)}))}wrapUserFunction(t){try{const e=t();return e instanceof _s?e:_s.resolve(e)}catch(t){return _s.reject(t)}}wrapSuccess(t,e){return t?this.wrapUserFunction((()=>t(e))):_s.resolve(e)}wrapFailure(t,e){return t?this.wrapUserFunction((()=>t(e))):_s.reject(e)}static resolve(t){return new _s(((e,n)=>{e(t)}))}static reject(t){return new _s(((e,n)=>{n(t)}))}static waitFor(t){return new _s(((e,n)=>{let r=0,i=0,s=!1;t.forEach((t=>{++r,t.next((()=>{++i,s&&i===r&&e()}),(t=>n(t)))})),s=!0,i===r&&e()}))}static or(t){let e=_s.resolve(!1);for(const n of t)e=e.next((t=>t?_s.resolve(t):n()));return e}static forEach(t,e){const n=[];return t.forEach(((t,r)=>{n.push(e.call(this,t,r))})),this.waitFor(n)}static mapArray(t,e){return new _s(((n,r)=>{const i=t.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const c=a;e(t[c]).next((t=>{s[c]=t,++o,o===i&&n(s)}),(t=>r(t)))}}))}static doWhile(t,e){return new _s(((n,r)=>{const i=()=>{!0===t()?e().next((()=>{i()}),r):n()};i()}))}}class Ts{constructor(t,e){this.action=t,this.transaction=e,this.aborted=!1,this.V=new Xi,this.transaction.oncomplete=()=>{this.V.resolve()},this.transaction.onabort=()=>{e.error?this.V.reject(new Cs(t,e.error)):this.V.resolve()},this.transaction.onerror=e=>{const n=xs(e.target.error);this.V.reject(new Cs(t,n))}}static open(t,e,n,r){try{return new Ts(e,t.transaction(r,n))}catch(t){throw new Cs(e,t)}}get m(){return this.V.promise}abort(t){t&&this.V.reject(t),this.aborted||(ji("SimpleDb","Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())}g(){const t=this.transaction;this.aborted||"function"!=typeof t.commit||t.commit()}store(t){const e=this.transaction.objectStore(t);return new Ds(e)}}class Ss{constructor(t,e,n){this.name=t,this.version=e,this.p=n,12.2===Ss.S(h())&&$i("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}static delete(t){return ji("SimpleDb","Removing database:",t),Ns(window.indexedDB.deleteDatabase(t)).toPromise()}static D(){if(!l())return!1;if(Ss.C())return!0;const t=h(),e=Ss.S(t),n=0<e&&e<10,r=Ss.v(t),i=0<r&&r<4.5;return!(t.indexOf("MSIE ")>0||t.indexOf("Trident/")>0||t.indexOf("Edge/")>0||n||i)}static C(){var t;return"undefined"!=typeof process&&"YES"===(null===(t=process.__PRIVATE_env)||void 0===t?void 0:t.F)}static M(t,e){return t.store(e)}static S(t){const e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)}static v(t){const e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)}async O(t){return this.db||(ji("SimpleDb","Opening database:",this.name),this.db=await new Promise(((e,n)=>{const r=indexedDB.open(this.name,this.version);r.onsuccess=t=>{const n=t.target.result;e(n)},r.onblocked=()=>{n(new Cs(t,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},r.onerror=e=>{const r=e.target.error;"VersionError"===r.name?n(new Wi(Qi.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):"InvalidStateError"===r.name?n(new Wi(Qi.FAILED_PRECONDITION,"Unable to open an IndexedDB connection. This could be due to running in a private browsing session on a browser whose private browsing sessions do not support IndexedDB: "+r)):n(new Cs(t,r))},r.onupgradeneeded=t=>{ji("SimpleDb",'Database "'+this.name+'" requires upgrade from version:',t.oldVersion);const e=t.target.result;this.p.N(e,r.transaction,t.oldVersion,this.version).next((()=>{ji("SimpleDb","Database upgrade to version "+this.version+" complete")}))}}))),this.B&&(this.db.onversionchange=t=>this.B(t)),this.db}L(t){this.B=t,this.db&&(this.db.onversionchange=e=>t(e))}async runTransaction(t,e,n,r){const i="readonly"===e;let s=0;for(;;){++s;try{this.db=await this.O(t);const e=Ts.open(this.db,t,i?"readonly":"readwrite",n),s=r(e).next((t=>(e.g(),t))).catch((t=>(e.abort(t),_s.reject(t)))).toPromise();return s.catch((()=>{})),await e.m,s}catch(t){const e=t,n="FirebaseError"!==e.name&&s<3;if(ji("SimpleDb","Transaction failed with error:",e.message,"Retrying:",n),this.close(),!n)return Promise.reject(e)}}}close(){this.db&&this.db.close(),this.db=void 0}}class Is{constructor(t){this.k=t,this.q=!1,this.K=null}get isDone(){return this.q}get $(){return this.K}set cursor(t){this.k=t}done(){this.q=!0}U(t){this.K=t}delete(){return Ns(this.k.delete())}}class Cs extends Wi{constructor(t,e){super(Qi.UNAVAILABLE,`IndexedDB transaction '${t}' failed: ${e}`),this.name="IndexedDbTransactionError"}}function As(t){return"IndexedDbTransactionError"===t.name}class Ds{constructor(t){this.store=t}put(t,e){let n;return void 0!==e?(ji("SimpleDb","PUT",this.store.name,t,e),n=this.store.put(e,t)):(ji("SimpleDb","PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),Ns(n)}add(t){return ji("SimpleDb","ADD",this.store.name,t,t),Ns(this.store.add(t))}get(t){return Ns(this.store.get(t)).next((e=>(void 0===e&&(e=null),ji("SimpleDb","GET",this.store.name,t,e),e)))}delete(t){return ji("SimpleDb","DELETE",this.store.name,t),Ns(this.store.delete(t))}count(){return ji("SimpleDb","COUNT",this.store.name),Ns(this.store.count())}W(t,e){const n=this.options(t,e),r=n.index?this.store.index(n.index):this.store;if("function"==typeof r.getAll){const t=r.getAll(n.range);return new _s(((e,n)=>{t.onerror=t=>{n(t.target.error)},t.onsuccess=t=>{e(t.target.result)}}))}{const t=this.cursor(n),e=[];return this.G(t,((t,n)=>{e.push(n)})).next((()=>e))}}j(t,e){const n=this.store.getAll(t,null===e?void 0:e);return new _s(((t,e)=>{n.onerror=t=>{e(t.target.error)},n.onsuccess=e=>{t(e.target.result)}}))}H(t,e){ji("SimpleDb","DELETE ALL",this.store.name);const n=this.options(t,e);n.J=!1;const r=this.cursor(n);return this.G(r,((t,e,n)=>n.delete()))}Y(t,e){let n;e?n=t:(n={},e=t);const r=this.cursor(n);return this.G(r,e)}Z(t){const e=this.cursor({});return new _s(((n,r)=>{e.onerror=t=>{const e=xs(t.target.error);r(e)},e.onsuccess=e=>{const r=e.target.result;r?t(r.primaryKey,r.value).next((t=>{t?r.continue():n()})):n()}}))}G(t,e){const n=[];return new _s(((r,i)=>{t.onerror=t=>{i(t.target.error)},t.onsuccess=t=>{const i=t.target.result;if(!i)return void r();const s=new Is(i),o=e(i.primaryKey,i.value,s);if(o instanceof _s){const t=o.catch((t=>(s.done(),_s.reject(t))));n.push(t)}s.isDone?r():null===s.$?i.continue():i.continue(s.$)}})).next((()=>_s.waitFor(n)))}options(t,e){let n;return void 0!==t&&("string"==typeof t?n=t:e=t),{index:n,range:e}}cursor(t){let e="next";if(t.reverse&&(e="prev"),t.index){const n=this.store.index(t.index);return t.J?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)}}function Ns(t){return new _s(((e,n)=>{t.onsuccess=t=>{const n=t.target.result;e(n)},t.onerror=t=>{const e=xs(t.target.error);n(e)}}))}let ks=!1;function xs(t){const e=Ss.S(h());if(e>=12.2&&e<13){const e="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(e)>=0){const t=new Wi("internal",`IOS_INDEXEDDB_BUG1: IndexedDb has thrown '${e}'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.`);return ks||(ks=!0,setTimeout((()=>{throw t}),0)),t}}return t}class Rs{constructor(t,e){this.previousValue=t,e&&(e.sequenceNumberHandler=t=>this.se(t),this.oe=t=>e.writeSequenceNumber(t))}se(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue}next(){const t=++this.previousValue;return this.oe&&this.oe(t),t}}function Ls(t){return null==t}function Os(t){return 0===t&&1/t==-1/0}Rs._e=-1;function Ms(t){let e=0;for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e++;return e}function Ps(t,e){for(const n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Vs(t){for(const e in t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}class Fs{constructor(t,e){this.comparator=t,this.root=e||Bs.EMPTY}insert(t,e){return new Fs(this.comparator,this.root.insert(t,e,this.comparator).copy(null,null,Bs.BLACK,null,null))}remove(t){return new Fs(this.comparator,this.root.remove(t,this.comparator).copy(null,null,Bs.BLACK,null,null))}get(t){let e=this.root;for(;!e.isEmpty();){const n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null}indexOf(t){let e=0,n=this.root;for(;!n.isEmpty();){const r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(t){return this.root.inorderTraversal(t)}forEach(t){this.inorderTraversal(((e,n)=>(t(e,n),!1)))}toString(){const t=[];return this.inorderTraversal(((e,n)=>(t.push(`${e}:${n}`),!1))),`{${t.join(", ")}}`}reverseTraversal(t){return this.root.reverseTraversal(t)}getIterator(){return new Us(this.root,null,this.comparator,!1)}getIteratorFrom(t){return new Us(this.root,t,this.comparator,!1)}getReverseIterator(){return new Us(this.root,null,this.comparator,!0)}getReverseIteratorFrom(t){return new Us(this.root,t,this.comparator,!0)}}class Us{constructor(t,e,n,r){this.isReverse=r,this.nodeStack=[];let i=1;for(;!t.isEmpty();)if(i=e?n(t.key,e):1,e&&r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}getNext(){let t=this.nodeStack.pop();const e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}}}class Bs{constructor(t,e,n,r,i){this.key=t,this.value=e,this.color=null!=n?n:Bs.RED,this.left=null!=r?r:Bs.EMPTY,this.right=null!=i?i:Bs.EMPTY,this.size=this.left.size+1+this.right.size}copy(t,e,n,r,i){return new Bs(null!=t?t:this.key,null!=e?e:this.value,null!=n?n:this.color,null!=r?r:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)}reverseTraversal(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(t,e,n){let r=this;const i=n(t,r.key);return r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n)),r.fixUp()}removeMin(){if(this.left.isEmpty())return Bs.EMPTY;let t=this;return t.left.isRed()||t.left.left.isRed()||(t=t.moveRedLeft()),t=t.copy(null,null,null,t.left.removeMin(),null),t.fixUp()}remove(t,e){let n,r=this;if(e(t,r.key)<0)r.left.isEmpty()||r.left.isRed()||r.left.left.isRed()||(r=r.moveRedLeft()),r=r.copy(null,null,null,r.left.remove(t,e),null);else{if(r.left.isRed()&&(r=r.rotateRight()),r.right.isEmpty()||r.right.isRed()||r.right.left.isRed()||(r=r.moveRedRight()),0===e(t,r.key)){if(r.right.isEmpty())return Bs.EMPTY;n=r.right.min(),r=r.copy(n.key,n.value,null,null,r.right.removeMin())}r=r.copy(null,null,null,null,r.right.remove(t,e))}return r.fixUp()}isRed(){return this.color}fixUp(){let t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t}moveRedLeft(){let t=this.colorFlip();return t.right.left.isRed()&&(t=t.copy(null,null,null,null,t.right.rotateRight()),t=t.rotateLeft(),t=t.colorFlip()),t}moveRedRight(){let t=this.colorFlip();return t.left.left.isRed()&&(t=t.rotateRight(),t=t.colorFlip()),t}rotateLeft(){const t=this.copy(null,null,Bs.RED,null,this.right.left);return this.right.copy(null,null,this.color,t,null)}rotateRight(){const t=this.copy(null,null,Bs.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,t)}colorFlip(){const t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)}checkMaxDepth(){const t=this.check();return Math.pow(2,t)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ki();if(this.right.isRed())throw Ki();const t=this.left.check();if(t!==this.right.check())throw Ki();return t+(this.isRed()?0:1)}}Bs.EMPTY=null,Bs.RED=!0,Bs.BLACK=!1,Bs.EMPTY=new class{constructor(){this.size=0}get key(){throw Ki()}get value(){throw Ki()}get color(){throw Ki()}get left(){throw Ki()}get right(){throw Ki()}copy(t,e,n,r,i){return this}insert(t,e,n){return new Bs(t,e)}remove(t,e){return this}isEmpty(){return!0}inorderTraversal(t){return!1}reverseTraversal(t){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class js{constructor(t){this.comparator=t,this.data=new Fs(this.comparator)}has(t){return null!==this.data.get(t)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(t){return this.data.indexOf(t)}forEach(t){this.data.inorderTraversal(((e,n)=>(t(e),!1)))}forEachInRange(t,e){const n=this.data.getIteratorFrom(t[0]);for(;n.hasNext();){const r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}}forEachWhile(t,e){let n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();)if(!t(n.getNext().key))return}firstAfterOrEqual(t){const e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null}getIterator(){return new $s(this.data.getIterator())}getIteratorFrom(t){return new $s(this.data.getIteratorFrom(t))}add(t){return this.copy(this.data.remove(t).insert(t,!0))}delete(t){return this.has(t)?this.copy(this.data.remove(t)):this}isEmpty(){return this.data.isEmpty()}unionWith(t){let e=this;return e.size<t.size&&(e=t,t=this),t.forEach((t=>{e=e.add(t)})),e}isEqual(t){if(!(t instanceof js))return!1;if(this.size!==t.size)return!1;const e=this.data.getIterator(),n=t.data.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(0!==this.comparator(t,r))return!1}return!0}toArray(){const t=[];return this.forEach((e=>{t.push(e)})),t}toString(){const t=[];return this.forEach((e=>t.push(e))),"SortedSet("+t.toString()+")"}copy(t){const e=new js(this.comparator);return e.data=t,e}}class $s{constructor(t){this.iter=t}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class qs{constructor(t){this.fields=t,t.sort(ps.comparator)}static empty(){return new qs([])}unionWith(t){let e=new js(ps.comparator);for(const t of this.fields)e=e.add(t);for(const n of t)e=e.add(n);return new qs(e.toArray())}covers(t){for(const e of this.fields)if(e.isPrefixOf(t))return!0;return!1}isEqual(t){return cs(this.fields,t.fields,((t,e)=>t.isEqual(e)))}}class zs extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class Ks{constructor(t){this.binaryString=t}static fromBase64String(t){const e=function(t){try{return atob(t)}catch(t){throw"undefined"!=typeof DOMException&&t instanceof DOMException?new zs("Invalid base64 string: "+t):t}}(t);return new Ks(e)}static fromUint8Array(t){const e=function(t){let e="";for(let n=0;n<t.length;++n)e+=String.fromCharCode(t[n]);return e}(t);return new Ks(e)}[Symbol.iterator](){let t=0;return{next:()=>t<this.binaryString.length?{value:this.binaryString.charCodeAt(t++),done:!1}:{value:void 0,done:!0}}}toBase64(){return t=this.binaryString,btoa(t);var t}toUint8Array(){return function(t){const e=new Uint8Array(t.length);for(let n=0;n<t.length;n++)e[n]=t.charCodeAt(n);return e}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(t){return as(this.binaryString,t.binaryString)}isEqual(t){return this.binaryString===t.binaryString}}Ks.EMPTY_BYTE_STRING=new Ks("");const Hs=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Gs(t){if(Hi(!!t),"string"==typeof t){let e=0;const n=Hs.exec(t);if(Hi(!!n),n[1]){let t=n[1];t=(t+"000000000").substr(0,9),e=Number(t)}const r=new Date(t);return{seconds:Math.floor(r.getTime()/1e3),nanos:e}}return{seconds:Qs(t.seconds),nanos:Qs(t.nanos)}}function Qs(t){return"number"==typeof t?t:"string"==typeof t?Number(t):0}function Ws(t){return"string"==typeof t?Ks.fromBase64String(t):Ks.fromUint8Array(t)}function Xs(t){var e,n;return"server_timestamp"===(null===(n=((null===(e=null==t?void 0:t.mapValue)||void 0===e?void 0:e.fields)||{}).__type__)||void 0===n?void 0:n.stringValue)}function Ys(t){const e=t.mapValue.fields.__previous_value__;return Xs(e)?Ys(e):e}function Js(t){const e=Gs(t.mapValue.fields.__local_write_time__.timestampValue);return new us(e.seconds,e.nanos)}class Zs{constructor(t,e,n,r,i,s,o,a,c){this.databaseId=t,this.appId=e,this.persistenceKey=n,this.host=r,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=c}}class to{constructor(t,e){this.projectId=t,this.database=e||"(default)"}static empty(){return new to("","")}get isDefaultDatabase(){return"(default)"===this.database}isEqual(t){return t instanceof to&&t.projectId===this.projectId&&t.database===this.database}}const eo={mapValue:{fields:{__type__:{stringValue:"__max__"}}}};function no(t){return"nullValue"in t?0:"booleanValue"in t?1:"integerValue"in t||"doubleValue"in t?2:"timestampValue"in t?3:"stringValue"in t?5:"bytesValue"in t?6:"referenceValue"in t?7:"geoPointValue"in t?8:"arrayValue"in t?9:"mapValue"in t?Xs(t)?4:mo(t)?9007199254740991:10:Ki()}function ro(t,e){if(t===e)return!0;const n=no(t);if(n!==no(e))return!1;switch(n){case 0:case 9007199254740991:return!0;case 1:return t.booleanValue===e.booleanValue;case 4:return Js(t).isEqual(Js(e));case 3:return function(t,e){if("string"==typeof t.timestampValue&&"string"==typeof e.timestampValue&&t.timestampValue.length===e.timestampValue.length)return t.timestampValue===e.timestampValue;const n=Gs(t.timestampValue),r=Gs(e.timestampValue);return n.seconds===r.seconds&&n.nanos===r.nanos}(t,e);case 5:return t.stringValue===e.stringValue;case 6:return function(t,e){return Ws(t.bytesValue).isEqual(Ws(e.bytesValue))}(t,e);case 7:return t.referenceValue===e.referenceValue;case 8:return function(t,e){return Qs(t.geoPointValue.latitude)===Qs(e.geoPointValue.latitude)&&Qs(t.geoPointValue.longitude)===Qs(e.geoPointValue.longitude)}(t,e);case 2:return function(t,e){if("integerValue"in t&&"integerValue"in e)return Qs(t.integerValue)===Qs(e.integerValue);if("doubleValue"in t&&"doubleValue"in e){const n=Qs(t.doubleValue),r=Qs(e.doubleValue);return n===r?Os(n)===Os(r):isNaN(n)&&isNaN(r)}return!1}(t,e);case 9:return cs(t.arrayValue.values||[],e.arrayValue.values||[],ro);case 10:return function(t,e){const n=t.mapValue.fields||{},r=e.mapValue.fields||{};if(Ms(n)!==Ms(r))return!1;for(const t in n)if(n.hasOwnProperty(t)&&(void 0===r[t]||!ro(n[t],r[t])))return!1;return!0}(t,e);default:return Ki()}}function io(t,e){return void 0!==(t.values||[]).find((t=>ro(t,e)))}function so(t,e){if(t===e)return 0;const n=no(t),r=no(e);if(n!==r)return as(n,r);switch(n){case 0:case 9007199254740991:return 0;case 1:return as(t.booleanValue,e.booleanValue);case 2:return function(t,e){const n=Qs(t.integerValue||t.doubleValue),r=Qs(e.integerValue||e.doubleValue);return n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1}(t,e);case 3:return oo(t.timestampValue,e.timestampValue);case 4:return oo(Js(t),Js(e));case 5:return as(t.stringValue,e.stringValue);case 6:return function(t,e){const n=Ws(t),r=Ws(e);return n.compareTo(r)}(t.bytesValue,e.bytesValue);case 7:return function(t,e){const n=t.split("/"),r=e.split("/");for(let t=0;t<n.length&&t<r.length;t++){const e=as(n[t],r[t]);if(0!==e)return e}return as(n.length,r.length)}(t.referenceValue,e.referenceValue);case 8:return function(t,e){const n=as(Qs(t.latitude),Qs(e.latitude));return 0!==n?n:as(Qs(t.longitude),Qs(e.longitude))}(t.geoPointValue,e.geoPointValue);case 9:return function(t,e){const n=t.values||[],r=e.values||[];for(let t=0;t<n.length&&t<r.length;++t){const e=so(n[t],r[t]);if(e)return e}return as(n.length,r.length)}(t.arrayValue,e.arrayValue);case 10:return function(t,e){if(t===eo.mapValue&&e===eo.mapValue)return 0;if(t===eo.mapValue)return 1;if(e===eo.mapValue)return-1;const n=t.fields||{},r=Object.keys(n),i=e.fields||{},s=Object.keys(i);r.sort(),s.sort();for(let t=0;t<r.length&&t<s.length;++t){const e=as(r[t],s[t]);if(0!==e)return e;const o=so(n[r[t]],i[s[t]]);if(0!==o)return o}return as(r.length,s.length)}(t.mapValue,e.mapValue);default:throw Ki()}}function oo(t,e){if("string"==typeof t&&"string"==typeof e&&t.length===e.length)return as(t,e);const n=Gs(t),r=Gs(e),i=as(n.seconds,r.seconds);return 0!==i?i:as(n.nanos,r.nanos)}function ao(t){return co(t)}function co(t){return"nullValue"in t?"null":"booleanValue"in t?""+t.booleanValue:"integerValue"in t?""+t.integerValue:"doubleValue"in t?""+t.doubleValue:"timestampValue"in t?function(t){const e=Gs(t);return`time(${e.seconds},${e.nanos})`}(t.timestampValue):"stringValue"in t?t.stringValue:"bytesValue"in t?function(t){return Ws(t).toBase64()}(t.bytesValue):"referenceValue"in t?function(t){return gs.fromName(t).toString()}(t.referenceValue):"geoPointValue"in t?function(t){return`geo(${t.latitude},${t.longitude})`}(t.geoPointValue):"arrayValue"in t?function(t){let e="[",n=!0;for(const r of t.values||[])n?n=!1:e+=",",e+=co(r);return e+"]"}(t.arrayValue):"mapValue"in t?function(t){const e=Object.keys(t.fields||{}).sort();let n="{",r=!0;for(const i of e)r?r=!1:n+=",",n+=`${i}:${co(t.fields[i])}`;return n+"}"}(t.mapValue):Ki()}function uo(t){return!!t&&"integerValue"in t}function ho(t){return!!t&&"arrayValue"in t}function lo(t){return!!t&&"nullValue"in t}function fo(t){return!!t&&"doubleValue"in t&&isNaN(Number(t.doubleValue))}function po(t){return!!t&&"mapValue"in t}function go(t){if(t.geoPointValue)return{geoPointValue:Object.assign({},t.geoPointValue)};if(t.timestampValue&&"object"==typeof t.timestampValue)return{timestampValue:Object.assign({},t.timestampValue)};if(t.mapValue){const e={mapValue:{fields:{}}};return Ps(t.mapValue.fields,((t,n)=>e.mapValue.fields[t]=go(n))),e}if(t.arrayValue){const e={arrayValue:{values:[]}};for(let n=0;n<(t.arrayValue.values||[]).length;++n)e.arrayValue.values[n]=go(t.arrayValue.values[n]);return e}return Object.assign({},t)}function mo(t){return"__max__"===(((t.mapValue||{}).fields||{}).__type__||{}).stringValue}class yo{constructor(t){this.value=t}static empty(){return new yo({mapValue:{}})}field(t){if(t.isEmpty())return this.value;{let e=this.value;for(let n=0;n<t.length-1;++n)if(e=(e.mapValue.fields||{})[t.get(n)],!po(e))return null;return e=(e.mapValue.fields||{})[t.lastSegment()],e||null}}set(t,e){this.getFieldsMap(t.popLast())[t.lastSegment()]=go(e)}setAll(t){let e=ps.emptyPath(),n={},r=[];t.forEach(((t,i)=>{if(!e.isImmediateParentOf(i)){const t=this.getFieldsMap(e);this.applyChanges(t,n,r),n={},r=[],e=i.popLast()}t?n[i.lastSegment()]=go(t):r.push(i.lastSegment())}));const i=this.getFieldsMap(e);this.applyChanges(i,n,r)}delete(t){const e=this.field(t.popLast());po(e)&&e.mapValue.fields&&delete e.mapValue.fields[t.lastSegment()]}isEqual(t){return ro(this.value,t.value)}getFieldsMap(t){let e=this.value;e.mapValue.fields||(e.mapValue={fields:{}});for(let n=0;n<t.length;++n){let r=e.mapValue.fields[t.get(n)];po(r)&&r.mapValue.fields||(r={mapValue:{fields:{}}},e.mapValue.fields[t.get(n)]=r),e=r}return e.mapValue.fields}applyChanges(t,e,n){Ps(e,((e,n)=>t[e]=n));for(const e of n)delete t[e]}clone(){return new yo(go(this.value))}}function vo(t){const e=[];return Ps(t.fields,((t,n)=>{const r=new ps([t]);if(po(n)){const t=vo(n.mapValue).fields;if(0===t.length)e.push(r);else for(const n of t)e.push(r.child(n))}else e.push(r)})),new qs(e)}class wo{constructor(t,e,n,r,i,s,o){this.key=t,this.documentType=e,this.version=n,this.readTime=r,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(t){return new wo(t,0,hs.min(),hs.min(),hs.min(),yo.empty(),0)}static newFoundDocument(t,e,n,r){return new wo(t,1,e,hs.min(),n,r,0)}static newNoDocument(t,e){return new wo(t,2,e,hs.min(),hs.min(),yo.empty(),0)}static newUnknownDocument(t,e){return new wo(t,3,e,hs.min(),hs.min(),yo.empty(),2)}convertToFoundDocument(t,e){return!this.createTime.isEqual(hs.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=t),this.version=t,this.documentType=1,this.data=e,this.documentState=0,this}convertToNoDocument(t){return this.version=t,this.documentType=2,this.data=yo.empty(),this.documentState=0,this}convertToUnknownDocument(t){return this.version=t,this.documentType=3,this.data=yo.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=hs.min(),this}setReadTime(t){return this.readTime=t,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(t){return t instanceof wo&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.documentType===t.documentType&&this.documentState===t.documentState&&this.data.isEqual(t.data)}mutableCopy(){return new wo(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return`Document(${this.key}, ${this.version}, ${JSON.stringify(this.data.value)}, {createTime: ${this.createTime}}), {documentType: ${this.documentType}}), {documentState: ${this.documentState}})`}}class bo{constructor(t,e){this.position=t,this.inclusive=e}}function Eo(t,e,n){let r=0;for(let i=0;i<t.position.length;i++){const s=e[i],o=t.position[i];if(r=s.field.isKeyField()?gs.comparator(gs.fromName(o.referenceValue),n.key):so(o,n.data.field(s.field)),"desc"===s.dir&&(r*=-1),0!==r)break}return r}function _o(t,e){if(null===t)return null===e;if(null===e)return!1;if(t.inclusive!==e.inclusive||t.position.length!==e.position.length)return!1;for(let n=0;n<t.position.length;n++)if(!ro(t.position[n],e.position[n]))return!1;return!0}class To{constructor(t,e="asc"){this.field=t,this.dir=e}}function So(t,e){return t.dir===e.dir&&t.field.isEqual(e.field)}class Io{}class Co extends Io{constructor(t,e,n){super(),this.field=t,this.op=e,this.value=n}static create(t,e,n){return t.isKeyField()?"in"===e||"not-in"===e?this.createKeyFieldInFilter(t,e,n):new Lo(t,e,n):"array-contains"===e?new Vo(t,n):"in"===e?new Fo(t,n):"not-in"===e?new Uo(t,n):"array-contains-any"===e?new Bo(t,n):new Co(t,e,n)}static createKeyFieldInFilter(t,e,n){return"in"===e?new Oo(t,n):new Mo(t,n)}matches(t){const e=t.data.field(this.field);return"!="===this.op?null!==e&&this.matchesComparison(so(e,this.value)):null!==e&&no(this.value)===no(e)&&this.matchesComparison(so(e,this.value))}matchesComparison(t){switch(this.op){case"<":return t<0;case"<=":return t<=0;case"==":return 0===t;case"!=":return 0!==t;case">":return t>0;case">=":return t>=0;default:return Ki()}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class Ao extends Io{constructor(t,e){super(),this.filters=t,this.op=e,this.ue=null}static create(t,e){return new Ao(t,e)}matches(t){return Do(this)?void 0===this.filters.find((e=>!e.matches(t))):void 0!==this.filters.find((e=>e.matches(t)))}getFlattenedFilters(){return null!==this.ue||(this.ue=this.filters.reduce(((t,e)=>t.concat(e.getFlattenedFilters())),[])),this.ue}getFilters(){return Object.assign([],this.filters)}}function Do(t){return"and"===t.op}function No(t){return function(t){for(const e of t.filters)if(e instanceof Ao)return!1;return!0}(t)&&Do(t)}function ko(t){if(t instanceof Co)return t.field.canonicalString()+t.op.toString()+ao(t.value);if(No(t))return t.filters.map((t=>ko(t))).join(",");{const e=t.filters.map((t=>ko(t))).join(",");return`${t.op}(${e})`}}function xo(t,e){return t instanceof Co?function(t,e){return e instanceof Co&&t.op===e.op&&t.field.isEqual(e.field)&&ro(t.value,e.value)}(t,e):t instanceof Ao?function(t,e){return e instanceof Ao&&t.op===e.op&&t.filters.length===e.filters.length&&t.filters.reduce(((t,n,r)=>t&&xo(n,e.filters[r])),!0)}(t,e):void Ki()}function Ro(t){return t instanceof Co?function(t){return`${t.field.canonicalString()} ${t.op} ${ao(t.value)}`}(t):t instanceof Ao?function(t){return t.op.toString()+" {"+t.getFilters().map(Ro).join(" ,")+"}"}(t):"Filter"}class Lo extends Co{constructor(t,e,n){super(t,e,n),this.key=gs.fromName(n.referenceValue)}matches(t){const e=gs.comparator(t.key,this.key);return this.matchesComparison(e)}}class Oo extends Co{constructor(t,e){super(t,"in",e),this.keys=Po(0,e)}matches(t){return this.keys.some((e=>e.isEqual(t.key)))}}class Mo extends Co{constructor(t,e){super(t,"not-in",e),this.keys=Po(0,e)}matches(t){return!this.keys.some((e=>e.isEqual(t.key)))}}function Po(t,e){var n;return((null===(n=e.arrayValue)||void 0===n?void 0:n.values)||[]).map((t=>gs.fromName(t.referenceValue)))}class Vo extends Co{constructor(t,e){super(t,"array-contains",e)}matches(t){const e=t.data.field(this.field);return ho(e)&&io(e.arrayValue,this.value)}}class Fo extends Co{constructor(t,e){super(t,"in",e)}matches(t){const e=t.data.field(this.field);return null!==e&&io(this.value.arrayValue,e)}}class Uo extends Co{constructor(t,e){super(t,"not-in",e)}matches(t){if(io(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const e=t.data.field(this.field);return null!==e&&!io(this.value.arrayValue,e)}}class Bo extends Co{constructor(t,e){super(t,"array-contains-any",e)}matches(t){const e=t.data.field(this.field);return!(!ho(e)||!e.arrayValue.values)&&e.arrayValue.values.some((t=>io(this.value.arrayValue,t)))}}class jo{constructor(t,e=null,n=[],r=[],i=null,s=null,o=null){this.path=t,this.collectionGroup=e,this.orderBy=n,this.filters=r,this.limit=i,this.startAt=s,this.endAt=o,this.ce=null}}function $o(t,e=null,n=[],r=[],i=null,s=null,o=null){return new jo(t,e,n,r,i,s,o)}function qo(t){const e=Gi(t);if(null===e.ce){let t=e.path.canonicalString();null!==e.collectionGroup&&(t+="|cg:"+e.collectionGroup),t+="|f:",t+=e.filters.map((t=>ko(t))).join(","),t+="|ob:",t+=e.orderBy.map((t=>function(t){return t.field.canonicalString()+t.dir}(t))).join(","),Ls(e.limit)||(t+="|l:",t+=e.limit),e.startAt&&(t+="|lb:",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map((t=>ao(t))).join(",")),e.endAt&&(t+="|ub:",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map((t=>ao(t))).join(",")),e.ce=t}return e.ce}function zo(t,e){if(t.limit!==e.limit)return!1;if(t.orderBy.length!==e.orderBy.length)return!1;for(let n=0;n<t.orderBy.length;n++)if(!So(t.orderBy[n],e.orderBy[n]))return!1;if(t.filters.length!==e.filters.length)return!1;for(let n=0;n<t.filters.length;n++)if(!xo(t.filters[n],e.filters[n]))return!1;return t.collectionGroup===e.collectionGroup&&!!t.path.isEqual(e.path)&&!!_o(t.startAt,e.startAt)&&_o(t.endAt,e.endAt)}function Ko(t){return gs.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}class Ho{constructor(t,e=null,n=[],r=[],i=null,s="F",o=null,a=null){this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.le=null,this.he=null,this.Pe=null,this.startAt,this.endAt}}function Go(t){return new Ho(t)}function Qo(t){return 0===t.filters.length&&null===t.limit&&null==t.startAt&&null==t.endAt&&(0===t.explicitOrderBy.length||1===t.explicitOrderBy.length&&t.explicitOrderBy[0].field.isKeyField())}function Wo(t){const e=Gi(t);if(null===e.le){e.le=[];const t=new Set;for(const n of e.explicitOrderBy)e.le.push(n),t.add(n.field.canonicalString());const n=e.explicitOrderBy.length>0?e.explicitOrderBy[e.explicitOrderBy.length-1].dir:"asc",r=function(t){let e=new js(ps.comparator);return t.filters.forEach((t=>{t.getFlattenedFilters().forEach((t=>{t.isInequality()&&(e=e.add(t.field))}))})),e}(e);r.forEach((r=>{t.has(r.canonicalString())||r.isKeyField()||e.le.push(new To(r,n))})),t.has(ps.keyField().canonicalString())||e.le.push(new To(ps.keyField(),n))}return e.le}function Xo(t){const e=Gi(t);return e.he||(e.he=function(t,e){if("F"===t.limitType)return $o(t.path,t.collectionGroup,e,t.filters,t.limit,t.startAt,t.endAt);{e=e.map((t=>{const e="desc"===t.dir?"asc":"desc";return new To(t.field,e)}));const n=t.endAt?new bo(t.endAt.position,t.endAt.inclusive):null,r=t.startAt?new bo(t.startAt.position,t.startAt.inclusive):null;return $o(t.path,t.collectionGroup,e,t.filters,t.limit,n,r)}}(e,Wo(t))),e.he}function Yo(t,e,n){return new Ho(t.path,t.collectionGroup,t.explicitOrderBy.slice(),t.filters.slice(),e,n,t.startAt,t.endAt)}function Jo(t,e){return zo(Xo(t),Xo(e))&&t.limitType===e.limitType}function Zo(t){return`${qo(Xo(t))}|lt:${t.limitType}`}function ta(t){return`Query(target=${function(t){let e=t.path.canonicalString();return null!==t.collectionGroup&&(e+=" collectionGroup="+t.collectionGroup),t.filters.length>0&&(e+=`, filters: [${t.filters.map((t=>Ro(t))).join(", ")}]`),Ls(t.limit)||(e+=", limit: "+t.limit),t.orderBy.length>0&&(e+=`, orderBy: [${t.orderBy.map((t=>function(t){return`${t.field.canonicalString()} (${t.dir})`}(t))).join(", ")}]`),t.startAt&&(e+=", startAt: ",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map((t=>ao(t))).join(",")),t.endAt&&(e+=", endAt: ",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map((t=>ao(t))).join(",")),`Target(${e})`}(Xo(t))}; limitType=${t.limitType})`}function ea(t,e){return e.isFoundDocument()&&function(t,e){const n=e.key.path;return null!==t.collectionGroup?e.key.hasCollectionId(t.collectionGroup)&&t.path.isPrefixOf(n):gs.isDocumentKey(t.path)?t.path.isEqual(n):t.path.isImmediateParentOf(n)}(t,e)&&function(t,e){for(const n of Wo(t))if(!n.field.isKeyField()&&null===e.data.field(n.field))return!1;return!0}(t,e)&&function(t,e){for(const n of t.filters)if(!n.matches(e))return!1;return!0}(t,e)&&function(t,e){return!(t.startAt&&!function(t,e,n){const r=Eo(t,e,n);return t.inclusive?r<=0:r<0}(t.startAt,Wo(t),e)||t.endAt&&!function(t,e,n){const r=Eo(t,e,n);return t.inclusive?r>=0:r>0}(t.endAt,Wo(t),e))}(t,e)}function na(t){return(e,n)=>{let r=!1;for(const i of Wo(t)){const t=ra(i,e,n);if(0!==t)return t;r=r||i.field.isKeyField()}return 0}}function ra(t,e,n){const r=t.field.isKeyField()?gs.comparator(e.key,n.key):function(t,e,n){const r=e.data.field(t),i=n.data.field(t);return null!==r&&null!==i?so(r,i):Ki()}(t.field,e,n);switch(t.dir){case"asc":return r;case"desc":return-1*r;default:return Ki()}}class ia{constructor(t,e){this.mapKeyFn=t,this.equalsFn=e,this.inner={},this.innerSize=0}get(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(const[e,r]of n)if(this.equalsFn(e,t))return r}has(t){return void 0!==this.get(t)}set(t,e){const n=this.mapKeyFn(t),r=this.inner[n];if(void 0===r)return this.inner[n]=[[t,e]],void this.innerSize++;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],t))return void(r[n]=[t,e]);r.push([t,e]),this.innerSize++}delete(t){const e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(let r=0;r<n.length;r++)if(this.equalsFn(n[r][0],t))return 1===n.length?delete this.inner[e]:n.splice(r,1),this.innerSize--,!0;return!1}forEach(t){Ps(this.inner,((e,n)=>{for(const[e,r]of n)t(e,r)}))}isEmpty(){return Vs(this.inner)}size(){return this.innerSize}}const sa=new Fs(gs.comparator);function oa(){return sa}const aa=new Fs(gs.comparator);function ca(...t){let e=aa;for(const n of t)e=e.insert(n.key,n);return e}function ua(t){let e=aa;return t.forEach(((t,n)=>e=e.insert(t,n.overlayedDocument))),e}function ha(){return da()}function la(){return da()}function da(){return new ia((t=>t.toString()),((t,e)=>t.isEqual(e)))}const fa=new Fs(gs.comparator),pa=new js(gs.comparator);function ga(...t){let e=pa;for(const n of t)e=e.add(n);return e}const ma=new js(as);function ya(t,e){if(t.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Os(e)?"-0":e}}function va(t){return{integerValue:""+t}}function wa(t,e){return function(t){return"number"==typeof t&&Number.isInteger(t)&&!Os(t)&&t<=Number.MAX_SAFE_INTEGER&&t>=Number.MIN_SAFE_INTEGER}(e)?va(e):ya(t,e)}class ba{constructor(){this._=void 0}}function Ea(t,e,n){return t instanceof Sa?function(t,e){const n={fields:{__type__:{stringValue:"server_timestamp"},__local_write_time__:{timestampValue:{seconds:t.seconds,nanos:t.nanoseconds}}}};return e&&Xs(e)&&(e=Ys(e)),e&&(n.fields.__previous_value__=e),{mapValue:n}}(n,e):t instanceof Ia?Ca(t,e):t instanceof Aa?Da(t,e):function(t,e){const n=Ta(t,e),r=ka(n)+ka(t.Ie);return uo(n)&&uo(t.Ie)?va(r):ya(t.serializer,r)}(t,e)}function _a(t,e,n){return t instanceof Ia?Ca(t,e):t instanceof Aa?Da(t,e):n}function Ta(t,e){return t instanceof Na?function(t){return uo(t)||function(t){return!!t&&"doubleValue"in t}(t)}(e)?e:{integerValue:0}:null}class Sa extends ba{}class Ia extends ba{constructor(t){super(),this.elements=t}}function Ca(t,e){const n=xa(e);for(const e of t.elements)n.some((t=>ro(t,e)))||n.push(e);return{arrayValue:{values:n}}}class Aa extends ba{constructor(t){super(),this.elements=t}}function Da(t,e){let n=xa(e);for(const e of t.elements)n=n.filter((t=>!ro(t,e)));return{arrayValue:{values:n}}}class Na extends ba{constructor(t,e){super(),this.serializer=t,this.Ie=e}}function ka(t){return Qs(t.integerValue||t.doubleValue)}function xa(t){return ho(t)&&t.arrayValue.values?t.arrayValue.values.slice():[]}class Ra{constructor(t,e){this.version=t,this.transformResults=e}}class La{constructor(t,e){this.updateTime=t,this.exists=e}static none(){return new La}static exists(t){return new La(void 0,t)}static updateTime(t){return new La(t)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(t){return this.exists===t.exists&&(this.updateTime?!!t.updateTime&&this.updateTime.isEqual(t.updateTime):!t.updateTime)}}function Oa(t,e){return void 0!==t.updateTime?e.isFoundDocument()&&e.version.isEqual(t.updateTime):void 0===t.exists||t.exists===e.isFoundDocument()}class Ma{}function Pa(t,e){if(!t.hasLocalMutations||e&&0===e.fields.length)return null;if(null===e)return t.isNoDocument()?new Ha(t.key,La.none()):new ja(t.key,t.data,La.none());{const n=t.data,r=yo.empty();let i=new js(ps.comparator);for(let t of e.fields)if(!i.has(t)){let e=n.field(t);null===e&&t.length>1&&(t=t.popLast(),e=n.field(t)),null===e?r.delete(t):r.set(t,e),i=i.add(t)}return new $a(t.key,r,new qs(i.toArray()),La.none())}}function Va(t,e,n){t instanceof ja?function(t,e,n){const r=t.value.clone(),i=za(t.fieldTransforms,e,n.transformResults);r.setAll(i),e.convertToFoundDocument(n.version,r).setHasCommittedMutations()}(t,e,n):t instanceof $a?function(t,e,n){if(!Oa(t.precondition,e))return void e.convertToUnknownDocument(n.version);const r=za(t.fieldTransforms,e,n.transformResults),i=e.data;i.setAll(qa(t)),i.setAll(r),e.convertToFoundDocument(n.version,i).setHasCommittedMutations()}(t,e,n):function(t,e,n){e.convertToNoDocument(n.version).setHasCommittedMutations()}(0,e,n)}function Fa(t,e,n,r){return t instanceof ja?function(t,e,n,r){if(!Oa(t.precondition,e))return n;const i=t.value.clone(),s=Ka(t.fieldTransforms,r,e);return i.setAll(s),e.convertToFoundDocument(e.version,i).setHasLocalMutations(),null}(t,e,n,r):t instanceof $a?function(t,e,n,r){if(!Oa(t.precondition,e))return n;const i=Ka(t.fieldTransforms,r,e),s=e.data;return s.setAll(qa(t)),s.setAll(i),e.convertToFoundDocument(e.version,s).setHasLocalMutations(),null===n?null:n.unionWith(t.fieldMask.fields).unionWith(t.fieldTransforms.map((t=>t.field)))}(t,e,n,r):function(t,e,n){return Oa(t.precondition,e)?(e.convertToNoDocument(e.version).setHasLocalMutations(),null):n}(t,e,n)}function Ua(t,e){let n=null;for(const r of t.fieldTransforms){const t=e.data.field(r.field),i=Ta(r.transform,t||null);null!=i&&(null===n&&(n=yo.empty()),n.set(r.field,i))}return n||null}function Ba(t,e){return t.type===e.type&&!!t.key.isEqual(e.key)&&!!t.precondition.isEqual(e.precondition)&&!!function(t,e){return void 0===t&&void 0===e||!(!t||!e)&&cs(t,e,((t,e)=>function(t,e){return t.field.isEqual(e.field)&&function(t,e){return t instanceof Ia&&e instanceof Ia||t instanceof Aa&&e instanceof Aa?cs(t.elements,e.elements,ro):t instanceof Na&&e instanceof Na?ro(t.Ie,e.Ie):t instanceof Sa&&e instanceof Sa}(t.transform,e.transform)}(t,e)))}(t.fieldTransforms,e.fieldTransforms)&&(0===t.type?t.value.isEqual(e.value):1!==t.type||t.data.isEqual(e.data)&&t.fieldMask.isEqual(e.fieldMask))}class ja extends Ma{constructor(t,e,n,r=[]){super(),this.key=t,this.value=e,this.precondition=n,this.fieldTransforms=r,this.type=0}getFieldMask(){return null}}class $a extends Ma{constructor(t,e,n,r,i=[]){super(),this.key=t,this.data=e,this.fieldMask=n,this.precondition=r,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function qa(t){const e=new Map;return t.fieldMask.fields.forEach((n=>{if(!n.isEmpty()){const r=t.data.field(n);e.set(n,r)}})),e}function za(t,e,n){const r=new Map;Hi(t.length===n.length);for(let i=0;i<n.length;i++){const s=t[i],o=s.transform,a=e.data.field(s.field);r.set(s.field,_a(o,a,n[i]))}return r}function Ka(t,e,n){const r=new Map;for(const i of t){const t=i.transform,s=n.data.field(i.field);r.set(i.field,Ea(t,s,e))}return r}class Ha extends Ma{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ga extends Ma{constructor(t,e){super(),this.key=t,this.precondition=e,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Qa{constructor(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r}applyToRemoteDocument(t,e){const n=e.mutationResults;for(let e=0;e<this.mutations.length;e++){const r=this.mutations[e];r.key.isEqual(t.key)&&Va(r,t,n[e])}}applyToLocalView(t,e){for(const n of this.baseMutations)n.key.isEqual(t.key)&&(e=Fa(n,t,e,this.localWriteTime));for(const n of this.mutations)n.key.isEqual(t.key)&&(e=Fa(n,t,e,this.localWriteTime));return e}applyToLocalDocumentSet(t,e){const n=la();return this.mutations.forEach((r=>{const i=t.get(r.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=e.has(r.key)?null:o;const a=Pa(s,o);null!==a&&n.set(r.key,a),s.isValidDocument()||s.convertToNoDocument(hs.min())})),n}keys(){return this.mutations.reduce(((t,e)=>t.add(e.key)),ga())}isEqual(t){return this.batchId===t.batchId&&cs(this.mutations,t.mutations,((t,e)=>Ba(t,e)))&&cs(this.baseMutations,t.baseMutations,((t,e)=>Ba(t,e)))}}class Wa{constructor(t,e,n,r){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.docVersions=r}static from(t,e,n){Hi(t.mutations.length===n.length);let r=fa;const i=t.mutations;for(let t=0;t<i.length;t++)r=r.insert(i[t].key,n[t].version);return new Wa(t,e,n,r)}}class Xa{constructor(t,e){this.largestBatchId=t,this.mutation=e}getKey(){return this.mutation.key}isEqual(t){return null!==t&&this.mutation===t.mutation}toString(){return`Overlay{\n      largestBatchId: ${this.largestBatchId},\n      mutation: ${this.mutation.toString()}\n    }`}}class Ya{constructor(t,e){this.count=t,this.unchangedNames=e}}var Ja,Za;function tc(t){if(void 0===t)return $i("GRPC error has no .code"),Qi.UNKNOWN;switch(t){case Ja.OK:return Qi.OK;case Ja.CANCELLED:return Qi.CANCELLED;case Ja.UNKNOWN:return Qi.UNKNOWN;case Ja.DEADLINE_EXCEEDED:return Qi.DEADLINE_EXCEEDED;case Ja.RESOURCE_EXHAUSTED:return Qi.RESOURCE_EXHAUSTED;case Ja.INTERNAL:return Qi.INTERNAL;case Ja.UNAVAILABLE:return Qi.UNAVAILABLE;case Ja.UNAUTHENTICATED:return Qi.UNAUTHENTICATED;case Ja.INVALID_ARGUMENT:return Qi.INVALID_ARGUMENT;case Ja.NOT_FOUND:return Qi.NOT_FOUND;case Ja.ALREADY_EXISTS:return Qi.ALREADY_EXISTS;case Ja.PERMISSION_DENIED:return Qi.PERMISSION_DENIED;case Ja.FAILED_PRECONDITION:return Qi.FAILED_PRECONDITION;case Ja.ABORTED:return Qi.ABORTED;case Ja.OUT_OF_RANGE:return Qi.OUT_OF_RANGE;case Ja.UNIMPLEMENTED:return Qi.UNIMPLEMENTED;case Ja.DATA_LOSS:return Qi.DATA_LOSS;default:return Ki()}}(Za=Ja||(Ja={}))[Za.OK=0]="OK",Za[Za.CANCELLED=1]="CANCELLED",Za[Za.UNKNOWN=2]="UNKNOWN",Za[Za.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Za[Za.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Za[Za.NOT_FOUND=5]="NOT_FOUND",Za[Za.ALREADY_EXISTS=6]="ALREADY_EXISTS",Za[Za.PERMISSION_DENIED=7]="PERMISSION_DENIED",Za[Za.UNAUTHENTICATED=16]="UNAUTHENTICATED",Za[Za.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Za[Za.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Za[Za.ABORTED=10]="ABORTED",Za[Za.OUT_OF_RANGE=11]="OUT_OF_RANGE",Za[Za.UNIMPLEMENTED=12]="UNIMPLEMENTED",Za[Za.INTERNAL=13]="INTERNAL",Za[Za.UNAVAILABLE=14]="UNAVAILABLE",Za[Za.DATA_LOSS=15]="DATA_LOSS";const ec=new Mi([4294967295,4294967295],0);function nc(t){const e=(new TextEncoder).encode(t),n=new Oi;return n.update(e),new Uint8Array(n.digest())}function rc(t){const e=new DataView(t.buffer),n=e.getUint32(0,!0),r=e.getUint32(4,!0),i=e.getUint32(8,!0),s=e.getUint32(12,!0);return[new Mi([n,r],0),new Mi([i,s],0)]}class ic{constructor(t,e,n){if(this.bitmap=t,this.padding=e,this.hashCount=n,e<0||e>=8)throw new sc(`Invalid padding: ${e}`);if(n<0)throw new sc(`Invalid hash count: ${n}`);if(t.length>0&&0===this.hashCount)throw new sc(`Invalid hash count: ${n}`);if(0===t.length&&0!==e)throw new sc(`Invalid padding when bitmap length is 0: ${e}`);this.Te=8*t.length-e,this.Ee=Mi.fromNumber(this.Te)}de(t,e,n){let r=t.add(e.multiply(Mi.fromNumber(n)));return 1===r.compare(ec)&&(r=new Mi([r.getBits(0),r.getBits(1)],0)),r.modulo(this.Ee).toNumber()}Ae(t){return 0!=(this.bitmap[Math.floor(t/8)]&1<<t%8)}mightContain(t){if(0===this.Te)return!1;const e=nc(t),[n,r]=rc(e);for(let t=0;t<this.hashCount;t++){const e=this.de(n,r,t);if(!this.Ae(e))return!1}return!0}static create(t,e,n){const r=t%8==0?0:8-t%8,i=new Uint8Array(Math.ceil(t/8)),s=new ic(i,r,e);return n.forEach((t=>s.insert(t))),s}insert(t){if(0===this.Te)return;const e=nc(t),[n,r]=rc(e);for(let t=0;t<this.hashCount;t++){const e=this.de(n,r,t);this.Re(e)}}Re(t){const e=Math.floor(t/8),n=t%8;this.bitmap[e]|=1<<n}}class sc extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class oc{constructor(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(t,e,n){const r=new Map;return r.set(t,ac.createSynthesizedTargetChangeForCurrentChange(t,e,n)),new oc(hs.min(),r,new Fs(as),oa(),ga())}}class ac{constructor(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(t,e,n){return new ac(n,e,ga(),ga(),ga())}}class cc{constructor(t,e,n,r){this.Ve=t,this.removedTargetIds=e,this.key=n,this.me=r}}class uc{constructor(t,e){this.targetId=t,this.fe=e}}class hc{constructor(t,e,n=Ks.EMPTY_BYTE_STRING,r=null){this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}class lc{constructor(){this.ge=0,this.pe=pc(),this.ye=Ks.EMPTY_BYTE_STRING,this.we=!1,this.Se=!0}get current(){return this.we}get resumeToken(){return this.ye}get be(){return 0!==this.ge}get De(){return this.Se}Ce(t){t.approximateByteSize()>0&&(this.Se=!0,this.ye=t)}ve(){let t=ga(),e=ga(),n=ga();return this.pe.forEach(((r,i)=>{switch(i){case 0:t=t.add(r);break;case 2:e=e.add(r);break;case 1:n=n.add(r);break;default:Ki()}})),new ac(this.ye,this.we,t,e,n)}Fe(){this.Se=!1,this.pe=pc()}Me(t,e){this.Se=!0,this.pe=this.pe.insert(t,e)}xe(t){this.Se=!0,this.pe=this.pe.remove(t)}Oe(){this.ge+=1}Ne(){this.ge-=1,Hi(this.ge>=0)}Be(){this.Se=!0,this.we=!0}}class dc{constructor(t){this.Le=t,this.ke=new Map,this.qe=oa(),this.Qe=fc(),this.Ke=new Fs(as)}$e(t){for(const e of t.Ve)t.me&&t.me.isFoundDocument()?this.Ue(e,t.me):this.We(e,t.key,t.me);for(const e of t.removedTargetIds)this.We(e,t.key,t.me)}Ge(t){this.forEachTarget(t,(e=>{const n=this.ze(e);switch(t.state){case 0:this.je(e)&&n.Ce(t.resumeToken);break;case 1:n.Ne(),n.be||n.Fe(),n.Ce(t.resumeToken);break;case 2:n.Ne(),n.be||this.removeTarget(e);break;case 3:this.je(e)&&(n.Be(),n.Ce(t.resumeToken));break;case 4:this.je(e)&&(this.He(e),n.Ce(t.resumeToken));break;default:Ki()}}))}forEachTarget(t,e){t.targetIds.length>0?t.targetIds.forEach(e):this.ke.forEach(((t,n)=>{this.je(n)&&e(n)}))}Je(t){const e=t.targetId,n=t.fe.count,r=this.Ye(e);if(r){const i=r.target;if(Ko(i))if(0===n){const t=new gs(i.path);this.We(e,t,wo.newNoDocument(t,hs.min()))}else Hi(1===n);else{const r=this.Ze(e);if(r!==n){const n=this.Xe(t),i=n?this.et(n,t,r):1;if(0!==i){this.He(e);const t=2===i?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ke=this.Ke.insert(e,t)}}}}}Xe(t){const e=t.fe.unchangedNames;if(!e||!e.bits)return null;const{bits:{bitmap:n="",padding:r=0},hashCount:i=0}=e;let s,o;try{s=Ws(n).toUint8Array()}catch(t){if(t instanceof zs)return qi("Decoding the base64 bloom filter in existence filter failed ("+t.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw t}try{o=new ic(s,r,i)}catch(t){return qi(t instanceof sc?"BloomFilter error: ":"Applying bloom filter failed: ",t),null}return 0===o.Te?null:o}et(t,e,n){return e.fe.count===n-this.rt(t,e.targetId)?0:2}rt(t,e){const n=this.Le.getRemoteKeysForTarget(e);let r=0;return n.forEach((n=>{const i=this.Le.nt(),s=`projects/${i.projectId}/databases/${i.database}/documents/${n.path.canonicalString()}`;t.mightContain(s)||(this.We(e,n,null),r++)})),r}it(t){const e=new Map;this.ke.forEach(((n,r)=>{const i=this.Ye(r);if(i){if(n.current&&Ko(i.target)){const e=new gs(i.target.path);null!==this.qe.get(e)||this.st(r,e)||this.We(r,e,wo.newNoDocument(e,t))}n.De&&(e.set(r,n.ve()),n.Fe())}}));let n=ga();this.Qe.forEach(((t,e)=>{let r=!0;e.forEachWhile((t=>{const e=this.Ye(t);return!e||"TargetPurposeLimboResolution"===e.purpose||(r=!1,!1)})),r&&(n=n.add(t))})),this.qe.forEach(((e,n)=>n.setReadTime(t)));const r=new oc(t,e,this.Ke,this.qe,n);return this.qe=oa(),this.Qe=fc(),this.Ke=new Fs(as),r}Ue(t,e){if(!this.je(t))return;const n=this.st(t,e.key)?2:0;this.ze(t).Me(e.key,n),this.qe=this.qe.insert(e.key,e),this.Qe=this.Qe.insert(e.key,this.ot(e.key).add(t))}We(t,e,n){if(!this.je(t))return;const r=this.ze(t);this.st(t,e)?r.Me(e,1):r.xe(e),this.Qe=this.Qe.insert(e,this.ot(e).delete(t)),n&&(this.qe=this.qe.insert(e,n))}removeTarget(t){this.ke.delete(t)}Ze(t){const e=this.ze(t).ve();return this.Le.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size}Oe(t){this.ze(t).Oe()}ze(t){let e=this.ke.get(t);return e||(e=new lc,this.ke.set(t,e)),e}ot(t){let e=this.Qe.get(t);return e||(e=new js(as),this.Qe=this.Qe.insert(t,e)),e}je(t){const e=null!==this.Ye(t);return e||ji("WatchChangeAggregator","Detected inactive target",t),e}Ye(t){const e=this.ke.get(t);return e&&e.be?null:this.Le._t(t)}He(t){this.ke.set(t,new lc),this.Le.getRemoteKeysForTarget(t).forEach((e=>{this.We(t,e,null)}))}st(t,e){return this.Le.getRemoteKeysForTarget(t).has(e)}}function fc(){return new Fs(gs.comparator)}function pc(){return new Fs(gs.comparator)}const gc={asc:"ASCENDING",desc:"DESCENDING"},mc={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},yc={and:"AND",or:"OR"};class vc{constructor(t,e){this.databaseId=t,this.useProto3Json=e}}function wc(t,e){return t.useProto3Json||Ls(e)?e:{value:e}}function bc(t,e){return t.useProto3Json?`${new Date(1e3*e.seconds).toISOString().replace(/\.\d*/,"").replace("Z","")}.${("000000000"+e.nanoseconds).slice(-9)}Z`:{seconds:""+e.seconds,nanos:e.nanoseconds}}function Ec(t,e){return t.useProto3Json?e.toBase64():e.toUint8Array()}function _c(t,e){return bc(t,e.toTimestamp())}function Tc(t){return Hi(!!t),hs.fromTimestamp(function(t){const e=Gs(t);return new us(e.seconds,e.nanos)}(t))}function Sc(t,e){return Ic(t,e).canonicalString()}function Ic(t,e){const n=function(t){return new ds(["projects",t.projectId,"databases",t.database])}(t).child("documents");return void 0===e?n:n.child(e)}function Cc(t){const e=ds.fromString(t);return Hi(zc(e)),e}function Ac(t,e){return Sc(t.databaseId,e.path)}function Dc(t,e){const n=Cc(e);if(n.get(1)!==t.databaseId.projectId)throw new Wi(Qi.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+n.get(1)+" vs "+t.databaseId.projectId);if(n.get(3)!==t.databaseId.database)throw new Wi(Qi.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+n.get(3)+" vs "+t.databaseId.database);return new gs(xc(n))}function Nc(t,e){return Sc(t.databaseId,e)}function kc(t){return new ds(["projects",t.databaseId.projectId,"databases",t.databaseId.database]).canonicalString()}function xc(t){return Hi(t.length>4&&"documents"===t.get(4)),t.popFirst(5)}function Rc(t,e,n){return{name:Ac(t,e),fields:n.value.mapValue.fields}}function Lc(t,e){return{documents:[Nc(t,e.path)]}}function Oc(t,e){const n={structuredQuery:{}},r=e.path;let i;null!==e.collectionGroup?(i=r,n.structuredQuery.from=[{collectionId:e.collectionGroup,allDescendants:!0}]):(i=r.popLast(),n.structuredQuery.from=[{collectionId:r.lastSegment()}]),n.parent=Nc(t,i);const s=function(t){if(0!==t.length)return $c(Ao.create(t,"and"))}(e.filters);s&&(n.structuredQuery.where=s);const o=function(t){if(0!==t.length)return t.map((t=>function(t){return{field:Bc(t.field),direction:Vc(t.dir)}}(t)))}(e.orderBy);o&&(n.structuredQuery.orderBy=o);const a=wc(t,e.limit);return null!==a&&(n.structuredQuery.limit=a),e.startAt&&(n.structuredQuery.startAt=function(t){return{before:t.inclusive,values:t.position}}(e.startAt)),e.endAt&&(n.structuredQuery.endAt=function(t){return{before:!t.inclusive,values:t.position}}(e.endAt)),{ut:n,parent:i}}function Mc(t){let e=function(t){const e=Cc(t);return 4===e.length?ds.emptyPath():xc(e)}(t.parent);const n=t.structuredQuery,r=n.from?n.from.length:0;let i=null;if(r>0){Hi(1===r);const t=n.from[0];t.allDescendants?i=t.collectionId:e=e.child(t.collectionId)}let s=[];n.where&&(s=function(t){const e=Pc(t);return e instanceof Ao&&No(e)?e.getFilters():[e]}(n.where));let o=[];n.orderBy&&(o=function(t){return t.map((t=>function(t){return new To(jc(t.field),function(t){switch(t){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(t.direction))}(t)))}(n.orderBy));let a=null;n.limit&&(a=function(t){let e;return e="object"==typeof t?t.value:t,Ls(e)?null:e}(n.limit));let c=null;n.startAt&&(c=function(t){const e=!!t.before,n=t.values||[];return new bo(n,e)}(n.startAt));let u=null;return n.endAt&&(u=function(t){const e=!t.before,n=t.values||[];return new bo(n,e)}(n.endAt)),function(t,e,n,r,i,s,o,a){return new Ho(t,e,n,r,i,s,o,a)}(e,i,o,s,a,"F",c,u)}function Pc(t){return void 0!==t.unaryFilter?function(t){switch(t.unaryFilter.op){case"IS_NAN":const e=jc(t.unaryFilter.field);return Co.create(e,"==",{doubleValue:NaN});case"IS_NULL":const n=jc(t.unaryFilter.field);return Co.create(n,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const r=jc(t.unaryFilter.field);return Co.create(r,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=jc(t.unaryFilter.field);return Co.create(i,"!=",{nullValue:"NULL_VALUE"});default:return Ki()}}(t):void 0!==t.fieldFilter?function(t){return Co.create(jc(t.fieldFilter.field),function(t){switch(t){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";default:return Ki()}}(t.fieldFilter.op),t.fieldFilter.value)}(t):void 0!==t.compositeFilter?function(t){return Ao.create(t.compositeFilter.filters.map((t=>Pc(t))),function(t){switch(t){case"AND":return"and";case"OR":return"or";default:return Ki()}}(t.compositeFilter.op))}(t):Ki()}function Vc(t){return gc[t]}function Fc(t){return mc[t]}function Uc(t){return yc[t]}function Bc(t){return{fieldPath:t.canonicalString()}}function jc(t){return ps.fromServerFormat(t.fieldPath)}function $c(t){return t instanceof Co?function(t){if("=="===t.op){if(fo(t.value))return{unaryFilter:{field:Bc(t.field),op:"IS_NAN"}};if(lo(t.value))return{unaryFilter:{field:Bc(t.field),op:"IS_NULL"}}}else if("!="===t.op){if(fo(t.value))return{unaryFilter:{field:Bc(t.field),op:"IS_NOT_NAN"}};if(lo(t.value))return{unaryFilter:{field:Bc(t.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Bc(t.field),op:Fc(t.op),value:t.value}}}(t):t instanceof Ao?function(t){const e=t.getFilters().map((t=>$c(t)));return 1===e.length?e[0]:{compositeFilter:{op:Uc(t.op),filters:e}}}(t):Ki()}function qc(t){const e=[];return t.fields.forEach((t=>e.push(t.canonicalString()))),{fieldPaths:e}}function zc(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)}class Kc{constructor(t,e,n,r,i=hs.min(),s=hs.min(),o=Ks.EMPTY_BYTE_STRING,a=null){this.target=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(t){return new Kc(this.target,this.targetId,this.purpose,t,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(t,e){return new Kc(this.target,this.targetId,this.purpose,this.sequenceNumber,e,this.lastLimboFreeSnapshotVersion,t,null)}withExpectedCount(t){return new Kc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,t)}withLastLimboFreeSnapshotVersion(t){return new Kc(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,t,this.resumeToken,this.expectedCount)}}class Hc{constructor(t){this.ct=t}}function Gc(t){const e=Mc({parent:t.parent,structuredQuery:t.structuredQuery});return"LAST"===t.limitType?Yo(e,e.limit,"L"):e}class Qc{constructor(){}Pt(t,e){this.It(t,e),e.Tt()}It(t,e){if("nullValue"in t)this.Et(e,5);else if("booleanValue"in t)this.Et(e,10),e.dt(t.booleanValue?1:0);else if("integerValue"in t)this.Et(e,15),e.dt(Qs(t.integerValue));else if("doubleValue"in t){const n=Qs(t.doubleValue);isNaN(n)?this.Et(e,13):(this.Et(e,15),Os(n)?e.dt(0):e.dt(n))}else if("timestampValue"in t){const n=t.timestampValue;this.Et(e,20),"string"==typeof n?e.At(n):(e.At(`${n.seconds||""}`),e.dt(n.nanos||0))}else if("stringValue"in t)this.Rt(t.stringValue,e),this.Vt(e);else if("bytesValue"in t)this.Et(e,30),e.ft(Ws(t.bytesValue)),this.Vt(e);else if("referenceValue"in t)this.gt(t.referenceValue,e);else if("geoPointValue"in t){const n=t.geoPointValue;this.Et(e,45),e.dt(n.latitude||0),e.dt(n.longitude||0)}else"mapValue"in t?mo(t)?this.Et(e,Number.MAX_SAFE_INTEGER):(this.yt(t.mapValue,e),this.Vt(e)):"arrayValue"in t?(this.wt(t.arrayValue,e),this.Vt(e)):Ki()}Rt(t,e){this.Et(e,25),this.St(t,e)}St(t,e){e.At(t)}yt(t,e){const n=t.fields||{};this.Et(e,55);for(const t of Object.keys(n))this.Rt(t,e),this.It(n[t],e)}wt(t,e){const n=t.values||[];this.Et(e,50);for(const t of n)this.It(t,e)}gt(t,e){this.Et(e,37),gs.fromName(t).path.forEach((t=>{this.Et(e,60),this.St(t,e)}))}Et(t,e){t.dt(e)}Vt(t){t.dt(2)}}Qc.bt=new Qc;class Wc{constructor(){this._n=new Xc}addToCollectionParentIndex(t,e){return this._n.add(e),_s.resolve()}getCollectionParents(t,e){return _s.resolve(this._n.getEntries(e))}addFieldIndex(t,e){return _s.resolve()}deleteFieldIndex(t,e){return _s.resolve()}deleteAllFieldIndexes(t){return _s.resolve()}createTargetIndexes(t,e){return _s.resolve()}getDocumentsMatchingTarget(t,e){return _s.resolve(null)}getIndexType(t,e){return _s.resolve(0)}getFieldIndexes(t,e){return _s.resolve([])}getNextCollectionGroupToUpdate(t){return _s.resolve(null)}getMinOffset(t,e){return _s.resolve(ys.min())}getMinOffsetFromCollectionGroup(t,e){return _s.resolve(ys.min())}updateCollectionGroup(t,e,n){return _s.resolve()}updateIndexEntries(t,e){return _s.resolve()}}class Xc{constructor(){this.index={}}add(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new js(ds.comparator),i=!r.has(n);return this.index[e]=r.add(n),i}has(t){const e=t.lastSegment(),n=t.popLast(),r=this.index[e];return r&&r.has(n)}getEntries(t){return(this.index[t]||new js(ds.comparator)).toArray()}}new Uint8Array(0);class Yc{constructor(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}static withCacheSize(t){return new Yc(t,Yc.DEFAULT_COLLECTION_PERCENTILE,Yc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}}Yc.DEFAULT_COLLECTION_PERCENTILE=10,Yc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Yc.DEFAULT=new Yc(41943040,Yc.DEFAULT_COLLECTION_PERCENTILE,Yc.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Yc.DISABLED=new Yc(-1,0,0);class Jc{constructor(t){this.On=t}next(){return this.On+=2,this.On}static Nn(){return new Jc(0)}static Bn(){return new Jc(-1)}}class Zc{constructor(){this.changes=new ia((t=>t.toString()),((t,e)=>t.isEqual(e))),this.changesApplied=!1}addEntry(t){this.assertNotApplied(),this.changes.set(t.key,t)}removeEntry(t,e){this.assertNotApplied(),this.changes.set(t,wo.newInvalidDocument(t).setReadTime(e))}getEntry(t,e){this.assertNotApplied();const n=this.changes.get(e);return void 0!==n?_s.resolve(n):this.getFromCache(t,e)}getEntries(t,e){return this.getAllFromCache(t,e)}apply(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)}assertNotApplied(){}}class tu{constructor(t,e){this.overlayedDocument=t,this.mutatedFields=e}}class eu{constructor(t,e,n,r){this.remoteDocumentCache=t,this.mutationQueue=e,this.documentOverlayCache=n,this.indexManager=r}getDocument(t,e){let n=null;return this.documentOverlayCache.getOverlay(t,e).next((r=>(n=r,this.remoteDocumentCache.getEntry(t,e)))).next((t=>(null!==n&&Fa(n.mutation,t,qs.empty(),us.now()),t)))}getDocuments(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.getLocalViewOfDocuments(t,e,ga()).next((()=>e))))}getLocalViewOfDocuments(t,e,n=ga()){const r=ha();return this.populateOverlays(t,r,e).next((()=>this.computeViews(t,e,r,n).next((t=>{let e=ca();return t.forEach(((t,n)=>{e=e.insert(t,n.overlayedDocument)})),e}))))}getOverlayedDocuments(t,e){const n=ha();return this.populateOverlays(t,n,e).next((()=>this.computeViews(t,e,n,ga())))}populateOverlays(t,e,n){const r=[];return n.forEach((t=>{e.has(t)||r.push(t)})),this.documentOverlayCache.getOverlays(t,r).next((t=>{t.forEach(((t,n)=>{e.set(t,n)}))}))}computeViews(t,e,n,r){let i=oa();const s=da(),o=da();return e.forEach(((t,e)=>{const o=n.get(e.key);r.has(e.key)&&(void 0===o||o.mutation instanceof $a)?i=i.insert(e.key,e):void 0!==o?(s.set(e.key,o.mutation.getFieldMask()),Fa(o.mutation,e,o.mutation.getFieldMask(),us.now())):s.set(e.key,qs.empty())})),this.recalculateAndSaveOverlays(t,i).next((t=>(t.forEach(((t,e)=>s.set(t,e))),e.forEach(((t,e)=>{var n;return o.set(t,new tu(e,null!==(n=s.get(t))&&void 0!==n?n:null))})),o)))}recalculateAndSaveOverlays(t,e){const n=da();let r=new Fs(((t,e)=>t-e)),i=ga();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next((t=>{for(const i of t)i.keys().forEach((t=>{const s=e.get(t);if(null===s)return;let o=n.get(t)||qs.empty();o=i.applyToLocalView(s,o),n.set(t,o);const a=(r.get(i.batchId)||ga()).add(t);r=r.insert(i.batchId,a)}))})).next((()=>{const s=[],o=r.getReverseIterator();for(;o.hasNext();){const r=o.getNext(),a=r.key,c=r.value,u=la();c.forEach((t=>{if(!i.has(t)){const r=Pa(e.get(t),n.get(t));null!==r&&u.set(t,r),i=i.add(t)}})),s.push(this.documentOverlayCache.saveOverlays(t,a,u))}return _s.waitFor(s)})).next((()=>n))}recalculateAndSaveOverlaysForDocumentKeys(t,e){return this.remoteDocumentCache.getEntries(t,e).next((e=>this.recalculateAndSaveOverlays(t,e)))}getDocumentsMatchingQuery(t,e,n,r){return function(t){return gs.isDocumentKey(t.path)&&null===t.collectionGroup&&0===t.filters.length}(e)?this.getDocumentsMatchingDocumentQuery(t,e.path):function(t){return null!==t.collectionGroup}(e)?this.getDocumentsMatchingCollectionGroupQuery(t,e,n,r):this.getDocumentsMatchingCollectionQuery(t,e,n,r)}getNextDocuments(t,e,n,r){return this.remoteDocumentCache.getAllFromCollectionGroup(t,e,n,r).next((i=>{const s=r-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(t,e,n.largestBatchId,r-i.size):_s.resolve(ha());let o=-1,a=i;return s.next((e=>_s.forEach(e,((e,n)=>(o<n.largestBatchId&&(o=n.largestBatchId),i.get(e)?_s.resolve():this.remoteDocumentCache.getEntry(t,e).next((t=>{a=a.insert(e,t)}))))).next((()=>this.populateOverlays(t,e,i))).next((()=>this.computeViews(t,a,e,ga()))).next((t=>({batchId:o,changes:ua(t)})))))}))}getDocumentsMatchingDocumentQuery(t,e){return this.getDocument(t,new gs(e)).next((t=>{let e=ca();return t.isFoundDocument()&&(e=e.insert(t.key,t)),e}))}getDocumentsMatchingCollectionGroupQuery(t,e,n,r){const i=e.collectionGroup;let s=ca();return this.indexManager.getCollectionParents(t,i).next((o=>_s.forEach(o,(o=>{const a=function(t,e){return new Ho(e,null,t.explicitOrderBy.slice(),t.filters.slice(),t.limit,t.limitType,t.startAt,t.endAt)}(e,o.child(i));return this.getDocumentsMatchingCollectionQuery(t,a,n,r).next((t=>{t.forEach(((t,e)=>{s=s.insert(t,e)}))}))})).next((()=>s))))}getDocumentsMatchingCollectionQuery(t,e,n,r){let i;return this.documentOverlayCache.getOverlaysForCollection(t,e.path,n.largestBatchId).next((s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(t,e,n,i,r)))).next((t=>{i.forEach(((e,n)=>{const r=n.getKey();null===t.get(r)&&(t=t.insert(r,wo.newInvalidDocument(r)))}));let n=ca();return t.forEach(((t,r)=>{const s=i.get(t);void 0!==s&&Fa(s.mutation,r,qs.empty(),us.now()),ea(e,r)&&(n=n.insert(t,r))})),n}))}}class nu{constructor(t){this.serializer=t,this.cr=new Map,this.lr=new Map}getBundleMetadata(t,e){return _s.resolve(this.cr.get(e))}saveBundleMetadata(t,e){return this.cr.set(e.id,function(t){return{id:t.id,version:t.version,createTime:Tc(t.createTime)}}(e)),_s.resolve()}getNamedQuery(t,e){return _s.resolve(this.lr.get(e))}saveNamedQuery(t,e){return this.lr.set(e.name,function(t){return{name:t.name,query:Gc(t.bundledQuery),readTime:Tc(t.readTime)}}(e)),_s.resolve()}}class ru{constructor(){this.overlays=new Fs(gs.comparator),this.hr=new Map}getOverlay(t,e){return _s.resolve(this.overlays.get(e))}getOverlays(t,e){const n=ha();return _s.forEach(e,(e=>this.getOverlay(t,e).next((t=>{null!==t&&n.set(e,t)})))).next((()=>n))}saveOverlays(t,e,n){return n.forEach(((n,r)=>{this.ht(t,e,r)})),_s.resolve()}removeOverlaysForBatchId(t,e,n){const r=this.hr.get(n);return void 0!==r&&(r.forEach((t=>this.overlays=this.overlays.remove(t))),this.hr.delete(n)),_s.resolve()}getOverlaysForCollection(t,e,n){const r=ha(),i=e.length+1,s=new gs(e.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const t=o.getNext().value,s=t.getKey();if(!e.isPrefixOf(s.path))break;s.path.length===i&&t.largestBatchId>n&&r.set(t.getKey(),t)}return _s.resolve(r)}getOverlaysForCollectionGroup(t,e,n,r){let i=new Fs(((t,e)=>t-e));const s=this.overlays.getIterator();for(;s.hasNext();){const t=s.getNext().value;if(t.getKey().getCollectionGroup()===e&&t.largestBatchId>n){let e=i.get(t.largestBatchId);null===e&&(e=ha(),i=i.insert(t.largestBatchId,e)),e.set(t.getKey(),t)}}const o=ha(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach(((t,e)=>o.set(t,e))),!(o.size()>=r)););return _s.resolve(o)}ht(t,e,n){const r=this.overlays.get(n.key);if(null!==r){const t=this.hr.get(r.largestBatchId).delete(n.key);this.hr.set(r.largestBatchId,t)}this.overlays=this.overlays.insert(n.key,new Xa(e,n));let i=this.hr.get(e);void 0===i&&(i=ga(),this.hr.set(e,i)),this.hr.set(e,i.add(n.key))}}class iu{constructor(){this.Pr=new js(su.Ir),this.Tr=new js(su.Er)}isEmpty(){return this.Pr.isEmpty()}addReference(t,e){const n=new su(t,e);this.Pr=this.Pr.add(n),this.Tr=this.Tr.add(n)}dr(t,e){t.forEach((t=>this.addReference(t,e)))}removeReference(t,e){this.Ar(new su(t,e))}Rr(t,e){t.forEach((t=>this.removeReference(t,e)))}Vr(t){const e=new gs(new ds([])),n=new su(e,t),r=new su(e,t+1),i=[];return this.Tr.forEachInRange([n,r],(t=>{this.Ar(t),i.push(t.key)})),i}mr(){this.Pr.forEach((t=>this.Ar(t)))}Ar(t){this.Pr=this.Pr.delete(t),this.Tr=this.Tr.delete(t)}gr(t){const e=new gs(new ds([])),n=new su(e,t),r=new su(e,t+1);let i=ga();return this.Tr.forEachInRange([n,r],(t=>{i=i.add(t.key)})),i}containsKey(t){const e=new su(t,0),n=this.Pr.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)}}class su{constructor(t,e){this.key=t,this.pr=e}static Ir(t,e){return gs.comparator(t.key,e.key)||as(t.pr,e.pr)}static Er(t,e){return as(t.pr,e.pr)||gs.comparator(t.key,e.key)}}class ou{constructor(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.yr=1,this.wr=new js(su.Ir)}checkEmpty(t){return _s.resolve(0===this.mutationQueue.length)}addMutationBatch(t,e,n,r){const i=this.yr;this.yr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Qa(i,e,n,r);this.mutationQueue.push(s);for(const e of r)this.wr=this.wr.add(new su(e.key,i)),this.indexManager.addToCollectionParentIndex(t,e.key.path.popLast());return _s.resolve(s)}lookupMutationBatch(t,e){return _s.resolve(this.Sr(e))}getNextMutationBatchAfterBatchId(t,e){const n=e+1,r=this.br(n),i=r<0?0:r;return _s.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return _s.resolve(0===this.mutationQueue.length?-1:this.yr-1)}getAllMutationBatches(t){return _s.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(t,e){const n=new su(e,0),r=new su(e,Number.POSITIVE_INFINITY),i=[];return this.wr.forEachInRange([n,r],(t=>{const e=this.Sr(t.pr);i.push(e)})),_s.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(t,e){let n=new js(as);return e.forEach((t=>{const e=new su(t,0),r=new su(t,Number.POSITIVE_INFINITY);this.wr.forEachInRange([e,r],(t=>{n=n.add(t.pr)}))})),_s.resolve(this.Dr(n))}getAllMutationBatchesAffectingQuery(t,e){const n=e.path,r=n.length+1;let i=n;gs.isDocumentKey(i)||(i=i.child(""));const s=new su(new gs(i),0);let o=new js(as);return this.wr.forEachWhile((t=>{const e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(o=o.add(t.pr)),!0)}),s),_s.resolve(this.Dr(o))}Dr(t){const e=[];return t.forEach((t=>{const n=this.Sr(t);null!==n&&e.push(n)})),e}removeMutationBatch(t,e){Hi(0===this.Cr(e.batchId,"removed")),this.mutationQueue.shift();let n=this.wr;return _s.forEach(e.mutations,(r=>{const i=new su(r.key,e.batchId);return n=n.delete(i),this.referenceDelegate.markPotentiallyOrphaned(t,r.key)})).next((()=>{this.wr=n}))}Mn(t){}containsKey(t,e){const n=new su(e,0),r=this.wr.firstAfterOrEqual(n);return _s.resolve(e.isEqual(r&&r.key))}performConsistencyCheck(t){return this.mutationQueue.length,_s.resolve()}Cr(t,e){return this.br(t)}br(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId}Sr(t){const e=this.br(t);return e<0||e>=this.mutationQueue.length?null:this.mutationQueue[e]}}class au{constructor(t){this.vr=t,this.docs=new Fs(gs.comparator),this.size=0}setIndexManager(t){this.indexManager=t}addEntry(t,e){const n=e.key,r=this.docs.get(n),i=r?r.size:0,s=this.vr(e);return this.docs=this.docs.insert(n,{document:e.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())}removeEntry(t){const e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)}getEntry(t,e){const n=this.docs.get(e);return _s.resolve(n?n.document.mutableCopy():wo.newInvalidDocument(e))}getEntries(t,e){let n=oa();return e.forEach((t=>{const e=this.docs.get(t);n=n.insert(t,e?e.document.mutableCopy():wo.newInvalidDocument(t))})),_s.resolve(n)}getDocumentsMatchingQuery(t,e,n,r){let i=oa();const s=e.path,o=new gs(s.child("")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:t,value:{document:o}}=a.getNext();if(!s.isPrefixOf(t.path))break;t.path.length>s.length+1||vs(ms(o),n)<=0||(r.has(o.key)||ea(e,o))&&(i=i.insert(o.key,o.mutableCopy()))}return _s.resolve(i)}getAllFromCollectionGroup(t,e,n,r){Ki()}Fr(t,e){return _s.forEach(this.docs,(t=>e(t)))}newChangeBuffer(t){return new cu(this)}getSize(t){return _s.resolve(this.size)}}class cu extends Zc{constructor(t){super(),this.ar=t}applyChanges(t){const e=[];return this.changes.forEach(((n,r)=>{r.isValidDocument()?e.push(this.ar.addEntry(t,r)):this.ar.removeEntry(n)})),_s.waitFor(e)}getFromCache(t,e){return this.ar.getEntry(t,e)}getAllFromCache(t,e){return this.ar.getEntries(t,e)}}class uu{constructor(t){this.persistence=t,this.Mr=new ia((t=>qo(t)),zo),this.lastRemoteSnapshotVersion=hs.min(),this.highestTargetId=0,this.Or=0,this.Nr=new iu,this.targetCount=0,this.Br=Jc.Nn()}forEachTarget(t,e){return this.Mr.forEach(((t,n)=>e(n))),_s.resolve()}getLastRemoteSnapshotVersion(t){return _s.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(t){return _s.resolve(this.Or)}allocateTargetId(t){return this.highestTargetId=this.Br.next(),_s.resolve(this.highestTargetId)}setTargetsMetadata(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.Or&&(this.Or=e),_s.resolve()}qn(t){this.Mr.set(t.target,t);const e=t.targetId;e>this.highestTargetId&&(this.Br=new Jc(e),this.highestTargetId=e),t.sequenceNumber>this.Or&&(this.Or=t.sequenceNumber)}addTargetData(t,e){return this.qn(e),this.targetCount+=1,_s.resolve()}updateTargetData(t,e){return this.qn(e),_s.resolve()}removeTargetData(t,e){return this.Mr.delete(e.target),this.Nr.Vr(e.targetId),this.targetCount-=1,_s.resolve()}removeTargets(t,e,n){let r=0;const i=[];return this.Mr.forEach(((s,o)=>{o.sequenceNumber<=e&&null===n.get(o.targetId)&&(this.Mr.delete(s),i.push(this.removeMatchingKeysForTargetId(t,o.targetId)),r++)})),_s.waitFor(i).next((()=>r))}getTargetCount(t){return _s.resolve(this.targetCount)}getTargetData(t,e){const n=this.Mr.get(e)||null;return _s.resolve(n)}addMatchingKeys(t,e,n){return this.Nr.dr(e,n),_s.resolve()}removeMatchingKeys(t,e,n){this.Nr.Rr(e,n);const r=this.persistence.referenceDelegate,i=[];return r&&e.forEach((e=>{i.push(r.markPotentiallyOrphaned(t,e))})),_s.waitFor(i)}removeMatchingKeysForTargetId(t,e){return this.Nr.Vr(e),_s.resolve()}getMatchingKeysForTargetId(t,e){const n=this.Nr.gr(e);return _s.resolve(n)}containsKey(t,e){return _s.resolve(this.Nr.containsKey(e))}}class hu{constructor(t,e){this.Lr={},this.overlays={},this.kr=new Rs(0),this.qr=!1,this.qr=!0,this.referenceDelegate=t(this),this.Qr=new uu(this),this.indexManager=new Wc,this.remoteDocumentCache=function(t){return new au(t)}((t=>this.referenceDelegate.Kr(t))),this.serializer=new Hc(e),this.$r=new nu(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.qr=!1,Promise.resolve()}get started(){return this.qr}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(t){return this.indexManager}getDocumentOverlayCache(t){let e=this.overlays[t.toKey()];return e||(e=new ru,this.overlays[t.toKey()]=e),e}getMutationQueue(t,e){let n=this.Lr[t.toKey()];return n||(n=new ou(e,this.referenceDelegate),this.Lr[t.toKey()]=n),n}getTargetCache(){return this.Qr}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.$r}runTransaction(t,e,n){ji("MemoryPersistence","Starting transaction:",t);const r=new lu(this.kr.next());return this.referenceDelegate.Ur(),n(r).next((t=>this.referenceDelegate.Wr(r).next((()=>t)))).toPromise().then((t=>(r.raiseOnCommittedEvent(),t)))}Gr(t,e){return _s.or(Object.values(this.Lr).map((n=>()=>n.containsKey(t,e))))}}class lu extends bs{constructor(t){super(),this.currentSequenceNumber=t}}class du{constructor(t){this.persistence=t,this.zr=new iu,this.jr=null}static Hr(t){return new du(t)}get Jr(){if(this.jr)return this.jr;throw Ki()}addReference(t,e,n){return this.zr.addReference(n,e),this.Jr.delete(n.toString()),_s.resolve()}removeReference(t,e,n){return this.zr.removeReference(n,e),this.Jr.add(n.toString()),_s.resolve()}markPotentiallyOrphaned(t,e){return this.Jr.add(e.toString()),_s.resolve()}removeTarget(t,e){this.zr.Vr(e.targetId).forEach((t=>this.Jr.add(t.toString())));const n=this.persistence.getTargetCache();return n.getMatchingKeysForTargetId(t,e.targetId).next((t=>{t.forEach((t=>this.Jr.add(t.toString())))})).next((()=>n.removeTargetData(t,e)))}Ur(){this.jr=new Set}Wr(t){const e=this.persistence.getRemoteDocumentCache().newChangeBuffer();return _s.forEach(this.Jr,(n=>{const r=gs.fromPath(n);return this.Yr(t,r).next((t=>{t||e.removeEntry(r,hs.min())}))})).next((()=>(this.jr=null,e.apply(t))))}updateLimboDocument(t,e){return this.Yr(t,e).next((t=>{t?this.Jr.delete(e.toString()):this.Jr.add(e.toString())}))}Kr(t){return 0}Yr(t,e){return _s.or([()=>_s.resolve(this.zr.containsKey(e)),()=>this.persistence.getTargetCache().containsKey(t,e),()=>this.persistence.Gr(t,e)])}}class fu{constructor(t,e,n,r){this.targetId=t,this.fromCache=e,this.qi=n,this.Qi=r}static Ki(t,e){let n=ga(),r=ga();for(const t of e.docChanges)switch(t.type){case 0:n=n.add(t.doc.key);break;case 1:r=r.add(t.doc.key)}return new fu(t,e.fromCache,n,r)}}class pu{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(t){this._documentReadCount+=t}}class gu{constructor(){this.$i=!1,this.Ui=!1,this.Wi=100,this.Gi=function(){var t;const e=null===(t=a())||void 0===t?void 0:t.forceEnvironment;if("node"===e)return!0;if("browser"===e)return!1;try{return"[object process]"===Object.prototype.toString.call(n.g.process)}catch(t){return!1}}()||!navigator.userAgent.includes("Safari")||navigator.userAgent.includes("Chrome")?Ss.v(h())>0?6:4:8}initialize(t,e){this.zi=t,this.indexManager=e,this.$i=!0}getDocumentsMatchingQuery(t,e,n,r){const i={result:null};return this.ji(t,e).next((t=>{i.result=t})).next((()=>{if(!i.result)return this.Hi(t,e,r,n).next((t=>{i.result=t}))})).next((()=>{if(i.result)return;const n=new pu;return this.Ji(t,e,n).next((r=>{if(i.result=r,this.Ui)return this.Yi(t,e,n,r.size)}))})).next((()=>i.result))}Yi(t,e,n,r){return n.documentReadCount<this.Wi?(Bi()<=T.DEBUG&&ji("QueryEngine","SDK will not create cache indexes for query:",ta(e),"since it only creates cache indexes for collection contains","more than or equal to",this.Wi,"documents"),_s.resolve()):(Bi()<=T.DEBUG&&ji("QueryEngine","Query:",ta(e),"scans",n.documentReadCount,"local documents and returns",r,"documents as results."),n.documentReadCount>this.Gi*r?(Bi()<=T.DEBUG&&ji("QueryEngine","The SDK decides to create cache indexes for query:",ta(e),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(t,Xo(e))):_s.resolve())}ji(t,e){if(Qo(e))return _s.resolve(null);let n=Xo(e);return this.indexManager.getIndexType(t,n).next((r=>0===r?null:(null!==e.limit&&1===r&&(e=Yo(e,null,"F"),n=Xo(e)),this.indexManager.getDocumentsMatchingTarget(t,n).next((r=>{const i=ga(...r);return this.zi.getDocuments(t,i).next((r=>this.indexManager.getMinOffset(t,n).next((n=>{const s=this.Zi(e,r);return this.Xi(e,s,i,n.readTime)?this.ji(t,Yo(e,null,"F")):this.es(t,s,e,n)}))))})))))}Hi(t,e,n,r){return Qo(e)||r.isEqual(hs.min())?_s.resolve(null):this.zi.getDocuments(t,n).next((i=>{const s=this.Zi(e,i);return this.Xi(e,s,n,r)?_s.resolve(null):(Bi()<=T.DEBUG&&ji("QueryEngine","Re-using previous result from %s to execute query: %s",r.toString(),ta(e)),this.es(t,s,e,function(t,e){const n=t.toTimestamp().seconds,r=t.toTimestamp().nanoseconds+1,i=hs.fromTimestamp(1e9===r?new us(n+1,0):new us(n,r));return new ys(i,gs.empty(),e)}(r,-1)).next((t=>t)))}))}Zi(t,e){let n=new js(na(t));return e.forEach(((e,r)=>{ea(t,r)&&(n=n.add(r))})),n}Xi(t,e,n,r){if(null===t.limit)return!1;if(n.size!==e.size)return!0;const i="F"===t.limitType?e.last():e.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(r)>0)}Ji(t,e,n){return Bi()<=T.DEBUG&&ji("QueryEngine","Using full collection scan to execute query:",ta(e)),this.zi.getDocumentsMatchingQuery(t,e,ys.min(),n)}es(t,e,n,r){return this.zi.getDocumentsMatchingQuery(t,n,r).next((t=>(e.forEach((e=>{t=t.insert(e.key,e)})),t)))}}class mu{constructor(t,e,n,r){this.persistence=t,this.ts=e,this.serializer=r,this.ns=new Fs(as),this.rs=new ia((t=>qo(t)),zo),this.ss=new Map,this.os=t.getRemoteDocumentCache(),this.Qr=t.getTargetCache(),this.$r=t.getBundleCache(),this._s(n)}_s(t){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(t),this.indexManager=this.persistence.getIndexManager(t),this.mutationQueue=this.persistence.getMutationQueue(t,this.indexManager),this.localDocuments=new eu(this.os,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.os.setIndexManager(this.indexManager),this.ts.initialize(this.localDocuments,this.indexManager)}collectGarbage(t){return this.persistence.runTransaction("Collect garbage","readwrite-primary",(e=>t.collect(e,this.ns)))}}async function yu(t,e){const n=Gi(t);return await n.persistence.runTransaction("Handle user change","readonly",(t=>{let r;return n.mutationQueue.getAllMutationBatches(t).next((i=>(r=i,n._s(e),n.mutationQueue.getAllMutationBatches(t)))).next((e=>{const i=[],s=[];let o=ga();for(const t of r){i.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}for(const t of e){s.push(t.batchId);for(const e of t.mutations)o=o.add(e.key)}return n.localDocuments.getDocuments(t,o).next((t=>({us:t,removedBatchIds:i,addedBatchIds:s})))}))}))}function vu(t){const e=Gi(t);return e.persistence.runTransaction("Get last remote snapshot version","readonly",(t=>e.Qr.getLastRemoteSnapshotVersion(t)))}function wu(t,e){const n=Gi(t);return n.persistence.runTransaction("Get next mutation batch","readonly",(t=>(void 0===e&&(e=-1),n.mutationQueue.getNextMutationBatchAfterBatchId(t,e))))}async function bu(t,e,n){const r=Gi(t),i=r.ns.get(e),s=n?"readwrite":"readwrite-primary";try{n||await r.persistence.runTransaction("Release target",s,(t=>r.persistence.referenceDelegate.removeTarget(t,i)))}catch(t){if(!As(t))throw t;ji("LocalStore",`Failed to update sequence numbers for target ${e}: ${t}`)}r.ns=r.ns.remove(e),r.rs.delete(i.target)}function Eu(t,e,n){const r=Gi(t);let i=hs.min(),s=ga();return r.persistence.runTransaction("Execute query","readwrite",(t=>function(t,e,n){const r=Gi(t),i=r.rs.get(n);return void 0!==i?_s.resolve(r.ns.get(i)):r.Qr.getTargetData(e,n)}(r,t,Xo(e)).next((e=>{if(e)return i=e.lastLimboFreeSnapshotVersion,r.Qr.getMatchingKeysForTargetId(t,e.targetId).next((t=>{s=t}))})).next((()=>r.ts.getDocumentsMatchingQuery(t,e,n?i:hs.min(),n?s:ga()))).next((t=>(function(t,e,n){let r=t.ss.get(e)||hs.min();n.forEach(((t,e)=>{e.readTime.compareTo(r)>0&&(r=e.readTime)})),t.ss.set(e,r)}(r,function(t){return t.collectionGroup||(t.path.length%2==1?t.path.lastSegment():t.path.get(t.path.length-2))}(e),t),{documents:t,hs:s})))))}class _u{constructor(){this.activeTargetIds=ma}As(t){this.activeTargetIds=this.activeTargetIds.add(t)}Rs(t){this.activeTargetIds=this.activeTargetIds.delete(t)}ds(){const t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)}}class Tu{constructor(){this.no=new _u,this.ro={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(t){}updateMutationState(t,e,n){}addLocalQueryTarget(t){return this.no.As(t),this.ro[t]||"not-current"}updateQueryState(t,e,n){this.ro[t]=e}removeLocalQueryTarget(t){this.no.Rs(t)}isLocalQueryTarget(t){return this.no.activeTargetIds.has(t)}clearQueryState(t){delete this.ro[t]}getAllActiveQueryTargets(){return this.no.activeTargetIds}isActiveQueryTarget(t){return this.no.activeTargetIds.has(t)}start(){return this.no=new _u,Promise.resolve()}handleUserChange(t,e,n){}setOnlineState(t){}shutdown(){}writeSequenceNumber(t){}notifyBundleLoaded(t){}}class Su{io(t){}shutdown(){}}class Iu{constructor(){this.so=()=>this.oo(),this._o=()=>this.ao(),this.uo=[],this.co()}io(t){this.uo.push(t)}shutdown(){window.removeEventListener("online",this.so),window.removeEventListener("offline",this._o)}co(){window.addEventListener("online",this.so),window.addEventListener("offline",this._o)}oo(){ji("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(const t of this.uo)t(0)}ao(){ji("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(const t of this.uo)t(1)}static D(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Cu=null;function Au(){return null===Cu?Cu=268435456+Math.round(2147483648*Math.random()):Cu++,"0x"+Cu.toString(16)}const Du={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Nu{constructor(t){this.lo=t.lo,this.ho=t.ho}Po(t){this.Io=t}To(t){this.Eo=t}onMessage(t){this.Ao=t}close(){this.ho()}send(t){this.lo(t)}Ro(){this.Io()}Vo(t){this.Eo(t)}mo(t){this.Ao(t)}}const ku="WebChannelConnection";class xu extends class{constructor(t){this.databaseInfo=t,this.databaseId=t.databaseId;const e=t.ssl?"https":"http",n=encodeURIComponent(this.databaseId.projectId),r=encodeURIComponent(this.databaseId.database);this.fo=e+"://"+t.host,this.po=`projects/${n}/databases/${r}`,this.yo="(default)"===this.databaseId.database?`project_id=${n}`:`project_id=${n}&database_id=${r}`}get wo(){return!1}So(t,e,n,r,i){const s=Au(),o=this.bo(t,e.toUriEncodedString());ji("RestConnection",`Sending RPC '${t}' ${s}:`,o,n);const a={"google-cloud-resource-prefix":this.po,"x-goog-request-params":this.yo};return this.Do(a,r,i),this.Co(t,o,a,n).then((e=>(ji("RestConnection",`Received RPC '${t}' ${s}: `,e),e)),(e=>{throw qi("RestConnection",`RPC '${t}' ${s} failed with error: `,e,"url: ",o,"request:",n),e}))}vo(t,e,n,r,i,s){return this.So(t,e,n,r,i)}Do(t,e,n){t["X-Goog-Api-Client"]="gl-js/ fire/"+Fi,t["Content-Type"]="text/plain",this.databaseInfo.appId&&(t["X-Firebase-GMPID"]=this.databaseInfo.appId),e&&e.headers.forEach(((e,n)=>t[n]=e)),n&&n.headers.forEach(((e,n)=>t[n]=e))}bo(t,e){const n=Du[t];return`${this.fo}/v1/${e}:${n}`}terminate(){}}{constructor(t){super(t),this.forceLongPolling=t.forceLongPolling,this.autoDetectLongPolling=t.autoDetectLongPolling,this.useFetchStreams=t.useFetchStreams,this.longPollingOptions=t.longPollingOptions}Co(t,e,n,r){const i=Au();return new Promise(((s,o)=>{const a=new Li;a.setWithCredentials(!0),a.listenOnce(Ni.COMPLETE,(()=>{try{switch(a.getLastErrorCode()){case Di.NO_ERROR:const e=a.getResponseJson();ji(ku,`XHR for RPC '${t}' ${i} received:`,JSON.stringify(e)),s(e);break;case Di.TIMEOUT:ji(ku,`RPC '${t}' ${i} timed out`),o(new Wi(Qi.DEADLINE_EXCEEDED,"Request time out"));break;case Di.HTTP_ERROR:const n=a.getStatus();if(ji(ku,`RPC '${t}' ${i} failed with status:`,n,"response text:",a.getResponseText()),n>0){let t=a.getResponseJson();Array.isArray(t)&&(t=t[0]);const e=null==t?void 0:t.error;if(e&&e.status&&e.message){const t=function(t){const e=t.toLowerCase().replace(/_/g,"-");return Object.values(Qi).indexOf(e)>=0?e:Qi.UNKNOWN}(e.status);o(new Wi(t,e.message))}else o(new Wi(Qi.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Wi(Qi.UNAVAILABLE,"Connection failed."));break;default:Ki()}}finally{ji(ku,`RPC '${t}' ${i} completed.`)}}));const c=JSON.stringify(r);ji(ku,`RPC '${t}' ${i} sending request:`,r),a.send(e,"POST",c,n,15)}))}Fo(t,e,n){const r=Au(),i=[this.fo,"/","google.firestore.v1.Firestore","/",t,"/channel"],s=Ci(),o=Ai(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:`projects/${this.databaseId.projectId}/databases/${this.databaseId.database}`},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},c=this.longPollingOptions.timeoutSeconds;void 0!==c&&(a.longPollingTimeout=Math.round(1e3*c)),this.useFetchStreams&&(a.useFetchStreams=!0),this.Do(a.initMessageHeaders,e,n),a.encodeInitMessageHeaders=!0;const u=i.join("");ji(ku,`Creating RPC '${t}' stream ${r}: ${u}`,a);const h=s.createWebChannel(u,a);let l=!1,d=!1;const f=new Nu({lo:e=>{d?ji(ku,`Not sending because RPC '${t}' stream ${r} is closed:`,e):(l||(ji(ku,`Opening RPC '${t}' stream ${r} transport.`),h.open(),l=!0),ji(ku,`RPC '${t}' stream ${r} sending:`,e),h.send(e))},ho:()=>h.close()}),p=(t,e,n)=>{t.listen(e,(t=>{try{n(t)}catch(t){setTimeout((()=>{throw t}),0)}}))};return p(h,Ri.EventType.OPEN,(()=>{d||ji(ku,`RPC '${t}' stream ${r} transport opened.`)})),p(h,Ri.EventType.CLOSE,(()=>{d||(d=!0,ji(ku,`RPC '${t}' stream ${r} transport closed`),f.Vo())})),p(h,Ri.EventType.ERROR,(e=>{d||(d=!0,qi(ku,`RPC '${t}' stream ${r} transport errored:`,e),f.Vo(new Wi(Qi.UNAVAILABLE,"The operation could not be completed")))})),p(h,Ri.EventType.MESSAGE,(e=>{var n;if(!d){const i=e.data[0];Hi(!!i);const s=i,o=s.error||(null===(n=s[0])||void 0===n?void 0:n.error);if(o){ji(ku,`RPC '${t}' stream ${r} received error:`,o);const e=o.status;let n=function(t){const e=Ja[t];if(void 0!==e)return tc(e)}(e),i=o.message;void 0===n&&(n=Qi.INTERNAL,i="Unknown error status: "+e+" with message "+o.message),d=!0,f.Vo(new Wi(n,i)),h.close()}else ji(ku,`RPC '${t}' stream ${r} received:`,i),f.mo(i)}})),p(o,ki.STAT_EVENT,(e=>{e.stat===xi.PROXY?ji(ku,`RPC '${t}' stream ${r} detected buffering proxy`):e.stat===xi.NOPROXY&&ji(ku,`RPC '${t}' stream ${r} detected no buffering proxy`)})),setTimeout((()=>{f.Ro()}),0),f}}function Ru(){return"undefined"!=typeof document?document:null}function Lu(t){return new vc(t,!0)}class Ou{constructor(t,e,n=1e3,r=1.5,i=6e4){this.oi=t,this.timerId=e,this.Mo=n,this.xo=r,this.Oo=i,this.No=0,this.Bo=null,this.Lo=Date.now(),this.reset()}reset(){this.No=0}ko(){this.No=this.Oo}qo(t){this.cancel();const e=Math.floor(this.No+this.Qo()),n=Math.max(0,Date.now()-this.Lo),r=Math.max(0,e-n);r>0&&ji("ExponentialBackoff",`Backing off for ${r} ms (base delay: ${this.No} ms, delay with jitter: ${e} ms, last attempt: ${n} ms ago)`),this.Bo=this.oi.enqueueAfterDelay(this.timerId,r,(()=>(this.Lo=Date.now(),t()))),this.No*=this.xo,this.No<this.Mo&&(this.No=this.Mo),this.No>this.Oo&&(this.No=this.Oo)}Ko(){null!==this.Bo&&(this.Bo.skipDelay(),this.Bo=null)}cancel(){null!==this.Bo&&(this.Bo.cancel(),this.Bo=null)}Qo(){return(Math.random()-.5)*this.No}}class Mu{constructor(t,e,n,r,i,s,o,a){this.oi=t,this.$o=n,this.Uo=r,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.Wo=0,this.Go=null,this.zo=null,this.stream=null,this.jo=new Ou(t,e)}Ho(){return 1===this.state||5===this.state||this.Jo()}Jo(){return 2===this.state||3===this.state}start(){4!==this.state?this.auth():this.Yo()}async stop(){this.Ho()&&await this.close(0)}Zo(){this.state=0,this.jo.reset()}Xo(){this.Jo()&&null===this.Go&&(this.Go=this.oi.enqueueAfterDelay(this.$o,6e4,(()=>this.e_())))}t_(t){this.n_(),this.stream.send(t)}async e_(){if(this.Jo())return this.close(0)}n_(){this.Go&&(this.Go.cancel(),this.Go=null)}r_(){this.zo&&(this.zo.cancel(),this.zo=null)}async close(t,e){this.n_(),this.r_(),this.jo.cancel(),this.Wo++,4!==t?this.jo.reset():e&&e.code===Qi.RESOURCE_EXHAUSTED?($i(e.toString()),$i("Using maximum backoff delay to prevent overloading the backend."),this.jo.ko()):e&&e.code===Qi.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.i_(),this.stream.close(),this.stream=null),this.state=t,await this.listener.To(e)}i_(){}auth(){this.state=1;const t=this.s_(this.Wo),e=this.Wo;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then((([t,n])=>{this.Wo===e&&this.o_(t,n)}),(e=>{t((()=>{const t=new Wi(Qi.UNKNOWN,"Fetching auth token failed: "+e.message);return this.__(t)}))}))}o_(t,e){const n=this.s_(this.Wo);this.stream=this.a_(t,e),this.stream.Po((()=>{n((()=>(this.state=2,this.zo=this.oi.enqueueAfterDelay(this.Uo,1e4,(()=>(this.Jo()&&(this.state=3),Promise.resolve()))),this.listener.Po())))})),this.stream.To((t=>{n((()=>this.__(t)))})),this.stream.onMessage((t=>{n((()=>this.onMessage(t)))}))}Yo(){this.state=5,this.jo.qo((async()=>{this.state=0,this.start()}))}__(t){return ji("PersistentStream",`close with error: ${t}`),this.stream=null,this.close(4,t)}s_(t){return e=>{this.oi.enqueueAndForget((()=>this.Wo===t?e():(ji("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())))}}}class Pu extends Mu{constructor(t,e,n,r,i,s){super(t,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i}a_(t,e){return this.connection.Fo("Listen",t,e)}onMessage(t){this.jo.reset();const e=function(t,e){let n;if("targetChange"in e){e.targetChange;const r=function(t){return"NO_CHANGE"===t?0:"ADD"===t?1:"REMOVE"===t?2:"CURRENT"===t?3:"RESET"===t?4:Ki()}(e.targetChange.targetChangeType||"NO_CHANGE"),i=e.targetChange.targetIds||[],s=function(t,e){return t.useProto3Json?(Hi(void 0===e||"string"==typeof e),Ks.fromBase64String(e||"")):(Hi(void 0===e||e instanceof Uint8Array),Ks.fromUint8Array(e||new Uint8Array))}(t,e.targetChange.resumeToken),o=e.targetChange.cause,a=o&&function(t){const e=void 0===t.code?Qi.UNKNOWN:tc(t.code);return new Wi(e,t.message||"")}(o);n=new hc(r,i,s,a||null)}else if("documentChange"in e){e.documentChange;const r=e.documentChange;r.document,r.document.name,r.document.updateTime;const i=Dc(t,r.document.name),s=Tc(r.document.updateTime),o=r.document.createTime?Tc(r.document.createTime):hs.min(),a=new yo({mapValue:{fields:r.document.fields}}),c=wo.newFoundDocument(i,s,o,a),u=r.targetIds||[],h=r.removedTargetIds||[];n=new cc(u,h,c.key,c)}else if("documentDelete"in e){e.documentDelete;const r=e.documentDelete;r.document;const i=Dc(t,r.document),s=r.readTime?Tc(r.readTime):hs.min(),o=wo.newNoDocument(i,s),a=r.removedTargetIds||[];n=new cc([],a,o.key,o)}else if("documentRemove"in e){e.documentRemove;const r=e.documentRemove;r.document;const i=Dc(t,r.document),s=r.removedTargetIds||[];n=new cc([],s,i,null)}else{if(!("filter"in e))return Ki();{e.filter;const t=e.filter;t.targetId;const{count:r=0,unchangedNames:i}=t,s=new Ya(r,i),o=t.targetId;n=new uc(o,s)}}return n}(this.serializer,t),n=function(t){if(!("targetChange"in t))return hs.min();const e=t.targetChange;return e.targetIds&&e.targetIds.length?hs.min():e.readTime?Tc(e.readTime):hs.min()}(t);return this.listener.u_(e,n)}c_(t){const e={};e.database=kc(this.serializer),e.addTarget=function(t,e){let n;const r=e.target;if(n=Ko(r)?{documents:Lc(t,r)}:{query:Oc(t,r).ut},n.targetId=e.targetId,e.resumeToken.approximateByteSize()>0){n.resumeToken=Ec(t,e.resumeToken);const r=wc(t,e.expectedCount);null!==r&&(n.expectedCount=r)}else if(e.snapshotVersion.compareTo(hs.min())>0){n.readTime=bc(t,e.snapshotVersion.toTimestamp());const r=wc(t,e.expectedCount);null!==r&&(n.expectedCount=r)}return n}(this.serializer,t);const n=function(t,e){const n=function(t){switch(t){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ki()}}(e.purpose);return null==n?null:{"goog-listen-tags":n}}(this.serializer,t);n&&(e.labels=n),this.t_(e)}l_(t){const e={};e.database=kc(this.serializer),e.removeTarget=t,this.t_(e)}}class Vu extends Mu{constructor(t,e,n,r,i,s){super(t,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",e,n,r,s),this.serializer=i,this.h_=!1}get P_(){return this.h_}start(){this.h_=!1,this.lastStreamToken=void 0,super.start()}i_(){this.h_&&this.I_([])}a_(t,e){return this.connection.Fo("Write",t,e)}onMessage(t){if(Hi(!!t.streamToken),this.lastStreamToken=t.streamToken,this.h_){this.jo.reset();const e=function(t,e){return t&&t.length>0?(Hi(void 0!==e),t.map((t=>function(t,e){let n=t.updateTime?Tc(t.updateTime):Tc(e);return n.isEqual(hs.min())&&(n=Tc(e)),new Ra(n,t.transformResults||[])}(t,e)))):[]}(t.writeResults,t.commitTime),n=Tc(t.commitTime);return this.listener.T_(n,e)}return Hi(!t.writeResults||0===t.writeResults.length),this.h_=!0,this.listener.E_()}d_(){const t={};t.database=kc(this.serializer),this.t_(t)}I_(t){const e={streamToken:this.lastStreamToken,writes:t.map((t=>function(t,e){let n;if(e instanceof ja)n={update:Rc(t,e.key,e.value)};else if(e instanceof Ha)n={delete:Ac(t,e.key)};else if(e instanceof $a)n={update:Rc(t,e.key,e.data),updateMask:qc(e.fieldMask)};else{if(!(e instanceof Ga))return Ki();n={verify:Ac(t,e.key)}}return e.fieldTransforms.length>0&&(n.updateTransforms=e.fieldTransforms.map((t=>function(t,e){const n=e.transform;if(n instanceof Sa)return{fieldPath:e.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof Ia)return{fieldPath:e.field.canonicalString(),appendMissingElements:{values:n.elements}};if(n instanceof Aa)return{fieldPath:e.field.canonicalString(),removeAllFromArray:{values:n.elements}};if(n instanceof Na)return{fieldPath:e.field.canonicalString(),increment:n.Ie};throw Ki()}(0,t)))),e.precondition.isNone||(n.currentDocument=function(t,e){return void 0!==e.updateTime?{updateTime:_c(t,e.updateTime)}:void 0!==e.exists?{exists:e.exists}:Ki()}(t,e.precondition)),n}(this.serializer,t)))};this.t_(e)}}class Fu extends class{}{constructor(t,e,n,r){super(),this.authCredentials=t,this.appCheckCredentials=e,this.connection=n,this.serializer=r,this.A_=!1}R_(){if(this.A_)throw new Wi(Qi.FAILED_PRECONDITION,"The client has already been terminated.")}So(t,e,n,r){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([i,s])=>this.connection.So(t,Ic(e,n),r,i,s))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Qi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Wi(Qi.UNKNOWN,t.toString())}))}vo(t,e,n,r,i){return this.R_(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then((([s,o])=>this.connection.vo(t,Ic(e,n),r,s,o,i))).catch((t=>{throw"FirebaseError"===t.name?(t.code===Qi.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),t):new Wi(Qi.UNKNOWN,t.toString())}))}terminate(){this.A_=!0,this.connection.terminate()}}class Uu{constructor(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state="Unknown",this.m_=0,this.f_=null,this.g_=!0}p_(){0===this.m_&&(this.y_("Unknown"),this.f_=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,(()=>(this.f_=null,this.w_("Backend didn't respond within 10 seconds."),this.y_("Offline"),Promise.resolve()))))}S_(t){"Online"===this.state?this.y_("Unknown"):(this.m_++,this.m_>=1&&(this.b_(),this.w_(`Connection failed 1 times. Most recent error: ${t.toString()}`),this.y_("Offline")))}set(t){this.b_(),this.m_=0,"Online"===t&&(this.g_=!1),this.y_(t)}y_(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))}w_(t){const e=`Could not reach Cloud Firestore backend. ${t}\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.`;this.g_?($i(e),this.g_=!1):ji("OnlineStateTracker",e)}b_(){null!==this.f_&&(this.f_.cancel(),this.f_=null)}}class Bu{constructor(t,e,n,r,i){this.localStore=t,this.datastore=e,this.asyncQueue=n,this.remoteSyncer={},this.D_=[],this.C_=new Map,this.v_=new Set,this.F_=[],this.M_=i,this.M_.io((t=>{n.enqueueAndForget((async()=>{Wu(this)&&(ji("RemoteStore","Restarting streams for network reachability change."),await async function(t){const e=Gi(t);e.v_.add(4),await $u(e),e.x_.set("Unknown"),e.v_.delete(4),await ju(e)}(this))}))})),this.x_=new Uu(n,r)}}async function ju(t){if(Wu(t))for(const e of t.F_)await e(!0)}async function $u(t){for(const e of t.F_)await e(!1)}function qu(t,e){const n=Gi(t);n.C_.has(e.targetId)||(n.C_.set(e.targetId,e),Qu(n)?Gu(n):dh(n).Jo()&&Ku(n,e))}function zu(t,e){const n=Gi(t),r=dh(n);n.C_.delete(e),r.Jo()&&Hu(n,e),0===n.C_.size&&(r.Jo()?r.Xo():Wu(n)&&n.x_.set("Unknown"))}function Ku(t,e){if(t.O_.Oe(e.targetId),e.resumeToken.approximateByteSize()>0||e.snapshotVersion.compareTo(hs.min())>0){const n=t.remoteSyncer.getRemoteKeysForTarget(e.targetId).size;e=e.withExpectedCount(n)}dh(t).c_(e)}function Hu(t,e){t.O_.Oe(e),dh(t).l_(e)}function Gu(t){t.O_=new dc({getRemoteKeysForTarget:e=>t.remoteSyncer.getRemoteKeysForTarget(e),_t:e=>t.C_.get(e)||null,nt:()=>t.datastore.serializer.databaseId}),dh(t).start(),t.x_.p_()}function Qu(t){return Wu(t)&&!dh(t).Ho()&&t.C_.size>0}function Wu(t){return 0===Gi(t).v_.size}function Xu(t){t.O_=void 0}async function Yu(t){t.C_.forEach(((e,n)=>{Ku(t,e)}))}async function Ju(t,e){Xu(t),Qu(t)?(t.x_.S_(e),Gu(t)):t.x_.set("Unknown")}async function Zu(t,e,n){if(t.x_.set("Online"),e instanceof hc&&2===e.state&&e.cause)try{await async function(t,e){const n=e.cause;for(const r of e.targetIds)t.C_.has(r)&&(await t.remoteSyncer.rejectListen(r,n),t.C_.delete(r),t.O_.removeTarget(r))}(t,e)}catch(n){ji("RemoteStore","Failed to remove targets %s: %s ",e.targetIds.join(","),n),await th(t,n)}else if(e instanceof cc?t.O_.$e(e):e instanceof uc?t.O_.Je(e):t.O_.Ge(e),!n.isEqual(hs.min()))try{const e=await vu(t.localStore);n.compareTo(e)>=0&&await function(t,e){const n=t.O_.it(e);return n.targetChanges.forEach(((n,r)=>{if(n.resumeToken.approximateByteSize()>0){const i=t.C_.get(r);i&&t.C_.set(r,i.withResumeToken(n.resumeToken,e))}})),n.targetMismatches.forEach(((e,n)=>{const r=t.C_.get(e);if(!r)return;t.C_.set(e,r.withResumeToken(Ks.EMPTY_BYTE_STRING,r.snapshotVersion)),Hu(t,e);const i=new Kc(r.target,e,n,r.sequenceNumber);Ku(t,i)})),t.remoteSyncer.applyRemoteEvent(n)}(t,n)}catch(e){ji("RemoteStore","Failed to raise snapshot:",e),await th(t,e)}}async function th(t,e,n){if(!As(e))throw e;t.v_.add(1),await $u(t),t.x_.set("Offline"),n||(n=()=>vu(t.localStore)),t.asyncQueue.enqueueRetryable((async()=>{ji("RemoteStore","Retrying IndexedDB access"),await n(),t.v_.delete(1),await ju(t)}))}function eh(t,e){return e().catch((n=>th(t,n,e)))}async function nh(t){const e=Gi(t),n=fh(e);let r=e.D_.length>0?e.D_[e.D_.length-1].batchId:-1;for(;rh(e);)try{const t=await wu(e.localStore,r);if(null===t){0===e.D_.length&&n.Xo();break}r=t.batchId,ih(e,t)}catch(t){await th(e,t)}sh(e)&&oh(e)}function rh(t){return Wu(t)&&t.D_.length<10}function ih(t,e){t.D_.push(e);const n=fh(t);n.Jo()&&n.P_&&n.I_(e.mutations)}function sh(t){return Wu(t)&&!fh(t).Ho()&&t.D_.length>0}function oh(t){fh(t).start()}async function ah(t){fh(t).d_()}async function ch(t){const e=fh(t);for(const n of t.D_)e.I_(n.mutations)}async function uh(t,e,n){const r=t.D_.shift(),i=Wa.from(r,e,n);await eh(t,(()=>t.remoteSyncer.applySuccessfulWrite(i))),await nh(t)}async function hh(t,e){e&&fh(t).P_&&await async function(t,e){if(function(t){return function(t){switch(t){default:return Ki();case Qi.CANCELLED:case Qi.UNKNOWN:case Qi.DEADLINE_EXCEEDED:case Qi.RESOURCE_EXHAUSTED:case Qi.INTERNAL:case Qi.UNAVAILABLE:case Qi.UNAUTHENTICATED:return!1;case Qi.INVALID_ARGUMENT:case Qi.NOT_FOUND:case Qi.ALREADY_EXISTS:case Qi.PERMISSION_DENIED:case Qi.FAILED_PRECONDITION:case Qi.ABORTED:case Qi.OUT_OF_RANGE:case Qi.UNIMPLEMENTED:case Qi.DATA_LOSS:return!0}}(t)&&t!==Qi.ABORTED}(e.code)){const n=t.D_.shift();fh(t).Zo(),await eh(t,(()=>t.remoteSyncer.rejectFailedWrite(n.batchId,e))),await nh(t)}}(t,e),sh(t)&&oh(t)}async function lh(t,e){const n=Gi(t);n.asyncQueue.verifyOperationInProgress(),ji("RemoteStore","RemoteStore received new credentials");const r=Wu(n);n.v_.add(3),await $u(n),r&&n.x_.set("Unknown"),await n.remoteSyncer.handleCredentialChange(e),n.v_.delete(3),await ju(n)}function dh(t){return t.N_||(t.N_=function(t,e,n){const r=Gi(t);return r.R_(),new Pu(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Po:Yu.bind(null,t),To:Ju.bind(null,t),u_:Zu.bind(null,t)}),t.F_.push((async e=>{e?(t.N_.Zo(),Qu(t)?Gu(t):t.x_.set("Unknown")):(await t.N_.stop(),Xu(t))}))),t.N_}function fh(t){return t.B_||(t.B_=function(t,e,n){const r=Gi(t);return r.R_(),new Vu(e,r.connection,r.authCredentials,r.appCheckCredentials,r.serializer,n)}(t.datastore,t.asyncQueue,{Po:ah.bind(null,t),To:hh.bind(null,t),E_:ch.bind(null,t),T_:uh.bind(null,t)}),t.F_.push((async e=>{e?(t.B_.Zo(),await nh(t)):(await t.B_.stop(),t.D_.length>0&&(ji("RemoteStore",`Stopping write stream with ${t.D_.length} pending writes`),t.D_=[]))}))),t.B_}class ph{constructor(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Xi,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch((t=>{}))}get promise(){return this.deferred.promise}static createAndSchedule(t,e,n,r,i){const s=Date.now()+n,o=new ph(t,e,s,r,i);return o.start(n),o}start(t){this.timerHandle=setTimeout((()=>this.handleDelayElapsed()),t)}skipDelay(){return this.handleDelayElapsed()}cancel(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Wi(Qi.CANCELLED,"Operation cancelled"+(t?": "+t:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget((()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then((t=>this.deferred.resolve(t)))):Promise.resolve()))}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function gh(t,e){if($i("AsyncQueue",`${e}: ${t}`),As(t))return new Wi(Qi.UNAVAILABLE,`${e}: ${t}`);throw t}class mh{constructor(t){this.comparator=t?(e,n)=>t(e,n)||gs.comparator(e.key,n.key):(t,e)=>gs.comparator(t.key,e.key),this.keyedMap=ca(),this.sortedSet=new Fs(this.comparator)}static emptySet(t){return new mh(t.comparator)}has(t){return null!=this.keyedMap.get(t)}get(t){return this.keyedMap.get(t)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(t){const e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1}get size(){return this.sortedSet.size}forEach(t){this.sortedSet.inorderTraversal(((e,n)=>(t(e),!1)))}add(t){const e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))}delete(t){const e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this}isEqual(t){if(!(t instanceof mh))return!1;if(this.size!==t.size)return!1;const e=this.sortedSet.getIterator(),n=t.sortedSet.getIterator();for(;e.hasNext();){const t=e.getNext().key,r=n.getNext().key;if(!t.isEqual(r))return!1}return!0}toString(){const t=[];return this.forEach((e=>{t.push(e.toString())})),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"}copy(t,e){const n=new mh;return n.comparator=this.comparator,n.keyedMap=t,n.sortedSet=e,n}}class yh{constructor(){this.L_=new Fs(gs.comparator)}track(t){const e=t.doc.key,n=this.L_.get(e);n?0!==t.type&&3===n.type?this.L_=this.L_.insert(e,t):3===t.type&&1!==n.type?this.L_=this.L_.insert(e,{type:n.type,doc:t.doc}):2===t.type&&2===n.type?this.L_=this.L_.insert(e,{type:2,doc:t.doc}):2===t.type&&0===n.type?this.L_=this.L_.insert(e,{type:0,doc:t.doc}):1===t.type&&0===n.type?this.L_=this.L_.remove(e):1===t.type&&2===n.type?this.L_=this.L_.insert(e,{type:1,doc:n.doc}):0===t.type&&1===n.type?this.L_=this.L_.insert(e,{type:2,doc:t.doc}):Ki():this.L_=this.L_.insert(e,t)}k_(){const t=[];return this.L_.inorderTraversal(((e,n)=>{t.push(n)})),t}}class vh{constructor(t,e,n,r,i,s,o,a,c){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=c}static fromInitialDocuments(t,e,n,r,i){const s=[];return e.forEach((t=>{s.push({type:0,doc:t})})),new vh(t,e,mh.emptySet(e),s,n,r,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(t){if(!(this.fromCache===t.fromCache&&this.hasCachedResults===t.hasCachedResults&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&Jo(this.query,t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;const e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(let t=0;t<e.length;t++)if(e[t].type!==n[t].type||!e[t].doc.isEqual(n[t].doc))return!1;return!0}}class wh{constructor(){this.q_=void 0,this.Q_=[]}}class bh{constructor(){this.queries=new ia((t=>Zo(t)),Jo),this.onlineState="Unknown",this.K_=new Set}}function Eh(t,e){const n=Gi(t);let r=!1;for(const t of e){const e=t.query,i=n.queries.get(e);if(i){for(const e of i.Q_)e.W_(t)&&(r=!0);i.q_=t}}r&&Th(n)}function _h(t,e,n){const r=Gi(t),i=r.queries.get(e);if(i)for(const t of i.Q_)t.onError(n);r.queries.delete(e)}function Th(t){t.K_.forEach((t=>{t.next()}))}class Sh{constructor(t,e,n){this.query=t,this.G_=e,this.z_=!1,this.j_=null,this.onlineState="Unknown",this.options=n||{}}W_(t){if(!this.options.includeMetadataChanges){const e=[];for(const n of t.docChanges)3!==n.type&&e.push(n);t=new vh(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0,t.hasCachedResults)}let e=!1;return this.z_?this.H_(t)&&(this.G_.next(t),e=!0):this.J_(t,this.onlineState)&&(this.Y_(t),e=!0),this.j_=t,e}onError(t){this.G_.error(t)}U_(t){this.onlineState=t;let e=!1;return this.j_&&!this.z_&&this.J_(this.j_,t)&&(this.Y_(this.j_),e=!0),e}J_(t,e){if(!t.fromCache)return!0;const n="Offline"!==e;return(!this.options.Z_||!n)&&(!t.docs.isEmpty()||t.hasCachedResults||"Offline"===e)}H_(t){if(t.docChanges.length>0)return!0;const e=this.j_&&this.j_.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges}Y_(t){t=vh.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache,t.hasCachedResults),this.z_=!0,this.G_.next(t)}}class Ih{constructor(t){this.key=t}}class Ch{constructor(t){this.key=t}}class Ah{constructor(t,e){this.query=t,this.oa=e,this._a=null,this.hasCachedResults=!1,this.current=!1,this.aa=ga(),this.mutatedKeys=ga(),this.ua=na(t),this.ca=new mh(this.ua)}get la(){return this.oa}ha(t,e){const n=e?e.Pa:new yh,r=e?e.ca:this.ca;let i=e?e.mutatedKeys:this.mutatedKeys,s=r,o=!1;const a="F"===this.query.limitType&&r.size===this.query.limit?r.last():null,c="L"===this.query.limitType&&r.size===this.query.limit?r.first():null;if(t.inorderTraversal(((t,e)=>{const u=r.get(t),h=ea(this.query,e)?e:null,l=!!u&&this.mutatedKeys.has(u.key),d=!!h&&(h.hasLocalMutations||this.mutatedKeys.has(h.key)&&h.hasCommittedMutations);let f=!1;u&&h?u.data.isEqual(h.data)?l!==d&&(n.track({type:3,doc:h}),f=!0):this.Ia(u,h)||(n.track({type:2,doc:h}),f=!0,(a&&this.ua(h,a)>0||c&&this.ua(h,c)<0)&&(o=!0)):!u&&h?(n.track({type:0,doc:h}),f=!0):u&&!h&&(n.track({type:1,doc:u}),f=!0,(a||c)&&(o=!0)),f&&(h?(s=s.add(h),i=d?i.add(t):i.delete(t)):(s=s.delete(t),i=i.delete(t)))})),null!==this.query.limit)for(;s.size>this.query.limit;){const t="F"===this.query.limitType?s.last():s.first();s=s.delete(t.key),i=i.delete(t.key),n.track({type:1,doc:t})}return{ca:s,Pa:n,Xi:o,mutatedKeys:i}}Ia(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations}applyChanges(t,e,n,r){const i=this.ca;this.ca=t.ca,this.mutatedKeys=t.mutatedKeys;const s=t.Pa.k_();s.sort(((t,e)=>function(t,e){const n=t=>{switch(t){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ki()}};return n(t)-n(e)}(t.type,e.type)||this.ua(t.doc,e.doc))),this.Ta(n),r=null!=r&&r;const o=e&&!r?this.Ea():[],a=0===this.aa.size&&this.current&&!r?1:0,c=a!==this._a;return this._a=a,0!==s.length||c?{snapshot:new vh(this.query,t.ca,i,s,t.mutatedKeys,0===a,c,!1,!!n&&n.resumeToken.approximateByteSize()>0),da:o}:{da:o}}U_(t){return this.current&&"Offline"===t?(this.current=!1,this.applyChanges({ca:this.ca,Pa:new yh,mutatedKeys:this.mutatedKeys,Xi:!1},!1)):{da:[]}}Aa(t){return!this.oa.has(t)&&!!this.ca.has(t)&&!this.ca.get(t).hasLocalMutations}Ta(t){t&&(t.addedDocuments.forEach((t=>this.oa=this.oa.add(t))),t.modifiedDocuments.forEach((t=>{})),t.removedDocuments.forEach((t=>this.oa=this.oa.delete(t))),this.current=t.current)}Ea(){if(!this.current)return[];const t=this.aa;this.aa=ga(),this.ca.forEach((t=>{this.Aa(t.key)&&(this.aa=this.aa.add(t.key))}));const e=[];return t.forEach((t=>{this.aa.has(t)||e.push(new Ch(t))})),this.aa.forEach((n=>{t.has(n)||e.push(new Ih(n))})),e}Ra(t){this.oa=t.hs,this.aa=ga();const e=this.ha(t.documents);return this.applyChanges(e,!0)}Va(){return vh.fromInitialDocuments(this.query,this.ca,this.mutatedKeys,0===this._a,this.hasCachedResults)}}class Dh{constructor(t,e,n){this.query=t,this.targetId=e,this.view=n}}class Nh{constructor(t){this.key=t,this.ma=!1}}class kh{constructor(t,e,n,r,i,s){this.localStore=t,this.remoteStore=e,this.eventManager=n,this.sharedClientState=r,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.fa={},this.ga=new ia((t=>Zo(t)),Jo),this.pa=new Map,this.ya=new Set,this.wa=new Fs(gs.comparator),this.Sa=new Map,this.ba=new iu,this.Da={},this.Ca=new Map,this.va=Jc.Bn(),this.onlineState="Unknown",this.Fa=void 0}get isPrimaryClient(){return!0===this.Fa}}async function xh(t,e){const n=function(t){const e=Gi(t);return e.remoteStore.remoteSyncer.applyRemoteEvent=Lh.bind(null,e),e.remoteStore.remoteSyncer.getRemoteKeysForTarget=Gh.bind(null,e),e.remoteStore.remoteSyncer.rejectListen=Mh.bind(null,e),e.fa.u_=Eh.bind(null,e.eventManager),e.fa.xa=_h.bind(null,e.eventManager),e}(t);let r,i;const s=n.ga.get(e);if(s)r=s.targetId,n.sharedClientState.addLocalQueryTarget(r),i=s.view.Va();else{const t=await function(t,e){const n=Gi(t);return n.persistence.runTransaction("Allocate target","readwrite",(t=>{let r;return n.Qr.getTargetData(t,e).next((i=>i?(r=i,_s.resolve(r)):n.Qr.allocateTargetId(t).next((i=>(r=new Kc(e,i,"TargetPurposeListen",t.currentSequenceNumber),n.Qr.addTargetData(t,r).next((()=>r)))))))})).then((t=>{const r=n.ns.get(t.targetId);return(null===r||t.snapshotVersion.compareTo(r.snapshotVersion)>0)&&(n.ns=n.ns.insert(t.targetId,t),n.rs.set(e,t.targetId)),t}))}(n.localStore,Xo(e)),s=n.sharedClientState.addLocalQueryTarget(t.targetId);r=t.targetId,i=await async function(t,e,n,r,i){t.Ma=(e,n,r)=>async function(t,e,n,r){let i=e.view.ha(n);i.Xi&&(i=await Eu(t.localStore,e.query,!1).then((({documents:t})=>e.view.ha(t,i))));const s=r&&r.targetChanges.get(e.targetId),o=r&&null!=r.targetMismatches.get(e.targetId),a=e.view.applyChanges(i,t.isPrimaryClient,s,o);return $h(t,e.targetId,a.da),a.snapshot}(t,e,n,r);const s=await Eu(t.localStore,e,!0),o=new Ah(e,s.hs),a=o.ha(s.documents),c=ac.createSynthesizedTargetChangeForCurrentChange(n,r&&"Offline"!==t.onlineState,i),u=o.applyChanges(a,t.isPrimaryClient,c);$h(t,n,u.da);const h=new Dh(e,n,o);return t.ga.set(e,h),t.pa.has(n)?t.pa.get(n).push(e):t.pa.set(n,[e]),u.snapshot}(n,e,r,"current"===s,t.resumeToken),n.isPrimaryClient&&qu(n.remoteStore,t)}return i}async function Rh(t,e){const n=Gi(t),r=n.ga.get(e),i=n.pa.get(r.targetId);if(i.length>1)return n.pa.set(r.targetId,i.filter((t=>!Jo(t,e)))),void n.ga.delete(e);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(r.targetId),n.sharedClientState.isActiveQueryTarget(r.targetId)||await bu(n.localStore,r.targetId,!1).then((()=>{n.sharedClientState.clearQueryState(r.targetId),zu(n.remoteStore,r.targetId),Bh(n,r.targetId)})).catch(Es)):(Bh(n,r.targetId),await bu(n.localStore,r.targetId,!0))}async function Lh(t,e){const n=Gi(t);try{const t=await function(t,e){const n=Gi(t),r=e.snapshotVersion;let i=n.ns;return n.persistence.runTransaction("Apply remote event","readwrite-primary",(t=>{const s=n.os.newChangeBuffer({trackRemovals:!0});i=n.ns;const o=[];e.targetChanges.forEach(((s,a)=>{const c=i.get(a);if(!c)return;o.push(n.Qr.removeMatchingKeys(t,s.removedDocuments,a).next((()=>n.Qr.addMatchingKeys(t,s.addedDocuments,a))));let u=c.withSequenceNumber(t.currentSequenceNumber);null!==e.targetMismatches.get(a)?u=u.withResumeToken(Ks.EMPTY_BYTE_STRING,hs.min()).withLastLimboFreeSnapshotVersion(hs.min()):s.resumeToken.approximateByteSize()>0&&(u=u.withResumeToken(s.resumeToken,r)),i=i.insert(a,u),function(t,e,n){return 0===t.resumeToken.approximateByteSize()||e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=3e8||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0}(c,u,s)&&o.push(n.Qr.updateTargetData(t,u))}));let a=oa(),c=ga();if(e.documentUpdates.forEach((r=>{e.resolvedLimboDocuments.has(r)&&o.push(n.persistence.referenceDelegate.updateLimboDocument(t,r))})),o.push(function(t,e,n){let r=ga(),i=ga();return n.forEach((t=>r=r.add(t))),e.getEntries(t,r).next((t=>{let r=oa();return n.forEach(((n,s)=>{const o=t.get(n);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(n)),s.isNoDocument()&&s.version.isEqual(hs.min())?(e.removeEntry(n,s.readTime),r=r.insert(n,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(e.addEntry(s),r=r.insert(n,s)):ji("LocalStore","Ignoring outdated watch update for ",n,". Current version:",o.version," Watch version:",s.version)})),{cs:r,ls:i}}))}(t,s,e.documentUpdates).next((t=>{a=t.cs,c=t.ls}))),!r.isEqual(hs.min())){const e=n.Qr.getLastRemoteSnapshotVersion(t).next((e=>n.Qr.setTargetsMetadata(t,t.currentSequenceNumber,r)));o.push(e)}return _s.waitFor(o).next((()=>s.apply(t))).next((()=>n.localDocuments.getLocalViewOfDocuments(t,a,c))).next((()=>a))})).then((t=>(n.ns=i,t)))}(n.localStore,e);e.targetChanges.forEach(((t,e)=>{const r=n.Sa.get(e);r&&(Hi(t.addedDocuments.size+t.modifiedDocuments.size+t.removedDocuments.size<=1),t.addedDocuments.size>0?r.ma=!0:t.modifiedDocuments.size>0?Hi(r.ma):t.removedDocuments.size>0&&(Hi(r.ma),r.ma=!1))})),await Kh(n,t,e)}catch(t){await Es(t)}}function Oh(t,e,n){const r=Gi(t);if(r.isPrimaryClient&&0===n||!r.isPrimaryClient&&1===n){const t=[];r.ga.forEach(((n,r)=>{const i=r.view.U_(e);i.snapshot&&t.push(i.snapshot)})),function(t,e){const n=Gi(t);n.onlineState=e;let r=!1;n.queries.forEach(((t,n)=>{for(const t of n.Q_)t.U_(e)&&(r=!0)})),r&&Th(n)}(r.eventManager,e),t.length&&r.fa.u_(t),r.onlineState=e,r.isPrimaryClient&&r.sharedClientState.setOnlineState(e)}}async function Mh(t,e,n){const r=Gi(t);r.sharedClientState.updateQueryState(e,"rejected",n);const i=r.Sa.get(e),s=i&&i.key;if(s){let t=new Fs(gs.comparator);t=t.insert(s,wo.newNoDocument(s,hs.min()));const n=ga().add(s),i=new oc(hs.min(),new Map,new Fs(as),t,n);await Lh(r,i),r.wa=r.wa.remove(s),r.Sa.delete(e),zh(r)}else await bu(r.localStore,e,!1).then((()=>Bh(r,e,n))).catch(Es)}async function Ph(t,e){const n=Gi(t),r=e.batch.batchId;try{const t=await function(t,e){const n=Gi(t);return n.persistence.runTransaction("Acknowledge batch","readwrite-primary",(t=>{const r=e.batch.keys(),i=n.os.newChangeBuffer({trackRemovals:!0});return function(t,e,n,r){const i=n.batch,s=i.keys();let o=_s.resolve();return s.forEach((t=>{o=o.next((()=>r.getEntry(e,t))).next((e=>{const s=n.docVersions.get(t);Hi(null!==s),e.version.compareTo(s)<0&&(i.applyToRemoteDocument(e,n),e.isValidDocument()&&(e.setReadTime(n.commitVersion),r.addEntry(e)))}))})),o.next((()=>t.mutationQueue.removeMutationBatch(e,i)))}(n,t,e,i).next((()=>i.apply(t))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e.batch.batchId))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,function(t){let e=ga();for(let n=0;n<t.mutationResults.length;++n)t.mutationResults[n].transformResults.length>0&&(e=e.add(t.batch.mutations[n].key));return e}(e)))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(n.localStore,e);Uh(n,r,null),Fh(n,r),n.sharedClientState.updateMutationState(r,"acknowledged"),await Kh(n,t)}catch(t){await Es(t)}}async function Vh(t,e,n){const r=Gi(t);try{const t=await function(t,e){const n=Gi(t);return n.persistence.runTransaction("Reject batch","readwrite-primary",(t=>{let r;return n.mutationQueue.lookupMutationBatch(t,e).next((e=>(Hi(null!==e),r=e.keys(),n.mutationQueue.removeMutationBatch(t,e)))).next((()=>n.mutationQueue.performConsistencyCheck(t))).next((()=>n.documentOverlayCache.removeOverlaysForBatchId(t,r,e))).next((()=>n.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(t,r))).next((()=>n.localDocuments.getDocuments(t,r)))}))}(r.localStore,e);Uh(r,e,n),Fh(r,e),r.sharedClientState.updateMutationState(e,"rejected",n),await Kh(r,t)}catch(n){await Es(n)}}function Fh(t,e){(t.Ca.get(e)||[]).forEach((t=>{t.resolve()})),t.Ca.delete(e)}function Uh(t,e,n){const r=Gi(t);let i=r.Da[r.currentUser.toKey()];if(i){const t=i.get(e);t&&(n?t.reject(n):t.resolve(),i=i.remove(e)),r.Da[r.currentUser.toKey()]=i}}function Bh(t,e,n=null){t.sharedClientState.removeLocalQueryTarget(e);for(const r of t.pa.get(e))t.ga.delete(r),n&&t.fa.xa(r,n);t.pa.delete(e),t.isPrimaryClient&&t.ba.Vr(e).forEach((e=>{t.ba.containsKey(e)||jh(t,e)}))}function jh(t,e){t.ya.delete(e.path.canonicalString());const n=t.wa.get(e);null!==n&&(zu(t.remoteStore,n),t.wa=t.wa.remove(e),t.Sa.delete(n),zh(t))}function $h(t,e,n){for(const r of n)r instanceof Ih?(t.ba.addReference(r.key,e),qh(t,r)):r instanceof Ch?(ji("SyncEngine","Document no longer in limbo: "+r.key),t.ba.removeReference(r.key,e),t.ba.containsKey(r.key)||jh(t,r.key)):Ki()}function qh(t,e){const n=e.key,r=n.path.canonicalString();t.wa.get(n)||t.ya.has(r)||(ji("SyncEngine","New document in limbo: "+n),t.ya.add(r),zh(t))}function zh(t){for(;t.ya.size>0&&t.wa.size<t.maxConcurrentLimboResolutions;){const e=t.ya.values().next().value;t.ya.delete(e);const n=new gs(ds.fromString(e)),r=t.va.next();t.Sa.set(r,new Nh(n)),t.wa=t.wa.insert(n,r),qu(t.remoteStore,new Kc(Xo(Go(n.path)),r,"TargetPurposeLimboResolution",Rs._e))}}async function Kh(t,e,n){const r=Gi(t),i=[],s=[],o=[];r.ga.isEmpty()||(r.ga.forEach(((t,a)=>{o.push(r.Ma(a,e,n).then((t=>{if((t||n)&&r.isPrimaryClient&&r.sharedClientState.updateQueryState(a.targetId,(null==t?void 0:t.fromCache)?"not-current":"current"),t){i.push(t);const e=fu.Ki(a.targetId,t);s.push(e)}})))})),await Promise.all(o),r.fa.u_(i),await async function(t,e){const n=Gi(t);try{await n.persistence.runTransaction("notifyLocalViewChanges","readwrite",(t=>_s.forEach(e,(e=>_s.forEach(e.qi,(r=>n.persistence.referenceDelegate.addReference(t,e.targetId,r))).next((()=>_s.forEach(e.Qi,(r=>n.persistence.referenceDelegate.removeReference(t,e.targetId,r)))))))))}catch(t){if(!As(t))throw t;ji("LocalStore","Failed to update sequence numbers: "+t)}for(const t of e){const e=t.targetId;if(!t.fromCache){const t=n.ns.get(e),r=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(r);n.ns=n.ns.insert(e,i)}}}(r.localStore,s))}async function Hh(t,e){const n=Gi(t);if(!n.currentUser.isEqual(e)){ji("SyncEngine","User change. New user:",e.toKey());const t=await yu(n.localStore,e);n.currentUser=e,function(t,e){t.Ca.forEach((t=>{t.forEach((t=>{t.reject(new Wi(Qi.CANCELLED,"'waitForPendingWrites' promise is rejected due to a user change."))}))})),t.Ca.clear()}(n),n.sharedClientState.handleUserChange(e,t.removedBatchIds,t.addedBatchIds),await Kh(n,t.us)}}function Gh(t,e){const n=Gi(t),r=n.Sa.get(e);if(r&&r.ma)return ga().add(r.key);{let t=ga();const r=n.pa.get(e);if(!r)return t;for(const e of r){const r=n.ga.get(e);t=t.unionWith(r.view.la)}return t}}function Qh(t){const e=Gi(t);return e.remoteStore.remoteSyncer.applySuccessfulWrite=Ph.bind(null,e),e.remoteStore.remoteSyncer.rejectFailedWrite=Vh.bind(null,e),e}class Wh{constructor(){this.synchronizeTabs=!1}async initialize(t){this.serializer=Lu(t.databaseInfo.databaseId),this.sharedClientState=this.createSharedClientState(t),this.persistence=this.createPersistence(t),await this.persistence.start(),this.localStore=this.createLocalStore(t),this.gcScheduler=this.createGarbageCollectionScheduler(t,this.localStore),this.indexBackfillerScheduler=this.createIndexBackfillerScheduler(t,this.localStore)}createGarbageCollectionScheduler(t,e){return null}createIndexBackfillerScheduler(t,e){return null}createLocalStore(t){return function(t,e,n,r){return new mu(t,e,n,r)}(this.persistence,new gu,t.initialUser,this.serializer)}createPersistence(t){return new hu(du.Hr,this.serializer)}createSharedClientState(t){return new Tu}async terminate(){var t,e;null===(t=this.gcScheduler)||void 0===t||t.stop(),null===(e=this.indexBackfillerScheduler)||void 0===e||e.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}class Xh{async initialize(t,e){this.localStore||(this.localStore=t.localStore,this.sharedClientState=t.sharedClientState,this.datastore=this.createDatastore(e),this.remoteStore=this.createRemoteStore(e),this.eventManager=this.createEventManager(e),this.syncEngine=this.createSyncEngine(e,!t.synchronizeTabs),this.sharedClientState.onlineStateHandler=t=>Oh(this.syncEngine,t,1),this.remoteStore.remoteSyncer.handleCredentialChange=Hh.bind(null,this.syncEngine),await async function(t,e){const n=Gi(t);e?(n.v_.delete(2),await ju(n)):e||(n.v_.add(2),await $u(n),n.x_.set("Unknown"))}(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(t){return new bh}createDatastore(t){const e=Lu(t.databaseInfo.databaseId),n=function(t){return new xu(t)}(t.databaseInfo);return function(t,e,n,r){return new Fu(t,e,n,r)}(t.authCredentials,t.appCheckCredentials,n,e)}createRemoteStore(t){return function(t,e,n,r,i){return new Bu(t,e,n,r,i)}(this.localStore,this.datastore,t.asyncQueue,(t=>Oh(this.syncEngine,t,0)),Iu.D()?new Iu:new Su)}createSyncEngine(t,e){return function(t,e,n,r,i,s,o){const a=new kh(t,e,n,r,i,s);return o&&(a.Fa=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,t.initialUser,t.maxConcurrentLimboResolutions,e)}async terminate(){var t;await async function(t){const e=Gi(t);ji("RemoteStore","RemoteStore shutting down."),e.v_.add(5),await $u(e),e.M_.shutdown(),e.x_.set("Unknown")}(this.remoteStore),null===(t=this.datastore)||void 0===t||t.terminate()}}class Yh{constructor(t){this.observer=t,this.muted=!1}next(t){this.observer.next&&this.Ba(this.observer.next,t)}error(t){this.observer.error?this.Ba(this.observer.error,t):$i("Uncaught Error in snapshot listener:",t.toString())}La(){this.muted=!0}Ba(t,e){this.muted||setTimeout((()=>{this.muted||t(e)}),0)}}class Jh{constructor(t,e,n,r){this.authCredentials=t,this.appCheckCredentials=e,this.asyncQueue=n,this.databaseInfo=r,this.user=Vi.UNAUTHENTICATED,this.clientId=os.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this.authCredentials.start(n,(async t=>{ji("FirestoreClient","Received user=",t.uid),await this.authCredentialListener(t),this.user=t})),this.appCheckCredentials.start(n,(t=>(ji("FirestoreClient","Received new app check token=",t),this.appCheckCredentialListener(t,this.user))))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(t){this.authCredentialListener=t}setAppCheckTokenChangeListener(t){this.appCheckCredentialListener=t}verifyNotTerminated(){if(this.asyncQueue.isShuttingDown)throw new Wi(Qi.FAILED_PRECONDITION,"The client has already been terminated.")}terminate(){this.asyncQueue.enterRestrictedMode();const t=new Xi;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted((async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),t.resolve()}catch(e){const n=gh(e,"Failed to shutdown persistence");t.reject(n)}})),t.promise}}async function Zh(t,e){t.asyncQueue.verifyOperationInProgress(),ji("FirestoreClient","Initializing OfflineComponentProvider");const n=t.configuration;await e.initialize(n);let r=n.initialUser;t.setCredentialChangeListener((async t=>{r.isEqual(t)||(await yu(e.localStore,t),r=t)})),e.persistence.setDatabaseDeletedListener((()=>t.terminate())),t._offlineComponents=e}async function tl(t,e){t.asyncQueue.verifyOperationInProgress();const n=await async function(t){if(!t._offlineComponents)if(t._uninitializedComponentsProvider){ji("FirestoreClient","Using user provided OfflineComponentProvider");try{await Zh(t,t._uninitializedComponentsProvider._offline)}catch(e){const n=e;if(!function(t){return"FirebaseError"===t.name?t.code===Qi.FAILED_PRECONDITION||t.code===Qi.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||22===t.code||20===t.code||11===t.code}(n))throw n;qi("Error using user provided cache. Falling back to memory cache: "+n),await Zh(t,new Wh)}}else ji("FirestoreClient","Using default OfflineComponentProvider"),await Zh(t,new Wh);return t._offlineComponents}(t);ji("FirestoreClient","Initializing OnlineComponentProvider"),await e.initialize(n,t.configuration),t.setCredentialChangeListener((t=>lh(e.remoteStore,t))),t.setAppCheckTokenChangeListener(((t,n)=>lh(e.remoteStore,n))),t._onlineComponents=e}async function el(t){return t._onlineComponents||(t._uninitializedComponentsProvider?(ji("FirestoreClient","Using user provided OnlineComponentProvider"),await tl(t,t._uninitializedComponentsProvider._online)):(ji("FirestoreClient","Using default OnlineComponentProvider"),await tl(t,new Xh))),t._onlineComponents}async function nl(t){const e=await el(t),n=e.eventManager;return n.onListen=xh.bind(null,e.syncEngine),n.onUnlisten=Rh.bind(null,e.syncEngine),n}function rl(t,e,n={}){const r=new Xi;return t.asyncQueue.enqueueAndForget((async()=>function(t,e,n,r,i){const s=new Yh({next:s=>{e.enqueueAndForget((()=>async function(t,e){const n=Gi(t),r=e.query;let i=!1;const s=n.queries.get(r);if(s){const t=s.Q_.indexOf(e);t>=0&&(s.Q_.splice(t,1),i=0===s.Q_.length)}if(i)return n.queries.delete(r),n.onUnlisten(r)}(t,o)));const a=s.docs.has(n);!a&&s.fromCache?i.reject(new Wi(Qi.UNAVAILABLE,"Failed to get document because the client is offline.")):a&&s.fromCache&&r&&"server"===r.source?i.reject(new Wi(Qi.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(s)},error:t=>i.reject(t)}),o=new Sh(Go(n.path),s,{includeMetadataChanges:!0,Z_:!0});return async function(t,e){const n=Gi(t),r=e.query;let i=!1,s=n.queries.get(r);if(s||(i=!0,s=new wh),i)try{s.q_=await n.onListen(r)}catch(t){const n=gh(t,`Initialization of query '${ta(e.query)}' failed`);return void e.onError(n)}n.queries.set(r,s),s.Q_.push(e),e.U_(n.onlineState),s.q_&&e.W_(s.q_)&&Th(n)}(t,o)}(await nl(t),t.asyncQueue,e,n,r))),r.promise}function il(t){const e={};return void 0!==t.timeoutSeconds&&(e.timeoutSeconds=t.timeoutSeconds),e}const sl=new Map;function ol(t){if(!gs.isDocumentKey(t))throw new Wi(Qi.INVALID_ARGUMENT,`Invalid document reference. Document references must have an even number of segments, but ${t} has ${t.length}.`)}function al(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=`${t.substring(0,20)}...`),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";{const e=function(t){return t.constructor?t.constructor.name:null}(t);return e?`a custom ${e} object`:"an object"}}return"function"==typeof t?"a function":Ki()}function cl(t,e){if("_delegate"in t&&(t=t._delegate),!(t instanceof e)){if(e.name===t.constructor.name)throw new Wi(Qi.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const n=al(t);throw new Wi(Qi.INVALID_ARGUMENT,`Expected type '${e.name}', but it was: ${n}`)}}return t}class ul{constructor(t){var e,n;if(void 0===t.host){if(void 0!==t.ssl)throw new Wi(Qi.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host="firestore.googleapis.com",this.ssl=!0}else this.host=t.host,this.ssl=null===(e=t.ssl)||void 0===e||e;if(this.credentials=t.credentials,this.ignoreUndefinedProperties=!!t.ignoreUndefinedProperties,this.localCache=t.localCache,void 0===t.cacheSizeBytes)this.cacheSizeBytes=41943040;else{if(-1!==t.cacheSizeBytes&&t.cacheSizeBytes<1048576)throw new Wi(Qi.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=t.cacheSizeBytes}(function(t,e,n,r){if(!0===e&&!0===r)throw new Wi(Qi.INVALID_ARGUMENT,"experimentalForceLongPolling and experimentalAutoDetectLongPolling cannot be used together.")})(0,t.experimentalForceLongPolling,0,t.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!t.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===t.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!t.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=il(null!==(n=t.experimentalLongPollingOptions)&&void 0!==n?n:{}),function(t){if(void 0!==t.timeoutSeconds){if(isNaN(t.timeoutSeconds))throw new Wi(Qi.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (must not be NaN)`);if(t.timeoutSeconds<5)throw new Wi(Qi.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (minimum allowed value is 5)`);if(t.timeoutSeconds>30)throw new Wi(Qi.INVALID_ARGUMENT,`invalid long polling timeout: ${t.timeoutSeconds} (maximum allowed value is 30)`)}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!t.useFetchStreams}isEqual(t){return this.host===t.host&&this.ssl===t.ssl&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.experimentalForceLongPolling===t.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===t.experimentalAutoDetectLongPolling&&function(t,e){return t.timeoutSeconds===e.timeoutSeconds}(this.experimentalLongPollingOptions,t.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===t.ignoreUndefinedProperties&&this.useFetchStreams===t.useFetchStreams}}class hl{constructor(t,e,n,r){this._authCredentials=t,this._appCheckCredentials=e,this._databaseId=n,this._app=r,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new ul({}),this._settingsFrozen=!1}get app(){if(!this._app)throw new Wi(Qi.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return void 0!==this._terminateTask}_setSettings(t){if(this._settingsFrozen)throw new Wi(Qi.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new ul(t),void 0!==t.credentials&&(this._authCredentials=function(t){if(!t)return new Ji;switch(t.type){case"firstParty":return new ns(t.sessionIndex||"0",t.iamToken||null,t.authTokenFactory||null);case"provider":return t.client;default:throw new Wi(Qi.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(t.credentials))}_getSettings(){return this._settings}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return this._terminateTask||(this._terminateTask=this._terminate()),this._terminateTask}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(t){const e=sl.get(t);e&&(ji("ComponentProvider","Removing Datastore"),sl.delete(t),e.terminate())}(this),Promise.resolve()}}class ll{constructor(t,e,n){this.converter=e,this._query=n,this.type="query",this.firestore=t}withConverter(t){return new ll(this.firestore,t,this._query)}}class dl{constructor(t,e,n){this.converter=e,this._key=n,this.type="document",this.firestore=t}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new fl(this.firestore,this.converter,this._key.path.popLast())}withConverter(t){return new dl(this.firestore,t,this._key)}}class fl extends ll{constructor(t,e,n){super(t,e,Go(n)),this._path=n,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const t=this._path.popLast();return t.isEmpty()?null:new dl(this.firestore,null,new gs(t))}withConverter(t){return new fl(this.firestore,t,this._path)}}function pl(t,e,...n){if(t=y(t),1===arguments.length&&(e=os.newId()),function(t,e,n){if(!n)throw new Wi(Qi.INVALID_ARGUMENT,`Function ${t}() cannot be called with an empty ${e}.`)}("doc","path",e),t instanceof hl){const r=ds.fromString(e,...n);return ol(r),new dl(t,null,new gs(r))}{if(!(t instanceof dl||t instanceof fl))throw new Wi(Qi.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=t._path.child(ds.fromString(e,...n));return ol(r),new dl(t.firestore,t instanceof fl?t.converter:null,new gs(r))}}class gl{constructor(){this.Xa=Promise.resolve(),this.eu=[],this.tu=!1,this.nu=[],this.ru=null,this.iu=!1,this.su=!1,this.ou=[],this.jo=new Ou(this,"async_queue_retry"),this._u=()=>{const t=Ru();t&&ji("AsyncQueue","Visibility state changed to "+t.visibilityState),this.jo.Ko()};const t=Ru();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._u)}get isShuttingDown(){return this.tu}enqueueAndForget(t){this.enqueue(t)}enqueueAndForgetEvenWhileRestricted(t){this.au(),this.uu(t)}enterRestrictedMode(t){if(!this.tu){this.tu=!0,this.su=t||!1;const e=Ru();e&&"function"==typeof e.removeEventListener&&e.removeEventListener("visibilitychange",this._u)}}enqueue(t){if(this.au(),this.tu)return new Promise((()=>{}));const e=new Xi;return this.uu((()=>this.tu&&this.su?Promise.resolve():(t().then(e.resolve,e.reject),e.promise))).then((()=>e.promise))}enqueueRetryable(t){this.enqueueAndForget((()=>(this.eu.push(t),this.cu())))}async cu(){if(0!==this.eu.length){try{await this.eu[0](),this.eu.shift(),this.jo.reset()}catch(t){if(!As(t))throw t;ji("AsyncQueue","Operation failed with retryable error: "+t)}this.eu.length>0&&this.jo.qo((()=>this.cu()))}}uu(t){const e=this.Xa.then((()=>(this.iu=!0,t().catch((t=>{this.ru=t,this.iu=!1;const e=function(t){let e=t.message||"";return t.stack&&(e=t.stack.includes(t.message)?t.stack:t.message+"\n"+t.stack),e}(t);throw $i("INTERNAL UNHANDLED ERROR: ",e),t})).then((t=>(this.iu=!1,t))))));return this.Xa=e,e}enqueueAfterDelay(t,e,n){this.au(),this.ou.indexOf(t)>-1&&(e=0);const r=ph.createAndSchedule(this,t,e,n,(t=>this.lu(t)));return this.nu.push(r),r}au(){this.ru&&Ki()}verifyOperationInProgress(){}async hu(){let t;do{t=this.Xa,await t}while(t!==this.Xa)}Pu(t){for(const e of this.nu)if(e.timerId===t)return!0;return!1}Iu(t){return this.hu().then((()=>{this.nu.sort(((t,e)=>t.targetTimeMs-e.targetTimeMs));for(const e of this.nu)if(e.skipDelay(),"all"!==t&&e.timerId===t)break;return this.hu()}))}Tu(t){this.ou.push(t)}lu(t){const e=this.nu.indexOf(t);this.nu.splice(e,1)}}class ml extends hl{constructor(t,e,n,r){super(t,e,n,r),this.type="firestore",this._queue=new gl,this._persistenceKey=(null==r?void 0:r.name)||"[DEFAULT]"}_terminate(){return this._firestoreClient||vl(this),this._firestoreClient.terminate()}}function yl(t){return t._firestoreClient||vl(t),t._firestoreClient.verifyNotTerminated(),t._firestoreClient}function vl(t){var e,n,r;const i=t._freezeSettings(),s=function(t,e,n,r){return new Zs(t,e,n,r.host,r.ssl,r.experimentalForceLongPolling,r.experimentalAutoDetectLongPolling,il(r.experimentalLongPollingOptions),r.useFetchStreams)}(t._databaseId,(null===(e=t._app)||void 0===e?void 0:e.options.appId)||"",t._persistenceKey,i);t._firestoreClient=new Jh(t._authCredentials,t._appCheckCredentials,t._queue,s),(null===(n=i.localCache)||void 0===n?void 0:n._offlineComponentProvider)&&(null===(r=i.localCache)||void 0===r?void 0:r._onlineComponentProvider)&&(t._firestoreClient._uninitializedComponentsProvider={_offlineKind:i.localCache.kind,_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider})}class wl{constructor(t){this._byteString=t}static fromBase64String(t){try{return new wl(Ks.fromBase64String(t))}catch(t){throw new Wi(Qi.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+t)}}static fromUint8Array(t){return new wl(Ks.fromUint8Array(t))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(t){return this._byteString.isEqual(t._byteString)}}class bl{constructor(...t){for(let e=0;e<t.length;++e)if(0===t[e].length)throw new Wi(Qi.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new ps(t)}isEqual(t){return this._internalPath.isEqual(t._internalPath)}}class El{constructor(t){this._methodName=t}}class _l{constructor(t,e){if(!isFinite(t)||t<-90||t>90)throw new Wi(Qi.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Wi(Qi.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}get latitude(){return this._lat}get longitude(){return this._long}isEqual(t){return this._lat===t._lat&&this._long===t._long}toJSON(){return{latitude:this._lat,longitude:this._long}}_compareTo(t){return as(this._lat,t._lat)||as(this._long,t._long)}}const Tl=/^__.*__$/;class Sl{constructor(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}toMutation(t,e){return new $a(t,this.data,this.fieldMask,e,this.fieldTransforms)}}function Il(t){switch(t){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ki()}}class Cl{constructor(t,e,n,r,i,s){this.settings=t,this.databaseId=e,this.serializer=n,this.ignoreUndefinedProperties=r,void 0===i&&this.Eu(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get du(){return this.settings.du}Au(t){return new Cl(Object.assign(Object.assign({},this.settings),t),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}Ru(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Au({path:n,Vu:!1});return r.mu(t),r}fu(t){var e;const n=null===(e=this.path)||void 0===e?void 0:e.child(t),r=this.Au({path:n,Vu:!1});return r.Eu(),r}gu(t){return this.Au({path:void 0,Vu:!0})}pu(t){return Ml(t,this.settings.methodName,this.settings.yu||!1,this.path,this.settings.wu)}contains(t){return void 0!==this.fieldMask.find((e=>t.isPrefixOf(e)))||void 0!==this.fieldTransforms.find((e=>t.isPrefixOf(e.field)))}Eu(){if(this.path)for(let t=0;t<this.path.length;t++)this.mu(this.path.get(t))}mu(t){if(0===t.length)throw this.pu("Document fields must not be empty");if(Il(this.du)&&Tl.test(t))throw this.pu('Document fields cannot begin and end with "__"')}}class Al{constructor(t,e,n){this.databaseId=t,this.ignoreUndefinedProperties=e,this.serializer=n||Lu(t)}Su(t,e,n,r=!1){return new Cl({du:t,methodName:e,wu:n,path:ps.emptyPath(),Vu:!1,yu:r},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}class Dl extends El{_toFieldTransform(t){if(2!==t.du)throw 1===t.du?t.pu(`${this._methodName}() can only appear at the top level of your update data`):t.pu(`${this._methodName}() cannot be used with set() unless you pass {merge:true}`);return t.fieldMask.push(t.path),null}isEqual(t){return t instanceof Dl}}function Nl(t,e){if(kl(t=y(t)))return xl("Unsupported field value:",e,t),function(t,e){const n={};return Vs(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Ps(t,((t,r)=>{const i=Nl(r,e.Ru(t));null!=i&&(n[t]=i)})),{mapValue:{fields:n}}}(t,e);if(t instanceof El)return function(t,e){if(!Il(e.du))throw e.pu(`${t._methodName}() can only be used with update() and set()`);if(!e.path)throw e.pu(`${t._methodName}() is not currently supported inside arrays`);const n=t._toFieldTransform(e);n&&e.fieldTransforms.push(n)}(t,e),null;if(void 0===t&&e.ignoreUndefinedProperties)return null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.settings.Vu&&4!==e.du)throw e.pu("Nested arrays are not supported");return function(t,e){const n=[];let r=0;for(const i of t){let t=Nl(i,e.gu(r));null==t&&(t={nullValue:"NULL_VALUE"}),n.push(t),r++}return{arrayValue:{values:n}}}(t,e)}return function(t,e){if(null===(t=y(t)))return{nullValue:"NULL_VALUE"};if("number"==typeof t)return wa(e.serializer,t);if("boolean"==typeof t)return{booleanValue:t};if("string"==typeof t)return{stringValue:t};if(t instanceof Date){const n=us.fromDate(t);return{timestampValue:bc(e.serializer,n)}}if(t instanceof us){const n=new us(t.seconds,1e3*Math.floor(t.nanoseconds/1e3));return{timestampValue:bc(e.serializer,n)}}if(t instanceof _l)return{geoPointValue:{latitude:t.latitude,longitude:t.longitude}};if(t instanceof wl)return{bytesValue:Ec(e.serializer,t._byteString)};if(t instanceof dl){const n=e.databaseId,r=t.firestore._databaseId;if(!r.isEqual(n))throw e.pu(`Document reference is for database ${r.projectId}/${r.database} but should be for database ${n.projectId}/${n.database}`);return{referenceValue:Sc(t.firestore._databaseId||e.databaseId,t._key.path)}}throw e.pu(`Unsupported field value: ${al(t)}`)}(t,e)}function kl(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof us||t instanceof _l||t instanceof wl||t instanceof dl||t instanceof El)}function xl(t,e,n){if(!kl(n)||!function(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}(n)){const r=al(n);throw"an object"===r?e.pu(t+" a custom object"):e.pu(t+" "+r)}}function Rl(t,e,n){if((e=y(e))instanceof bl)return e._internalPath;if("string"==typeof e)return Ol(t,e);throw Ml("Field path arguments must be of type string or ",t,!1,void 0,n)}const Ll=new RegExp("[~\\*/\\[\\]]");function Ol(t,e,n){if(e.search(Ll)>=0)throw Ml(`Invalid field path (${e}). Paths must not contain '~', '*', '/', '[', or ']'`,t,!1,void 0,n);try{return new bl(...e.split("."))._internalPath}catch(r){throw Ml(`Invalid field path (${e}). Paths must not be empty, begin with '.', end with '.', or contain '..'`,t,!1,void 0,n)}}function Ml(t,e,n,r,i){const s=r&&!r.isEmpty(),o=void 0!==i;let a=`Function ${e}() called with invalid data`;n&&(a+=" (via `toFirestore()`)"),a+=". ";let c="";return(s||o)&&(c+=" (found",s&&(c+=` in field ${r}`),o&&(c+=` in document ${i}`),c+=")"),new Wi(Qi.INVALID_ARGUMENT,a+t+c)}function Pl(t,e){return t.some((t=>t.isEqual(e)))}class Vl{constructor(t,e,n,r,i){this._firestore=t,this._userDataWriter=e,this._key=n,this._document=r,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new dl(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const t=new Fl(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(t)}return this._userDataWriter.convertValue(this._document.data.value)}}get(t){if(this._document){const e=this._document.data.field(Ul("DocumentSnapshot.get",t));if(null!==e)return this._userDataWriter.convertValue(e)}}}class Fl extends Vl{data(){return super.data()}}function Ul(t,e){return"string"==typeof e?Ol(t,e):e instanceof bl?e._internalPath:e._delegate._internalPath}class Bl{convertValue(t,e="none"){switch(no(t)){case 0:return null;case 1:return t.booleanValue;case 2:return Qs(t.integerValue||t.doubleValue);case 3:return this.convertTimestamp(t.timestampValue);case 4:return this.convertServerTimestamp(t,e);case 5:return t.stringValue;case 6:return this.convertBytes(Ws(t.bytesValue));case 7:return this.convertReference(t.referenceValue);case 8:return this.convertGeoPoint(t.geoPointValue);case 9:return this.convertArray(t.arrayValue,e);case 10:return this.convertObject(t.mapValue,e);default:throw Ki()}}convertObject(t,e){return this.convertObjectMap(t.fields,e)}convertObjectMap(t,e="none"){const n={};return Ps(t,((t,r)=>{n[t]=this.convertValue(r,e)})),n}convertGeoPoint(t){return new _l(Qs(t.latitude),Qs(t.longitude))}convertArray(t,e){return(t.values||[]).map((t=>this.convertValue(t,e)))}convertServerTimestamp(t,e){switch(e){case"previous":const n=Ys(t);return null==n?null:this.convertValue(n,e);case"estimate":return this.convertTimestamp(Js(t));default:return null}}convertTimestamp(t){const e=Gs(t);return new us(e.seconds,e.nanos)}convertDocumentKey(t,e){const n=ds.fromString(t);Hi(zc(n));const r=new to(n.get(1),n.get(3)),i=new gs(n.popFirst(5));return r.isEqual(e)||$i(`Document ${i} contains a document reference within a different database (${r.projectId}/${r.database}) which is not supported. It will be treated as a reference in the current database (${e.projectId}/${e.database}) instead.`),i}}class jl{constructor(t,e){this.hasPendingWrites=t,this.fromCache=e}isEqual(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache}}class $l extends Vl{constructor(t,e,n,r,i,s){super(t,e,n,r,s),this._firestore=t,this._firestoreImpl=t,this.metadata=i}exists(){return super.exists()}data(t={}){if(this._document){if(this._converter){const e=new ql(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(e,t)}return this._userDataWriter.convertValue(this._document.data.value,t.serverTimestamps)}}get(t,e={}){if(this._document){const n=this._document.data.field(Ul("DocumentSnapshot.get",t));if(null!==n)return this._userDataWriter.convertValue(n,e.serverTimestamps)}}}class ql extends $l{data(t={}){return super.data(t)}}function zl(t){t=cl(t,dl);const e=cl(t.firestore,ml);return rl(yl(e),t._key).then((n=>function(t,e,n){const r=n.docs.get(e._key),i=new Kl(t);return new $l(t,i,e._key,r,new jl(n.hasPendingWrites,n.fromCache),e.converter)}(e,t,n)))}class Kl extends Bl{constructor(t){super(),this.firestore=t}convertBytes(t){return new wl(t)}convertReference(t){const e=this.convertDocumentKey(t,this.firestore._databaseId);return new dl(this.firestore,null,e)}}function Hl(t,e){return function(t,e){const n=new Xi;return t.asyncQueue.enqueueAndForget((async()=>async function(t,e,n){const r=Qh(t);try{const t=await function(t,e){const n=Gi(t),r=us.now(),i=e.reduce(((t,e)=>t.add(e.key)),ga());let s,o;return n.persistence.runTransaction("Locally write mutations","readwrite",(t=>{let a=oa(),c=ga();return n.os.getEntries(t,i).next((t=>{a=t,a.forEach(((t,e)=>{e.isValidDocument()||(c=c.add(t))}))})).next((()=>n.localDocuments.getOverlayedDocuments(t,a))).next((i=>{s=i;const o=[];for(const t of e){const e=Ua(t,s.get(t.key).overlayedDocument);null!=e&&o.push(new $a(t.key,e,vo(e.value.mapValue),La.exists(!0)))}return n.mutationQueue.addMutationBatch(t,r,o,e)})).next((e=>{o=e;const r=e.applyToLocalDocumentSet(s,c);return n.documentOverlayCache.saveOverlays(t,e.batchId,r)}))})).then((()=>({batchId:o.batchId,changes:ua(s)})))}(r.localStore,e);r.sharedClientState.addPendingMutation(t.batchId),function(t,e,n){let r=t.Da[t.currentUser.toKey()];r||(r=new Fs(as)),r=r.insert(e,n),t.Da[t.currentUser.toKey()]=r}(r,t.batchId,n),await Kh(r,t.changes),await nh(r.remoteStore)}catch(t){const e=gh(t,"Failed to persist write");n.reject(e)}}(await function(t){return el(t).then((t=>t.syncEngine))}(t),e,n))),n.promise}(yl(t),e)}new WeakMap,function(t,e=!0){Fi="10.7.2",et(new v("firestore",((t,{instanceIdentifier:n,options:r})=>{const i=t.getProvider("app").getImmediate(),s=new ml(new ts(t.getProvider("auth-internal")),new is(t.getProvider("app-check-internal")),function(t,e){if(!Object.prototype.hasOwnProperty.apply(t.options,["projectId"]))throw new Wi(Qi.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new to(t.options.projectId,e)}(i,n),i);return r=Object.assign({useFetchStreams:e},r),s._setSettings(r),s}),"PUBLIC").setMultipleInstances(!0)),st(Pi,"4.4.1",t),st(Pi,"4.4.1","esm2017")}();var Gl=n(193),Ql=n(128),Wl=function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};const Xl="advanced",Yl=function(t,e){const n="string"==typeof t?t:"(default)",r=function(t,e){const n=t.container.getProvider("heartbeat").getImmediate({optional:!0});return n&&n.triggerHeartbeat(),t.container.getProvider(e)}("object"==typeof t?t:function(t=X){const e=J.get(t);if(!e&&t===X&&c())return it();if(!e)throw nt.create("no-app",{appName:t});return e}(),"firestore").getImmediate({identifier:n});if(!r._initialized){const t=(t=>{const e=(t=>{var e,n;return null===(n=null===(e=a())||void 0===e?void 0:e.emulatorHosts)||void 0===n?void 0:n[t]})(t);if(!e)return;const n=e.lastIndexOf(":");if(n<=0||n+1===e.length)throw new Error(`Invalid host ${e} with no separate hostname and port!`);const r=parseInt(e.substring(n+1),10);return"["===e[0]?[e.substring(1,n-1),r]:[e.substring(0,n),r]})("firestore");t&&function(t,e,n,r={}){var i;const s=(t=cl(t,hl))._getSettings(),a=`${e}:${n}`;if("firestore.googleapis.com"!==s.host&&s.host!==a&&qi("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used."),t._setSettings(Object.assign(Object.assign({},s),{host:a,ssl:!1})),r.mockUserToken){let e,n;if("string"==typeof r.mockUserToken)e=r.mockUserToken,n=Vi.MOCK_USER;else{e=function(t,e){if(t.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const n=e||"demo-project",r=t.iat||0,i=t.sub||t.user_id;if(!i)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const s=Object.assign({iss:`https://securetoken.google.com/${n}`,aud:n,iat:r,exp:r+3600,auth_time:r,sub:i,user_id:i,firebase:{sign_in_provider:"custom",identities:{}}},t);return[o(JSON.stringify({alg:"none",type:"JWT"})),o(JSON.stringify(s)),""].join(".")}(r.mockUserToken,null===(i=t._app)||void 0===i?void 0:i.options.projectId);const s=r.mockUserToken.sub||r.mockUserToken.user_id;if(!s)throw new Wi(Qi.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");n=new Vi(s)}t._authCredentials=new Zi(new Yi(e,n))}}(r,...t)}return r}(it("novice"===Xl?{apiKey:"AIzaSyDPiIf3b-npnhE1yUe6zh71rH0Ao8LKeTo",authDomain:"sinchonattendance.firebaseapp.com",databaseURL:"https://sinchonattendance-default-rtdb.firebaseio.com",projectId:"sinchonattendance",storageBucket:"sinchonattendance.appspot.com",messagingSenderId:"502890463273",appId:"1:502890463273:web:8da140c037f1f532e09c38",measurementId:"G-ND0CDPHZ3Z"}:{apiKey:"AIzaSyC2csBRWTvcDJY02-v182SdOFohVgnh170",authDomain:"sinchonattendanceadvanced.firebaseapp.com",projectId:"sinchonattendanceadvanced",storageBucket:"sinchonattendanceadvanced.appspot.com",messagingSenderId:"458774138568",appId:"1:458774138568:web:ee7151c3c3aef58a489ffd",measurementId:"G-70V4V9HH7Z"})),Jl=pl(Yl,"attendance",String((0,Gl.$I)())),Zl=pl(Yl,"secret",String((0,Gl.$I)()));function td(){return Wl(this,void 0,void 0,(function*(){return(yield zl(Jl)).data()}))}function ed(){var t,e;return Wl(this,void 0,void 0,(function*(){const n=yield zl(Zl),r=null===(t=n.data())||void 0===t?void 0:t.secretCode,i=null===(e=n.data())||void 0===e?void 0:e.startTime;return{secretCode:r,secretCodeStartTime:(0,Ql.W)(i)}}))}function nd(t,e){return Wl(this,void 0,void 0,(function*(){yield function(t,e,n,...r){t=cl(t,dl);const i=cl(t.firestore,ml),s=function(t){const e=t._freezeSettings(),n=Lu(t._databaseId);return new Al(t._databaseId,!!e.ignoreUndefinedProperties,n)}(i);let o;return o="string"==typeof(e=y(e))||e instanceof bl?function(t,e,n,r,i,s){const o=t.Su(1,e,n),a=[Rl(e,r,n)],c=[i];if(s.length%2!=0)throw new Wi(Qi.INVALID_ARGUMENT,`Function ${e}() needs to be called with an even number of arguments that alternate between field names and values.`);for(let t=0;t<s.length;t+=2)a.push(Rl(e,s[t])),c.push(s[t+1]);const u=[],h=yo.empty();for(let t=a.length-1;t>=0;--t)if(!Pl(u,a[t])){const e=a[t];let n=c[t];n=y(n);const r=o.fu(e);if(n instanceof Dl)u.push(e);else{const t=Nl(n,r);null!=t&&(u.push(e),h.set(e,t))}}const l=new qs(u);return new Sl(h,l,o.fieldTransforms)}(s,"updateDoc",t._key,e,n,r):function(t,e,n,r){const i=t.Su(1,e,n);xl("Data must be an object, but it was:",i,r);const s=[],o=yo.empty();Ps(r,((t,r)=>{const a=Ol(e,t,n);r=y(r);const c=i.fu(a);if(r instanceof Dl)s.push(a);else{const t=Nl(r,c);null!=t&&(s.push(a),o.set(a,t))}}));const a=new qs(s);return new Sl(o,a,i.fieldTransforms)}(s,"updateDoc",t._key,e),Hl(i,[o.toMutation(t._key,La.exists(!0))])}(Jl,{[t]:e})}))}},365:(t,e,n)=>{var r=n(312),i=n(783),s=n(193),o=n(379),a=n.n(o),c=n(795),u=n.n(c),h=n(569),l=n.n(h),d=n(565),f=n.n(d),p=n(216),g=n.n(p),m=n(589),y=n.n(m),v=n(426),w={};w.styleTagTransform=y(),w.setAttributes=f(),w.insert=l().bind(null,"head"),w.domAPI=u(),w.insertStyleElement=g(),a()(v.Z,w),v.Z&&v.Z.locals&&v.Z.locals;var b=n(128),E=n(183),_=function(t,e,n,r){return new(n||(n=Promise))((function(i,s){function o(t){try{c(r.next(t))}catch(t){s(t)}}function a(t){try{c(r.throw(t))}catch(t){s(t)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(o,a)}c((r=r.apply(t,e||[])).next())}))};const T=document.querySelector(".attendForm"),S=document.querySelector(".attendInput"),I=document.querySelector(".attendSubmit"),C=document.querySelector(".talking"),A=document.querySelector(".attendFormContainer"),D={attendStep:1,userHandle:"",thisWeekAttendance:{},thisWeekSecretCode:"",secretCodeStartTime:""};window.addEventListener("load",(()=>{C.textContent="백준 핸들을 입력해 주세요.",0!==(0,s.$I)()||alert("강의 날짜가 아닙니다.")}));const N=document.querySelector(".timer"),k=document.querySelector(".timerTitle");window.addEventListener("load",(()=>{const t=document.querySelector("#navbar-title");console.log(i.tn),t.textContent="novice"===i.tn?"알고리즘 캠프 초급 출석확인":"알고리즘 캠프 중급 출석확인"})),window.addEventListener("load",(()=>_(void 0,void 0,void 0,(function*(){const t=yield(0,i.Q5)();if(!t||"000000"===t.secretCodeStartTime)return C.textContent=r.$B.YET_STARTED,S.disabled=!0,I.disabled=!0,S.value="",k.textContent="강사진이 출석코드를 세팅하면 새로고침해 주세요.",void(N.textContent="");const{secretCodeStartTime:e}=t,n=(0,s.By)(e,r.Nk),o=(0,s.Xn)(),a=(0,s.eS)(o,n);Math.abs(a)>r.Nk||a<0?k.textContent="출석 시간이 아닙니다.":(k.textContent="남은 출석 시간",N.textContent=(0,b.k)(a,":"),D.countDownInterval=(0,s.Wt)(a,(t=>{N.textContent=(0,b.k)(t,":")}),(()=>{k.textContent="출석 시간이 지났습니다.",S.disabled=!0,I.disabled=!0})))})))),window.addEventListener("load",(function(){T.addEventListener("submit",(function(t){return _(this,void 0,void 0,(function*(){t.preventDefault(),console.log("사용자의 제출");const e=S.value;if(!e)return void(1===D.attendStep&&C.textContent!==r.$B.ALREADY_FINISHED&&C.textContent!==r.$B.END?alert("핸들을 입력해 주세요"):alert("출석코드를 입력해 주세요"));if(2==D.attendStep)return yield function(t,e){return _(this,void 0,void 0,(function*(){t==e?(yield(0,i.es)(D.userHandle,!0),C.textContent=r.$B.END,A.style.display="none",D.attendStep=1):C.textContent=r.$B.TRY_AGAIN}))}(D.thisWeekSecretCode,e),void T.reset();C.textContent=r.$B.LOADING;const n=yield function(){return _(this,void 0,void 0,(function*(){try{return{thisWeekAttendance:yield(0,i.B3)(),thisWeekSecretCode:yield(0,i.Q5)()}}catch(t){return void(C.textContent=r.$B.DB_CONNECTION_ERROR)}}))}();if(!n)return void(C.textContent=r.$B.DB_CONNECTION_ERROR);const{thisWeekAttendance:o,thisWeekSecretCode:a}=n;if(!o||!a)return void(C.textContent=r.$B.DB_CONNECTION_ERROR);const{secretCode:c,secretCodeStartTime:u}=a;if(!c||"000000"===u)return C.textContent=r.$B.YET_STARTED,S.value="",k.textContent="강사진이 출석코드를 세팅하면 새로고침해 주세요.",N.textContent="",S.disabled=!0,I.disabled=!0,void clearInterval(D.countDownInterval);D.thisWeekAttendance=o,D.thisWeekSecretCode=c,D.secretCodeStartTime=u;const h=(0,s.Xn)();(0,s.eS)(u,h)>r.Nk?C.textContent=r.$B.ALREADY_FINISHED:(0,E.f)(o,e)?(0,E.H)(o,e)?C.textContent=r.$B.ALREADY_END:(D.userHandle=e,C.textContent=r.$B.DO_ATTENDANCE,D.attendStep=2,T.reset()):C.textContent=r.$B.HANDLE_NOT_EXIST}))}))}))},128:(t,e,n)=>{function r(t,e=""){if("number"!=typeof t)return t;const n=Math.floor(t/1e4),r=Math.floor(t%1e4/100),i=t%100;return`${n.toString().padStart(2,"0")}${e}${r.toString().padStart(2,"0")}${e}${i.toString().padStart(2,"0")}`}function i(t,e=""){if("number"!=typeof t)return t;const n=Math.floor(t/3600),r=Math.floor(t%3600/60),i=t%60;return`${n.toString().padStart(2,"0")}${e}${r.toString().padStart(2,"0")}${e}${i.toString().padStart(2,"0")}`}n.d(e,{W:()=>r,k:()=>i})},193:(t,e,n)=>{n.d(e,{$I:()=>c,By:()=>o,Wt:()=>a,Xn:()=>s,eS:()=>i});var r=n(312);function i(t,e){const n=t=>({hours:parseInt(t.substring(0,2),10),minutes:parseInt(t.substring(2,4),10),seconds:parseInt(t.substring(4,6),10)}),r=({hours:t,minutes:e,seconds:n})=>3600*t+60*e+n;return r(n(e))-r(n(t))}function s(){const t=new Date;return("0"+t.getHours()).slice(-2)+("0"+t.getMinutes()).slice(-2)+("0"+t.getSeconds()).slice(-2)}function o(t,e){const n=parseInt(t.substring(0,2),10),r=parseInt(t.substring(2,4),10),i=parseInt(t.substring(4,6),10)+e,s=r+Math.floor(i/60);return("0"+(n+Math.floor(s/60))%24).slice(-2)+("0"+s%60).slice(-2)+("0"+i%60).slice(-2)}function a(t,e,n){const r=Date.now()+1e3*t,i=setInterval((()=>{const t=r-Date.now();t<=0?(clearInterval(i),e(0),n()):e(Math.ceil(t/1e3))}),1e3);return i}function c(){return function(t){return t in r.p1}(t=function(){const t=new Date;return t.getFullYear().toString().slice(-2)+(t.getMonth()+1).toString().padStart(2,"0")+t.getDate().toString().padStart(2,"0")}())?r.p1[t]:0;var t}},956:t=>{t.exports="data:image/svg+xml,%3csvg xmlns=%27http://www.w3.org/2000/svg%27 viewBox=%270 0 30 30%27%3e%3cpath stroke=%27rgba%28255, 255, 255, 0.55%29%27 stroke-linecap=%27round%27 stroke-miterlimit=%2710%27 stroke-width=%272%27 d=%27M4 7h22M4 15h22M4 23h22%27/%3e%3c/svg%3e"},719:(t,e,n)=>{t.exports=n.p+"89020a7d831a37612345.png"},238:(t,e,n)=>{t.exports=n.p+"d097397f7e1c74ee5f4b.png"},9:(t,e,n)=>{t.exports=n.p+"113add31aeac3bb371b2.png"}},e={};function n(r){var i=e[r];if(void 0!==i)return i.exports;var s=e[r]={id:r,exports:{}};return t[r](s,s.exports,n),s.exports}n.m=t,n.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return n.d(e,{a:e}),e},n.d=(t,e)=>{for(var r in e)n.o(e,r)&&!n.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"==typeof window)return window}}(),n.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t;n.g.importScripts&&(t=n.g.location+"");var e=n.g.document;if(!t&&e&&(e.currentScript&&(t=e.currentScript.src),!t)){var r=e.getElementsByTagName("script");if(r.length)for(var i=r.length-1;i>-1&&!t;)t=r[i--].src}if(!t)throw new Error("Automatic publicPath is not supported in this browser");t=t.replace(/#.*$/,"").replace(/\?.*$/,"").replace(/\/[^\/]+$/,"/"),n.p=t})(),n.b=document.baseURI||self.location.href,n.nc=void 0,n(183),n(312),n(783),n(365),n(128),n(193)})();